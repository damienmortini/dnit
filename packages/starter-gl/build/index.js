class t extends Set{constructor(){super(),this._onceCallbacksMap=new Map}add(t,{once:e=!1}={}){if(e){const e=(...e)=>{t(...e),this.delete(t)};return this._onceCallbacksMap.set(t,e),super.add(e)}return super.add(t)}delete(t){return this._onceCallbacksMap.delete(t),super.delete(this._onceCallbacksMap.get(t)||t)}dispatch(t){for(const e of this)e(t)}}var e=new class extends t{constructor(){super(),this._updateBinded=this._update.bind(this),this.time=.001*window.performance.now(),this.reset(),document.addEventListener("visibilitychange",()=>{this.reset()}),this._update()}reset(){this._previousTime=.001*window.performance.now(),this.deltaTime=1/60,this.smoothDeltatime=this.deltaTime,this.timeScale=1,this.smoothTimeScale=this.timeScale}_update(){requestAnimationFrame(this._updateBinded),this.time=.001*window.performance.now(),this.deltaTime=this.time-this._previousTime,this.smoothDeltatime+=.05*(this.deltaTime-this.smoothDeltatime),this.timeScale=this.deltaTime/(1/60),this.smoothTimeScale=this.smoothDeltatime/(1/60),this._previousTime=this.time,this.dispatch()}};class i extends HTMLElement{constructor(){super(),this.noautoplay=!1,this._updateBinded=this.update.bind(this),this._pauseFlag=0,document.addEventListener("visibilitychange",()=>{document.hidden?this._pauseFlag|=4:this._pauseFlag&=-5}),new IntersectionObserver(t=>{let e=!1;for(const i of t)i.isIntersecting&&(e=!0);e?this._pauseFlag&=-3:this._pauseFlag|=2}).observe(this),window.addEventListener("blur",()=>{this._pauseFlag|=8}),window.addEventListener("focus",()=>{this._pauseFlag&=-9})}connectedCallback(){this._pauseFlag&=-17,document.hasFocus()||(this._pauseFlag|=8),this.noautoplay&&(this._pauseFlag|=1),this.update()}disconnectedCallback(){this._pauseFlag|=16}get _pauseFlag(){return this.__pauseFlag}set _pauseFlag(t){this.__pauseFlag!==t&&(this.__pauseFlag=t,this.__pauseFlag?e.delete(this._updateBinded):e.add(this._updateBinded))}get noautoplay(){return this.hasAttribute("noautoplay")}set noautoplay(t){t?this.setAttribute("noautoplay",""):this.removeAttribute("noautoplay")}play(){this._pauseFlag&=-2}pause(){this._pauseFlag|=1}get paused(){return!!this._pauseFlag}update(){}}var s="undefined"!=typeof Float32Array?Float32Array:Array;function n(t,e,i){var s=e[0],n=e[1],r=e[2],a=e[3],h=e[4],o=e[5],d=e[6],c=e[7],u=e[8],l=e[9],p=e[10],g=e[11],_=e[12],m=e[13],f=e[14],v=e[15],y=i[0],w=i[1],b=i[2],x=i[3];return t[0]=y*s+w*h+b*u+x*_,t[1]=y*n+w*o+b*l+x*m,t[2]=y*r+w*d+b*p+x*f,t[3]=y*a+w*c+b*g+x*v,y=i[4],w=i[5],b=i[6],x=i[7],t[4]=y*s+w*h+b*u+x*_,t[5]=y*n+w*o+b*l+x*m,t[6]=y*r+w*d+b*p+x*f,t[7]=y*a+w*c+b*g+x*v,y=i[8],w=i[9],b=i[10],x=i[11],t[8]=y*s+w*h+b*u+x*_,t[9]=y*n+w*o+b*l+x*m,t[10]=y*r+w*d+b*p+x*f,t[11]=y*a+w*c+b*g+x*v,y=i[12],w=i[13],b=i[14],x=i[15],t[12]=y*s+w*h+b*u+x*_,t[13]=y*n+w*o+b*l+x*m,t[14]=y*r+w*d+b*p+x*f,t[15]=y*a+w*c+b*g+x*v,t}function r(t,e){var i=new s(3);!function(t,e){var i=e[0],s=e[1],n=e[2],r=e[4],a=e[5],h=e[6],o=e[8],d=e[9],c=e[10];t[0]=Math.hypot(i,s,n),t[1]=Math.hypot(r,a,h),t[2]=Math.hypot(o,d,c)}(i,e);var n=1/i[0],r=1/i[1],a=1/i[2],h=e[0]*n,o=e[1]*r,d=e[2]*a,c=e[4]*n,u=e[5]*r,l=e[6]*a,p=e[8]*n,g=e[9]*r,_=e[10]*a,m=h+u+_,f=0;return m>0?(f=2*Math.sqrt(m+1),t[3]=.25*f,t[0]=(l-g)/f,t[1]=(p-d)/f,t[2]=(o-c)/f):h>u&&h>_?(f=2*Math.sqrt(1+h-u-_),t[3]=(l-g)/f,t[0]=.25*f,t[1]=(o+c)/f,t[2]=(p+d)/f):u>_?(f=2*Math.sqrt(1+u-h-_),t[3]=(p-d)/f,t[0]=(o+c)/f,t[1]=.25*f,t[2]=(l+g)/f):(f=2*Math.sqrt(1+_-h-u),t[3]=(o-c)/f,t[0]=(p+d)/f,t[1]=(l+g)/f,t[2]=.25*f),t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});class a extends Float32Array{constructor(t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return super(t),this}set x(t){this[12]=t}get x(){return this[12]}set y(t){this[13]=t}get y(){return this[13]}set z(t){this[14]=t}get z(){return this[14]}set w(t){this[15]=t}get w(){return this[15]}set(t,e,i,s,n,r,a,h,o,d,c,u,l,p,g,_){return t.length?this.copy(t):(function(t,e,i,s,n,r,a,h,o,d,c,u,l,p,g,_,m){t[0]=e,t[1]=i,t[2]=s,t[3]=n,t[4]=r,t[5]=a,t[6]=h,t[7]=o,t[8]=d,t[9]=c,t[10]=u,t[11]=l,t[12]=p,t[13]=g,t[14]=_,t[15]=m}(this,t,e,i,s,n,r,a,h,o,d,c,u,l,p,g,_),this)}translate(t,e=this){var i,s,n,r,a,h,o,d,c,u,l,p,g,_,m,f,v,y;return i=this,s=e,f=(n=t)[0],v=n[1],y=n[2],s===i?(i[12]=s[0]*f+s[4]*v+s[8]*y+s[12],i[13]=s[1]*f+s[5]*v+s[9]*y+s[13],i[14]=s[2]*f+s[6]*v+s[10]*y+s[14],i[15]=s[3]*f+s[7]*v+s[11]*y+s[15]):(r=s[0],a=s[1],h=s[2],o=s[3],d=s[4],c=s[5],u=s[6],l=s[7],p=s[8],g=s[9],_=s[10],m=s[11],i[0]=r,i[1]=a,i[2]=h,i[3]=o,i[4]=d,i[5]=c,i[6]=u,i[7]=l,i[8]=p,i[9]=g,i[10]=_,i[11]=m,i[12]=r*f+d*v+p*y+s[12],i[13]=a*f+c*v+g*y+s[13],i[14]=h*f+u*v+_*y+s[14],i[15]=o*f+l*v+m*y+s[15]),this}rotateX(t,e=this){var i,s,n,r,a,h,o,d,c,u,l,p,g;return i=this,s=e,n=t,r=Math.sin(n),a=Math.cos(n),h=s[4],o=s[5],d=s[6],c=s[7],u=s[8],l=s[9],p=s[10],g=s[11],s!==i&&(i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15]),i[4]=h*a+u*r,i[5]=o*a+l*r,i[6]=d*a+p*r,i[7]=c*a+g*r,i[8]=u*a-h*r,i[9]=l*a-o*r,i[10]=p*a-d*r,i[11]=g*a-c*r,this}rotateY(t,e=this){var i,s,n,r,a,h,o,d,c,u,l,p,g;return i=this,s=e,n=t,r=Math.sin(n),a=Math.cos(n),h=s[0],o=s[1],d=s[2],c=s[3],u=s[8],l=s[9],p=s[10],g=s[11],s!==i&&(i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15]),i[0]=h*a-u*r,i[1]=o*a-l*r,i[2]=d*a-p*r,i[3]=c*a-g*r,i[8]=h*r+u*a,i[9]=o*r+l*a,i[10]=d*r+p*a,i[11]=c*r+g*a,this}rotateZ(t,e=this){var i,s,n,r,a,h,o,d,c,u,l,p,g;return i=this,s=e,n=t,r=Math.sin(n),a=Math.cos(n),h=s[0],o=s[1],d=s[2],c=s[3],u=s[4],l=s[5],p=s[6],g=s[7],s!==i&&(i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15]),i[0]=h*a+u*r,i[1]=o*a+l*r,i[2]=d*a+p*r,i[3]=c*a+g*r,i[4]=u*a-h*r,i[5]=l*a-o*r,i[6]=p*a-d*r,i[7]=g*a-c*r,this}scale(t,e=this){var i,s,n,r,a,h;return i=this,s=e,r=(n="number"==typeof t?[t,t,t]:t)[0],a=n[1],h=n[2],i[0]=s[0]*r,i[1]=s[1]*r,i[2]=s[2]*r,i[3]=s[3]*r,i[4]=s[4]*a,i[5]=s[5]*a,i[6]=s[6]*a,i[7]=s[7]*a,i[8]=s[8]*h,i[9]=s[9]*h,i[10]=s[10]*h,i[11]=s[11]*h,i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],this}multiply(t,e){return e?n(this,t,e):n(this,this,t),this}identity(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}copy(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}fromPerspective({fov:t,aspectRatio:e,near:i,far:s}){return function(t,e,i,s,n){var r,a=1/Math.tan(e/2);t[0]=a/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(r=1/(s-n),t[10]=(n+s)*r,t[14]=2*n*s*r):(t[10]=-1,t[14]=-2*s)}(this,t,e,i,s),this}fromQuaternion(t){var e,i,s,n,r,a,h,o,d,c,u,l,p,g,_,m,f,v;return e=this,s=(i=t)[0],n=i[1],r=i[2],a=i[3],c=s*(h=s+s),u=n*h,l=n*(o=n+n),p=r*h,g=r*o,_=r*(d=r+r),m=a*h,f=a*o,v=a*d,e[0]=1-l-_,e[1]=u+v,e[2]=p-f,e[3]=0,e[4]=u-v,e[5]=1-c-_,e[6]=g+m,e[7]=0,e[8]=p+f,e[9]=g-m,e[10]=1-c-l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}setPosition(t){return this.x=t[0],this.y=t[1],this.z=t[2],this}invert(t=this){var e,i,s,n,r,a,h,o,d,c,u,l,p,g,_,m,f,v,y,w,b,x,E,T,A,M,F,S,z,P,R;return e=this,s=(i=t)[0],n=i[1],r=i[2],a=i[3],h=i[4],o=i[5],d=i[6],c=i[7],u=i[8],l=i[9],p=i[10],g=i[11],_=i[12],m=i[13],f=i[14],v=i[15],(R=(y=s*o-n*h)*(P=p*v-g*f)-(w=s*d-r*h)*(z=l*v-g*m)+(b=s*c-a*h)*(S=l*f-p*m)+(x=n*d-r*o)*(F=u*v-g*_)-(E=n*c-a*o)*(M=u*f-p*_)+(T=r*c-a*d)*(A=u*m-l*_))&&(R=1/R,e[0]=(o*P-d*z+c*S)*R,e[1]=(r*z-n*P-a*S)*R,e[2]=(m*T-f*E+v*x)*R,e[3]=(p*E-l*T-g*x)*R,e[4]=(d*F-h*P-c*M)*R,e[5]=(s*P-r*F+a*M)*R,e[6]=(f*b-_*T-v*w)*R,e[7]=(u*T-p*b+g*w)*R,e[8]=(h*z-o*F+c*A)*R,e[9]=(n*F-s*z-a*A)*R,e[10]=(_*E-m*b+v*y)*R,e[11]=(l*b-u*E-g*y)*R,e[12]=(o*M-h*S-d*A)*R,e[13]=(s*S-n*M+r*A)*R,e[14]=(m*w-_*x-f*y)*R,e[15]=(u*x-l*w+p*y)*R),this}}class h{constructor({near:t=.01,far:e=1e3,aspectRatio:i=1,fov:s=Math.PI/3}={}){this._near=t,this._far=e,this._aspectRatio=i,this._fov=s,this.transform=new a,this._inverseTransform=new a,this._projection=new a,this._projectionView=new a,this._updateProjection()}set near(t){this._near=t,this._updateProjection()}get near(){return this._near}set far(t){this._far=t,this._updateProjection()}get far(){return this._far}set fov(t){this._fov=t,this._updateProjection()}get fov(){return this._fov}set aspectRatio(t){this._aspectRatio=t,this._updateProjection()}get aspectRatio(){return this._aspectRatio}get inverseTransform(){return this._inverseTransform.invert(this.transform)}get projection(){return this._projection}get projectionView(){return this._projectionView.set(this.projection).multiply(this.inverseTransform)}_updateProjection(){this._projection.fromPerspective(this)}}Object.defineProperty(h.prototype,"near",{enumerable:!0}),Object.defineProperty(h.prototype,"far",{enumerable:!0}),Object.defineProperty(h.prototype,"fov",{enumerable:!0}),Object.defineProperty(h.prototype,"aspectRatio",{enumerable:!0}),Object.defineProperty(h.prototype,"inverseTransform",{enumerable:!0}),Object.defineProperty(h.prototype,"projection",{enumerable:!0}),Object.defineProperty(h.prototype,"projectionView",{enumerable:!0});class o{constructor({width:t=1,height:e=1,depth:i=1,widthSegments:s=1,heightSegments:n=1,depthSegments:r=1,positions:a=!0,normals:h=!0,uvs:o=!0,indices:d=!0}={}){const c=[],u=[],l=[],p=[];let g=0;function _(t,e,i,s,n,r,_,m,f,v){const y=r/f,w=_/v,b=r/2,x=_/2,E=m/2,T=f+1,A=v+1;let M,F,S=0;const z={x:0,y:0,z:0};for(F=0;F<A;F++){const r=F*w-x;for(M=0;M<T;M++){const d=M*y-b;z[t]=d*s,z[e]=r*n,z[i]=E,a&&u.push(z.x,z.y,z.z),z[t]=0,z[e]=0,z[i]=m>0?1:-1,h&&l.push(z.x,z.y,z.z),o&&(p.push(M/f),p.push(1-F/v)),S+=1}}if(d)for(F=0;F<v;F++)for(M=0;M<f;M++){const t=g+M+T*F,e=g+M+T*(F+1),i=g+(M+1)+T*(F+1),s=g+(M+1)+T*F;c.push(t,e,s),c.push(e,i,s)}g+=S}_("z","y","x",-1,-1,i,e,t,r,n),_("z","y","x",1,-1,i,e,-t,r,n),_("x","z","y",1,1,t,i,e,s,r),_("x","z","y",1,-1,t,i,-e,s,r),_("x","y","z",1,-1,t,e,i,s,n),_("x","y","z",-1,-1,t,e,-i,s,n),a&&(this.positions=new Float32Array(u)),h&&(this.normals=new Float32Array(l)),o&&(this.uvs=new Float32Array(p)),d&&(c.length>65536?this.indices=new Uint32Array(c):c.length>256?this.indices=new Uint16Array(c):this.indices=new Uint8Array(c))}}class d{constructor({gl:t,mesh:e,program:i}={gl:t}){this.gl=t;const s=t.getExtension("OES_vertex_array_object");s&&(this.gl.createVertexArray=s.createVertexArrayOES.bind(s),this.gl.bindVertexArray=s.bindVertexArrayOES.bind(s)),this._vertexArray=this.gl.createVertexArray(),e&&i&&this.add({mesh:e,program:i})}add({mesh:t,program:e}={}){this.bind(),e.attributes.set(t.attributes),t.indices&&t.indices.buffer.bind(),this.unbind()}bind(){this.gl.bindVertexArray(this._vertexArray)}unbind(){this.gl.bindVertexArray(null)}}class c{constructor({gl:t,data:e,width:i,height:s,target:n=t.TEXTURE_2D,level:r=0,internalFormat:a=t.RGBA8||t.RGBA,format:h=t.RGBA,type:o=t.UNSIGNED_BYTE,minFilter:d=t.LINEAR,magFilter:c=t.LINEAR,wrapS:u=t.CLAMP_TO_EDGE,wrapT:l=t.CLAMP_TO_EDGE,flipY:p=!1,generateMipmap:g=!0}){this.gl=t,this._texture=this.gl.createTexture(),this._width=i,this._height=s,this._dataWidth=void 0,this._dataHeight=void 0,this._target=n,this._unit=0,this.level=r,this.internalFormat=a,this.format=h,this.type=o,this.minFilter=d,this.magFilter=c,this.wrapS=u,this.wrapT=l,this.flipY=p,this.data=e,this.data&&g&&this.generateMipmap()}generateMipmap(){this.bind(),this.gl.generateMipmap(this._target),this.unbind()}set data(t){this._data=t,this._data&&void 0===this._data.length&&(this._dataWidth=this._data.width||this._data.videoWidth,this._dataHeight=this._data.height||this._data.videoHeight),this.bind(),this.gl instanceof WebGLRenderingContext&&this._data&&void 0===this._data.length?this.gl.texImage2D(this._target,this.level,this.internalFormat,this.format,this.type,this._data):this.gl.texImage2D(this._target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this._data),this.unbind()}get data(){return this._data}set width(t){this._width=t,this.data=this.data}get width(){return this._width||this._dataWidth}set height(t){this._height=t,this.data=this.data}get height(){return this._height||this._dataHeight}set minFilter(t){this._minFilter!==t&&(this._minFilter=t,this.bind(),this.gl.texParameteri(this._target,this.gl.TEXTURE_MIN_FILTER,this._minFilter),this.unbind())}get minFilter(){return this._minFilter}set magFilter(t){this._magFilter!==t&&(this._magFilter=t,this.bind(),this.gl.texParameteri(this._target,this.gl.TEXTURE_MAG_FILTER,this._magFilter),this.unbind())}get magFilter(){return this._magFilter}set wrapS(t){this._wrapS!==t&&(this._wrapS=t,this.bind(),this.gl.texParameteri(this._target,this.gl.TEXTURE_WRAP_S,this._wrapS),this.unbind())}get wrapS(){return this._wrapS}set wrapT(t){this._wrapT!==t&&(this._wrapT=t,this.bind(),this.gl.texParameteri(this._target,this.gl.TEXTURE_WRAP_T,this._wrapT),this.unbind())}get wrapT(){return this._wrapT}set flipY(t){this._flipY!==t&&(this._flipY=t,this.bind(),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this._flipY),this.unbind())}get flipY(){return this._flipY}bind({unit:t=0}={}){this._unit=t,this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this._target,this._texture)}unbind({unit:t=this._unit}={}){this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this._target,null)}clone(){return new c(this)}}class u{constructor({gl:t,data:e=null,target:i=t.ARRAY_BUFFER,usage:s=t.STATIC_DRAW}={gl:t}){this.gl=t,this.target=i,this.usage=s,this._buffer=this.gl.createBuffer(),e&&(this.data=e)}set data(t){this._data=t,this.bind(),this.gl.bufferData(this.target,this._data,this.usage),this.unbind()}get data(){return this._data}bind({target:t=this.target,index:e,offset:i=0,size:s}={}){void 0===e?this.gl.bindBuffer(t,this._buffer):void 0===s?this.gl.bindBufferBase(t,e,this._buffer):this.gl.bindBufferRange(t,e,this._buffer,i,s)}unbind({target:t=this.target,index:e,offset:i=0,size:s}={}){void 0===e?this.gl.bindBuffer(t,null):void 0===s?this.gl.bindBufferBase(t,e,null):this.gl.bindBufferRange(t,e,null,i,s)}}class l{constructor({gl:t,data:e,buffer:i=new u({gl:t}),size:s=1,type:n,offset:r=0,normalized:a=!1,stride:h=0,count:o,divisor:d=0}){this.gl=t,this.buffer=i,this.size=s,this.type=n,this.offset=r,this.normalized=a,this.stride=h,this.count=o,this.divisor=d,e&&(this.data=e)}set count(t){this._count=t}get count(){return void 0===this._count?this.data.length/this.size:this._count}set type(t){this._type=t}get type(){return this._type||this._dataType}set data(t){this.buffer.data=t,this.data instanceof Float32Array||this.data instanceof Float64Array?this._dataType=this.gl.FLOAT:this.data instanceof Int8Array?this._dataType=this.gl.BYTE:this.data instanceof Int16Array?this._dataType=this.gl.SHORT:this.data instanceof Int32Array?this._dataType=this.gl.INT:this.data instanceof Uint8Array?this._dataType=this.gl.UNSIGNED_BYTE:this.data instanceof Uint16Array?this._dataType=this.gl.UNSIGNED_SHORT:this.data instanceof Uint32Array&&(this._dataType=this.gl.UNSIGNED_INT)}get data(){return this.buffer.data}}class p{constructor({gl:t,positions:e,normals:i,uvs:s,attributes:n={},indices:r}){this.gl=t,this.gl.getExtension("OES_element_index_uint"),this._drawElementsInstanced=()=>{},this._drawArraysInstanced=()=>{};const a=this.gl.getExtension("ANGLE_instanced_arrays");a?(this._drawElementsInstanced=a.drawElementsInstancedANGLE.bind(a),this._drawArraysInstanced=a.drawArraysInstancedANGLE.bind(a)):this.gl.drawElementsInstanced&&(this._drawElementsInstanced=this.gl.drawElementsInstanced.bind(this.gl),this._drawArraysInstanced=this.gl.drawArraysInstanced.bind(this.gl)),this.attributes=new Map(n.entries?n:Object.entries(n)),e&&this.attributes.set("position",new l({gl:t,data:e,size:3})),i&&this.attributes.set("normal",new l({gl:t,data:i,size:3})),s&&this.attributes.set("uv",new l({gl:t,data:s,size:2}));for(const[e,i]of this.attributes)i instanceof l||this.attributes.set(e,new l(Object.assign({gl:t},i)));!r||this.indices instanceof l||(this.indices=new l(Object.assign({gl:this.gl,buffer:new u({gl:this.gl,target:this.gl.ELEMENT_ARRAY_BUFFER})},void 0!==r.length?{data:r}:r)))}draw({mode:t=this.gl.TRIANGLES,elements:e=!!this.indices,count:i=(e?this.indices.count:this.attributes.get("position").count),offset:s=(this.indices?this.indices.offset:0),type:n=(e?this.indices.type:null),first:r=0,instanceCount:a}={}){e?void 0!==a?this._drawElementsInstanced(t,i,n,s,a):this.gl.drawElements(t,i,n,s):void 0!==a?this._drawArraysInstanced(t,r,i,a):this.gl.drawArrays(t,r,i)}}class g{static addChunks(t="void main() {}",e){for(const[i,s]of e)switch(i){case"start":t=t.replace(/^(#version .*?\n(\s*precision highp float;\s)?)?([\s\S]*)/,`$1\n${s}\n$3`);break;case"end":t=t.replace(/(}\s*$)/,`\n${s}\n$1`);break;case"main":t=t.replace(/(\bvoid\b +\bmain\b[\s\S]*?{\s*)/,`$1\n${s}\n`);break;default:t=t.replace(i,s)}return t}constructor({vertex:t="#version 300 es\n      void main() {\n        gl_Position = vec4(0., 0., 0., 1.);\n      }\n    ",fragment:e="#version 300 es\n      precision highp float;\n\n      out vec4 fragColor;\n\n      void main() {\n        fragColor = vec4(1.);\n      }\n    ",vertexChunks:i=[],fragmentChunks:s=[],uniforms:n={},dataTypeConctructors:r={Vector2:class extends Float32Array{constructor(){super(2)}},Vector3:class extends Float32Array{constructor(){super(3)}},Vector4:class extends Float32Array{constructor(){super(4)}},Matrix3:class extends Float32Array{constructor(){super([1,0,0,0,1,0,0,0,1])}},Matrix4:class extends Float32Array{constructor(){super([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},Texture:class{},TextureCube:class{}}}={}){this.uniforms=n,this.uniformTypes=new Map,this._dataTypeConctructors=r,this._vertex=g.addChunks(t,i),this._fragment=g.addChunks(e,s),this._parseUniforms()}get vertex(){return this._vertex}set vertex(t){this._vertex=t,this._parseUniforms()}get fragment(){return this._fragment}set fragment(t){this._fragment=t,this._parseUniforms()}_createUniform(t,e,i){if(i){this.uniformTypes.set(t,e+"array");for(let s=0;s<i;s++)this.uniformTypes.set(`${t}[${s}]`,e)}else this.uniformTypes.set(t,e);let s,n;if(/float|double/.test(e))s=isNaN(i)?0:new Array(i).fill(0);else if(/int|uint/.test(e))s=isNaN(i)?0:new Array(i).fill(0);else if(/sampler2D/.test(e))s=isNaN(i)?new this._dataTypeConctructors.Texture:new Array(i).fill(void 0).map(t=>new this._dataTypeConctructors.Texture);else if(/samplerCube/.test(e))s=isNaN(i)?new this._dataTypeConctructors.TextureCube:new Array(i).fill(void 0).map(t=>new this._dataTypeConctructors.TextureCube);else if(n=/(.?)vec(\d)/.exec(e)){const t=n[2];s=isNaN(i)?new this._dataTypeConctructors["Vector"+t]:new Array(i).fill(void 0).map(e=>new this._dataTypeConctructors["Vector"+t])}else if(n=/mat(\d)/.exec(e)){const t=n[1];s=isNaN(i)?new this._dataTypeConctructors["Matrix"+t]:new Array(i).fill(void 0).map(e=>new this._dataTypeConctructors["Matrix"+t])}else s=void 0;return s}_parseUniforms(){const t={};this.uniformTypes.clear();for(const e of[this.vertex,this.fragment]){const i=new Map,s=/struct\s*(.*)\s*{\s*([\s\S]*?)}/g,n=/^\s*(.[^ ]+) (.[^ ;[\]]+)\[? *(\d+)? *\]?/gm;let r;for(;r=s.exec(e);){const t=r[1],e=r[2],s={};let a;for(;a=n.exec(e);){const[,t,e,i]=a,n=parseInt(i);s[e]={type:t,arrayLength:n}}i.set(t,s)}const a=/^\s*uniform (highp|mediump|lowp)? *(.[^ ]+) (.[^ ;[\]]+)\[? *(\d+)? *\]?/gm;let h;for(;h=a.exec(e);){const[,,e,s,n]=h,r=i.get(e);if(r)for(const e of Object.keys(r)){const i=`${i}.${e}`;t[i]=this._createUniform(i,r[e].type,r[e].arrayLength)}else{const i=parseInt(n);t[s]=this._createUniform(s,e,i)}}}for(const[e,i]of Object.entries(t))e in this.uniforms||(this.uniforms[e]=i);for(const e of Object.keys(this.uniforms))e in t||delete this.uniforms[e]}}class _{constructor({gl:t,shader:e=new g,transformFeedbackVaryings:i}={gl:t}){this.gl=t,this._shader=e instanceof g?e:new g(e),this._program=t.createProgram(),this._attachedShaders=new Map,this._textureUnits=new Map,this._vertexAttribDivisor=()=>{};const s=this.gl.getExtension("ANGLE_instanced_arrays");s?this._vertexAttribDivisor=s.vertexAttribDivisorANGLE.bind(s):this.gl.vertexAttribDivisor&&(this._vertexAttribDivisor=this.gl.vertexAttribDivisor.bind(this.gl));const n=this;class r extends Map{set(e,{buffer:i,location:s=n._attributesLocations.get(e),size:r,type:a=t.FLOAT,normalized:h=!1,stride:o=0,offset:d=0,divisor:c=0}={}){if(e instanceof Map)for(const[t,i]of e)this.set(t,i);else i.bind(),void 0===s&&(-1===(s=t.getAttribLocation(n._program,e))&&console.warn(`Attribute "${e}" is missing or never used`),n._attributesLocations.set(e,s)),t.enableVertexAttribArray(s),a===t.FLOAT||a===t.HALF_FLOAT?t.vertexAttribPointer(s,r,a,h,o,d):t.vertexAttribIPointer(s,r,a,h,o,d),i.unbind(),n._vertexAttribDivisor(s,c),super.set(e,{buffer:i,size:r,type:a,normalized:h,stride:o,offset:d})}}const a=(e,i)=>{let s=n._uniformLocations.get(e);if(void 0===s&&(s=t.getUniformLocation(n._program,e),n._uniformLocations.set(e,s)),null===s)return;const r=n.uniformTypes.get(e);if("float"===r||"bool"===r)t.uniform1f(s,i);else if("vec2"===r)t.uniform2fv(s,i);else if("vec3"===r)t.uniform3fv(s,i);else if("vec4"===r)t.uniform4fv(s,i);else if("int"===r)t.uniform1i(s,i);else if("ivec2"===r)t.uniform2iv(s,i);else if("ivec3"===r)t.uniform3iv(s,i);else if("ivec4"===r)t.uniform4iv(s,i);else if("mat3"===r)t.uniformMatrix3fv(s,!1,i);else if("mat4"===r)t.uniformMatrix4fv(s,!1,i);else if(r.startsWith("sampler"))t.uniform1i(s,n._textureUnits.get(e));else if(r.endsWith("array"))for(let t=0;t<i.length;t++)a(`${e}[${t}]`,i[t]);else if(i instanceof Object)for(const t of Object.keys(i))a(`${e}.${t}`,i[t])};class h extends Map{set(t,e){void 0!==e&&(a(t,e),n._shader.uniforms[t]=e,super.set(t,e))}}i&&this.gl.transformFeedbackVaryings(this._program,i,t.INTERLEAVED_ATTRIBS),this.attributes=new r,this.uniforms=new h,this._updateShader(this.gl.VERTEX_SHADER,this._shader.vertex),this._updateShader(this.gl.FRAGMENT_SHADER,this._shader.fragment)}set vertexShader(t){this._shader.vertex=t,this._updateShader(this.gl.VERTEX_SHADER,this._shader.vertex)}get vertexShader(){return this._shader.vertex}set fragmentShader(t){this._shader.fragment=t,this._updateShader(this.gl.FRAGMENT_SHADER,this._shader.fragment)}get fragmentShader(){return this._shader.fragment}get uniformTypes(){return this._shader.uniformTypes}get textureUnits(){return this._textureUnits}use(){this.gl.useProgram(this._program)}_updateShader(t,e){if(!e)return;if(this.gl.getParameter(this.gl.VERSION).startsWith("WebGL 1.0"))if(e=(e=e.replace(/#version.*?\n/g,"")).replace(/\btexture\b/g,"texture2D"),t===this.gl.VERTEX_SHADER)e=(e=e.replace(/(^\s*)\bin\b/gm,"$1attribute")).replace(/(^\s*)\bout\b/gm,"$1varying");else{e=e.replace(/(^\s*)\bin\b/gm,"$1varying");const t=/out vec4 (.*?);/.exec(e);if(t){const i=t[1];e=(e=e.replace(/out.*?;/,"")).replace(new RegExp(`\\b${i}\\b`,"g"),"gl_FragColor")}}const i=this.gl.createShader(t);this.gl.shaderSource(i,e),this.gl.compileShader(i);const s=this.gl.getShaderInfoLog(i);if(!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)){const i=/ERROR: 0:(\d+):/.exec(s);if(i){const n=parseFloat(i[1]),r=e.split("\n"),a=t===this.gl.VERTEX_SHADER?"Vertex Shader":"Fragment Shader";throw console.groupCollapsed(a+" source"),console.warn(e),console.groupEnd(),new Error(`${a}: ${s}\nat: ${r[n-1].replace(/^\s*/,"")}`)}throw new Error(s)}s&&console.warn(s);const n=this._attachedShaders.get(t);if(n&&(this.gl.detachShader(this._program,n),this.gl.deleteShader(n)),this.gl.attachShader(this._program,i),this.gl.deleteShader(i),this._attachedShaders.set(t,i),2===this._attachedShaders.size){this.gl.linkProgram(this._program);const t=this.gl.getProgramInfoLog(this._program);if(!this.gl.getProgramParameter(this._program,this.gl.LINK_STATUS))throw new Error(t);t&&console.warn(t),this._attributesLocations=new Map,this._uniformLocations=new Map,this.use(),this.uniforms.clear(),this._textureUnits.clear();let e=0;for(const[t,i]of Object.entries(this._shader.uniforms))this.uniformTypes.get(t).startsWith("sampler")&&(this._textureUnits.set(t,e),e++),this.uniforms.set(t,i)}}}class m extends class{constructor({gl:t,mesh:e,program:i,vertexArray:s=new d({gl:t,mesh:e,program:i})}){this.gl=t,this.mesh=e,this.program=i,this.vertexArray=s,this._boundTextures=new Set}bind(){this.program.use(),this.vertexArray.bind();for(const[t,e]of this.program.uniformTypes)if(e.startsWith("sampler")){const e=this.program.uniforms.get(t);e instanceof c&&(e.bind({unit:this.program.textureUnits.get(t)}),this._boundTextures.add(e))}}draw(t){t=Object.assign({bind:!0,uniforms:{}},t),this.program.use();for(const e of Object.keys(t.uniforms))this.program.uniforms.set(e,t.uniforms[e]);t.bind&&this.bind(),this.mesh.draw(t),t.bind&&this.unbind()}unbind(){this.vertexArray.unbind();for(const t of this._boundTextures)t.unbind(),this._boundTextures.delete(t)}}{constructor({gl:t,width:e,height:i,depth:s,widthSegments:n,heightSegments:r,depthSegments:a,normals:h=!1,uvs:d=!1,attributes:c={},program:u=new _({gl:t,shader:{vertexChunks:[["start","\n            in vec3 position;\n          "],["end","\n            gl_Position = vec4(position, 1.);\n          "]]}})}){super({gl:t,mesh:new p(Object.assign({gl:t,attributes:c},new o({width:e,height:i,depth:s,widthSegments:n,heightSegments:r,depthSegments:a,normals:h,uvs:d}))),program:u})}}var f,v;f=new s(2),s!=Float32Array&&(f[0]=0,f[1]=0),v=f;class y extends Float32Array{static distance(t,e){return i=t,n=(s=e)[0]-i[0],r=s[1]-i[1],Math.hypot(n,r);var i,s,n,r}constructor(t=[0,0]){return super(t),this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}set(t,e){return function(t,e,i){t[0]=e,t[1]=i}(this,t,e),this}copy(t){return function(t,e){t[0]=e[0],t[1]=e[1]}(this,t),this}add(t){return function(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1]}(this,this,t),this}multiply(t){return function(t,e,i){t[0]=e[0]*i[0],t[1]=e[1]*i[1]}(this,this,t),this}get size(){return e=(t=this)[0],i=t[1],Math.hypot(e,i);var t,e,i}get squaredSize(){return e=(t=this)[0],i=t[1],e*e+i*i;var t,e,i}subtract(t){return function(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1]}(this,this,t),this}negate(t=this){return function(t,e){t[0]=-e[0],t[1]=-e[1]}(this,t),this}cross(t,e){return function(t,e,i){var s=e[0]*i[1]-e[1]*i[0];t[0]=t[1]=0,t[2]=s}(this,t,e),this}scale(t){return function(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i}(this,this,t),this}normalize(){return function(t,e){var i=e[0],s=e[1],n=i*i+s*s;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t}(this,this)}dot(t){return i=t,(e=this)[0]*i[0]+e[1]*i[1];var e,i}distance(t){return y.distance(this,t)}equals(t){return i=t,(e=this)[0]===i[0]&&e[1]===i[1];var e,i}applyMatrix3(t){return function(t,e,i){var s=e[0],n=e[1];t[0]=i[0]*s+i[3]*n+i[6],t[1]=i[1]*s+i[4]*n+i[7]}(this,this,t),this}applyMatrix4(t){return function(t,e,i){var s=e[0],n=e[1];t[0]=i[0]*s+i[4]*n+i[12],t[1]=i[1]*s+i[5]*n+i[13]}(this,this,t),this}rotate(t,e){!function(t,e,i,s){var n=e[0]-i[0],r=e[1]-i[1],a=Math.sin(s),h=Math.cos(s);t[0]=n*h-r*a+i[0],t[1]=n*a+r*h+i[1]}(this,this,t,e)}lerp(t,e){!function(t,e,i,s){var n=e[0],r=e[1];t[0]=n+s*(i[0]-n),t[1]=r+s*(i[1]-r)}(this,this,t,e)}clone(){return new y(this)}}const w=new Map;class b extends y{static get TOUCH_TYPE(){return"touchtype"}static get MOUSE_TYPE(){return"mousetype"}static get(t=window){let e=w.get(t);return e||(e=new b(t)),e}get downed(){return this._downed}constructor(e){super(),this._domElement=e||window,this.type=b.TOUCH_TYPE,this.velocity=new y,this.dragOffset=new y,this.centered=new y,this.centeredFlippedY=new y,this.normalized=new y,this.normalizedFlippedY=new y,this.normalizedCentered=new y,this.normalizedCenteredFlippedY=new y,this._downed=!1,w.set(this._domElement,this),this.onDown=new t,this.onMove=new t,this.onUp=new t,this.onClick=new t,this.onTypeChange=new t,this._preventMouseTypeChange=!1,this._onPointerMoveBinded=this._onPointerMove.bind(this),this._onPointerDownBinded=this._onPointerDown.bind(this),this._onPointerUpBinded=this._onPointerUp.bind(this),this._updateBinded=this._update.bind(this),this._resizeBinded=this.resize.bind(this),this._position=new y,this.enable()}resize(){this._domElementBoundingRect=this._domElement===window?{left:0,top:0,width:window.innerWidth,height:window.innerHeight}:this._domElement.getBoundingClientRect()}_onPointerDown(t){this.resize(),"touchstart"===t.type&&(this._preventMouseTypeChange=!0,this._changeType(b.TOUCH_TYPE)),this._downed=!0,this.dragOffset.set(0,0),this.copy(this._position),this._onPointerEvent(t),this._updatePositions(),this.onDown.dispatch(t)}_onPointerMove(t){if("mousemove"===t.type){if(this._preventMouseTypeChange)return;this._changeType(b.MOUSE_TYPE)}this._onPointerEvent(t),this.onMove.dispatch(t)}_onPointerUp(t){this._downed&&(this._downed=!1,this._onPointerEvent(t),this._updatePositions(),this.onUp.dispatch(t),this.dragOffset.size<4&&this.onClick.dispatch(t),clearTimeout(this._timeout),this._timeout=setTimeout(()=>{this._preventMouseTypeChange=!1},2e3))}_onPointerEvent(t){window.TouchEvent&&t instanceof window.TouchEvent&&(t="touchend"===t.type?t.changedTouches[0]:t.touches[0]),this._position.x=t.clientX-this._domElementBoundingRect.left,this._position.y=t.clientY-this._domElementBoundingRect.top}_changeType(t){this.type!==t&&(this.type=t,this.disable(),this.enable(),this.onTypeChange.dispatch(this.type))}_update(){(this.x||this.y)&&(this.velocity.x=this._position.x-this.x,this.velocity.y=this._position.y-this.y,this.downed&&this.dragOffset.add(this.velocity)),this._updatePositions()}_updatePositions(){this.x=this._position.x,this.y=this._position.y,(this.x||this.y)&&(this.centered.x=this.centeredFlippedY.x=this.x-.5*this._domElementBoundingRect.width,this.centered.y=this.centeredFlippedY.y=this.y-.5*this._domElementBoundingRect.height,this.centeredFlippedY.y*=-1,this.normalized.x=this.normalizedFlippedY.x=this.x/this._domElementBoundingRect.width,this.normalized.y=this.normalizedFlippedY.y=this.y/this._domElementBoundingRect.height,this.normalizedFlippedY.y=1-this.normalizedFlippedY.y,this.normalizedCentered.x=this.normalizedCenteredFlippedY.x=2*this.normalized.x-1,this.normalizedCentered.y=this.normalizedCenteredFlippedY.y=2*this.normalized.y-1,this.normalizedCenteredFlippedY.y*=-1)}enable(){this.disable(),this.resize(),this.type===b.TOUCH_TYPE?(this._domElement.addEventListener("touchmove",this._onPointerMoveBinded,{passive:!0}),window.addEventListener("touchend",this._onPointerUpBinded,{passive:!0})):(this._domElement.addEventListener("mousedown",this._onPointerDownBinded),window.addEventListener("mouseup",this._onPointerUpBinded)),this._domElement.addEventListener("touchstart",this._onPointerDownBinded,{passive:!0}),this._domElement.addEventListener("mousemove",this._onPointerMoveBinded),window.addEventListener("resize",this._resizeBinded),e.add(this._updateBinded=this._updateBinded||this._update.bind(this))}disable(){e.delete(this._updateBinded),this._domElement.removeEventListener("touchstart",this._onPointerDownBinded),this._domElement.removeEventListener("mousedown",this._onPointerDownBinded),this._domElement.removeEventListener("touchmove",this._onPointerMoveBinded),this._domElement.removeEventListener("mousemove",this._onPointerMoveBinded),window.removeEventListener("touchend",this._onPointerUpBinded),window.removeEventListener("mouseup",this._onPointerUpBinded),window.removeEventListener("resize",this._resizeBinded)}}function x(){var t=new s(3);return s!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function E(t){var e=t[0],i=t[1],s=t[2];return Math.hypot(e,i,s)}function T(t,e,i){var n=new s(3);return n[0]=t,n[1]=e,n[2]=i,n}function A(t,e){var i=e[0],s=e[1],n=e[2],r=i*i+s*s+n*n;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function M(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function F(t,e,i){var s=e[0],n=e[1],r=e[2],a=i[0],h=i[1],o=i[2];return t[0]=n*o-r*h,t[1]=r*a-s*o,t[2]=s*h-n*a,t}var S=E;!function(){var t=x()}();class z extends Float32Array{constructor(t=[0,0,0]){return super(t),this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}set(t,e,i){return function(t,e,i,s){t[0]=e,t[1]=i,t[2]=s}(this,t,e,i),this}copy(t){return function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2]}(this,t),this}add(t){return function(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}(this,this,t),this}get size(){return E(this)}get squaredSize(){return e=(t=this)[0],i=t[1],s=t[2],e*e+i*i+s*s;var t,e,i,s}distance(t){return e=this,s=(i=t)[0]-e[0],n=i[1]-e[1],r=i[2]-e[2],Math.hypot(s,n,r);var e,i,s,n,r}squaredDistance(t){return e=this,s=(i=t)[0]-e[0],n=i[1]-e[1],r=i[2]-e[2],s*s+n*n+r*r;var e,i,s,n,r}subtract(t){return function(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2]}(this,this,t),this}negate(t=this){return function(t,e){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2]}(this,t),this}cross(t,e){return F(this,t,e),this}scale(t){return function(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}(this,this,t),this}normalize(){return A(this,this),this}dot(t){return M(this,t)}lerp(t,e){return function(t,e,i,s){var n=e[0],r=e[1],a=e[2];return t[0]=n+s*(i[0]-n),t[1]=r+s*(i[1]-r),t[2]=a+s*(i[2]-a),t}(this,this,t,e)}equals(t){return i=t,(e=this)[0]===i[0]&&e[1]===i[1]&&e[2]===i[2];var e,i}applyMatrix4(t){return function(t,e,i){var s=e[0],n=e[1],r=e[2],a=i[3]*s+i[7]*n+i[11]*r+i[15];a=a||1,t[0]=(i[0]*s+i[4]*n+i[8]*r+i[12])/a,t[1]=(i[1]*s+i[5]*n+i[9]*r+i[13])/a,t[2]=(i[2]*s+i[6]*n+i[10]*r+i[14])/a}(this,this,t),this}applyQuaternion(t){return function(t,e,i){var s=i[0],n=i[1],r=i[2],a=i[3],h=e[0],o=e[1],d=e[2],c=n*d-r*o,u=r*h-s*d,l=s*o-n*h,p=n*l-r*u,g=r*c-s*l,_=s*u-n*c,m=2*a;c*=m,u*=m,l*=m,p*=2,g*=2,_*=2,t[0]=h+c+p,t[1]=o+u+g,t[2]=d+l+_}(this,this,t),this}angle(t){return i=t,s=(e=this)[0],n=e[1],r=e[2],a=i[0],h=i[1],o=i[2],d=Math.sqrt(s*s+n*n+r*r)*Math.sqrt(a*a+h*h+o*o),c=d&&M(e,i)/d,Math.acos(Math.min(Math.max(c,-1),1));var e,i,s,n,r,a,h,o,d,c}clone(){return new z(this)}}!function(){var t=function(){var t=new s(4);return s!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}()}();function P(){var t=new s(4);return s!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function R(t,e,i){var s=e[0],n=e[1],r=e[2],a=e[3],h=i[0],o=i[1],d=i[2],c=i[3];return t[0]=s*c+a*h+n*d-r*o,t[1]=n*c+a*o+r*h-s*d,t[2]=r*c+a*d+s*o-n*h,t[3]=a*c-s*h-n*o-r*d,t}function C(t,e,i,s){var n,r,a,h,o,d=e[0],c=e[1],u=e[2],l=e[3],p=i[0],g=i[1],_=i[2],m=i[3];return(r=d*p+c*g+u*_+l*m)<0&&(r=-r,p=-p,g=-g,_=-_,m=-m),1-r>1e-6?(n=Math.acos(r),a=Math.sin(n),h=Math.sin((1-s)*n)/a,o=Math.sin(s*n)/a):(h=1-s,o=s),t[0]=h*d+o*p,t[1]=h*c+o*g,t[2]=h*u+o*_,t[3]=h*l+o*m,t}function B(t,e){var i,s=e[0]+e[4]+e[8];if(s>0)i=Math.sqrt(s+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var r=(n+1)%3,a=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*r+r]-e[3*a+a]+1),t[n]=.5*i,i=.5/i,t[3]=(e[3*r+a]-e[3*a+r])*i,t[r]=(e[3*r+n]+e[3*n+r])*i,t[a]=(e[3*a+n]+e[3*n+a])*i}return t}var L,D,U,O,I,j,N=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Y=function(t,e,i,s,n){return t[0]=e,t[1]=i,t[2]=s,t[3]=n,t},V=function(t,e){var i=e[0],s=e[1],n=e[2],r=e[3],a=i*i+s*s+n*n+r*r;return a>0&&(a=1/Math.sqrt(a)),t[0]=i*a,t[1]=s*a,t[2]=n*a,t[3]=r*a,t};L=x(),D=T(1,0,0),U=T(0,1,0),O=P(),I=P(),j=function(){var t=new s(9);return s!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}();class $ extends Float32Array{constructor(t=[0,0,0,1]){return super(t),this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get w(){return this[3]}set w(t){this[3]=t}identity(){return function(t){t[0]=0,t[1]=0,t[2]=0,t[3]=1}(this),this}set(t,e,i,s){return Y(this,t,e,i,s),this}rotateX(t){return function(t,e,i){i*=.5;var s=e[0],n=e[1],r=e[2],a=e[3],h=Math.sin(i),o=Math.cos(i);t[0]=s*o+a*h,t[1]=n*o+r*h,t[2]=r*o-n*h,t[3]=a*o-s*h}(this,this,t),this}rotateY(t){return function(t,e,i){i*=.5;var s=e[0],n=e[1],r=e[2],a=e[3],h=Math.sin(i),o=Math.cos(i);t[0]=s*o-r*h,t[1]=n*o+a*h,t[2]=r*o+s*h,t[3]=a*o-n*h}(this,this,t),this}rotateZ(t){return function(t,e,i){i*=.5;var s=e[0],n=e[1],r=e[2],a=e[3],h=Math.sin(i),o=Math.cos(i);t[0]=s*o+n*h,t[1]=n*o-s*h,t[2]=r*o+a*h,t[3]=a*o-r*h}(this,this,t),this}invert(t=this){return function(t,e){var i=e[0],s=e[1],n=e[2],r=e[3],a=i*i+s*s+n*n+r*r,h=a?1/a:0;t[0]=-i*h,t[1]=-s*h,t[2]=-n*h,t[3]=r*h}(this,t),this}copy(t){return N(this,t),this}normalize(t=this){return V(this,this),this}multiply(t,e){return e?R(this,t,e):R(this,this,t),this}fromMatrix3(t){return B(this,t),this}fromMatrix4(t){return r(this,t),this}}class k{constructor({matrix:t=new a,domElement:e=document.body,distance:i=0,invertRotation:s=!0,rotationEaseRatio:n=.04,zoomSpeed:r=.1,zoomEaseRatio:h=.1,minDistance:o=0,maxDistance:d=1/0,disabled:c=!1}={}){this.matrix=t,this._distance=i,this.invertRotation=s,this.rotationEaseRatio=n,this.maxDistance=d,this.minDistance=o,this.zoomSpeed=r,this.zoomEaseRatio=h,this._pointer=b.get(e),this._nextDistance=this._distance,this._cachedQuaternion=new $,this._cachedMatrix=new a,this._cachedVector3=new z,this._velocity=new y,this._velocityOrigin=new y,this._position=new z([this.matrix.x,this.matrix.y,this.matrix.z]),this._positionPrevious=this._position.clone(),this._positionOffset=new z,e.addEventListener("wheel",this.onWheel.bind(this),{passive:!0}),this.update(),this.disabled=c}set distance(t){this._distance=this._nextDistance=t}get distance(){return this._distance}onWheel(t){if(this.disabled)return;const e=1+Math.abs(t.deltaY*this.zoomSpeed*.01);this._nextDistance=this._nextDistance||1,this._nextDistance=t.deltaY>0?this._nextDistance*e:this._nextDistance/e,this._nextDistance=Math.max(Math.min(this._nextDistance,this.maxDistance),this.minDistance)}update(){this.disabled||(this._cachedMatrix.identity(),this._cachedQuaternion.identity(),this._distance+=(this._nextDistance-this._distance)*this.zoomEaseRatio,this._position.set(this.matrix.x,this.matrix.y,this.matrix.z).subtract(this._positionOffset),this.matrix.x=0,this.matrix.y=0,this.matrix.z=0,this._pointer.downed&&this._velocity.copy(this._pointer.velocity).scale(.004),this._velocity.lerp(this._velocityOrigin,this.rotationEaseRatio),this._cachedQuaternion.rotateY(this.invertRotation?-this._velocity.x:this._velocity.x),this._cachedQuaternion.rotateX(this.invertRotation?-this._velocity.y:this._velocity.y),this._cachedMatrix.fromQuaternion(this._cachedQuaternion),this.matrix.multiply(this._cachedMatrix),this._positionOffset.set(0,0,1),this._positionOffset.applyMatrix4(this.matrix),this._positionOffset.scale(this._distance),this._cachedVector3.copy(this._position).add(this._positionOffset),this.matrix.x=this._cachedVector3.x,this.matrix.y=this._cachedVector3.y,this.matrix.z=this._cachedVector3.z)}}class H extends g{constructor({positions:t=!0,normals:e=!1,uvs:i=!1,uniforms:s,vertexChunks:n=[],fragmentChunks:r=[]}={}){super({uniforms:s,vertexChunks:[["start",`\n          uniform mat4 projectionView;\n          uniform mat4 transform;\n  \n          ${t?"in vec3 position;":""}\n          ${e?"in vec3 normal;":""}\n          ${i?"in vec2 uv;":""}\n  \n          ${t?"out vec3 vPosition;":""}\n          ${e?"out vec3 vNormal;":""}\n          ${i?"out vec2 vUV;":""}\n        `],["main",`\n          ${t?"vPosition = position;":""}\n          ${e?"vNormal = normal;":""}\n          ${i?"vUV = uv;":""}\n        `],["end","\n          gl_Position = projectionView * transform * vec4(position, 1.);\n        "],...n],fragmentChunks:[["start",`\n          ${t?"in vec3 vPosition;":""}\n          ${e?"in vec3 vNormal;":""}\n          ${i?"in vec2 vUV;":""}\n        `],...r]})}}class G{constructor({canvas:t}){this.canvas=t;const e={depth:!0,alpha:!1,antialias:!0};/\bforcewebgl1\b/.test(window.location.search)||(this.gl=this.canvas.getContext("webgl2",e)),this.gl||(this.gl=this.canvas.getContext("webgl",e)||this.canvas.getContext("experimental-webgl",e)),this.camera=new h,this.cameraController=new k({domElement:this.canvas,matrix:this.camera.transform,distance:5}),this.gl.clearColor(0,0,0,1),this.gl.enable(this.gl.CULL_FACE),this.gl.enable(this.gl.DEPTH_TEST),this.object=new m({gl:this.gl,width:1,height:1,normals:!0,program:new _({gl:this.gl,shader:new H({normals:!0,fragmentChunks:[["end","\n              fragColor = vec4(vNormal * .5 + .5, 1.);\n            "]]})})})}resize(t,e){this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.camera.aspectRatio=t/e,this.update()}update(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.cameraController.update(),this.object.draw({uniforms:{projectionView:this.camera.projectionView}})}}window.customElements.define("starter-gl",class extends i{constructor(){super(),this.autoplay=!0,this._resizeBinded=this.resize.bind(this),this.attachShadow({mode:"open"}).innerHTML="\n      <style>\n        :host {\n          display: block;\n          touch-action: none;\n        }\n        \n        canvas {\n          width: 100%;\n          height: 100%;\n          max-height: 100%;\n        }\n      </style>\n      <canvas></canvas>\n    ",this.canvas=this.shadowRoot.querySelector("canvas"),this.view=new G({canvas:this.canvas})}connectedCallback(){super.connectedCallback(),window.addEventListener("resize",this._resizeBinded),this.resize()}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("resize",this._resizeBinded)}resize(){const t=this.canvas.offsetWidth,e=this.canvas.offsetHeight;this.canvas.width=t*window.devicePixelRatio,this.canvas.height=e*window.devicePixelRatio,this.view.resize(t,e)}update(){this.view.update()}});
//# sourceMappingURL=index.js.map
