class t extends Set{constructor(){super(),this._onceCallbacksMap=new Map}add(t,{once:e=!1}={}){if(e){const e=(...e)=>{t(...e),this.delete(t)};return this._onceCallbacksMap.set(t,e),super.add(e)}return super.add(t)}delete(t){return this._onceCallbacksMap.delete(t),super.delete(this._onceCallbacksMap.get(t)||t)}dispatch(t){for(const e of this)e(t)}}var e=new class extends t{constructor(){super(),this._updateBinded=this._update.bind(this),this.time=.001*window.performance.now(),this.reset(),document.addEventListener("visibilitychange",()=>{this.reset()}),this._update()}reset(){this._previousTime=.001*window.performance.now(),this.deltaTime=1/60,this.smoothDeltatime=this.deltaTime,this.timeScale=1,this.smoothTimeScale=this.timeScale}_update(){requestAnimationFrame(this._updateBinded),this.time=.001*window.performance.now(),this.deltaTime=this.time-this._previousTime,this.smoothDeltatime+=.05*(this.deltaTime-this.smoothDeltatime),this.timeScale=this.deltaTime/(1/60),this.smoothTimeScale=this.smoothDeltatime/(1/60),this._previousTime=this.time,this.dispatch()}};class i extends HTMLElement{constructor(){super(),this._paused=!0,this._pausedByUser=!0,this._pausedByBlur=!1,this._updateBinded=this.update.bind(this),this._onFocusChangeBinded=this._onFocusChange.bind(this)}connectedCallback(){this._autoplay=this.hasAttribute("autoplay"),this._background=this.hasAttribute("background"),this._background||(window.top.addEventListener("blur",this._onFocusChangeBinded),window.top.addEventListener("focus",this._onFocusChangeBinded),document.addEventListener("visibilitychange",this._onFocusChangeBinded)),this._autoplay&&this.play()}disconnectedCallback(){this._pausedByBlur=!0,window.top.removeEventListener("blur",this._onFocusChangeBinded),window.top.removeEventListener("focus",this._onFocusChangeBinded),document.removeEventListener("visibilitychange",this._onFocusChangeBinded)}get paused(){return this._paused}get _pausedByUser(){return this.__pausedByUser}set _pausedByUser(t){this.__pausedByUser=t,this._updatePlaybackState()}get _pausedByBlur(){return this.__pausedByBlur}set _pausedByBlur(t){this.__pausedByBlur=t,this._updatePlaybackState()}_onFocusChange(t){switch(t.type){case"visibilitychange":"visible"!==document.visibilityState&&(this._pausedByBlur=!0);break;case"blur":this._pausedByBlur=!0;break;case"focus":this._pausedByBlur=!1}}_updatePlaybackState(){const t=this._pausedByUser||this._pausedByBlur;t!==this._paused&&(this._paused=t,this._paused?(e.delete(this._updateBinded),this.dispatchEvent(new Event("pause"))):(e.add(this._updateBinded),this.dispatchEvent(new Event("play"))))}play(){this._pausedByUser=!1,window.top.document.hasFocus()||this._background||(this._pausedByBlur=!0,requestAnimationFrame(this._updateBinded))}pause(){this._pausedByUser=!0}update(){}}var s="undefined"!=typeof Float32Array?Float32Array:Array;function r(t,e,i){var s=e[0],r=e[1],n=e[2],a=e[3],h=e[4],o=e[5],d=e[6],u=e[7],c=e[8],l=e[9],p=e[10],g=e[11],m=e[12],_=e[13],f=e[14],v=e[15],y=i[0],w=i[1],b=i[2],x=i[3];return t[0]=y*s+w*h+b*c+x*m,t[1]=y*r+w*o+b*l+x*_,t[2]=y*n+w*d+b*p+x*f,t[3]=y*a+w*u+b*g+x*v,y=i[4],w=i[5],b=i[6],x=i[7],t[4]=y*s+w*h+b*c+x*m,t[5]=y*r+w*o+b*l+x*_,t[6]=y*n+w*d+b*p+x*f,t[7]=y*a+w*u+b*g+x*v,y=i[8],w=i[9],b=i[10],x=i[11],t[8]=y*s+w*h+b*c+x*m,t[9]=y*r+w*o+b*l+x*_,t[10]=y*n+w*d+b*p+x*f,t[11]=y*a+w*u+b*g+x*v,y=i[12],w=i[13],b=i[14],x=i[15],t[12]=y*s+w*h+b*c+x*m,t[13]=y*r+w*o+b*l+x*_,t[14]=y*n+w*d+b*p+x*f,t[15]=y*a+w*u+b*g+x*v,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});class n extends Float32Array{constructor(t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return super(t),this}set x(t){this[12]=t}get x(){return this[12]}set y(t){this[13]=t}get y(){return this[13]}set z(t){this[14]=t}get z(){return this[14]}set w(t){this[15]=t}get w(){return this[15]}set(t,e,i,s,r,n,a,h,o,d,u,c,l,p,g,m){return t.length?this.copy(t):(function(t,e,i,s,r,n,a,h,o,d,u,c,l,p,g,m,_){t[0]=e,t[1]=i,t[2]=s,t[3]=r,t[4]=n,t[5]=a,t[6]=h,t[7]=o,t[8]=d,t[9]=u,t[10]=c,t[11]=l,t[12]=p,t[13]=g,t[14]=m,t[15]=_}(this,t,e,i,s,r,n,a,h,o,d,u,c,l,p,g,m),this)}translate(t,e=this){var i,s,r,n,a,h,o,d,u,c,l,p,g,m,_,f,v,y;return i=this,s=e,f=(r=t)[0],v=r[1],y=r[2],s===i?(i[12]=s[0]*f+s[4]*v+s[8]*y+s[12],i[13]=s[1]*f+s[5]*v+s[9]*y+s[13],i[14]=s[2]*f+s[6]*v+s[10]*y+s[14],i[15]=s[3]*f+s[7]*v+s[11]*y+s[15]):(n=s[0],a=s[1],h=s[2],o=s[3],d=s[4],u=s[5],c=s[6],l=s[7],p=s[8],g=s[9],m=s[10],_=s[11],i[0]=n,i[1]=a,i[2]=h,i[3]=o,i[4]=d,i[5]=u,i[6]=c,i[7]=l,i[8]=p,i[9]=g,i[10]=m,i[11]=_,i[12]=n*f+d*v+p*y+s[12],i[13]=a*f+u*v+g*y+s[13],i[14]=h*f+c*v+m*y+s[14],i[15]=o*f+l*v+_*y+s[15]),this}rotateX(t,e=this){var i,s,r,n,a,h,o,d,u,c,l,p,g;return i=this,s=e,r=t,n=Math.sin(r),a=Math.cos(r),h=s[4],o=s[5],d=s[6],u=s[7],c=s[8],l=s[9],p=s[10],g=s[11],s!==i&&(i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15]),i[4]=h*a+c*n,i[5]=o*a+l*n,i[6]=d*a+p*n,i[7]=u*a+g*n,i[8]=c*a-h*n,i[9]=l*a-o*n,i[10]=p*a-d*n,i[11]=g*a-u*n,this}rotateY(t,e=this){var i,s,r,n,a,h,o,d,u,c,l,p,g;return i=this,s=e,r=t,n=Math.sin(r),a=Math.cos(r),h=s[0],o=s[1],d=s[2],u=s[3],c=s[8],l=s[9],p=s[10],g=s[11],s!==i&&(i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15]),i[0]=h*a-c*n,i[1]=o*a-l*n,i[2]=d*a-p*n,i[3]=u*a-g*n,i[8]=h*n+c*a,i[9]=o*n+l*a,i[10]=d*n+p*a,i[11]=u*n+g*a,this}rotateZ(t,e=this){var i,s,r,n,a,h,o,d,u,c,l,p,g;return i=this,s=e,r=t,n=Math.sin(r),a=Math.cos(r),h=s[0],o=s[1],d=s[2],u=s[3],c=s[4],l=s[5],p=s[6],g=s[7],s!==i&&(i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15]),i[0]=h*a+c*n,i[1]=o*a+l*n,i[2]=d*a+p*n,i[3]=u*a+g*n,i[4]=c*a-h*n,i[5]=l*a-o*n,i[6]=p*a-d*n,i[7]=g*a-u*n,this}scale(t,e=this){var i,s,r,n,a,h;return i=this,s=e,n=(r="number"==typeof t?[t,t,t]:t)[0],a=r[1],h=r[2],i[0]=s[0]*n,i[1]=s[1]*n,i[2]=s[2]*n,i[3]=s[3]*n,i[4]=s[4]*a,i[5]=s[5]*a,i[6]=s[6]*a,i[7]=s[7]*a,i[8]=s[8]*h,i[9]=s[9]*h,i[10]=s[10]*h,i[11]=s[11]*h,i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],this}multiply(t,e){return e?r(this,t,e):r(this,this,t),this}identity(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}copy(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}fromPerspective({fov:t,aspectRatio:e,near:i,far:s}){return function(t,e,i,s,r){var n,a=1/Math.tan(e/2);t[0]=a/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(n=1/(s-r),t[10]=(r+s)*n,t[14]=2*r*s*n):(t[10]=-1,t[14]=-2*s)}(this,t,e,i,s),this}fromQuaternion(t){var e,i,s,r,n,a,h,o,d,u,c,l,p,g,m,_,f,v;return e=this,s=(i=t)[0],r=i[1],n=i[2],a=i[3],u=s*(h=s+s),c=r*h,l=r*(o=r+r),p=n*h,g=n*o,m=n*(d=n+n),_=a*h,f=a*o,v=a*d,e[0]=1-l-m,e[1]=c+v,e[2]=p-f,e[3]=0,e[4]=c-v,e[5]=1-u-m,e[6]=g+_,e[7]=0,e[8]=p+f,e[9]=g-_,e[10]=1-u-l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}setPosition(t){return this.x=t[0],this.y=t[1],this.z=t[2],this}invert(t=this){var e,i,s,r,n,a,h,o,d,u,c,l,p,g,m,_,f,v,y,w,b,x,E,T,S,A,B,M,C,F,z;return e=this,s=(i=t)[0],r=i[1],n=i[2],a=i[3],h=i[4],o=i[5],d=i[6],u=i[7],c=i[8],l=i[9],p=i[10],g=i[11],m=i[12],_=i[13],f=i[14],v=i[15],(z=(y=s*o-r*h)*(F=p*v-g*f)-(w=s*d-n*h)*(C=l*v-g*_)+(b=s*u-a*h)*(M=l*f-p*_)+(x=r*d-n*o)*(B=c*v-g*m)-(E=r*u-a*o)*(A=c*f-p*m)+(T=n*u-a*d)*(S=c*_-l*m))&&(z=1/z,e[0]=(o*F-d*C+u*M)*z,e[1]=(n*C-r*F-a*M)*z,e[2]=(_*T-f*E+v*x)*z,e[3]=(p*E-l*T-g*x)*z,e[4]=(d*B-h*F-u*A)*z,e[5]=(s*F-n*B+a*A)*z,e[6]=(f*b-m*T-v*w)*z,e[7]=(c*T-p*b+g*w)*z,e[8]=(h*C-o*B+u*S)*z,e[9]=(r*B-s*C-a*S)*z,e[10]=(m*E-_*b+v*y)*z,e[11]=(l*b-c*E-g*y)*z,e[12]=(o*A-h*M-d*S)*z,e[13]=(s*M-r*A+n*S)*z,e[14]=(_*w-m*x-f*y)*z,e[15]=(c*x-l*w+p*y)*z),this}}class a{constructor({near:t=.01,far:e=1e3,aspectRatio:i=1,fov:s=Math.PI/3}={}){this._near=t,this._far=e,this._aspectRatio=i,this._fov=s,this.transform=new n,this._inverseTransform=new n,this._projection=new n,this._projectionView=new n,this._updateProjection()}set near(t){this._near=t,this._updateProjection()}get near(){return this._near}set far(t){this._far=t,this._updateProjection()}get far(){return this._far}set fov(t){this._fov=t,this._updateProjection()}get fov(){return this._fov}set aspectRatio(t){this._aspectRatio=t,this._updateProjection()}get aspectRatio(){return this._aspectRatio}get inverseTransform(){return this._inverseTransform.invert(this.transform)}get projection(){return this._projection}get projectionView(){return this._projectionView.set(this.projection).multiply(this.inverseTransform)}_updateProjection(){this._projection.fromPerspective(this)}}Object.defineProperty(a.prototype,"near",{enumerable:!0}),Object.defineProperty(a.prototype,"far",{enumerable:!0}),Object.defineProperty(a.prototype,"fov",{enumerable:!0}),Object.defineProperty(a.prototype,"aspectRatio",{enumerable:!0}),Object.defineProperty(a.prototype,"inverseTransform",{enumerable:!0}),Object.defineProperty(a.prototype,"projection",{enumerable:!0}),Object.defineProperty(a.prototype,"projectionView",{enumerable:!0});class h{constructor({width:t=1,height:e=1,depth:i=1,widthSegments:s=1,heightSegments:r=1,depthSegments:n=1,positions:a=!0,normals:h=!0,uvs:o=!0,indices:d=!0}){const u=[],c=[],l=[],p=[];let g=0;function m(t,e,i,s,r,n,m,_,f,v,y){const w=n/f,b=m/v,x=n/2,E=m/2,T=_/2,S=f+1,A=v+1;let B,M,C=0;const F={x:0,y:0,z:0};for(M=0;M<A;M++){const n=M*b-E;for(B=0;B<S;B++){const d=B*w-x;F[t]=d*s,F[e]=n*r,F[i]=T,a&&c.push(F.x,F.y,F.z),F[t]=0,F[e]=0,F[i]=_>0?1:-1,h&&l.push(F.x,F.y,F.z),o&&(p.push(B/f),p.push(1-M/v)),C+=1}}if(d)for(M=0;M<v;M++)for(B=0;B<f;B++){const t=g+B+S*M,e=g+B+S*(M+1),i=g+(B+1)+S*(M+1),s=g+(B+1)+S*M;u.push(t,e,s),u.push(e,i,s)}g+=C}m("z","y","x",-1,-1,i,e,t,n,r),m("z","y","x",1,-1,i,e,-t,n,r),m("x","z","y",1,1,t,i,e,s,n),m("x","z","y",1,-1,t,i,-e,s,n),m("x","y","z",1,-1,t,e,i,s,r),m("x","y","z",-1,-1,t,e,-i,s,r),a&&(this.positions=new Float32Array(c)),h&&(this.normals=new Float32Array(l)),o&&(this.uvs=new Float32Array(p)),d&&(this.indices=new Uint16Array(u))}}class o{constructor({gl:t,mesh:e,program:i}={gl:t}){this.gl=t;const s=t.getExtension("OES_vertex_array_object");s&&(this.gl.createVertexArray=s.createVertexArrayOES.bind(s),this.gl.bindVertexArray=s.bindVertexArrayOES.bind(s)),this._vertexArray=this.gl.createVertexArray(),e&&i&&this.add({mesh:e,program:i})}add({mesh:t,program:e}={}){this.bind(),e.attributes.set(t.attributes),t.indices&&t.indices.buffer.bind(),this.unbind()}bind(){this.gl.bindVertexArray(this._vertexArray)}unbind(){this.gl.bindVertexArray(null)}}class d{constructor({gl:t,data:e,width:i,height:s,target:r=t.TEXTURE_2D,level:n=0,internalFormat:a=t.RGBA8||t.RGBA,format:h=t.RGBA,type:o=t.UNSIGNED_BYTE,minFilter:d=t.NEAREST_MIPMAP_LINEAR,magFilter:u=t.LINEAR,wrapS:c=t.REPEAT,wrapT:l=t.REPEAT}){this.gl=t,this._texture=this.gl.createTexture(),this._width=i,this._height=s,this._dataWidth=void 0,this._dataHeight=void 0,this._target=r,this._unit=0,this.level=n,this.internalFormat=a,this.format=h,this.type=o,this.minFilter=d,this.magFilter=u,this.wrapS=c,this.wrapT=l,this.data=e}generateMipmap(){this.bind(),this.gl.generateMipmap(this._target),this.unbind()}set data(t){this._data=t,this._data&&this._data.width&&(this._dataWidth=this._data.width||this._data.videoWidth,this._dataHeight=this._data.height||this._data.videoHeight),this.bind(),this.gl instanceof WebGLRenderingContext&&this._dataWidth?this.gl.texImage2D(this._target,this.level,this.internalFormat,this.format,this.type,this._data):this.gl.texImage2D(this._target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this._data),this.unbind()}get data(){return this._data}set width(t){this._width=t,this.data=this.data}get width(){return this._width||this._dataWidth}set height(t){this._height=t,this.data=this.data}get height(){return this._height||this._dataHeight}set minFilter(t){this._minFilter!==t&&(this._minFilter=t,this.bind(),this.gl.texParameteri(this._target,this.gl.TEXTURE_MIN_FILTER,this._minFilter),this.unbind())}get minFilter(){return this._minFilter}set magFilter(t){this._magFilter!==t&&(this._magFilter=t,this.bind(),this.gl.texParameteri(this._target,this.gl.TEXTURE_MAG_FILTER,this._magFilter),this.unbind())}get magFilter(){return this._magFilter}set wrapS(t){this._wrapS!==t&&(this._wrapS=t,this.bind(),this.gl.texParameteri(this._target,this.gl.TEXTURE_WRAP_S,this._wrapS),this.unbind())}get wrapS(){return this._wrapS}set wrapT(t){this._wrapT!==t&&(this._wrapT=t,this.bind(),this.gl.texParameteri(this._target,this.gl.TEXTURE_WRAP_T,this._wrapT),this.unbind())}get wrapT(){return this._wrapT}bind({unit:t=0}={}){this._unit=t,this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this._target,this._texture)}unbind({unit:t=this._unit}={}){this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this._target,null)}clone(){return new d(this)}}class u{constructor({gl:t,data:e=null,target:i=t.ARRAY_BUFFER,usage:s=t.STATIC_DRAW}={gl:t}){this.gl=t,this.target=i,this.usage=s,this._buffer=this.gl.createBuffer(),e&&(this.data=e)}set data(t){this._data=t,this.bind(),this.gl.bufferData(this.target,this._data,this.usage),this.unbind()}get data(){return this._data}bind({target:t=this.target,index:e,offset:i=0,size:s}={}){void 0===e?this.gl.bindBuffer(t,this._buffer):void 0===s?this.gl.bindBufferBase(t,e,this._buffer):this.gl.bindBufferRange(t,e,this._buffer,i,s)}unbind({target:t=this.target,index:e,offset:i=0,size:s}={}){void 0===e?this.gl.bindBuffer(t,null):void 0===s?this.gl.bindBufferBase(t,e,null):this.gl.bindBufferRange(t,e,null,i,s)}}class c{constructor({gl:t,data:e,buffer:i=new u({gl:t}),size:s=1,type:r,offset:n=0,normalized:a=!1,stride:h=0,count:o,divisor:d=0}){this.gl=t,this.buffer=i,this.size=s,this.type=r,this.offset=n,this.normalized=a,this.stride=h,this.count=o,this.divisor=d,e&&(this.data=e)}set count(t){this._count=t}get count(){return void 0===this._count?this.data.length/this.size:this._count}set type(t){this._type=t}get type(){return this._type||this._dataType}set data(t){this.buffer.data=t,this.data instanceof Float32Array||this.data instanceof Float64Array?this._dataType=this.gl.FLOAT:this.data instanceof Int8Array?this._dataType=this.gl.BYTE:this.data instanceof Int16Array?this._dataType=this.gl.SHORT:this.data instanceof Int32Array?this._dataType=this.gl.INT:this.data instanceof Uint8Array?this._dataType=this.gl.UNSIGNED_BYTE:this.data instanceof Uint16Array?this._dataType=this.gl.UNSIGNED_SHORT:this.data instanceof Uint32Array&&(this._dataType=this.gl.UNSIGNED_INT)}get data(){return this.buffer.data}}class l{constructor({gl:t,positions:e,normals:i,uvs:s,attributes:r={},indices:n}){this.gl=t,this.gl.getExtension("OES_element_index_uint"),this._drawElementsInstanced=()=>{},this._drawArraysInstanced=()=>{};const a=this.gl.getExtension("ANGLE_instanced_arrays");a?(this._drawElementsInstanced=a.drawElementsInstancedANGLE.bind(a),this._drawArraysInstanced=a.drawArraysInstancedANGLE.bind(a)):this.gl.drawElementsInstanced&&(this._drawElementsInstanced=this.gl.drawElementsInstanced.bind(this.gl),this._drawArraysInstanced=this.gl.drawArraysInstanced.bind(this.gl)),this.attributes=new Map(r.entries?r:Object.entries(r)),e&&this.attributes.set("position",new c({gl:t,data:e,size:3})),i&&this.attributes.set("normal",new c({gl:t,data:i,size:3})),s&&this.attributes.set("uv",new c({gl:t,data:s,size:2}));for(const[e,i]of this.attributes)i instanceof c||this.attributes.set(e,new c(Object.assign({gl:t},i)));!n||this.indices instanceof c||(this.indices=new c(Object.assign({gl:this.gl,buffer:new u({gl:this.gl,target:this.gl.ELEMENT_ARRAY_BUFFER})},void 0!==n.length?{data:n}:n)))}draw({mode:t=this.gl.TRIANGLES,elements:e=!!this.indices,count:i=(e?this.indices.count:this.attributes.get("position").count),offset:s=(this.indices?this.indices.offset:0),type:r=(e?this.indices.type:null),first:n=0,instanceCount:a}={}){e?void 0!==a?this._drawElementsInstanced(t,i,r,s,a):this.gl.drawElements(t,i,r,s):void 0!==a?this._drawArraysInstanced(t,n,i,a):this.gl.drawArrays(t,n,i)}}var p,g;p=new s(2),s!=Float32Array&&(p[0]=0,p[1]=0),g=p;class m extends Float32Array{static distance(t,e){return i=t,r=(s=e)[0]-i[0],n=s[1]-i[1],Math.hypot(r,n);var i,s,r,n}constructor(t=[0,0]){return super(t),this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}set(t,e){return function(t,e,i){t[0]=e,t[1]=i}(this,t,e),this}copy(t){return function(t,e){t[0]=e[0],t[1]=e[1]}(this,t),this}add(t){return function(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1]}(this,this,t),this}multiply(t){return function(t,e,i){t[0]=e[0]*i[0],t[1]=e[1]*i[1]}(this,this,t),this}get size(){return e=(t=this)[0],i=t[1],Math.hypot(e,i);var t,e,i}get squaredSize(){return e=(t=this)[0],i=t[1],e*e+i*i;var t,e,i}subtract(t){return function(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1]}(this,this,t),this}negate(t=this){return function(t,e){t[0]=-e[0],t[1]=-e[1]}(this,t),this}cross(t,e){return function(t,e,i){var s=e[0]*i[1]-e[1]*i[0];t[0]=t[1]=0,t[2]=s}(this,t,e),this}scale(t){return function(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i}(this,this,t),this}normalize(){return function(t,e){var i=e[0],s=e[1],r=i*i+s*s;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t}(this,this)}dot(t){return i=t,(e=this)[0]*i[0]+e[1]*i[1];var e,i}distance(t){return m.distance(this,t)}equals(t){return i=t,(e=this)[0]===i[0]&&e[1]===i[1];var e,i}applyMatrix3(t){return function(t,e,i){var s=e[0],r=e[1];t[0]=i[0]*s+i[3]*r+i[6],t[1]=i[1]*s+i[4]*r+i[7]}(this,this,t),this}applyMatrix4(t){return function(t,e,i){var s=e[0],r=e[1];t[0]=i[0]*s+i[4]*r+i[12],t[1]=i[1]*s+i[5]*r+i[13]}(this,this,t),this}lerp(t,e){!function(t,e,i,s){var r=e[0],n=e[1];t[0]=r+s*(i[0]-r),t[1]=n+s*(i[1]-n)}(this,this,t,e)}clone(){return new m(this)}}function _(){var t=new s(3);return s!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function f(t){var e=t[0],i=t[1],s=t[2];return Math.hypot(e,i,s)}function v(t,e,i){var r=new s(3);return r[0]=t,r[1]=e,r[2]=i,r}function y(t,e){var i=e[0],s=e[1],r=e[2],n=i*i+s*s+r*r;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function w(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function b(t,e,i){var s=e[0],r=e[1],n=e[2],a=i[0],h=i[1],o=i[2];return t[0]=r*o-n*h,t[1]=n*a-s*o,t[2]=s*h-r*a,t}var x=f;!function(){var t=_()}();class E extends Float32Array{constructor(t=[0,0,0]){return super(t),this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}set(t,e,i){return function(t,e,i,s){t[0]=e,t[1]=i,t[2]=s}(this,t,e,i),this}copy(t){return function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2]}(this,t),this}add(t){return function(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}(this,this,t),this}get size(){return f(this)}get squaredSize(){return e=(t=this)[0],i=t[1],s=t[2],e*e+i*i+s*s;var t,e,i,s}distance(t){return e=this,s=(i=t)[0]-e[0],r=i[1]-e[1],n=i[2]-e[2],Math.hypot(s,r,n);var e,i,s,r,n}squaredDistance(t){return e=this,s=(i=t)[0]-e[0],r=i[1]-e[1],n=i[2]-e[2],s*s+r*r+n*n;var e,i,s,r,n}subtract(t){return function(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2]}(this,this,t),this}negate(t=this){return function(t,e){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2]}(this,t),this}cross(t,e){return b(this,t,e),this}scale(t){return function(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}(this,this,t),this}normalize(){return y(this,this),this}dot(t){return w(this,t)}lerp(t,e){return function(t,e,i,s){var r=e[0],n=e[1],a=e[2];return t[0]=r+s*(i[0]-r),t[1]=n+s*(i[1]-n),t[2]=a+s*(i[2]-a),t}(this,this,t,e)}equals(t){return i=t,(e=this)[0]===i[0]&&e[1]===i[1]&&e[2]===i[2];var e,i}applyMatrix4(t){return function(t,e,i){var s=e[0],r=e[1],n=e[2],a=i[3]*s+i[7]*r+i[11]*n+i[15];a=a||1,t[0]=(i[0]*s+i[4]*r+i[8]*n+i[12])/a,t[1]=(i[1]*s+i[5]*r+i[9]*n+i[13])/a,t[2]=(i[2]*s+i[6]*r+i[10]*n+i[14])/a}(this,this,t),this}angle(t){return i=t,s=(e=this)[0],r=e[1],n=e[2],a=i[0],h=i[1],o=i[2],d=Math.sqrt(s*s+r*r+n*n)*Math.sqrt(a*a+h*h+o*o),u=d&&w(e,i)/d,Math.acos(Math.min(Math.max(u,-1),1));var e,i,s,r,n,a,h,o,d,u}clone(){return new E(this)}}function T(t,e,i,s,r){return t[0]=e,t[1]=i,t[2]=s,t[3]=r,t}!function(){var t=function(){var t=new s(4);return s!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}()}();class S extends Float32Array{constructor(t=[0,0,0,0]){return super(t),this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get w(){return this[3]}set w(t){this[3]=t}set(t,e,i,s){return T(this,t,e,i,s),this}}function A(t,e,i){var s=e[0],r=e[1],n=e[2],a=e[3],h=e[4],o=e[5],d=e[6],u=e[7],c=e[8],l=i[0],p=i[1],g=i[2],m=i[3],_=i[4],f=i[5],v=i[6],y=i[7],w=i[8];return t[0]=l*s+p*a+g*d,t[1]=l*r+p*h+g*u,t[2]=l*n+p*o+g*c,t[3]=m*s+_*a+f*d,t[4]=m*r+_*h+f*u,t[5]=m*n+_*o+f*c,t[6]=v*s+y*a+w*d,t[7]=v*r+y*h+w*u,t[8]=v*n+y*o+w*c,t}class B extends Float32Array{constructor(t=[1,0,0,0,1,0,0,0,1]){return super(t),this}set(t,e,i,s,r,n,a,h,o){return function(t,e,i,s,r,n,a,h,o,d){t[0]=e,t[1]=i,t[2]=s,t[3]=r,t[4]=n,t[5]=a,t[6]=h,t[7]=o,t[8]=d}(this,t,e,i,s,r,n,a,h,o),this}translate(t,e=this){return function(t,e,i){var s=e[0],r=e[1],n=e[2],a=e[3],h=e[4],o=e[5],d=e[6],u=e[7],c=e[8],l=i[0],p=i[1];t[0]=s,t[1]=r,t[2]=n,t[3]=a,t[4]=h,t[5]=o,t[6]=l*s+p*a+d,t[7]=l*r+p*h+u,t[8]=l*n+p*o+c}(this,e,t),this}rotate(t,e=this){return function(t,e,i){var s=e[0],r=e[1],n=e[2],a=e[3],h=e[4],o=e[5],d=e[6],u=e[7],c=e[8],l=Math.sin(i),p=Math.cos(i);t[0]=p*s+l*a,t[1]=p*r+l*h,t[2]=p*n+l*o,t[3]=p*a-l*s,t[4]=p*h-l*r,t[5]=p*o-l*n,t[6]=d,t[7]=u,t[8]=c}(this,e,t),this}scale(t,e=this){return function(t,e,i){var s=i[0],r=i[1];t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]}(this,e,t),this}multiply(t,e){return e?A(this,t,e):A(this,this,t),this}identity(){return function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}(this),this}copy(t){return function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]}(this,t),this}fromMatrix4(t){return function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10]}(this,t),this}fromQuaternion(t){return function(t,e){var i=e[0],s=e[1],r=e[2],n=e[3],a=i+i,h=s+s,o=r+r,d=i*a,u=s*a,c=s*h,l=r*a,p=r*h,g=r*o,m=n*a,_=n*h,f=n*o;t[0]=1-c-g,t[3]=u-f,t[6]=l+_,t[1]=u+f,t[4]=1-d-g,t[7]=p-m,t[2]=l-_,t[5]=p+m,t[8]=1-d-c}(this,t),this}fromBasis(t,e,i){return this.set(t[0],t[1],t[2],e[0],e[1],e[2],i[0],i[1],i[2]),this}invert(t=this){return function(t,e){var i=e[0],s=e[1],r=e[2],n=e[3],a=e[4],h=e[5],o=e[6],d=e[7],u=e[8],c=u*a-h*d,l=-u*n+h*o,p=d*n-a*o,g=i*c+s*l+r*p;g&&(g=1/g,t[0]=c*g,t[1]=(-u*s+r*d)*g,t[2]=(h*s-r*a)*g,t[3]=l*g,t[4]=(u*i-r*o)*g,t[5]=(-h*i+r*n)*g,t[6]=p*g,t[7]=(-d*i+s*o)*g,t[8]=(a*i-s*n)*g)}(this,t),this}}class M{static add(t="void main() {}",e){for(const[i,s]of e)switch(i){case"start":t=t.replace(/^(#version .*?\n(\s*precision highp float;\s)?)?([\s\S]*)/,`$1\n${s}\n$3`);break;case"end":t=t.replace(/(}\s*$)/,`\n${s}\n$1`);break;case"main":t=t.replace(/(\bvoid\b +\bmain\b[\s\S]*?{\s*)/,`$1\n${s}\n`);break;default:t=t.replace(i,s)}return t}constructor({vertexShader:t="#version 300 es\n      void main() {\n        gl_Position = vec4(0., 0., 0., 1.);\n      }\n    ",fragmentShader:e="#version 300 es\n      precision highp float;\n\n      out vec4 fragColor;\n\n      void main() {\n        fragColor = vec4(1.);\n      }\n    ",dataTypeConctructors:i={Vector2:class extends Float32Array{constructor(){super(2)}},Vector3:class extends Float32Array{constructor(){super(3)}},Vector4:class extends Float32Array{constructor(){super(4)}},Matrix3:class extends Float32Array{constructor(){super([1,0,0,0,1,0,0,0,1])}},Matrix4:class extends Float32Array{constructor(){super([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},Texture:class{},TextureCube:class{}},uniforms:s={},vertexShaderChunks:r=[],fragmentShaderChunks:n=[],shaders:a=[]}={}){this.uniforms=s,this.uniformTypes={},this._dataTypeConctructors=i,this.vertexShader=t,this.fragmentShader=e,this._vertexShaderChunks=[],this._fragmentShaderChunks=[],this.add({vertexShaderChunks:r,fragmentShaderChunks:n,uniforms:s});for(const t of a)this.add(t)}add({vertexShaderChunks:t=[],fragmentShaderChunks:e=[],uniforms:i={}}={}){this.vertexShader=M.add(this.vertexShader,t),this._vertexShaderChunks.push(...t),this.fragmentShader=M.add(this.fragmentShader,e),this._fragmentShaderChunks.push(...e);for(const t of Object.keys(i))this.uniforms[t]=i[t]}set vertexShader(t){this._vertexShader=t,this._parseUniforms(this._vertexShader)}get vertexShader(){return this._vertexShader}set fragmentShader(t){this._fragmentShader=t,this._parseUniforms(this._fragmentShader)}get fragmentShader(){return this._fragmentShader}get vertexShaderChunks(){return this._vertexShaderChunks}get fragmentShaderChunks(){return this._fragmentShaderChunks}_addUniform(t,e,i){if(void 0!==this.uniforms[t])return;let s,r;if(this.uniformTypes[t]=e,/float|double/.test(e))s=isNaN(i)?0:new Array(i).fill(0);else if(/int|uint/.test(e))s=isNaN(i)?0:new Array(i).fill(0);else if(/sampler2D/.test(e))s=isNaN(i)?new this._dataTypeConctructors.Texture:new Array(i).fill(void 0).map(t=>new this._dataTypeConctructors.Texture);else if(/samplerCube/.test(e))s=isNaN(i)?new this._dataTypeConctructors.TextureCube:new Array(i).fill(void 0).map(t=>new this._dataTypeConctructors.TextureCube);else if(r=/(.?)vec(\d)/.exec(e)){const t=r[2];s=isNaN(i)?new this._dataTypeConctructors[`Vector${t}`]:new Array(i).fill(void 0).map(e=>new this._dataTypeConctructors[`Vector${t}`])}else if(r=/mat(\d)/.exec(e)){const t=r[1];s=isNaN(i)?new this._dataTypeConctructors[`Matrix${t}`]:new Array(i).fill(void 0).map(e=>new this._dataTypeConctructors[`Matrix${t}`])}else s=void 0;this.uniforms[t]=s}_parseUniforms(t){const e=new Map,i=/struct\s*(.*)\s*{\s*([\s\S]*?)}/g,s=/^\s*(.[^ ]+) (.[^ ;[\]]+)\[? *(\d+)? *\]?/gm;let r;for(;r=i.exec(t);){const t=r[1],i=r[2],n={};let a;for(;a=s.exec(i);){const[,t,e,i]=a,s=parseInt(i);n[e]={type:t,arrayLength:s}}e.set(t,n)}const n=/^\s*uniform (highp|mediump|lowp)? *(.[^ ]+) (.[^ ;[\]]+)\[? *(\d+)? *\]?/gm;let a;for(;a=n.exec(t);){const[,,t,i,s]=a,r=e.get(t);if(r)for(const t of Object.keys(r))this._addUniform(`${i}.${t}`,r[t].type,r[t].arrayLength);else{const e=parseInt(s);this._addUniform(i,t,e)}}}}class C extends M{constructor({gl:t,shader:e={},transformFeedbackVaryings:i}={gl:t}){super({shaders:[e],dataTypeConctructors:{Vector2:m,Vector3:E,Vector4:S,Matrix3:B,Matrix4:n,Texture:class extends d{constructor(){super({gl:t})}},TextureCube:class{}}}),this.gl=t,this._program=t.createProgram(),this._attachedShaders=new Map;const s=this;this._vertexAttribDivisor=()=>{};const r=this.gl.getExtension("ANGLE_instanced_arrays");r?this._vertexAttribDivisor=r.vertexAttribDivisorANGLE.bind(r):this.gl.vertexAttribDivisor&&(this._vertexAttribDivisor=this.gl.vertexAttribDivisor.bind(this.gl));class a extends Map{set(e,{buffer:i,location:r=s._attributesLocations.get(e),size:n,type:a=t.FLOAT,normalized:h=!1,stride:o=0,offset:d=0,divisor:u=0}={}){if(e instanceof Map)for(const[t,i]of e)this.set(t,i);else i.bind(),void 0===r&&(-1===(r=t.getAttribLocation(s._program,e))&&console.warn(`Attribute "${e}" is missing or never used`),s._attributesLocations.set(e,r)),t.enableVertexAttribArray(r),a===t.FLOAT||a===t.HALF_FLOAT?t.vertexAttribPointer(r,n,a,h,o,d):t.vertexAttribIPointer(r,n,a,h,o,d),i.unbind(),s._vertexAttribDivisor(r,u),super.set(e,{buffer:i,size:n,type:a,normalized:h,stride:o,offset:d})}}class h extends Map{set(e,...i){let r=i[0];if(void 0===r)return;let n,a=s._uniformLocations.get(e);if(void 0===a&&(a=t.getUniformLocation(s._program,e),s._uniformLocations.set(e,a)),void 0===r.length){if(r instanceof d){let t=0;for(const a in s.uniformTypes)if(s.uniformTypes[a].startsWith("sampler")){if(a===e){n=r,i=[t];break}t++}}else if(r instanceof Object){for(const t of Object.keys(r))s.uniforms.set(`${e}.${t}`,r[t]);return}i.length>1?(r=s.uniforms.get(e),r.set(...i)):r=i}else if(r[0]instanceof Object){for(let t=0;t<r.length;t++)if(r[0].length)s.uniforms.set(`${e}[${t}]`,r[t]);else for(const i of Object.keys(r[t]))s.uniforms.set(`${e}[${t}].${i}`,r[t][i]);return}if(null===a)return;const h=s.uniformTypes[e.replace(/\[.*?\]/,"")];"float"===h||"bool"===h?t.uniform1fv(a,r):"vec2"===h?t.uniform2fv(a,r):"vec3"===h?t.uniform3fv(a,r):"vec4"===h?t.uniform4fv(a,r):"int"===h||h.startsWith("sampler")?t.uniform1iv(a,r):"ivec2"===h?t.uniform2iv(a,r):"ivec3"===h?t.uniform3iv(a,r):"ivec4"===h?t.uniform4iv(a,r):"mat3"===h?t.uniformMatrix3fv(a,!1,r):"mat4"===h&&t.uniformMatrix4fv(a,!1,r),super.set(e,n||r)}}i&&this.gl.transformFeedbackVaryings(this._program,i,t.INTERLEAVED_ATTRIBS),this.vertexShader=this.vertexShader,this.fragmentShader=this.fragmentShader,this.use(),this.attributes=new a;const o=this.uniforms;this.uniforms=new h;for(const t of Object.keys(o))this.uniforms.set(t,o[t])}set vertexShader(t){super.vertexShader=t,this.gl&&this._updateShader(this.gl.VERTEX_SHADER,this.vertexShader)}get vertexShader(){return super.vertexShader}set fragmentShader(t){super.fragmentShader=t,this.gl&&this._updateShader(this.gl.FRAGMENT_SHADER,this.fragmentShader)}get fragmentShader(){return super.fragmentShader}use(){this.gl.useProgram(this._program)}_updateShader(t,e){if(!e)return;if(this.gl.getParameter(this.gl.VERSION).startsWith("WebGL 1.0"))if(e=(e=e.replace(/#version.*?\n/g,"")).replace(/\btexture\b/g,"texture2D"),t===this.gl.VERTEX_SHADER)e=(e=e.replace(/(^\s*)\bin\b/gm,"$1attribute")).replace(/(^\s*)\bout\b/gm,"$1varying");else{e=e.replace(/(^\s*)\bin\b/gm,"$1varying");const t=/out vec4 (.*?);/.exec(e);if(t){const i=t[1];e=(e=e.replace(/out.*?;/,"")).replace(new RegExp(`\\b${i}\\b`,"g"),"gl_FragColor")}}const i=this.gl.createShader(t);this.gl.shaderSource(i,e),this.gl.compileShader(i);const s=this.gl.getShaderInfoLog(i);if(!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)){const i=/ERROR: 0:(\d+):/.exec(s);if(i){const r=parseFloat(i[1]),n=e.split("\n"),a=t===this.gl.VERTEX_SHADER?"Vertex Shader":"Fragment Shader";throw console.groupCollapsed(`${a} source`),console.warn(e),console.groupEnd(),new Error(`${a}: ${s}\nat: ${n[r-1].replace(/^\s*/,"")}`)}throw new Error(s)}s&&console.warn(s);const r=this._attachedShaders.get(t);if(r&&(this.gl.detachShader(this._program,r),this.gl.deleteShader(r)),this.gl.attachShader(this._program,i),this.gl.deleteShader(i),this._attachedShaders.set(t,i),2===this._attachedShaders.size){this.gl.linkProgram(this._program);const t=this.gl.getProgramInfoLog(this._program);if(!this.gl.getProgramParameter(this._program,this.gl.LINK_STATUS))throw new Error(t);t&&console.warn(t),this._attributesLocations=new Map,this._uniformLocations=new Map}}}class F extends class{constructor({gl:t,mesh:e,program:i,vertexArray:s=new o({gl:t,mesh:e,program:i})}){this.gl=t,this.mesh=e,this.program=i,this.vertexArray=s,this._boundTextures=new Set}bind(){this.program.use(),this.vertexArray.bind();let t=0;for(const e in this.program.uniformTypes)if(this.program.uniformTypes[e].startsWith("sampler")){const i=this.program.uniforms.get(e);i instanceof d&&(i.bind({unit:t}),this._boundTextures.add(i)),t++}}draw(t){t=Object.assign({bind:!0,uniforms:{}},t),this.program.use();for(const e of Object.keys(t.uniforms))this.program.uniforms.set(e,t.uniforms[e]);t.bind&&this.bind(),this.mesh.draw(t),t.bind&&this.unbind()}unbind(){this.vertexArray.unbind();for(const t of this._boundTextures)t.unbind(),this._boundTextures.delete(t)}}{constructor({gl:t,width:e,height:i,depth:s,widthSegments:r,heightSegments:n,depthSegments:a,normals:o=!1,uvs:d=!1,attributes:u={},program:c=new C({gl:t,shader:{vertexShaderChunks:[["start","\n            in vec3 position;\n          "],["end","\n            gl_Position = vec4(position, 1.);\n          "]]}})}){super({gl:t,mesh:new l(Object.assign({gl:t,attributes:u},new h({width:e,height:i,depth:s,widthSegments:r,heightSegments:n,depthSegments:a,normals:o,uvs:d}))),program:c})}}const z=new Map;class P extends m{static get TOUCH_TYPE(){return"touchtype"}static get MOUSE_TYPE(){return"mousetype"}static get(t=window){let e=z.get(t);return e||(e=new P(t)),e}get downed(){return this._downed}constructor(e){super(),this._domElement=e||window,this.type=P.TOUCH_TYPE,this.velocity=new m,this.dragOffset=new m,this.centered=new m,this.centeredFlippedY=new m,this.normalized=new m,this.normalizedFlippedY=new m,this.normalizedCentered=new m,this.normalizedCenteredFlippedY=new m,this._downed=!1,z.set(this._domElement,this),this.onDown=new t,this.onMove=new t,this.onUp=new t,this.onClick=new t,this.onTypeChange=new t,this._preventMouseTypeChange=!1,this._onPointerMoveBinded=this._onPointerMove.bind(this),this._onPointerDownBinded=this._onPointerDown.bind(this),this._onPointerUpBinded=this._onPointerUp.bind(this),this._updateBinded=this._update.bind(this),this._resizeBinded=this.resize.bind(this),this._position=new m,this.enable()}resize(){this._domElementBoundingRect=this._domElement===window?{left:0,top:0,width:window.innerWidth,height:window.innerHeight}:this._domElement.getBoundingClientRect()}_onPointerDown(t){this.resize(),"touchstart"===t.type&&(this._preventMouseTypeChange=!0,this._changeType(P.TOUCH_TYPE)),this._downed=!0,this.dragOffset.set(0,0),this.copy(this._position),this._onPointerEvent(t),this._updatePositions(),this.onDown.dispatch(t)}_onPointerMove(t){if("mousemove"===t.type){if(this._preventMouseTypeChange)return;this._changeType(P.MOUSE_TYPE)}this._onPointerEvent(t),this.onMove.dispatch(t)}_onPointerUp(t){this._downed&&(this._downed=!1,this._onPointerEvent(t),this._updatePositions(),this.onUp.dispatch(t),this.dragOffset.size<4&&this.onClick.dispatch(t),clearTimeout(this._timeout),this._timeout=setTimeout(()=>{this._preventMouseTypeChange=!1},2e3))}_onPointerEvent(t){window.TouchEvent&&t instanceof window.TouchEvent&&(t="touchend"===t.type?t.changedTouches[0]:t.touches[0]),this._position.x=t.clientX-this._domElementBoundingRect.left,this._position.y=t.clientY-this._domElementBoundingRect.top}_changeType(t){this.type!==t&&(this.type=t,this.disable(),this.enable(),this.onTypeChange.dispatch(this.type))}_update(){(this.x||this.y)&&(this.velocity.x=this._position.x-this.x,this.velocity.y=this._position.y-this.y,this.downed&&this.dragOffset.add(this.velocity)),this._updatePositions()}_updatePositions(){this.x=this._position.x,this.y=this._position.y,(this.x||this.y)&&(this.centered.x=this.centeredFlippedY.x=this.x-.5*this._domElementBoundingRect.width,this.centered.y=this.centeredFlippedY.y=this.y-.5*this._domElementBoundingRect.height,this.centeredFlippedY.y*=-1,this.normalized.x=this.normalizedFlippedY.x=this.x/this._domElementBoundingRect.width,this.normalized.y=this.normalizedFlippedY.y=this.y/this._domElementBoundingRect.height,this.normalizedFlippedY.y=1-this.normalizedFlippedY.y,this.normalizedCentered.x=this.normalizedCenteredFlippedY.x=2*this.normalized.x-1,this.normalizedCentered.y=this.normalizedCenteredFlippedY.y=2*this.normalized.y-1,this.normalizedCenteredFlippedY.y*=-1)}enable(){this.disable(),this.resize(),this.type===P.TOUCH_TYPE?(this._domElement.addEventListener("touchmove",this._onPointerMoveBinded,{passive:!0}),window.addEventListener("touchend",this._onPointerUpBinded,{passive:!0})):(this._domElement.addEventListener("mousedown",this._onPointerDownBinded),window.addEventListener("mouseup",this._onPointerUpBinded)),this._domElement.addEventListener("touchstart",this._onPointerDownBinded,{passive:!0}),this._domElement.addEventListener("mousemove",this._onPointerMoveBinded),window.addEventListener("resize",this._resizeBinded),e.add(this._updateBinded=this._updateBinded||this._update.bind(this))}disable(){e.delete(this._updateBinded),this._domElement.removeEventListener("touchstart",this._onPointerDownBinded),this._domElement.removeEventListener("mousedown",this._onPointerDownBinded),this._domElement.removeEventListener("touchmove",this._onPointerMoveBinded),this._domElement.removeEventListener("mousemove",this._onPointerMoveBinded),window.removeEventListener("touchend",this._onPointerUpBinded),window.removeEventListener("mouseup",this._onPointerUpBinded),window.removeEventListener("resize",this._resizeBinded)}}function R(){var t=new s(4);return s!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function L(t,e,i){var s=e[0],r=e[1],n=e[2],a=e[3],h=i[0],o=i[1],d=i[2],u=i[3];return t[0]=s*u+a*h+r*d-n*o,t[1]=r*u+a*o+n*h-s*d,t[2]=n*u+a*d+s*o-r*h,t[3]=a*u-s*h-r*o-n*d,t}function k(t,e,i,s){var r,n,a,h,o,d=e[0],u=e[1],c=e[2],l=e[3],p=i[0],g=i[1],m=i[2],_=i[3];return(n=d*p+u*g+c*m+l*_)<0&&(n=-n,p=-p,g=-g,m=-m,_=-_),1-n>1e-6?(r=Math.acos(n),a=Math.sin(r),h=Math.sin((1-s)*r)/a,o=Math.sin(s*r)/a):(h=1-s,o=s),t[0]=h*d+o*p,t[1]=h*u+o*g,t[2]=h*c+o*m,t[3]=h*l+o*_,t}function D(t,e){var i,s=e[0]+e[4]+e[8];if(s>0)i=Math.sqrt(s+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var n=(r+1)%3,a=(r+2)%3;i=Math.sqrt(e[3*r+r]-e[3*n+n]-e[3*a+a]+1),t[r]=.5*i,i=.5/i,t[3]=(e[3*n+a]-e[3*a+n])*i,t[n]=(e[3*n+r]+e[3*r+n])*i,t[a]=(e[3*a+r]+e[3*r+a])*i}return t}var U,O,I,j,$,N,V=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Y=T,H=function(t,e){var i=e[0],s=e[1],r=e[2],n=e[3],a=i*i+s*s+r*r+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=i*a,t[1]=s*a,t[2]=r*a,t[3]=n*a,t};U=_(),O=v(1,0,0),I=v(0,1,0),j=R(),$=R(),N=function(){var t=new s(9);return s!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}();class W extends Float32Array{constructor(t=0,e=0,i=0,s=1){return super(4),this.set(t,e,i,s),this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get w(){return this[3]}set w(t){this[3]=t}identity(){return function(t){t[0]=0,t[1]=0,t[2]=0,t[3]=1}(this),this}set(t,e,i,s){return Y(this,t,e,i,s),this}rotateX(t){return function(t,e,i){i*=.5;var s=e[0],r=e[1],n=e[2],a=e[3],h=Math.sin(i),o=Math.cos(i);t[0]=s*o+a*h,t[1]=r*o+n*h,t[2]=n*o-r*h,t[3]=a*o-s*h}(this,this,t),this}rotateY(t){return function(t,e,i){i*=.5;var s=e[0],r=e[1],n=e[2],a=e[3],h=Math.sin(i),o=Math.cos(i);t[0]=s*o-n*h,t[1]=r*o+a*h,t[2]=n*o+s*h,t[3]=a*o-r*h}(this,this,t),this}rotateZ(t){return function(t,e,i){i*=.5;var s=e[0],r=e[1],n=e[2],a=e[3],h=Math.sin(i),o=Math.cos(i);t[0]=s*o+r*h,t[1]=r*o-s*h,t[2]=n*o+a*h,t[3]=a*o-n*h}(this,this,t),this}invert(t=this){return function(t,e){var i=e[0],s=e[1],r=e[2],n=e[3],a=i*i+s*s+r*r+n*n,h=a?1/a:0;t[0]=-i*h,t[1]=-s*h,t[2]=-r*h,t[3]=n*h}(this,t),this}copy(t){return V(this,t),this}normalize(t=this){return H(this,this),this}multiply(t,e){return e?L(this,t,e):L(this,this,t),this}fromMatrix3(t){return D(this,t),this}}class G{constructor({matrix:t=new n,domElement:e=document.body,distance:i=0,invertRotation:s=!0,rotationEaseRatio:r=.04,zoomSpeed:a=.1,zoomEaseRatio:h=.1,minDistance:o=0,maxDistance:d=1/0,enabled:u=!0}={}){this.matrix=t,this._distance=i,this.invertRotation=s,this.rotationEaseRatio=r,this.maxDistance=d,this.minDistance=o,this.zoomSpeed=a,this.zoomEaseRatio=h,this._pointer=P.get(e),this._nextDistance=this._distance,this._cachedQuaternion=new W,this._cachedMatrix=new n,this._cachedVector3=new E,this._velocity=new m,this._velocityOrigin=new m,this._position=new E([this.matrix.x,this.matrix.y,this.matrix.z]),this._positionPrevious=this._position.clone(),this._positionOffset=new E,e.addEventListener("wheel",this.onWheel.bind(this),{passive:!0}),this.enabled=!0,this.update(),this.enabled=u}set distance(t){this._distance=this._nextDistance=t}get distance(){return this._distance}onWheel(t){if(!this.enabled)return;const e=1+Math.abs(t.deltaY*this.zoomSpeed*.01);this._nextDistance=this._nextDistance||1,this._nextDistance=t.deltaY>0?this._nextDistance*e:this._nextDistance/e,this._nextDistance=Math.max(Math.min(this._nextDistance,this.maxDistance),this.minDistance)}update(){this.enabled&&(this._cachedMatrix.identity(),this._cachedQuaternion.identity(),this._distance+=(this._nextDistance-this._distance)*this.zoomEaseRatio,this._position.set(this.matrix.x,this.matrix.y,this.matrix.z).subtract(this._positionOffset),this.matrix.x=0,this.matrix.y=0,this.matrix.z=0,this._pointer.downed&&this._velocity.copy(this._pointer.velocity).scale(.003),this._velocity.lerp(this._velocityOrigin,this.rotationEaseRatio),this._cachedQuaternion.rotateY(this.invertRotation?-this._velocity.x:this._velocity.x),this._cachedQuaternion.rotateX(this.invertRotation?-this._velocity.y:this._velocity.y),this._cachedMatrix.fromQuaternion(this._cachedQuaternion),this.matrix.multiply(this._cachedMatrix),this._positionOffset.set(0,0,1),this._positionOffset.applyMatrix4(this.matrix),this._positionOffset.scale(this._distance),this._cachedVector3.copy(this._position).add(this._positionOffset),this.matrix.x=this._cachedVector3.x,this.matrix.y=this._cachedVector3.y,this.matrix.z=this._cachedVector3.z)}}class q extends M{constructor({positions:t=!0,normals:e=!1,uvs:i=!1,uniforms:s,vertexShaderChunks:r=[],fragmentShaderChunks:n=[],shaders:a=[]}={}){super({uniforms:s,vertexShaderChunks:[["start",`\n          uniform mat4 projectionView;\n          uniform mat4 transform;\n  \n          ${t?"in vec3 position;":""}\n          ${e?"in vec3 normal;":""}\n          ${i?"in vec2 uv;":""}\n  \n          ${t?"out vec3 vPosition;":""}\n          ${e?"out vec3 vNormal;":""}\n          ${i?"out vec2 vUV;":""}\n        `],["main",`\n          ${t?"vPosition = position;":""}\n          ${e?"vNormal = normal;":""}\n          ${i?"vUV = uv;":""}\n        `],["end","\n          gl_Position = projectionView * transform * vec4(position, 1.);\n        "],...r],fragmentShaderChunks:[["start",`\n          ${t?"in vec3 vPosition;":""}\n          ${e?"in vec3 vNormal;":""}\n          ${i?"in vec2 vUV;":""}\n        `],...n],shaders:a})}}class X{constructor({canvas:t}={}){this.canvas=t;const e={depth:!0,alpha:!1,antialias:!0};/\bforcewebgl1\b/.test(window.location.search)||(this.gl=this.canvas.getContext("webgl2",e)),this.gl||(this.gl=this.canvas.getContext("webgl",e)||this.canvas.getContext("experimental-webgl",e)),this.camera=new a,this.cameraController=new G({matrix:this.camera.transform,distance:5}),this.gl.clearColor(0,0,0,1),this.gl.enable(this.gl.CULL_FACE),this.gl.enable(this.gl.DEPTH_TEST),this.object=new F({gl:this.gl,width:1,height:1,normals:!0,program:new C({gl:this.gl,shader:new q({normals:!0,fragmentShaderChunks:[["end","\n              fragColor = vec4(vNormal * .5 + .5, 1.);\n            "]]})})})}resize(t,e){this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.camera.aspectRatio=t/e,this.update()}update(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.cameraController.update(),this.object.draw({uniforms:{projectionView:this.camera.projectionView}})}}window.customElements.define("starter-main",class extends i{constructor(){super(),this._resizeBinded=this.resize.bind(this),this.attachShadow({mode:"open"}).innerHTML="\n      <style>\n        :host {\n          display: block;\n        }\n        \n        canvas {\n          width: 100%;\n          height: 100%;\n        }\n      </style>\n      <canvas></canvas>\n    ",this.canvas=this.shadowRoot.querySelector("canvas"),this.view=new X({canvas:this.canvas})}connectedCallback(){super.connectedCallback(),window.addEventListener("resize",this._resizeBinded),this.resize(),this.play()}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("resize",this._resizeBinded)}resize(){const t=this.canvas.offsetWidth,e=this.canvas.offsetHeight;this.canvas.width=t*window.devicePixelRatio,this.canvas.height=e*window.devicePixelRatio,this.view.resize(t,e)}update(){this.view.update()}});