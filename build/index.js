(function(){"use strict";function e(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function t(e,t,n,a,r,i,d,o,s,l,_,u,c,m,g,p,f){return e[0]=t,e[1]=n,e[2]=a,e[3]=r,e[4]=i,e[5]=d,e[6]=o,e[7]=s,e[8]=l,e[9]=_,e[10]=u,e[11]=c,e[12]=m,e[13]=g,e[14]=p,e[15]=f,e}function n(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function a(e,t){let n=t[0],a=t[1],r=t[2],i=t[3],d=t[4],o=t[5],s=t[6],l=t[7],_=t[8],u=t[9],c=t[10],m=t[11],g=t[12],p=t[13],f=t[14],h=t[15],v=n*o-a*d,y=n*s-r*d,x=n*l-i*d,E=a*s-r*o,b=a*l-i*o,T=r*l-i*s,S=_*p-u*g,B=_*f-c*g,w=_*h-m*g,P=u*f-c*p,C=u*h-m*p,R=c*h-m*f,A=v*R-y*C+x*P+E*w-b*B+T*S;return A?(A=1/A,e[0]=(o*R-s*C+l*P)*A,e[1]=(r*C-a*R-i*P)*A,e[2]=(p*T-f*b+h*E)*A,e[3]=(c*b-u*T-m*E)*A,e[4]=(s*w-d*R-l*B)*A,e[5]=(n*R-r*w+i*B)*A,e[6]=(f*x-g*T-h*y)*A,e[7]=(_*T-c*x+m*y)*A,e[8]=(d*C-o*w+l*S)*A,e[9]=(a*w-n*C-i*S)*A,e[10]=(g*b-p*x+h*v)*A,e[11]=(u*x-_*b-m*v)*A,e[12]=(o*B-d*P-s*S)*A,e[13]=(n*P-a*B+r*S)*A,e[14]=(p*y-g*E-f*v)*A,e[15]=(_*E-u*y+c*v)*A,e):null}function r(e,t,n){let a=t[0],r=t[1],i=t[2],d=t[3],o=t[4],s=t[5],l=t[6],_=t[7],u=t[8],c=t[9],m=t[10],g=t[11],p=t[12],f=t[13],h=t[14],v=t[15],y=n[0],x=n[1],E=n[2],b=n[3];return e[0]=y*a+x*o+E*u+b*p,e[1]=y*r+x*s+E*c+b*f,e[2]=y*i+x*l+E*m+b*h,e[3]=y*d+x*_+E*g+b*v,y=n[4],x=n[5],E=n[6],b=n[7],e[4]=y*a+x*o+E*u+b*p,e[5]=y*r+x*s+E*c+b*f,e[6]=y*i+x*l+E*m+b*h,e[7]=y*d+x*_+E*g+b*v,y=n[8],x=n[9],E=n[10],b=n[11],e[8]=y*a+x*o+E*u+b*p,e[9]=y*r+x*s+E*c+b*f,e[10]=y*i+x*l+E*m+b*h,e[11]=y*d+x*_+E*g+b*v,y=n[12],x=n[13],E=n[14],b=n[15],e[12]=y*a+x*o+E*u+b*p,e[13]=y*r+x*s+E*c+b*f,e[14]=y*i+x*l+E*m+b*h,e[15]=y*d+x*_+E*g+b*v,e}function i(e,t,n){let a,r,i,d,o,s,l,_,u,c,m,g,p=n[0],f=n[1],h=n[2];return t===e?(e[12]=t[0]*p+t[4]*f+t[8]*h+t[12],e[13]=t[1]*p+t[5]*f+t[9]*h+t[13],e[14]=t[2]*p+t[6]*f+t[10]*h+t[14],e[15]=t[3]*p+t[7]*f+t[11]*h+t[15]):(a=t[0],r=t[1],i=t[2],d=t[3],o=t[4],s=t[5],l=t[6],_=t[7],u=t[8],c=t[9],m=t[10],g=t[11],e[0]=a,e[1]=r,e[2]=i,e[3]=d,e[4]=o,e[5]=s,e[6]=l,e[7]=_,e[8]=u,e[9]=c,e[10]=m,e[11]=g,e[12]=a*p+o*f+u*h+t[12],e[13]=r*p+s*f+c*h+t[13],e[14]=i*p+l*f+m*h+t[14],e[15]=d*p+_*f+g*h+t[15]),e}function d(e,t,n){let a=n[0],r=n[1],i=n[2];return e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e[3]=t[3]*a,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function o(e,t,n){let a=ve(n),r=he(n),i=t[4],d=t[5],o=t[6],s=t[7],l=t[8],_=t[9],u=t[10],c=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*r+l*a,e[5]=d*r+_*a,e[6]=o*r+u*a,e[7]=s*r+c*a,e[8]=l*r-i*a,e[9]=_*r-d*a,e[10]=u*r-o*a,e[11]=c*r-s*a,e}function s(e,t,n){let a=ve(n),r=he(n),i=t[0],d=t[1],o=t[2],s=t[3],l=t[8],_=t[9],u=t[10],c=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*r-l*a,e[1]=d*r-_*a,e[2]=o*r-u*a,e[3]=s*r-c*a,e[8]=i*a+l*r,e[9]=d*a+_*r,e[10]=o*a+u*r,e[11]=s*a+c*r,e}function l(e,t,n){let a=ve(n),r=he(n),i=t[0],d=t[1],o=t[2],s=t[3],l=t[4],_=t[5],u=t[6],c=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*r+l*a,e[1]=d*r+_*a,e[2]=o*r+u*a,e[3]=s*r+c*a,e[4]=l*r-i*a,e[5]=_*r-d*a,e[6]=u*r-o*a,e[7]=c*r-s*a,e}function _(e,t){let n=t[0],a=t[1],r=t[2],i=t[3],d=n+n,o=a+a,s=r+r,l=n*d,_=a*d,u=a*o,c=r*d,m=r*o,g=r*s,p=i*d,f=i*o,h=i*s;return e[0]=1-u-g,e[1]=_+h,e[2]=c-f,e[3]=0,e[4]=_-h,e[5]=1-l-g,e[6]=m+p,e[7]=0,e[8]=c+f,e[9]=m-p,e[10]=1-l-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function u(e,t,n,a,r){let i=1/Math.tan(t/2),d=1/(a-r);return e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(r+a)*d,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*r*a*d,e[15]=0,e}function c(){let e=new Te(2);return e[0]=0,e[1]=0,e}function m(e,t){return e[0]=t[0],e[1]=t[1],e}function g(e,t,n){return e[0]=t,e[1]=n,e}function p(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function f(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function h(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function v(e){var t=e[0],n=e[1];return fe(t*t+n*n)}function y(e){var t=e[0],n=e[1];return t*t+n*n}function x(e,t){return e[0]=-t[0],e[1]=-t[1],e}function E(e,t){var n=t[0],a=t[1],r=n*n+a*a;return 0<r&&(r=1/fe(r),e[0]=t[0]*r,e[1]=t[1]*r),e}function b(e,t){return e[0]*t[0]+e[1]*t[1]}function T(e,t,n){var a=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=a,e}function S(e,n,a,r){var t=n[0],i=n[1];return e[0]=t+r*(a[0]-t),e[1]=i+r*(a[1]-i),e}function B(e,t,n){var a=t[0],r=t[1];return e[0]=n[0]*a+n[3]*r+n[6],e[1]=n[1]*a+n[4]*r+n[7],e}function w(e,t,n){let a=t[0],r=t[1];return e[0]=n[0]*a+n[4]*r+n[12],e[1]=n[1]*a+n[5]*r+n[13],e}function P(e,t){return e[0]===t[0]&&e[1]===t[1]}function C(){let e=new Te(3);return e[0]=0,e[1]=0,e[2]=0,e}function R(e){let t=e[0],n=e[1],a=e[2];return fe(t*t+n*n+a*a)}function A(e,t,n){let a=new Te(3);return a[0]=e,a[1]=t,a[2]=n,a}function z(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function L(e,t,n,a){return e[0]=t,e[1]=n,e[2]=a,e}function F(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function D(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function I(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function U(e,t){let n=t[0]-e[0],a=t[1]-e[1],r=t[2]-e[2];return fe(n*n+a*a+r*r)}function k(e){let t=e[0],n=e[1],a=e[2];return t*t+n*n+a*a}function M(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function V(e,t){let n=t[0],a=t[1],r=t[2],i=n*n+a*a+r*r;return 0<i&&(i=1/fe(i),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i),e}function O(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Y(e,t,n){let a=t[0],r=t[1],i=t[2],d=n[0],o=n[1],s=n[2];return e[0]=r*s-i*o,e[1]=i*d-a*s,e[2]=a*o-r*d,e}function N(e,t,n){let a=t[0],r=t[1],i=t[2],d=n[3]*a+n[7]*r+n[11]*i+n[15];return d=d||1,e[0]=(n[0]*a+n[4]*r+n[8]*i+n[12])/d,e[1]=(n[1]*a+n[5]*r+n[9]*i+n[13])/d,e[2]=(n[2]*a+n[6]*r+n[10]*i+n[14])/d,e}function G(e,t){let n=A(e[0],e[1],e[2]),a=A(t[0],t[1],t[2]);V(n,n),V(a,a);let r=O(n,a);return 1<r?0:-1>r?ye:ge(r)}function W(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function j(){let e=new Te(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function H(e,t,n,a,r){return e[0]=t,e[1]=n,e[2]=a,e[3]=r,e}function X(){let e=new Te(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Q(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function q(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function K(e,t,n,a,r,i,d,o,s,l){return e[0]=t,e[1]=n,e[2]=a,e[3]=r,e[4]=i,e[5]=d,e[6]=o,e[7]=s,e[8]=l,e}function J(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Z(e,t){let n=t[0],a=t[1],r=t[2],i=t[3],d=t[4],o=t[5],s=t[6],l=t[7],_=t[8],u=_*d-o*l,c=-_*i+o*s,m=l*i-d*s,g=n*u+a*c+r*m;return g?(g=1/g,e[0]=u*g,e[1]=(-_*a+r*l)*g,e[2]=(o*a-r*d)*g,e[3]=c*g,e[4]=(_*n-r*s)*g,e[5]=(-o*n+r*i)*g,e[6]=m*g,e[7]=(-l*n+a*s)*g,e[8]=(d*n-a*i)*g,e):null}function $(e,t,n){let a=t[0],r=t[1],i=t[2],d=t[3],o=t[4],s=t[5],l=t[6],_=t[7],u=t[8],c=n[0],m=n[1],g=n[2],p=n[3],f=n[4],h=n[5],v=n[6],y=n[7],x=n[8];return e[0]=c*a+m*d+g*l,e[1]=c*r+m*o+g*_,e[2]=c*i+m*s+g*u,e[3]=p*a+f*d+h*l,e[4]=p*r+f*o+h*_,e[5]=p*i+f*s+h*u,e[6]=v*a+y*d+x*l,e[7]=v*r+y*o+x*_,e[8]=v*i+y*s+x*u,e}function ee(e,t,n){let a=t[0],r=t[1],i=t[2],d=t[3],o=t[4],s=t[5],l=t[6],_=t[7],u=t[8],c=n[0],m=n[1];return e[0]=a,e[1]=r,e[2]=i,e[3]=d,e[4]=o,e[5]=s,e[6]=c*a+m*d+l,e[7]=c*r+m*o+_,e[8]=c*i+m*s+u,e}function te(e,t,n){let a=t[0],r=t[1],i=t[2],d=t[3],o=t[4],l=t[5],_=t[6],u=t[7],m=t[8],g=ve(n),s=he(n);return e[0]=s*a+g*d,e[1]=s*r+g*o,e[2]=s*i+g*l,e[3]=s*d-g*a,e[4]=s*o-g*r,e[5]=s*l-g*i,e[6]=_,e[7]=u,e[8]=m,e}function ne(e,t,n){let a=n[0],r=n[1];return e[0]=a*t[0],e[1]=a*t[1],e[2]=a*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function ae(e,t){let n=t[0],a=t[1],r=t[2],i=t[3],d=n+n,o=a+a,s=r+r,l=n*d,_=a*d,u=a*o,c=r*d,m=r*o,g=r*s,p=i*d,f=i*o,h=i*s;return e[0]=1-u-g,e[3]=_-h,e[6]=c+f,e[1]=_+h,e[4]=1-l-g,e[7]=m-p,e[2]=c-f,e[5]=m+p,e[8]=1-l-u,e}function re(){let e=new Te(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function ie(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function de(e,t,n){n*=.5;let a=ve(n);return e[0]=a*t[0],e[1]=a*t[1],e[2]=a*t[2],e[3]=he(n),e}function oe(e,t,n){let a=t[0],r=t[1],i=t[2],d=t[3],o=n[0],s=n[1],l=n[2],_=n[3];return e[0]=a*_+d*o+r*l-i*s,e[1]=r*_+d*s+i*o-a*l,e[2]=i*_+d*l+a*s-r*o,e[3]=d*_-a*o-r*s-i*l,e}function se(e,t,n){n*=.5;let a=t[0],r=t[1],i=t[2],d=t[3],o=ve(n),s=he(n);return e[0]=a*s+d*o,e[1]=r*s+i*o,e[2]=i*s-r*o,e[3]=d*s-a*o,e}function le(e,t,n){n*=.5;let a=t[0],r=t[1],i=t[2],d=t[3],o=ve(n),s=he(n);return e[0]=a*s-i*o,e[1]=r*s+d*o,e[2]=i*s+a*o,e[3]=d*s-r*o,e}function _e(e,t,n){n*=.5;let a=t[0],r=t[1],i=t[2],d=t[3],o=ve(n),s=he(n);return e[0]=a*s+r*o,e[1]=r*s-a*o,e[2]=i*s+d*o,e[3]=d*s-i*o,e}function ue(e,n,a,r){let t,i,d,o,s,l=n[0],_=n[1],u=n[2],c=n[3],m=a[0],g=a[1],p=a[2],f=a[3];return i=l*m+_*g+u*p+c*f,0>i&&(i=-i,m=-m,g=-g,p=-p,f=-f),1e-6<1-i?(t=ge(i),d=ve(t),o=ve((1-r)*t)/d,s=ve(r*t)/d):(o=1-r,s=r),e[0]=o*l+s*m,e[1]=o*_+s*g,e[2]=o*u+s*p,e[3]=o*c+s*f,e}function ce(e,t){let n=t[0],a=t[1],r=t[2],i=t[3],d=n*n+a*a+r*r+i*i,o=d?1/d:0;return e[0]=-n*o,e[1]=-a*o,e[2]=-r*o,e[3]=i*o,e}function me(e,t){let n,a=t[0]+t[4]+t[8];if(0<a)n=fe(a+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);let r=(a+1)%3,i=(a+2)%3;n=fe(t[3*a+a]-t[3*r+r]-t[3*i+i]+1),e[a]=.5*n,n=.5/n,e[3]=(t[3*r+i]-t[3*i+r])*n,e[r]=(t[3*r+a]+t[3*a+r])*n,e[i]=(t[3*i+a]+t[3*a+i])*n}return e}var ge=Math.acos,pe=Math.min,fe=Math.sqrt,he=Math.cos,ve=Math.sin,ye=Math.PI;class xe extends Set{constructor(){super(),this._onceCallbacks=new Set}add(e,{once:t=!1}={}){t&&this._onceCallbacks.add(e),super.add(e)}dispatch(e){for(let t of this)t(e),this._onceCallbacks.has(t)&&(this._onceCallbacks.delete(t),this.delete(t))}}var Ee=new class extends xe{constructor(){super(),this._updateBinded=this._update.bind(this),this.time=.001*window.performance.now(),this._previousTime=this.time,this.deltaTime=0,this.timeScale=1,this._update()}_update(){requestAnimationFrame(this._updateBinded),this.time=.001*window.performance.now(),this.deltaTime=this.time-this._previousTime,this.timeScale=this.deltaTime/.0166666667,this._previousTime=this.time,this.dispatch()}};class be extends HTMLElement{constructor({autoplay:e=!1,background:t=!1}={}){super(),this._autoplay=e||this.hasAttribute("autoplay"),this._background=t||this.hasAttribute("background"),this.paused=!0,this._pausedByBlur=!1,this._updateBinded=this.update.bind(this)}connectedCallback(){this._background||(window.top.addEventListener("blur",this._onBlur=()=>{this._pausedByBlur=!this.paused,this.pause()}),window.top.addEventListener("focus",this._onFocus=()=>{this._pausedByBlur&&this.play()})),(window.top.document.hasFocus()||this._background)&&this._autoplay?this.play():this._autoplay&&(this._pausedByBlur=!0,requestAnimationFrame(this._updateBinded))}disconnectedCallback(){this.pause(),window.top.removeEventListener("blur",this._onBlur),window.top.removeEventListener("focus",this._onFocus)}play(){this.paused=!1,this._pausedByBlur=!1,Ee.add(this._updateBinded),this.dispatchEvent(new Event("playing"))}pause(){this.paused=!0,Ee.delete(this._updateBinded),this.dispatchEvent(new Event("pause"))}update(){}}window.customElements.define("dlib-loop",be);let Te="undefined"==typeof Float32Array?Array:Float32Array;class Se extends Float32Array{constructor(e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return super(e),this}set x(e){this[12]=e}get x(){return this[12]}set y(e){this[13]=e}get y(){return this[13]}set z(e){this[14]=e}get z(){return this[14]}set w(e){this[15]=e}get w(){return this[15]}set(e,n,a,r,i,d,o,s,l,_,u,c,m,g,p,f){return e.length?this.copy(e):(t(this,e,n,a,r,i,d,o,s,l,_,u,c,m,g,p,f),this)}translate(e,t=this){return i(this,t,e),this}rotateX(e,t=this){return o(this,t,e),this}rotateY(e,t=this){return s(this,t,e),this}rotateZ(e,t=this){return l(this,t,e),this}scale(e,t=this){return d(this,t,"number"==typeof e?[e,e,e]:e),this}multiply(e,t){return t?r(this,e,t):r(this,this,e),this}identity(){return n(this),this}copy(t){return e(this,t),this}fromPerspective({fov:e,aspectRatio:t,near:n,far:a}={}){return u(this,e,t,n,a),this}fromQuaternion(e){return _(this,e),this}setPosition(e){return this.x=e[0],this.y=e[1],this.z=e[2],this}invert(e=this){return a(this,e),this}}(function(){let e=c();return function(t,n,a,r,d,o){let s,_;for(n||(n=2),a||(a=0),_=r?pe(r*n+a,t.length):t.length,s=a;s<_;s+=n)e[0]=t[s],e[1]=t[s+1],d(e,e,o),t[s]=e[0],t[s+1]=e[1];return t}})();class Be extends Float32Array{constructor(e=[0,0]){return super(e),this}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}set(e,t){return g(this,e,t),this}copy(e){return m(this,e),this}add(e){return p(this,this,e),this}get size(){return v(this)}get squaredSize(){return y(this)}subtract(e){return f(this,this,e),this}negate(e=this){return x(this,e),this}cross(e,t){return T(this,e,t),this}scale(e){return h(this,this,e),this}normalize(){E(this,this)}dot(e){return b(this,e)}equals(e){return P(this,e)}applyMatrix3(e){return B(this,this,e),this}applyMatrix4(e){return w(this,this,e),this}lerp(e,t){S(this,this,e,t)}clone(){return new Be(this)}}(function(){let e=C();return function(t,n,a,r,d,o){let s,_;for(n||(n=3),a||(a=0),_=r?pe(r*n+a,t.length):t.length,s=a;s<_;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],d(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}})();class we extends Float32Array{constructor(e=[0,0,0]){return super(e),this}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}get z(){return this[2]}set z(e){this[2]=e}set(e,t,n){return L(this,e,t,n),this}copy(e){return z(this,e),this}add(e){return F(this,this,e),this}get size(){return R(this)}get squaredSize(){return k(this)}distance(e){return U(this,e)}subtract(e){return D(this,this,e),this}negate(e=this){return M(this,e),this}cross(e,t){return Y(this,e,t),this}scale(e){return I(this,this,e),this}normalize(){return V(this,this),this}dot(e){return O(this,e)}equals(e){return W(this,e)}applyMatrix4(e){return N(this,this,e),this}angle(e){return G(this,e)}clone(){return new we(this)}}(function(){let e=j();return function(t,n,a,r,d,o){let s,_;for(n||(n=4),a||(a=0),_=r?pe(r*n+a,t.length):t.length,s=a;s<_;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],d(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}})();class Pe extends Float32Array{constructor(e=[0,0,0,0]){return super(e),this}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}get z(){return this[2]}set z(e){this[2]=e}get w(){return this[3]}set w(e){this[3]=e}set(e,t,n,a){return H(this,e,t,n,a),this}}class Ce extends Float32Array{constructor(e=[1,0,0,0,1,0,0,0,1]){return super(e),this}set(e,t,n,a,r,i,d,o,s){return K(this,e,t,n,a,r,i,d,o,s),this}translate(e,t=this){return ee(this,t,e),this}rotate(e,t=this){return te(this,t,e),this}scale(e,t=this){return ne(this,t,e),this}multiply(e,t){return t?$(this,e,t):$(this,this,e),this}identity(){return J(this),this}copy(e){return q(this,e),this}fromMatrix4(e){return Q(this,e),this}fromQuaternion(e){return ae(this,e),this}fromBasis(e,t,n){return this.set(e[0],e[1],e[2],t[0],t[1],t[2],n[0],n[1],n[2]),this}invert(e=this){return Z(this,e),this}}class Re{static add(e="void main() {}",t){for(let[n,a]of t)e="start"===n?e.replace(/(#version .*?\n(\s*precision highp float;\s)?)([\s\S]*)/,`$1\n${a}\n$3`):"end"===n?e.replace(/(}\s*$)/,`\n${a}\n$1`):"main"===n?e.replace(/(\bvoid\b +\bmain\b[\s\S]*?{\s*)/,`$1\n${a}\n`):e.replace(n,a);return e}constructor({vertexShader:e=`#version 300 es
      void main() {
        gl_Position = vec4(0., 0., 0., 1.);
      }
    `,fragmentShader:t=`#version 300 es
      precision highp float;

      out vec4 fragColor;

      void main() {
        fragColor = vec4(1.);
      }
    `,dataTypeConctructors:n={Vector2:class extends Float32Array{constructor(){super(2)}},Vector3:class extends Float32Array{constructor(){super(3)}},Vector4:class extends Float32Array{constructor(){super(4)}},Matrix3:class extends Float32Array{constructor(){super([1,0,0,0,1,0,0,0,1])}},Matrix4:class extends Float32Array{constructor(){super([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},Texture:class{},TextureCube:class{}},uniforms:a=[],vertexShaderChunks:r=[],fragmentShaderChunks:i=[],shaders:d=[]}={}){this.uniforms=new Map,this.uniformTypes=new Map,this.vertexShader=e,this.fragmentShader=t,this._vertexShaderChunks=[],this._fragmentShaderChunks=[],this._dataTypeConctructors=n,this.add({vertexShaderChunks:r,fragmentShaderChunks:i,uniforms:a});for(let o of d)this.add(o)}add({vertexShaderChunks:e=[],fragmentShaderChunks:t=[],uniforms:n=[]}={}){this.vertexShader=Re.add(this.vertexShader,e),this._vertexShaderChunks.push(...e),this.fragmentShader=Re.add(this.fragmentShader,t),this._fragmentShaderChunks.push(...t);for(let[a,r]of n)this.uniforms.set(a,r)}set vertexShader(e){this._vertexShader=e,this._parseUniforms(this._vertexShader)}get vertexShader(){return this._vertexShader}set fragmentShader(e){this._fragmentShader=e,this._parseUniforms(this._fragmentShader)}get fragmentShader(){return this._fragmentShader}get vertexShaderChunks(){return this._vertexShaderChunks}get fragmentShaderChunks(){return this._fragmentShaderChunks}_addUniform(e,t,n){if(this.uniforms.has(e))return;let a,r;if(this.uniformTypes.set(e,t),/float|double/.test(t))a=isNaN(n)?0:Array(n).fill(0);else if(/int|uint/.test(t))a=isNaN(n)?0:Array(n).fill(0);else if(/sampler2D/.test(t))a=isNaN(n)?new this._dataTypeConctructors.Texture:Array(n).fill().map(()=>new this._dataTypeConctructors.Texture);else if(/samplerCube/.test(t))a=isNaN(n)?new this._dataTypeConctructors.TextureCube:Array(n).fill().map(()=>new this._dataTypeConctructors.TextureCube);else if(r=/(.?)vec(\d)/.exec(t)){let e=r[2];a=isNaN(n)?new this._dataTypeConctructors[`Vector${e}`]:Array(n).fill().map(()=>new this._dataTypeConctructors[`Vector${e}`])}else if(r=/mat(\d)/.exec(t)){let e=r[1];a=isNaN(n)?new this._dataTypeConctructors[`Matrix${e}`]:Array(n).fill().map(()=>new this._dataTypeConctructors[`Matrix${e}`])}else a=void 0;this.uniforms.set(e,a)}_parseUniforms(e){const t=new Map,n=/struct\s*(.*)\s*{\s*([\s\S]*?)}/g,a=/^\s*(.[^ ]+) (.[^ ;\[\]]+)\[? *(\d+)? *\]?/gm;for(let r;r=n.exec(e);){const e=r[1],n=r[2],i={};for(let e;e=a.exec(n);){const[,t,n,a]=e,r=parseInt(a);i[n]={type:t,arrayLength:r}}t.set(e,i)}const r=/^\s*uniform (.[^ ]+) (.[^ ;\[\]]+)\[? *(\d+)? *\]?/gm;for(let n;n=r.exec(e);){const[,e,a,r]=n,i=parseInt(r),d=t.get(e);if(d)for(const e in d)this._addUniform(`${a}.${e}`,d[e].type,d[e].arrayLength);else this._addUniform(a,e,i)}}}class Ae{constructor({gl:e,data:t=void 0,width:n=void 0,height:a=void 0,target:r=t&&t.length?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,level:i=0,internalFormat:d=e.RGBA8||e.RGBA,format:o=e.RGBA,type:s=e.UNSIGNED_BYTE,minFilter:l=e.NEAREST_MIPMAP_LINEAR,magFilter:_=e.LINEAR,wrapS:u=e.REPEAT,wrapT:c=e.REPEAT}={gl:e}){this.gl=e,this._texture=this.gl.createTexture(),this._width=n,this._height=a,this._dataWidth=void 0,this._dataHeight=void 0,this._target=r,this.level=i,this.internalFormat=d,this.format=o,this.type=s,this.minFilter=l,this.magFilter=_,this.wrapS=u,this.wrapT=c,this.data=t}generateMipmap(){this.bind(),this.gl.generateMipmap(this._target),this.unbind()}set data(e){if(this._data=e,!this._data&&!(this._width&&this._height))return;const t=this._data&&this._data.length?this._data:[this._data];t[0]&&(this._dataWidth=t[0].width||t[0].videoWidth,this._dataHeight=t[0].height||t[0].videoHeight);const n=this._target===this.gl.TEXTURE_CUBE_MAP?6:1,a=this._target===this.gl.TEXTURE_CUBE_MAP?this.gl.TEXTURE_CUBE_MAP_POSITIVE_X:this._target;this.bind();for(let n=0;n<t.length;n++)this.gl.getParameter(this.gl.VERSION).startsWith("WebGL 1.0")&&this._dataWidth?this.gl.texImage2D(a+n,this.level,this.internalFormat,this.format,this.type,t[n]):this.gl.texImage2D(a+n,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,t[n]);this.unbind()}get data(){return this._data}set width(e){this._width=e,this.data=this.data}get width(){return this._width||this._dataWidth}set height(e){this._height=e,this.data=this.data}get height(){return this._height||this._dataHeight}set minFilter(e){this._minFilter===e||(this._minFilter=e,this.bind(),this.gl.texParameteri(this._target,this.gl.TEXTURE_MIN_FILTER,this._minFilter),this.unbind())}get minFilter(){return this._minFilter}set magFilter(e){this._magFilter===e||(this._magFilter=e,this.bind(),this.gl.texParameteri(this._target,this.gl.TEXTURE_MAG_FILTER,this._magFilter),this.unbind())}get magFilter(){return this._magFilter}set wrapS(e){this._wrapS===e||(this._wrapS=e,this.bind(),this.gl.texParameteri(this._target,this.gl.TEXTURE_WRAP_S,this._wrapS),this.unbind())}get wrapS(){return this._wrapS}set wrapT(e){this._wrapT===e||(this._wrapT=e,this.bind(),this.gl.texParameteri(this._target,this.gl.TEXTURE_WRAP_T,this._wrapT),this.unbind())}get wrapT(){return this._wrapT}bind({unit:e=0}={}){this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this._target,this._texture)}unbind(){this.gl.bindTexture(this._target,null)}clone(){return new Ae(this)}}class ze extends Re{constructor({gl:e,vertexShader:t=void 0,fragmentShader:n=void 0,uniforms:a=void 0,attributes:r=void 0,transformFeedbackVaryings:i=void 0,vertexShaderChunks:d=void 0,fragmentShaderChunks:o=void 0,shaders:s=void 0}={gl:e}){super({vertexShader:t,fragmentShader:n,uniforms:a,vertexShaderChunks:d,fragmentShaderChunks:o,shaders:s,dataTypeConctructors:{Vector2:Be,Vector3:we,Vector4:Pe,Matrix3:Ce,Matrix4:Se,Texture:class{},TextureCube:class{}}}),this.gl=e,this._program=e.createProgram(),this._attachedShaders=new Map;const l=this;this._vertexAttribDivisor=function(){};const _=this.gl.getExtension("ANGLE_instanced_arrays");_?this._vertexAttribDivisor=_.vertexAttribDivisorANGLE.bind(_):this.gl.vertexAttribDivisor&&(this._vertexAttribDivisor=this.gl.vertexAttribDivisor.bind(this.gl));class u extends Map{set(t,{buffer:n,location:r=l._attributesLocations.get(t),size:a,type:i=e.FLOAT,normalized:d=!1,stride:o=0,offset:s=0,divisor:_=0}={}){if(t instanceof Map){for(let[e,n]of t)this.set(e,n);return}n.bind(),r===void 0&&(r=e.getAttribLocation(l._program,t),-1===r&&console.warn(`Attribute "${t}" is missing or never used`),l._attributesLocations.set(t,r)),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,a,i,d,o,s),n.unbind(),l._vertexAttribDivisor(r,_),super.set(t,{buffer:n,size:a,type:i,normalized:d,stride:o,offset:s})}}class c extends Map{set(t,...n){let a=n[0];if(void 0===a)return;let r=l._uniformLocations.get(t);r===void 0&&(r=e.getUniformLocation(l._program,t),l._uniformLocations.set(t,r));let i;if(a.length===void 0){if(a instanceof Ae){let e=0;for(const[r,d]of l.uniformTypes)if(d.startsWith("sampler")){if(r===t){i=a,n=[e];break}e++}}else if(a instanceof Object){for(let e in a)l.uniforms.set(`${t}.${e}`,a[e]);return}1<n.length?(a=l.uniforms.get(t),a.set(...n)):a=n}else if(a[0]instanceof Object){for(let e=0;e<a.length;e++)if(a[0].length)l.uniforms.set(`${t}[${e}]`,a[e]);else for(let n in a[e])l.uniforms.set(`${t}[${e}].${n}`,a[e][n]);return}if(null!==r){const n=l.uniformTypes.get(t);"float"===n||"bool"===n?e.uniform1fv(r,a):"vec2"===n?e.uniform2fv(r,a):"vec3"===n?e.uniform3fv(r,a):"vec4"===n?e.uniform4fv(r,a):"int"===n||n.startsWith("sampler")?e.uniform1iv(r,a):"ivec2"===n?e.uniform2iv(r,a):"ivec3"===n?e.uniform3iv(r,a):"ivec4"===n?e.uniform4iv(r,a):"mat3"===n?e.uniformMatrix3fv(r,!1,a):"mat4"===n&&e.uniformMatrix4fv(r,!1,a),super.set(t,i||a)}}}i&&this.gl.transformFeedbackVaryings(this._program,i,e.INTERLEAVED_ATTRIBS),this.vertexShader=this.vertexShader,this.fragmentShader=this.fragmentShader,this.use(),this.attributes=new u;const m=this.uniforms;this.uniforms=new c;for(const[l,_]of m)this.uniforms.set(l,_)}set vertexShader(e){super.vertexShader=e,this.gl&&this._updateShader(this.gl.VERTEX_SHADER,this.vertexShader)}get vertexShader(){return super.vertexShader}set fragmentShader(e){super.fragmentShader=e,this.gl&&this._updateShader(this.gl.FRAGMENT_SHADER,this.fragmentShader)}get fragmentShader(){return super.fragmentShader}use(){this.gl.useProgram(this._program)}_updateShader(e,t){if(t){if(this.gl.getParameter(this.gl.VERSION).startsWith("WebGL 1.0"))if(t=t.replace(/#version.*?\n/g,""),t=t.replace(/\btexture\b/g,"texture2D"),e===this.gl.VERTEX_SHADER)t=t.replace(/\bin\b/g,"attribute"),t=t.replace(/\bout\b/g,"varying");else{t=t.replace(/\bin\b/g,"varying");const e=/out vec4 (.*?);/.exec(t);if(e){const n=e[1];t=t.replace(/out.*?;/,""),t=t.replace(new RegExp(`\\b${n}\\b`,"g"),"gl_FragColor")}}const n=this.gl.createShader(e);this.gl.shaderSource(n,t),this.gl.compileShader(n);const a=this.gl.getShaderInfoLog(n);if(!this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)){const e=/ERROR: 0:(\d+):/.exec(a);if(e){const n=parseFloat(e[1]),r=t.split("\n");throw new Error(`${a}\nat: ${r[n-1].replace(/^\s*/,"")}`)}else throw new Error(a);return void this.gl.deleteShader(n)}a&&console.warn(a);const r=this._attachedShaders.get(e);if(r&&(this.gl.detachShader(this._program,r),this.gl.deleteShader(r)),this.gl.attachShader(this._program,n),this.gl.deleteShader(n),this._attachedShaders.set(e,n),2===this._attachedShaders.size){this.gl.linkProgram(this._program);const e=this.gl.getProgramInfoLog(this._program);if(!this.gl.getProgramParameter(this._program,this.gl.LINK_STATUS))throw new Error(e);else e&&console.warn(e);this._attributesLocations=new Map,this._uniformLocations=new Map}}}}class Le{constructor({gl:e,data:t=null,target:n=e.ARRAY_BUFFER,usage:a=e.STATIC_DRAW}={gl:e}){this.gl=e,this.target=n,this.usage=a,this._buffer=this.gl.createBuffer(),t&&(this.data=t)}set data(e){this._data=e,this.bind(),this.gl.bufferData(this.target,this._data,this.usage),this.unbind()}get data(){return this._data}bind({target:e=this.target,index:t=void 0,offset:n=0,size:a=void 0}={}){t===void 0?this.gl.bindBuffer(e,this._buffer):a===void 0?this.gl.bindBufferBase(e,t,this._buffer):this.gl.bindBufferRange(e,t,this._buffer,n,a)}unbind({target:e=this.target,index:t=void 0,offset:n=0,size:a=void 0}={}){t===void 0?this.gl.bindBuffer(e,null):a===void 0?this.gl.bindBufferBase(e,t,null):this.gl.bindBufferRange(e,t,null,n,a)}}class Fe{constructor({gl:e,data:t=void 0,buffer:n=new Le({gl:e}),size:a=1,type:r=void 0,offset:i=0,normalized:d=!1,stride:o=0,count:s=void 0,divisor:l=0}={gl:e}){this.gl=e,this.buffer=n,this.size=a,this.type=r,this.offset=i,this.normalized=d,this.stride=o,this.count=s,this.divisor=l,t&&(this.data=t)}set count(e){this._count=e}get count(){return this._count===void 0?this.data.length/this.size:this._count}set type(e){this._type=e}get type(){let e=this._type;return e||(this.data instanceof Float32Array||this.data instanceof Float64Array?e=this.gl.FLOAT:this.data instanceof Uint8Array?e=this.gl.UNSIGNED_BYTE:this.data instanceof Uint16Array?e=this.gl.UNSIGNED_SHORT:this.data instanceof Uint32Array&&(e=this.gl.UNSIGNED_INT)),e}set data(e){this.buffer.data=e}get data(){return this.buffer.data}}class De{constructor({gl:e,attributes:t=void 0,indices:n=void 0}={gl:e}){this.gl=e,this.gl.getExtension("OES_element_index_uint"),this._drawElementsInstanced=function(){},this._drawArraysInstanced=function(){};const a=this.gl.getExtension("ANGLE_instanced_arrays");a?(this._drawElementsInstanced=a.drawElementsInstancedANGLE.bind(a),this._drawArraysInstanced=a.drawArraysInstancedANGLE.bind(a)):this.gl.drawElementsInstanced&&(this._drawElementsInstanced=this.gl.drawElementsInstanced.bind(this.gl),this._drawArraysInstanced=this.gl.drawArraysInstanced.bind(this.gl)),this.attributes=new Map(t);for(const[a,r]of this.attributes)r instanceof Fe||this.attributes.set(a,new Fe(Object.assign({gl:e},r)));n&&!(this.indices instanceof Fe)&&(this.indices=new Fe(Object.assign({gl:this.gl,buffer:new Le({gl:this.gl,target:this.gl.ELEMENT_ARRAY_BUFFER})},n.length===void 0?n:{data:n})))}draw({mode:e=this.gl.TRIANGLES,elements:t=!!this.indices,count:n=t?this.indices.count:this.attributes.get("position").count,offset:a=this.indices?this.indices.offset:0,type:r=t?this.indices.type:null,first:i=0,instanceCount:d=void 0}={}){t?d===void 0?this.gl.drawElements(e,n,r,a):this._drawElementsInstanced(e,n,r,a,d):d===void 0?this.gl.drawArrays(e,i,n):this._drawArraysInstanced(e,i,n,d)}}class Ie{constructor({gl:e,mesh:t=void 0,program:n=void 0}={gl:e}){this.gl=e;const a=e.getExtension("OES_vertex_array_object");a&&(this.gl.createVertexArray=a.createVertexArrayOES.bind(a),this.gl.bindVertexArray=a.bindVertexArrayOES.bind(a)),this._vertexArray=this.gl.createVertexArray(),(t||n)&&this.add({mesh:t,program:n})}add({mesh:e=void 0,program:t=void 0}={}){this.bind(),t.attributes.set(e.attributes),e.indices&&e.indices.buffer.bind(),this.unbind()}bind(){this.gl.bindVertexArray(this._vertexArray)}unbind(){this.gl.bindVertexArray(null)}}class Ue{constructor({near:e=.01,far:t=1e3,aspectRatio:n=1,fov:a=ye/3}={}){this._near=e,this._far=t,this._aspectRatio=n,this._fov=a,this.transform=new Se,this._inverseTransform=new Se,this._projection=new Se,this._projectionView=new Se,this._updateProjection()}set near(e){this._near=e,this._updateProjection()}get near(){return this._near}set far(e){this._far=e,this._updateProjection()}get far(){return this._far}set fov(e){this._fov=e,this._updateProjection()}get fov(){return this._fov}set aspectRatio(e){this._aspectRatio=e,this._updateProjection()}get aspectRatio(){return this._aspectRatio}get inverseTransform(){return this._inverseTransform.invert(this.transform)}get projection(){return this._projection}get projectionView(){return this._projectionView.copy(this.projection).multiply(this.inverseTransform)}_updateProjection(){this._projection.fromPerspective(this)}}Object.defineProperty(Ue.prototype,"near",{enumerable:!0}),Object.defineProperty(Ue.prototype,"far",{enumerable:!0}),Object.defineProperty(Ue.prototype,"fov",{enumerable:!0}),Object.defineProperty(Ue.prototype,"aspectRatio",{enumerable:!0}),Object.defineProperty(Ue.prototype,"inverseTransform",{enumerable:!0}),Object.defineProperty(Ue.prototype,"projection",{enumerable:!0}),Object.defineProperty(Ue.prototype,"projectionView",{enumerable:!0});let ke=new Map;class Me extends Be{static get TOUCH_TYPE(){return"touchtype"}static get MOUSE_TYPE(){return"mousetype"}static get(e=document.body){let t=ke.get(e);return t||(t=new Me(e)),t}get downed(){return this._downed}constructor(e=document.body){super(),this.domElement=e,this.type=Me.TOUCH_TYPE,this.velocity=new Be,this.dragOffset=new Be,this.centered=new Be,this.centeredFlippedY=new Be,this.normalized=new Be,this.normalizedFlippedY=new Be,this.normalizedCentered=new Be,this.normalizedCenteredFlippedY=new Be,this._downed=!1,ke.set(this.domElement,this),this.onDown=new xe,this.onMove=new xe,this.onUp=new xe,this.onClick=new xe,this.onTypeChange=new xe,this._preventMouseTypeChange=!1,this._onPointerMoveBinded=this._onPointerMove.bind(this),this._onPointerDownBinded=this._onPointerDown.bind(this),this._onPointerUpBinded=this._onPointerUp.bind(this),this._updateBinded=this._update.bind(this),this._resizeBinded=this.resize.bind(this),this.resize(),this._position=new Be,this.enable()}resize(){this._domElementBoundingRect=this.domElement.getBoundingClientRect()}_onPointerDown(t){"touchstart"===t.type&&(this._preventMouseTypeChange=!0,this._changeType(Me.TOUCH_TYPE)),this._downed=!0,this.dragOffset.set(0,0),this.copy(this._position),this._onPointerEvent(t),this._updatePositions(),this.onDown.dispatch(t)}_onPointerMove(t){if("mousemove"===t.type){if(this._preventMouseTypeChange)return;this._changeType(Me.MOUSE_TYPE)}this._onPointerEvent(t),this.onMove.dispatch(t)}_onPointerUp(t){this._downed&&(this._downed=!1,this._onPointerEvent(t),this._updatePositions(),this.onUp.dispatch(t),4>this.dragOffset.length&&this.onClick.dispatch(t),clearTimeout(this._timeout),this._timeout=setTimeout(()=>{this._preventMouseTypeChange=!1},2e3))}_onPointerEvent(t){!!window.TouchEvent&&t instanceof window.TouchEvent&&("touchend"===t.type?t=t.changedTouches[0]:t=t.touches[0]),this._position.x=t.clientX-this._domElementBoundingRect.left,this._position.y=t.clientY-this._domElementBoundingRect.top}_changeType(e){this.type===e||(this.type=e,this.disable(),this.enable(),this.onTypeChange.dispatch(this.type))}_update(){(this.x||this.y)&&(this.velocity.x=this._position.x-this.x,this.velocity.y=this._position.y-this.y,this.downed&&this.dragOffset.add(this.velocity)),this._updatePositions()}_updatePositions(){this.x=this._position.x,this.y=this._position.y;(this.x||this.y)&&(this.centered.x=this.centeredFlippedY.x=this.x-.5*this._domElementBoundingRect.width,this.centered.y=this.centeredFlippedY.y=this.y-.5*this._domElementBoundingRect.height,this.centeredFlippedY.y*=-1,this.normalized.x=this.normalizedFlippedY.x=this.x/this._domElementBoundingRect.width,this.normalized.y=this.normalizedFlippedY.y=this.y/this._domElementBoundingRect.height,this.normalizedFlippedY.y=1-this.normalizedFlippedY.y,this.normalizedCentered.x=this.normalizedCenteredFlippedY.x=2*this.normalized.x-1,this.normalizedCentered.y=this.normalizedCenteredFlippedY.y=2*this.normalized.y-1,this.normalizedCenteredFlippedY.y*=-1)}enable(){this.disable(),this.resize(),this.type===Me.TOUCH_TYPE?(this.domElement.addEventListener("touchmove",this._onPointerMoveBinded),window.addEventListener("touchend",this._onPointerUpBinded)):(this.domElement.addEventListener("mousedown",this._onPointerDownBinded),window.addEventListener("mouseup",this._onPointerUpBinded)),this.domElement.addEventListener("touchstart",this._onPointerDownBinded),this.domElement.addEventListener("mousemove",this._onPointerMoveBinded),window.addEventListener("resize",this._resizeBinded),Ee.add(this._updateBinded=this._updateBinded||this._update.bind(this))}disable(){Ee.delete(this._updateBinded),this.domElement.removeEventListener("touchstart",this._onPointerDownBinded),this.domElement.removeEventListener("mousedown",this._onPointerDownBinded),this.domElement.removeEventListener("touchmove",this._onPointerMoveBinded),this.domElement.removeEventListener("mousemove",this._onPointerMoveBinded),window.removeEventListener("touchend",this._onPointerUpBinded),window.removeEventListener("mouseup",this._onPointerUpBinded),window.removeEventListener("resize",this._resizeBinded)}}const Ve=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Oe=function(e,t){let n=t[0],a=t[1],r=t[2],i=t[3],d=n*n+a*a+r*r+i*i;return 0<d&&(d=1/fe(d),e[0]=n*d,e[1]=a*d,e[2]=r*d,e[3]=i*d),e},Ye=function(){let e=C(),t=A(1,0,0),n=A(0,1,0);return function(r,i,a){let d=O(i,a);return-.999999>d?(Y(e,t,i),1e-6>R(e)&&Y(e,n,i),V(e,e),de(r,e,Math.PI),r):.999999<d?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Y(e,i,a),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+d,Oe(r,r))}}(),Ne=function(){let e=re(),n=re();return function(r,i,a,o,s,d){return ue(e,i,s,d),ue(n,a,o,d),ue(r,e,n,2*d*(1-d)),r}}(),Ge=function(){let e=X();return function(t,n,a,r){return e[0]=a[0],e[3]=a[1],e[6]=a[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],Oe(t,me(t,e))}}();class We extends Float32Array{constructor(e=0,t=0,n=0,a=1){return super(4),this.set(e,t,n,a),this}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}get z(){return this[2]}set z(e){this[2]=e}get w(){return this[3]}set w(e){this[3]=e}identity(){return ie(this),this}set(e,t,n,a){return H(this,e,t,n,a),this}rotateX(e){return se(this,this,e),this}rotateY(e){return le(this,this,e),this}rotateZ(e){return _e(this,this,e),this}invert(e=this){return ce(this,e),this}copy(e){return Ve(this,e),this}normalize(e=this){return Oe(this,this),this}multiply(e,t){return t?oe(this,e,t):oe(this,this,e),this}fromMatrix3(e){return me(this,e),this}}class je{constructor({matrix:e=new Se,domElement:t=document.body,distance:n=0,invertRotation:a=!0,rotationEaseRatio:r=.04,zoomSpeed:i=.1,zoomEaseRatio:d=.1,minDistance:o=0,maxDistance:s=1/0,enabled:l=!0}={}){this.matrix=e,this._distance=n,this.invertRotation=a,this.rotationEaseRatio=r,this.maxDistance=s,this.minDistance=o,this.zoomSpeed=i,this.zoomEaseRatio=d,this._pointer=Me.get(t),this._nextDistance=this._distance,this._cachedQuaternion=new We,this._cachedMatrix=new Se,this._cachedVector3=new we,this._velocity=new Be,this._velocityOrigin=new Be,this._position=new we([this.matrix.x,this.matrix.y,this.matrix.z]),this._positionPrevious=this._position.clone(),this._positionOffset=new we,t.addEventListener("wheel",this.onWheel.bind(this)),this.enabled=!0,this.update(),this.enabled=l}set distance(e){this._distance=this._nextDistance=e}get distance(){return this._distance}onWheel(t){if(this.enabled){const e=1+Math.abs(.01*(t.deltaY*this.zoomSpeed));this._nextDistance=this._nextDistance||1,this._nextDistance=0<t.deltaY?this._nextDistance*e:this._nextDistance/e,this._nextDistance=Math.max(pe(this._nextDistance,this.maxDistance),this.minDistance)}}update(){this.enabled&&(this._cachedMatrix.identity(),this._cachedQuaternion.identity(),this._distance+=(this._nextDistance-this._distance)*this.zoomEaseRatio,this._position.set(this.matrix.x,this.matrix.y,this.matrix.z).subtract(this._positionOffset),this.matrix.x=0,this.matrix.y=0,this.matrix.z=0,this._pointer.downed&&this._velocity.copy(this._pointer.velocity).scale(.003),this._velocity.lerp(this._velocityOrigin,this.rotationEaseRatio),this._cachedQuaternion.rotateY(this.invertRotation?-this._velocity.x:this._velocity.x),this._cachedQuaternion.rotateX(this.invertRotation?-this._velocity.y:this._velocity.y),this._cachedMatrix.fromQuaternion(this._cachedQuaternion),this.matrix.multiply(this._cachedMatrix),this._positionOffset.set(0,0,1),this._positionOffset.applyMatrix4(this.matrix),this._positionOffset.scale(this._distance),this._cachedVector3.copy(this._position).add(this._positionOffset),this.matrix.x=this._cachedVector3.x,this.matrix.y=this._cachedVector3.y,this.matrix.z=this._cachedVector3.z)}}class He{constructor({canvas:e=void 0}={}){this.canvas=e;const t={depth:!0,alpha:!1,antialias:!0};/\bforcewebgl1\b/.test(window.location.search)||(this.gl=this.canvas.getContext("webgl2",t)),this.gl||(this.gl=this.canvas.getContext("webgl",t)||this.canvas.getContext("experimental-webgl",t)),this.camera=new Ue,this.cameraController=new je({matrix:this.camera.transform,distance:5}),this.gl.clearColor(0,0,0,1),this.gl.enable(this.gl.CULL_FACE),this.gl.enable(this.gl.DEPTH_TEST),this.program=new ze({gl:this.gl,uniforms:[["transform",new Se]],vertexShaderChunks:[["start",`
          uniform mat4 projectionView;
          uniform mat4 transform;

          in vec3 normal;
          in vec3 position;

          out vec3 vNormal;
        `],["end",`
          gl_Position = projectionView * transform * vec4(position, 1.);
          vNormal = normal;
        `]],fragmentShaderChunks:[["start",`
          precision highp float;

          in vec3 vNormal;
        `],["end",`
          fragColor = vec4(vNormal * .5 + .5, 1.);
        `]]}),this.mesh=new De({gl:this.gl,attributes:[["position",{data:new Float32Array([-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5]),size:3}],["normal",{data:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0]),size:3}]],indices:new Uint8Array([0,2,3,0,3,1,4,6,7,4,7,5,8,10,11,8,11,9,12,14,15,12,15,13,16,18,19,16,19,17,20,22,23,20,23,21])}),this.vertexArray=new Ie({gl:this.gl,mesh:this.mesh,program:this.program})}resize(e,t){this.camera.aspectRatio=e/t,this.update()}update(){this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.cameraController.update(),this.program.use(),this.program.uniforms.set("projectionView",this.camera.projectionView),this.vertexArray.bind(),this.mesh.draw()}}window.customElements.define("dnit-main",class extends be{connectedCallback(){this.innerHTML=`
      <style>
        @import "src/main/index.css";
      </style>
      <canvas></canvas>
    `,this.canvas=this.querySelector("canvas"),this.view=new He({canvas:this.canvas}),this.querySelector("style").addEventListener("load",()=>{this.dispatchEvent(new Event("load")),this.resize()}),window.addEventListener("resize",this._resizeBinded=this.resize.bind(this)),this.play()}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("resize",this._resizeBinded)}resize(){let e=this.canvas.offsetWidth,t=this.canvas.offsetHeight;this.canvas.width=e*window.devicePixelRatio,this.canvas.height=t*window.devicePixelRatio,this.view.resize(e,t)}update(){this.view.update()}})})();