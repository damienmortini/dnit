(function(){"use strict";function e(e,t,r,a){this._x=e||0,this._y=t||0,this._z=r||0,this._w=a===void 0?1:a}function n(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}function t(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function r(){}function a(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._order=i||a.DefaultOrder}function i(){this.mask=1}function o(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function s(){Object.defineProperty(this,"id",{value:Qr++}),this.uuid=Zr.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=s.DefaultUp.clone();var r=new n,d=new a,l=new e,c=new n(1,1,1);d.onChange(function(){l.setFromEuler(d,!1)}),l.onChange(function(){d.setFromQuaternion(l,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:r},rotation:{enumerable:!0,value:d},quaternion:{enumerable:!0,value:l},scale:{enumerable:!0,value:c},modelViewMatrix:{value:new t},normalMatrix:{value:new o}}),this.matrix=new t,this.matrixWorld=new t,this.matrixAutoUpdate=s.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new i,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function d(){s.call(this),this.type="Camera",this.matrixWorldInverse=new t,this.projectionMatrix=new t}function l(e,t,r,a){d.call(this),this.type="PerspectiveCamera",this.fov=e===void 0?50:e,this.zoom=1,this.near=r===void 0?.1:r,this.far=a===void 0?2e3:a,this.focus=10,this.aspect=t===void 0?1:t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function c(e,t){this.x=e||0,this.y=t||0}function p(e,t){this.min=e===void 0?new n(+Infinity,+Infinity,+Infinity):e,this.max=t===void 0?new n(-Infinity,-Infinity,-Infinity):t}function m(e,t){this.center=e===void 0?new n:e,this.radius=t===void 0?0:t}function u(e,t){this.origin=e===void 0?new n:e,this.direction=t===void 0?new n:t}function f(e,t){this.start=e===void 0?new n:e,this.end=t===void 0?new n:t}function g(e,t){this.normal=e===void 0?new n(1,0,0):e,this.constant=t===void 0?0:t}function h(e,t,r){this.a=e===void 0?new n:e,this.b=t===void 0?new n:t,this.c=r===void 0?new n:r}function _(e,t,r){return void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}function x(e,t,r,a,i,o){this.a=e,this.b=t,this.c=r,this.normal=a&&a.isVector3?a:new n,this.vertexNormals=Array.isArray(a)?a:[],this.color=i&&i.isColor?i:new _,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=o===void 0?0:o}function v(){Object.defineProperty(this,"id",{value:ia++}),this.uuid=Zr.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=0,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}function y(e){v.call(this),this.type="MeshBasicMaterial",this.color=new _(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function E(e,t,r,a){this.x=e||0,this.y=t||0,this.z=r||0,this.w=a===void 0?1:a}function S(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e===void 0?0:e.length/t,this.normalized=!0===r,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function M(e,t,r){S.call(this,new Int8Array(e),t,r)}function b(e,t,r){S.call(this,new Uint8Array(e),t,r)}function T(e,t,r){S.call(this,new Uint8ClampedArray(e),t,r)}function L(e,t,r){S.call(this,new Int16Array(e),t,r)}function w(e,t,r){S.call(this,new Uint16Array(e),t,r)}function A(e,t,r){S.call(this,new Int32Array(e),t,r)}function R(e,t,r){S.call(this,new Uint32Array(e),t,r)}function P(e,t,r){S.call(this,new Float32Array(e),t,r)}function C(e,t,r){S.call(this,new Float64Array(e),t,r)}function D(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function U(e){if(0===e.length)return-Infinity;for(var t=e[0],r=1,a=e.length;r<a;++r)e[r]>t&&(t=e[r]);return t}function N(){Object.defineProperty(this,"id",{value:na+=2}),this.uuid=Zr.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function I(e,t){s.call(this),this.type="Mesh",this.geometry=e===void 0?new N:e,this.material=t===void 0?new y({color:16777215*Math.random()}):t,this.drawMode=0,this.updateMorphTargets()}function z(){Object.defineProperty(this,"id",{value:oa+=2}),this.uuid=Zr.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function F(e,t,r,a,i,n){z.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:a,heightSegments:i,depthSegments:n},this.fromBufferGeometry(new B(e,t,r,a,i,n)),this.mergeVertices()}function B(e,t,r,a,i,o){function s(e,t,r,i,o,s,u,h,_,v,E){var S=_+1,M=0,T=0,L=new n,w,A;for(A=0;A<v+1;A++){var R=A*(u/v)-u/2;for(w=0;w<S;w++){var y=w*(s/_)-s/2;L[e]=y*i,L[t]=R*o,L[r]=h/2,d.push(L.x,L.y,L.z),L[e]=0,L[t]=0,L[r]=0<h?1:-1,c.push(L.x,L.y,L.z),m.push(w/_),m.push(1-A/v),M+=1}}for(A=0;A<v;A++)for(w=0;w<_;w++){var x=f+w+S*A,a=f+w+S*(A+1),b=f+(w+1)+S*(A+1),P=f+(w+1)+S*A;p.push(x,a,P),p.push(a,b,P),T+=6}l.addGroup(g,T,E),g+=T,f+=M}N.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:a,heightSegments:i,depthSegments:o};var l=this;e=e||1,t=t||1,r=r||1,a=Hr(a)||1,i=Hr(i)||1,o=Hr(o)||1;var p=[],d=[],c=[],m=[],f=0,g=0;s("z","y","x",-1,-1,r,t,e,o,i,0),s("z","y","x",1,-1,r,t,-e,o,i,1),s("x","z","y",1,1,e,r,t,a,o,2),s("x","z","y",1,-1,e,r,-t,a,o,3),s("x","y","z",1,-1,e,t,r,a,i,4),s("x","y","z",-1,-1,e,t,-r,a,i,5),this.setIndex(p),this.addAttribute("position",new P(d,3)),this.addAttribute("normal",new P(c,3)),this.addAttribute("uv",new P(m,2))}function O(e){v.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new c(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function G(){s.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function V(){let e=new sa(2);return e[0]=0,e[1]=0,e}function H(e,t){return e[0]=t[0],e[1]=t[1],e}function k(e,t,r){return e[0]=t,e[1]=r,e}function W(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function X(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function Y(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function q(e,t){var r=t[0]-e[0],a=t[1]-e[1];return Fr(r*r+a*a)}function j(e){var t=e[0],r=e[1];return Fr(t*t+r*r)}function Z(e){var t=e[0],r=e[1];return t*t+r*r}function Q(e,t){return e[0]=-t[0],e[1]=-t[1],e}function J(e,t){var r=t[0],a=t[1],i=r*r+a*a;return 0<i&&(i=1/Fr(i),e[0]=t[0]*i,e[1]=t[1]*i),e}function K(e,t){return e[0]*t[0]+e[1]*t[1]}function $(e,t,r){var a=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=a,e}function ee(e,r,a,i){var t=r[0],n=r[1];return e[0]=t+i*(a[0]-t),e[1]=n+i*(a[1]-n),e}function te(e,t,r){var a=t[0],i=t[1];return e[0]=r[0]*a+r[3]*i+r[6],e[1]=r[1]*a+r[4]*i+r[7],e}function re(e,t,r){let a=t[0],i=t[1];return e[0]=r[0]*a+r[4]*i+r[12],e[1]=r[1]*a+r[5]*i+r[13],e}function ae(e,t){return e[0]===t[0]&&e[1]===t[1]}function ie(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ne(e,t,r,a,i,n,o,s,d,l,c,p,m,u,f,g,h){return e[0]=t,e[1]=r,e[2]=a,e[3]=i,e[4]=n,e[5]=o,e[6]=s,e[7]=d,e[8]=l,e[9]=c,e[10]=p,e[11]=m,e[12]=u,e[13]=f,e[14]=g,e[15]=h,e}function oe(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function se(e,t){let r=t[0],a=t[1],i=t[2],n=t[3],o=t[4],s=t[5],d=t[6],l=t[7],c=t[8],p=t[9],m=t[10],u=t[11],f=t[12],g=t[13],h=t[14],_=t[15],x=r*s-a*o,v=r*d-i*o,y=r*l-n*o,E=a*d-i*s,S=a*l-n*s,M=i*l-n*d,b=c*g-p*f,T=c*h-m*f,L=c*_-u*f,w=p*h-m*g,A=p*_-u*g,R=m*_-u*h,P=x*R-v*A+y*w+E*L-S*T+M*b;return P?(P=1/P,e[0]=(s*R-d*A+l*w)*P,e[1]=(i*A-a*R-n*w)*P,e[2]=(g*M-h*S+_*E)*P,e[3]=(m*S-p*M-u*E)*P,e[4]=(d*L-o*R-l*T)*P,e[5]=(r*R-i*L+n*T)*P,e[6]=(h*y-f*M-_*v)*P,e[7]=(c*M-m*y+u*v)*P,e[8]=(o*A-s*L+l*b)*P,e[9]=(a*L-r*A-n*b)*P,e[10]=(f*S-g*y+_*x)*P,e[11]=(p*y-c*S-u*x)*P,e[12]=(s*T-o*w-d*b)*P,e[13]=(r*w-a*T+i*b)*P,e[14]=(g*v-f*E-h*x)*P,e[15]=(c*E-p*v+m*x)*P,e):null}function de(e,t,r){let a=t[0],i=t[1],n=t[2],o=t[3],s=t[4],d=t[5],l=t[6],c=t[7],p=t[8],m=t[9],u=t[10],f=t[11],g=t[12],h=t[13],_=t[14],x=t[15],v=r[0],y=r[1],E=r[2],S=r[3];return e[0]=v*a+y*s+E*p+S*g,e[1]=v*i+y*d+E*m+S*h,e[2]=v*n+y*l+E*u+S*_,e[3]=v*o+y*c+E*f+S*x,v=r[4],y=r[5],E=r[6],S=r[7],e[4]=v*a+y*s+E*p+S*g,e[5]=v*i+y*d+E*m+S*h,e[6]=v*n+y*l+E*u+S*_,e[7]=v*o+y*c+E*f+S*x,v=r[8],y=r[9],E=r[10],S=r[11],e[8]=v*a+y*s+E*p+S*g,e[9]=v*i+y*d+E*m+S*h,e[10]=v*n+y*l+E*u+S*_,e[11]=v*o+y*c+E*f+S*x,v=r[12],y=r[13],E=r[14],S=r[15],e[12]=v*a+y*s+E*p+S*g,e[13]=v*i+y*d+E*m+S*h,e[14]=v*n+y*l+E*u+S*_,e[15]=v*o+y*c+E*f+S*x,e}function le(e,t,r){let a=r[0],i=r[1],n=r[2],o,s,d,l,c,p,m,u,f,g,h,_;return t===e?(e[12]=t[0]*a+t[4]*i+t[8]*n+t[12],e[13]=t[1]*a+t[5]*i+t[9]*n+t[13],e[14]=t[2]*a+t[6]*i+t[10]*n+t[14],e[15]=t[3]*a+t[7]*i+t[11]*n+t[15]):(o=t[0],s=t[1],d=t[2],l=t[3],c=t[4],p=t[5],m=t[6],u=t[7],f=t[8],g=t[9],h=t[10],_=t[11],e[0]=o,e[1]=s,e[2]=d,e[3]=l,e[4]=c,e[5]=p,e[6]=m,e[7]=u,e[8]=f,e[9]=g,e[10]=h,e[11]=_,e[12]=o*a+c*i+f*n+t[12],e[13]=s*a+p*i+g*n+t[13],e[14]=d*a+m*i+h*n+t[14],e[15]=l*a+u*i+_*n+t[15]),e}function ce(e,t,r){let a=r[0],i=r[1],n=r[2];return e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e[3]=t[3]*a,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function pe(e,t,r){let a=Ir(r),i=Nr(r),n=t[4],o=t[5],s=t[6],d=t[7],l=t[8],c=t[9],p=t[10],m=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*i+l*a,e[5]=o*i+c*a,e[6]=s*i+p*a,e[7]=d*i+m*a,e[8]=l*i-n*a,e[9]=c*i-o*a,e[10]=p*i-s*a,e[11]=m*i-d*a,e}function me(e,t,r){let a=Ir(r),i=Nr(r),n=t[0],o=t[1],s=t[2],d=t[3],l=t[8],c=t[9],p=t[10],m=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*i-l*a,e[1]=o*i-c*a,e[2]=s*i-p*a,e[3]=d*i-m*a,e[8]=n*a+l*i,e[9]=o*a+c*i,e[10]=s*a+p*i,e[11]=d*a+m*i,e}function ue(e,t,r){let a=Ir(r),i=Nr(r),n=t[0],o=t[1],s=t[2],d=t[3],l=t[4],c=t[5],p=t[6],m=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*i+l*a,e[1]=o*i+c*a,e[2]=s*i+p*a,e[3]=d*i+m*a,e[4]=l*i-n*a,e[5]=c*i-o*a,e[6]=p*i-s*a,e[7]=m*i-d*a,e}function fe(e,t){let r=t[0],a=t[1],i=t[2],n=t[3],o=r+r,s=a+a,d=i+i,l=r*o,c=a*o,p=a*s,m=i*o,u=i*s,f=i*d,g=n*o,h=n*s,_=n*d;return e[0]=1-p-f,e[1]=c+_,e[2]=m-h,e[3]=0,e[4]=c-_,e[5]=1-l-f,e[6]=u+g,e[7]=0,e[8]=m+h,e[9]=u-g,e[10]=1-l-p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ge(e,t,r,a,i){let n=1/Rr(t/2),o=1/(a-i);return e[0]=n/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+a)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*a*o,e[15]=0,e}function he(){let e=new sa(3);return e[0]=0,e[1]=0,e[2]=0,e}function _e(e){let t=e[0],r=e[1],a=e[2];return Fr(t*t+r*r+a*a)}function xe(e,t,r){let a=new sa(3);return a[0]=e,a[1]=t,a[2]=r,a}function ve(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ye(e,t,r,a){return e[0]=t,e[1]=r,e[2]=a,e}function Ee(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function Se(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function Me(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function be(e,t){let r=t[0]-e[0],a=t[1]-e[1],i=t[2]-e[2];return Fr(r*r+a*a+i*i)}function Te(e){let t=e[0],r=e[1],a=e[2];return t*t+r*r+a*a}function Le(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function we(e,t){let r=t[0],a=t[1],i=t[2],n=r*r+a*a+i*i;return 0<n&&(n=1/Fr(n),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n),e}function Ae(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Re(e,t,r){let a=t[0],i=t[1],n=t[2],o=r[0],s=r[1],d=r[2];return e[0]=i*d-n*s,e[1]=n*o-a*d,e[2]=a*s-i*o,e}function Pe(e,t,r){let a=t[0],i=t[1],n=t[2],o=r[3]*a+r[7]*i+r[11]*n+r[15];return o=o||1,e[0]=(r[0]*a+r[4]*i+r[8]*n+r[12])/o,e[1]=(r[1]*a+r[5]*i+r[9]*n+r[13])/o,e[2]=(r[2]*a+r[6]*i+r[10]*n+r[14])/o,e}function Ce(e,t){let r=xe(e[0],e[1],e[2]),a=xe(t[0],t[1],t[2]);we(r,r),we(a,a);let i=Ae(r,a);return 1<i?0:-1>i?Xr:Cr(i)}function De(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Ue(){let e=new sa(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Ne(){let e=new sa(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Ie(){let e=new sa(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function ze(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Fe(e,t,r){r*=.5;let a=Ir(r);return e[0]=a*t[0],e[1]=a*t[1],e[2]=a*t[2],e[3]=Nr(r),e}function Be(e,t,r){let a=t[0],i=t[1],n=t[2],o=t[3],s=r[0],d=r[1],l=r[2],c=r[3];return e[0]=a*c+o*s+i*l-n*d,e[1]=i*c+o*d+n*s-a*l,e[2]=n*c+o*l+a*d-i*s,e[3]=o*c-a*s-i*d-n*l,e}function Oe(e,t,r){r*=.5;let a=t[0],i=t[1],n=t[2],o=t[3],s=Ir(r),d=Nr(r);return e[0]=a*d+o*s,e[1]=i*d+n*s,e[2]=n*d-i*s,e[3]=o*d-a*s,e}function Ge(e,t,r){r*=.5;let a=t[0],i=t[1],n=t[2],o=t[3],s=Ir(r),d=Nr(r);return e[0]=a*d-n*s,e[1]=i*d+o*s,e[2]=n*d+a*s,e[3]=o*d-i*s,e}function Ve(e,t,r){r*=.5;let a=t[0],i=t[1],n=t[2],o=t[3],s=Ir(r),d=Nr(r);return e[0]=a*d+i*s,e[1]=i*d-a*s,e[2]=n*d+o*s,e[3]=o*d-n*s,e}function He(e,r,a,i){let t=r[0],n=r[1],o=r[2],s=r[3],d=a[0],l=a[1],c=a[2],p=a[3],m,u,f,g,h;return u=t*d+n*l+o*c+s*p,0>u&&(u=-u,d=-d,l=-l,c=-c,p=-p),1e-6<1-u?(m=Cr(u),f=Ir(m),g=Ir((1-i)*m)/f,h=Ir(i*m)/f):(g=1-i,h=i),e[0]=g*t+h*d,e[1]=g*n+h*l,e[2]=g*o+h*c,e[3]=g*s+h*p,e}function ke(e,t){let r=t[0],a=t[1],i=t[2],n=t[3],o=r*r+a*a+i*i+n*n,s=o?1/o:0;return e[0]=-r*s,e[1]=-a*s,e[2]=-i*s,e[3]=n*s,e}function We(e,t){let r=t[0]+t[4]+t[8],a;if(0<r)a=Fr(r+1),e[3]=.5*a,a=.5/a,e[0]=(t[5]-t[7])*a,e[1]=(t[6]-t[2])*a,e[2]=(t[1]-t[3])*a;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);let i=(r+1)%3,n=(r+2)%3;a=Fr(t[3*r+r]-t[3*i+i]-t[3*n+n]+1),e[r]=.5*a,a=.5/a,e[3]=(t[3*i+n]-t[3*n+i])*a,e[i]=(t[3*i+r]+t[3*r+i])*a,e[n]=(t[3*n+r]+t[3*r+n])*a}return e}function Xe(e,t,r,a,i,n,s,d,l,p){Object.defineProperty(this,"id",{value:ba++}),this.uuid=Zr.generateUUID(),this.name="",this.image=e===void 0?Xe.DEFAULT_IMAGE:e,this.mipmaps=[],this.mapping=t===void 0?Xe.DEFAULT_MAPPING:t,this.wrapS=r===void 0?1001:r,this.wrapT=a===void 0?1001:a,this.magFilter=i===void 0?1006:i,this.minFilter=n===void 0?1008:n,this.anisotropy=l===void 0?1:l,this.format=s===void 0?1023:s,this.type=d===void 0?1009:d,this.offset=new c(0,0),this.repeat=new c(1,1),this.center=new c(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new o,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=p===void 0?3000:p,this.version=0,this.onUpdate=null}function Ye(e,t,r,a,i,n,o,s,d,l,c,p){Xe.call(this,null,n,o,s,d,l,a,i,c,p),this.image={data:e,width:t,height:r},this.magFilter=d===void 0?1003:d,this.minFilter=l===void 0?1003:l,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function qe(e,t,r,a,i,n){this.planes=[e===void 0?new g:e,t===void 0?new g:t,r===void 0?new g:r,a===void 0?new g:a,i===void 0?new g:i,n===void 0?new g:n]}function je(e){function t(t,r){var a=t.array,i=t.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW,n=e.createBuffer();e.bindBuffer(r,n),e.bufferData(r,a,i),t.onUploadCallback();var o=e.FLOAT;return a instanceof Float32Array?o=e.FLOAT:a instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):a instanceof Uint16Array?o=e.UNSIGNED_SHORT:a instanceof Int16Array?o=e.SHORT:a instanceof Uint32Array?o=e.UNSIGNED_INT:a instanceof Int32Array?o=e.INT:a instanceof Int8Array?o=e.BYTE:a instanceof Uint8Array&&(o=e.UNSIGNED_BYTE),{buffer:n,type:o,bytesPerElement:a.BYTES_PER_ELEMENT,version:t.version}}function r(t,r,a){var i=r.array,n=r.updateRange;e.bindBuffer(a,t),!1===r.dynamic?e.bufferData(a,i,e.STATIC_DRAW):-1===n.count?e.bufferSubData(a,0,i):0===n.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(a,n.offset*i.BYTES_PER_ELEMENT,i.subarray(n.offset,n.offset+n.count)),n.count=-1)}var a=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),a.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var r=a.get(t);r&&(e.deleteBuffer(r.buffer),a.delete(t))},update:function(e,i){e.isInterleavedBufferAttribute&&(e=e.data);var n=a.get(e);n===void 0?a.set(e,t(e,i)):n.version<e.version&&(r(n.buffer,e,i),n.version=e.version)}}}function Ze(e,t,r,a,i,n){d.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=a,this.near=i===void 0?.1:i,this.far=n===void 0?2e3:n,this.updateProjectionMatrix()}function Qe(e,t,r,a){z.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:a},this.fromBufferGeometry(new Je(e,t,r,a)),this.mergeVertices()}function Je(e,t,r,i){N.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i},e=e||1,t=t||1;var n=e/2,o=t/2,s=Hr(r)||1,l=Hr(i)||1,p=s+1,m=e/s,u=t/l,f=[],g=[],h=[],_=[],v,E;for(E=0;E<l+1;E++){var S=E*u-o;for(v=0;v<p;v++){var y=v*m-n;g.push(y,-S,0),h.push(0,0,1),_.push(v/s),_.push(1-E/l)}}for(E=0;E<l;E++)for(v=0;v<s;v++){var x=v+p*E,a=v+p*(E+1),M=v+1+p*(E+1),c=v+1+p*E;f.push(x,a,c),f.push(a,M,c)}this.setIndex(f),this.addAttribute("position",new P(g,3)),this.addAttribute("normal",new P(h,3)),this.addAttribute("uv",new P(_,2))}function Ke(e){v.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function $e(e,t,r,a){function i(t,a,i,p){var m=a.background;null===m?n(o,s):m&&m.isColor&&(n(m,1),p=!0),(e.autoClear||p)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&m.isCubeTexture?(c===void 0&&(c=new I(new B(1,1,1),new Ke({uniforms:Aa.cube.uniforms,vertexShader:Aa.cube.vertexShader,fragmentShader:Aa.cube.fragmentShader,side:1,depthTest:!0,depthWrite:!1,fog:!1})),c.geometry.removeAttribute("normal"),c.geometry.removeAttribute("uv"),c.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},r.update(c.geometry)),c.material.uniforms.tCube.value=m,t.push(c,c.geometry,c.material,0,null)):m&&m.isTexture&&(d===void 0&&(d=new Ze(-1,1,1,-1,0,1),l=new I(new Je(2,2),new y({depthTest:!1,depthWrite:!1,fog:!1})),r.update(l.geometry)),l.material.map=m,e.renderBufferDirect(d,null,l.geometry,l.material,l,null))}function n(e,r){t.buffers.color.setClear(e.r,e.g,e.b,r,a)}var o=new _(0),s=0,d,l,c;return{getClearColor:function(){return o},setClearColor:function(e,t){o.set(e),s=t===void 0?1:t,n(o,s)},getClearAlpha:function(){return s},setClearAlpha:function(e){s=e,n(o,s)},render:i}}function et(e,t,r){function a(t,a){e.drawArrays(n,t,a),r.update(a,n)}function i(e,a,i){var o=t.get("ANGLE_instanced_arrays");if(null===o)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");var s=e.attributes.position;s.isInterleavedBufferAttribute?(i=s.data.count,o.drawArraysInstancedANGLE(n,0,i,e.maxInstancedCount)):o.drawArraysInstancedANGLE(n,a,i,e.maxInstancedCount),r.update(i,n,e.maxInstancedCount)}var n;this.setMode=function(e){n=e},this.render=a,this.renderInstances=i}function tt(e,t,r){function a(){if(void 0!==s)return s;var r=t.get("EXT_texture_filter_anisotropic");return s=null===r?0:e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT),s}function i(t){if("highp"===t){if(0<e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision&&0<e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision)return"highp";t="mediump"}return"mediump"===t&&0<e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision&&0<e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision?"mediump":"lowp"}var n=r.precision===void 0?"highp":r.precision,o=i(n),s;o!==n&&(console.warn("THREE.WebGLRenderer:",n,"not supported, using",o,"instead."),n=o);var d=!0===r.logarithmicDepthBuffer,l=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),c=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),p=e.getParameter(e.MAX_TEXTURE_SIZE),m=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),u=e.getParameter(e.MAX_VERTEX_ATTRIBS),f=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),h=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),_=0<c,x=!!t.get("OES_texture_float");return{getMaxAnisotropy:a,getMaxPrecision:i,precision:n,logarithmicDepthBuffer:d,maxTextures:l,maxVertexTextures:c,maxTextureSize:p,maxCubemapSize:m,maxAttributes:u,maxVertexUniforms:f,maxVaryings:g,maxFragmentUniforms:h,vertexTextures:_,floatFragmentTextures:x,floatVertexTextures:_&&x}}function rt(){function e(){p.value!==a&&(p.value=a,p.needsUpdate=0<n),r.numPlanes=n,r.numIntersection=0}function t(e,t,a,n){var o=null===e?0:e.length,s=null;if(0!==o){if(s=p.value,!0!==n||null===s){var d=a+4*o,m=t.matrixWorldInverse;c.getNormalMatrix(m),(null===s||s.length<d)&&(s=new Float32Array(d));for(var u=0,f=a;u!==o;++u,f+=4)l.copy(e[u]).applyMatrix4(m,c),l.normal.toArray(s,f),s[f+3]=l.constant}p.value=s,p.needsUpdate=!0}return r.numPlanes=o,s}var r=this,a=null,n=0,s=!1,d=!1,l=new g,c=new o,p={value:null,needsUpdate:!1};this.uniform=p,this.numPlanes=0,this.numIntersection=0,this.init=function(e,r,i){var o=0!==e.length||r||0!==n||s;return s=r,a=t(e,i,0),n=e.length,o},this.beginShadows=function(){d=!0,t(null)},this.endShadows=function(){d=!1,e()},this.setState=function(r,o,l,c,m,u){if(!s||null===r||0===r.length||d&&!l)d?t(null):e();else{var f=d?0:n,g=4*f,h=m.clippingState||null;p.value=h,h=t(r,c,g,u);for(var _=0;_!=g;++_)h[_]=a[_];m.clippingState=h,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=f}}}function at(e){var t={};return{get:function(r){if(void 0!==t[r])return t[r];var a;return a="WEBGL_depth_texture"===r?e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture"):"EXT_texture_filter_anisotropic"===r?e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"):"WEBGL_compressed_texture_s3tc"===r?e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"):"WEBGL_compressed_texture_pvrtc"===r?e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"):e.getExtension(r),null===a&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=a,a}}}function it(e,t,r){function a(e){var o=e.target,s=i[o.id];for(var d in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[d]);o.removeEventListener("dispose",a),delete i[o.id];var l=n[o.id];l&&(t.remove(l),delete n[o.id]),l=n[s.id],l&&(t.remove(l),delete n[s.id]),r.memory.geometries--}var i={},n={};return{get:function(e,t){var n=i[t.id];return n?n:(t.addEventListener("dispose",a),t.isBufferGeometry?n=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=new N().setFromObject(e)),n=t._bufferGeometry),i[t.id]=n,r.memory.geometries++,n)},update:function(r){var a=r.index,n=r.attributes;for(var o in null!==a&&t.update(a,e.ELEMENT_ARRAY_BUFFER),n)t.update(n[o],e.ARRAY_BUFFER);var s=r.morphAttributes;for(var o in s)for(var d=s[o],c=0,p=d.length;c<p;c++)t.update(d[c],e.ARRAY_BUFFER)},getWireframeAttribute:function(r){var o=n[r.id];if(o)return o;var s=[],d=r.index,p=r.attributes;if(null!==d)for(var m=d.array,u=0,f=m.length;u<f;u+=3){var g=m[u+0],h=m[u+1],_=m[u+2];s.push(g,h,h,_,_,g)}else for(var m=p.position.array,u=0,f=m.length/3-1;u<f;u+=3){var g=u+0,h=u+1,_=u+2;s.push(g,h,h,_,_,g)}return o=new(65535<U(s)?R:w)(s,1),t.update(o,e.ELEMENT_ARRAY_BUFFER),n[r.id]=o,o}}}function nt(e,t,r){function a(t,a){e.drawElements(n,a,o,t*s),r.update(a,n)}function i(e,a,i){var d=t.get("ANGLE_instanced_arrays");return null===d?void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):void(d.drawElementsInstancedANGLE(n,i,o,a*s,e.maxInstancedCount),r.update(i,n,e.maxInstancedCount))}var n,o,s;this.setMode=function(e){n=e},this.setIndex=function(e){o=e.type,s=e.bytesPerElement},this.render=a,this.renderInstances=i}function ot(e){function t(t,a,i){switch(i=i||1,r.calls++,a){case e.TRIANGLES:r.triangles+=i*(t/3);break;case e.TRIANGLE_STRIP:case e.TRIANGLE_FAN:r.triangles+=i*(t-2);break;case e.LINES:r.lines+=i*(t/2);break;case e.LINE_STRIP:r.lines+=i*(t-1);break;case e.LINE_LOOP:r.lines+=i*t;break;case e.POINTS:r.points+=i*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);}}var r={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:r,programs:null,autoReset:!0,reset:function(){r.frame++,r.calls=0,r.triangles=0,r.points=0,r.lines=0},update:t}}function st(e,t){return Ur(t[1])-Ur(e[1])}function dt(e){var t={},r=new Float32Array(8);return{update:function(a,n,o,s){var d=a.morphTargetInfluences,l=d.length,c=t[n.id];if(c===void 0){c=[];for(var p=0;p<l;p++)c[p]=[p,0];t[n.id]=c}for(var m=o.morphTargets&&n.morphAttributes.position,u=o.morphNormals&&n.morphAttributes.normal,p=0,f;p<l;p++)f=c[p],0!==f[1]&&(m&&n.removeAttribute("morphTarget"+p),u&&n.removeAttribute("morphNormal"+p));for(var p=0,f;p<l;p++)f=c[p],f[0]=p,f[1]=d[p];c.sort(st);for(var p=0,f;8>p;p++){if(f=c[p],f){var g=f[0],h=f[1];if(h){m&&n.addAttribute("morphTarget"+p,m[g]),u&&n.addAttribute("morphNormal"+p,u[g]),r[p]=h;continue}}r[p]=0}s.getUniforms().setValue(e,"morphTargetInfluences",r)}}}function lt(e,t){function r(r){var i=t.render.frame,n=r.geometry,o=e.get(r,n);return a[o.id]!==i&&(n.isGeometry&&o.updateFromObject(r),e.update(o),a[o.id]=i),o}var a={};return{update:r,dispose:function(){a={}}}}function ct(e,t,r,a,i,n,o,s,d,l){e=e===void 0?[]:e,t=t===void 0?301:t,Xe.call(this,e,t,r,a,i,n,o,s,d,l),this.flipY=!1}function pt(){this.seq=[],this.map={}}function mt(e,t,a){var o=e[0];if(0>=o||0<o)return e;var s=t*a,n=Ca[s];if(void 0===n&&(n=new Float32Array(s),Ca[s]=n),0!==t){o.toArray(n,0);for(var d=1,l=0;d!==t;++d)l+=a,e[d].toArray(n,l)}return n}function ut(e,t){var a=Da[t];a===void 0&&(a=new Int32Array(t),Da[t]=a);for(var n=0;n!==t;++n)a[n]=e.allocTextureUnit();return a}function ft(e,t){e.uniform1f(this.addr,t)}function gt(e,t){e.uniform1i(this.addr,t)}function ht(e,t){t.x===void 0?e.uniform2fv(this.addr,t):e.uniform2f(this.addr,t.x,t.y)}function _t(e,t){t.x===void 0?t.r===void 0?e.uniform3fv(this.addr,t):e.uniform3f(this.addr,t.r,t.g,t.b):e.uniform3f(this.addr,t.x,t.y,t.z)}function xt(e,t){t.x===void 0?e.uniform4fv(this.addr,t):e.uniform4f(this.addr,t.x,t.y,t.z,t.w)}function vt(e,t){e.uniformMatrix2fv(this.addr,!1,t.elements||t)}function yt(e,t){t.elements===void 0?e.uniformMatrix3fv(this.addr,!1,t):(Na.set(t.elements),e.uniformMatrix3fv(this.addr,!1,Na))}function Et(e,t){t.elements===void 0?e.uniformMatrix4fv(this.addr,!1,t):(Ua.set(t.elements),e.uniformMatrix4fv(this.addr,!1,Ua))}function St(e,t,r){var a=r.allocTextureUnit();e.uniform1i(this.addr,a),r.setTexture2D(t||Ra,a)}function Mt(e,t,r){var a=r.allocTextureUnit();e.uniform1i(this.addr,a),r.setTextureCube(t||Pa,a)}function bt(e,t){e.uniform2iv(this.addr,t)}function Tt(e,t){e.uniform3iv(this.addr,t)}function Lt(e,t){e.uniform4iv(this.addr,t)}function wt(e){return 5126===e?ft:35664===e?ht:35665===e?_t:35666===e?xt:35674===e?vt:35675===e?yt:35676===e?Et:35678===e||36198===e?St:35680===e?Mt:5124===e||35670===e?gt:35667===e||35671===e?bt:35668===e||35672===e?Tt:35669===e||35673===e?Lt:void 0}function At(e,t){e.uniform1fv(this.addr,t)}function Rt(e,t){e.uniform1iv(this.addr,t)}function Pt(e,t){e.uniform2fv(this.addr,mt(t,this.size,2))}function Ct(e,t){e.uniform3fv(this.addr,mt(t,this.size,3))}function Dt(e,t){e.uniform4fv(this.addr,mt(t,this.size,4))}function Ut(e,t){e.uniformMatrix2fv(this.addr,!1,mt(t,this.size,4))}function Nt(e,t){e.uniformMatrix3fv(this.addr,!1,mt(t,this.size,9))}function It(e,t){e.uniformMatrix4fv(this.addr,!1,mt(t,this.size,16))}function zt(e,t,r){var a=t.length,n=ut(r,a);e.uniform1iv(this.addr,n);for(var o=0;o!==a;++o)r.setTexture2D(t[o]||Ra,n[o])}function Ft(e,t,r){var a=t.length,n=ut(r,a);e.uniform1iv(this.addr,n);for(var o=0;o!==a;++o)r.setTextureCube(t[o]||Pa,n[o])}function Bt(e){return 5126===e?At:35664===e?Pt:35665===e?Ct:35666===e?Dt:35674===e?Ut:35675===e?Nt:35676===e?It:35678===e?zt:35680===e?Ft:5124===e||35670===e?Rt:35667===e||35671===e?bt:35668===e||35672===e?Tt:35669===e||35673===e?Lt:void 0}function Ot(e,t,r){this.id=e,this.addr=r,this.setValue=wt(t.type)}function Gt(e,t,r){this.id=e,this.addr=r,this.size=t.size,this.setValue=Bt(t.type)}function Vt(e){this.id=e,pt.call(this)}function Ht(e,t){e.seq.push(t),e.map[t.id]=t}function kt(e,t,r){var a=e.name,i=a.length;for(Ia.lastIndex=0;;){var n=Ia.exec(a),o=Ia.lastIndex,s=n[1],d="]"===n[2],l=n[3];if(d&&(s|=0),void 0===l||"["===l&&o+2===i){Ht(r,void 0===l?new Ot(s,e,t):new Gt(s,e,t));break}else{var c=r.map,p=c[s];void 0===p&&(p=new Vt(s),Ht(r,p)),r=p}}}function Wt(e,t,r){pt.call(this),this.renderer=r;for(var a=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),n=0;n<a;++n){var o=e.getActiveUniform(t,n),s=e.getUniformLocation(t,o.name);kt(o,s,this)}}function Xt(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")}function Yt(e,t,r){var a=e.createShader(t);return e.shaderSource(a,r),e.compileShader(a),!1===e.getShaderParameter(a,e.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(a)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t===e.VERTEX_SHADER?"vertex":"fragment",e.getShaderInfoLog(a),Xt(r)),a}function qt(e){switch(e){case 3000:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e);}}function jt(e,t){var r=qt(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function Zt(e,t){var r=qt(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}function Qt(e,t){var r;switch(t){case 1:r="Linear";break;case 2:r="Reinhard";break;case 3:r="Uncharted2";break;case 4:r="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+t);}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function Jt(e,t,r){e=e||{};var a=[e.derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""];return a.filter(er).join("\n")}function Kt(e){var t=[];for(var r in e){var a=e[r];!1===a||t.push("#define "+r+" "+a)}return t.join("\n")}function $t(e,t){for(var r={},a=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),n=0;n<a;n++){var o=e.getActiveAttrib(t,n),s=o.name;r[s]=e.getAttribLocation(t,s)}return r}function er(e){return""!==e}function tr(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function rr(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function ar(e){function t(e,t){var r=Ta[t];if(r===void 0)throw new Error("Can not resolve #include <"+t+">");return ar(r)}var r=/^[ \t]*#include +<([\w\d.]+)>/gm;return e.replace(r,t)}function ir(e){var t=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;return e.replace(t,function(e,t,r,a){for(var n="",o=parseInt(t);o<parseInt(r);o++)n+=a.replace(/\[ i \]/g,"[ "+o+" ]");return n})}function nr(e,t,r,a,i,n){var o=e.context,s=a.defines,d=i.vertexShader,l=i.fragmentShader,c="SHADOWMAP_TYPE_BASIC";1===n.shadowMapType?c="SHADOWMAP_TYPE_PCF":2===n.shadowMapType&&(c="SHADOWMAP_TYPE_PCF_SOFT");var p="ENVMAP_TYPE_CUBE",m="ENVMAP_MODE_REFLECTION",u="ENVMAP_BLENDING_MULTIPLY";if(n.envMap){switch(a.envMap.mapping){case 301:case 302:p="ENVMAP_TYPE_CUBE";break;case 306:case 307:p="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:p="ENVMAP_TYPE_EQUIREC";break;case 305:p="ENVMAP_TYPE_SPHERE";}switch(a.envMap.mapping){case 302:case 304:m="ENVMAP_MODE_REFRACTION";}switch(a.combine){case 0:u="ENVMAP_BLENDING_MULTIPLY";break;case 1:u="ENVMAP_BLENDING_MIX";break;case 2:u="ENVMAP_BLENDING_ADD";}}var f=0<e.gammaFactor?e.gammaFactor:1,g=Jt(a.extensions,n,t),h=Kt(s),_=o.createProgram(),x,v;a.isRawShaderMaterial?(x=[h].filter(er).join("\n"),0<x.length&&(x+="\n"),v=[g,h].filter(er).join("\n"),0<v.length&&(v+="\n")):(x=["precision "+n.precision+" float;","precision "+n.precision+" int;","#define SHADER_NAME "+i.name,h,n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+f,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+m:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexColors?"#define USE_COLOR":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&t.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(er).join("\n"),v=[g,"precision "+n.precision+" float;","precision "+n.precision+" int;","#define SHADER_NAME "+i.name,h,n.alphaTest?"#define ALPHATEST "+n.alphaTest:"","#define GAMMA_FACTOR "+f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+p:"",n.envMap?"#define "+m:"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexColors?"#define USE_COLOR":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&t.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",n.envMap&&t.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0===n.toneMapping?"":"#define TONE_MAPPING",0===n.toneMapping?"":Ta.tonemapping_pars_fragment,0===n.toneMapping?"":Qt("toneMapping",n.toneMapping),n.dithering?"#define DITHERING":"",n.outputEncoding||n.mapEncoding||n.envMapEncoding||n.emissiveMapEncoding?Ta.encodings_pars_fragment:"",n.mapEncoding?jt("mapTexelToLinear",n.mapEncoding):"",n.envMapEncoding?jt("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMapEncoding?jt("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.outputEncoding?Zt("linearToOutputTexel",n.outputEncoding):"",n.depthPacking?"#define DEPTH_PACKING "+a.depthPacking:"","\n"].filter(er).join("\n")),d=ar(d),d=tr(d,n),d=rr(d,n),l=ar(l),l=tr(l,n),l=rr(l,n),d=ir(d),l=ir(l);var y=x+d,E=v+l,S=Yt(o,o.VERTEX_SHADER,y),M=Yt(o,o.FRAGMENT_SHADER,E);o.attachShader(_,S),o.attachShader(_,M),void 0===a.index0AttributeName?!0===n.morphTargets&&o.bindAttribLocation(_,0,"position"):o.bindAttribLocation(_,0,a.index0AttributeName),o.linkProgram(_);var b=o.getProgramInfoLog(_).trim(),T=o.getShaderInfoLog(S).trim(),L=o.getShaderInfoLog(M).trim(),w=!0,A=!0;!1===o.getProgramParameter(_,o.LINK_STATUS)?(w=!1,console.error("THREE.WebGLProgram: shader error: ",o.getError(),"gl.VALIDATE_STATUS",o.getProgramParameter(_,o.VALIDATE_STATUS),"gl.getProgramInfoLog",b,T,L)):""===b?(""===T||""===L)&&(A=!1):console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",b),A&&(this.diagnostics={runnable:w,material:a,programLog:b,vertexShader:{log:T,prefix:x},fragmentShader:{log:L,prefix:v}}),o.deleteShader(S),o.deleteShader(M);var R;this.getUniforms=function(){return null==R&&(R=new Wt(o,_,e)),R};var P;return this.getAttributes=function(){return void 0===P&&(P=$t(o,_)),P},this.destroy=function(){o.deleteProgram(_),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.name=i.name,this.id=za++,this.code=r,this.usedTimes=1,this.program=_,this.vertexShader=S,this.fragmentShader=M,this}function or(e,t,r){function a(e){var t=e.skeleton,a=t.bones;if(r.floatVertexTextures)return 1024;var i=r.maxVertexUniforms,n=Hr((i-20)/4),o=Wr(n,a.length);return o<a.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+a.length+" bones. This GPU supports "+o+"."),0):o}function i(e,t){var r;return e?e.isTexture?r=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=e.texture.encoding):r=3000,3000===r&&t&&(r=3007),r}var n=[],o={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow"},s=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];this.getParameters=function(t,n,s,d,l,c,p){var m=o[t.type],u=p.isSkinnedMesh?a(p):0,f=r.precision;null!==t.precision&&(f=r.getMaxPrecision(t.precision),f!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",f,"instead."));var g=e.getRenderTarget(),h={shaderID:m,precision:f,supportsVertexTextures:r.vertexTextures,outputEncoding:i(g?g.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:i(t.map,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:i(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===306||t.envMap.mapping===307),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:i(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!d,useFog:t.fog,fogExp:d&&d.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:r.logarithmicDepthBuffer,skinning:t.skinning&&0<u,maxBones:u,useVertexTexture:r.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:n.directional.length,numPointLights:n.point.length,numSpotLights:n.spot.length,numRectAreaLights:n.rectArea.length,numHemiLights:n.hemi.length,numClippingPlanes:l,numClipIntersection:c,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&p.receiveShadow&&0<s.length,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===2,flipSided:t.side===1,depthPacking:t.depthPacking!==void 0&&t.depthPacking};return h},this.getProgramCode=function(t,r){var a=[];if(r.shaderID?a.push(r.shaderID):(a.push(t.fragmentShader),a.push(t.vertexShader)),void 0!==t.defines)for(var n in t.defines)a.push(n),a.push(t.defines[n]);for(var o=0;o<s.length;o++)a.push(r[s[o]]);return a.push(t.onBeforeCompile.toString()),a.push(e.gammaOutput),a.join()},this.acquireProgram=function(r,a,i,o){for(var s=0,d=n.length,l,c;s<d;s++)if(c=n[s],c.code===o){l=c,++l.usedTimes;break}return void 0===l&&(l=new nr(e,t,o,r,a,i),n.push(l)),l},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=n.indexOf(e);n[t]=n[n.length-1],n.pop(),e.destroy()}},this.programs=n}function sr(){function e(e){var t=a.get(e);return void 0===t&&(t={},a.set(e,t)),t}function t(e){a.delete(e)}function r(e,t,r){a.get(e)[t]=r}var a=new WeakMap;return{get:e,remove:t,update:r,dispose:function(){a=new WeakMap}}}function dr(e,t){return e.renderOrder===t.renderOrder?e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id===t.material.id?e.z===t.z?e.id-t.id:e.z-t.z:e.material.id-t.material.id:e.renderOrder-t.renderOrder}function lr(e,t){return e.renderOrder===t.renderOrder?e.z===t.z?e.id-t.id:t.z-e.z:e.renderOrder-t.renderOrder}function cr(){function e(e,n,o,s,d){var l=t[r];l===void 0?(l={id:e.id,object:e,geometry:n,material:o,program:o.program,renderOrder:e.renderOrder,z:s,group:d},t[r]=l):(l.id=e.id,l.object=e,l.geometry=n,l.material=o,l.program=o.program,l.renderOrder=e.renderOrder,l.z=s,l.group=d),(!0===o.transparent?i:a).push(l),r++}var t=[],r=0,a=[],i=[];return{opaque:a,transparent:i,init:function(){r=0,a.length=0,i.length=0},push:e,sort:function(){1<a.length&&a.sort(dr),1<i.length&&i.sort(lr)}}}function pr(){function e(e,r){var a=e.id+","+r.id,i=t[a];return void 0===i&&(i=new cr,t[a]=i),i}var t={};return{get:e,dispose:function(){t={}}}}function mr(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var r;switch(t.type){case"DirectionalLight":r={direction:new n,color:new _,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new c};break;case"SpotLight":r={position:new n,direction:new n,color:new _,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new c};break;case"PointLight":r={position:new n,color:new _,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new c,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":r={direction:new n,skyColor:new _,groundColor:new _};break;case"RectAreaLight":r={color:new _,position:new n,halfWidth:new n,halfHeight:new n};}return e[t.id]=r,r}}}function ur(){var e=new mr,a={id:Fa++,hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},r=new n,i=new t,o=new t;return{setup:function(t,n,s){for(var d=0,c=0,p=0,m=0,u=0,f=0,h=0,_=0,x=s.matrixWorldInverse,v=0,y=t.length;v<y;v++){var l=t[v],E=l.color,S=l.intensity,M=l.distance,T=l.shadow&&l.shadow.map?l.shadow.map.texture:null;if(l.isAmbientLight)d+=E.r*S,c+=E.g*S,p+=E.b*S;else if(l.isDirectionalLight){var L=e.get(l);if(L.color.copy(l.color).multiplyScalar(l.intensity),L.direction.setFromMatrixPosition(l.matrixWorld),r.setFromMatrixPosition(l.target.matrixWorld),L.direction.sub(r),L.direction.transformDirection(x),L.shadow=l.castShadow,l.castShadow){var w=l.shadow;L.shadowBias=w.bias,L.shadowRadius=w.radius,L.shadowMapSize=w.mapSize}a.directionalShadowMap[m]=T,a.directionalShadowMatrix[m]=l.shadow.matrix,a.directional[m]=L,m++}else if(l.isSpotLight){var L=e.get(l);if(L.position.setFromMatrixPosition(l.matrixWorld),L.position.applyMatrix4(x),L.color.copy(E).multiplyScalar(S),L.distance=M,L.direction.setFromMatrixPosition(l.matrixWorld),r.setFromMatrixPosition(l.target.matrixWorld),L.direction.sub(r),L.direction.transformDirection(x),L.coneCos=Nr(l.angle),L.penumbraCos=Nr(l.angle*(1-l.penumbra)),L.decay=0===l.distance?0:l.decay,L.shadow=l.castShadow,l.castShadow){var w=l.shadow;L.shadowBias=w.bias,L.shadowRadius=w.radius,L.shadowMapSize=w.mapSize}a.spotShadowMap[f]=T,a.spotShadowMatrix[f]=l.shadow.matrix,a.spot[f]=L,f++}else if(l.isRectAreaLight){var L=e.get(l);L.color.copy(E).multiplyScalar(S),L.position.setFromMatrixPosition(l.matrixWorld),L.position.applyMatrix4(x),o.identity(),i.copy(l.matrixWorld),i.premultiply(x),o.extractRotation(i),L.halfWidth.set(.5*l.width,0,0),L.halfHeight.set(0,.5*l.height,0),L.halfWidth.applyMatrix4(o),L.halfHeight.applyMatrix4(o),a.rectArea[h]=L,h++}else if(l.isPointLight){var L=e.get(l);if(L.position.setFromMatrixPosition(l.matrixWorld),L.position.applyMatrix4(x),L.color.copy(l.color).multiplyScalar(l.intensity),L.distance=l.distance,L.decay=0===l.distance?0:l.decay,L.shadow=l.castShadow,l.castShadow){var w=l.shadow;L.shadowBias=w.bias,L.shadowRadius=w.radius,L.shadowMapSize=w.mapSize,L.shadowCameraNear=w.camera.near,L.shadowCameraFar=w.camera.far}a.pointShadowMap[u]=T,a.pointShadowMatrix[u]=l.shadow.matrix,a.point[u]=L,u++}else if(l.isHemisphereLight){var L=e.get(l);L.direction.setFromMatrixPosition(l.matrixWorld),L.direction.transformDirection(x),L.direction.normalize(),L.skyColor.copy(l.color).multiplyScalar(S),L.groundColor.copy(l.groundColor).multiplyScalar(S),a.hemi[_]=L,_++}}a.ambient[0]=d,a.ambient[1]=c,a.ambient[2]=p,a.directional.length=m,a.spot.length=f,a.rectArea.length=h,a.point.length=u,a.hemi.length=_,a.hash=a.id+","+m+","+u+","+f+","+h+","+_+","+n.length},state:a}}function fr(){var e=new ur,t=[],r=[],a=[];return{init:function(){t.length=0,r.length=0,a.length=0},state:{lightsArray:t,shadowsArray:r,spritesArray:a,lights:e},setupLights:function(a){e.setup(t,r,a)},pushLight:function(e){t.push(e)},pushShadow:function(e){r.push(e)},pushSprite:function(e){a.push(e)}}}function gr(){function e(e,r){var a=e.id+","+r.id,i=t[a];return void 0===i&&(i=new fr,t[a]=i),i}var t={};return{get:e,dispose:function(){t={}}}}function hr(e,t,r){this.width=e,this.height=t,this.scissor=new E(0,0,e,t),this.scissorTest=!1,this.viewport=new E(0,0,e,t),r=r||{},r.minFilter===void 0&&(r.minFilter=1006),this.texture=new Xe(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.depthBuffer=!(r.depthBuffer!==void 0)||r.depthBuffer,this.stencilBuffer=!(r.stencilBuffer!==void 0)||r.stencilBuffer,this.depthTexture=r.depthTexture===void 0?null:r.depthTexture}function _r(e){v.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function xr(e){v.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new n,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}function yr(e,r,a){function o(t,r,a,i,n,o){var s=t.geometry,d=null,l=x,c=t.customDepthMaterial;if(a&&(l=v,c=t.customDistanceMaterial),!c){var p=!1;r.morphTargets&&(s&&s.isBufferGeometry?p=s.morphAttributes&&s.morphAttributes.position&&0<s.morphAttributes.position.length:s&&s.isGeometry&&(p=s.morphTargets&&0<s.morphTargets.length)),t.isSkinnedMesh&&!1===r.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t);var m=t.isSkinnedMesh&&r.skinning,u=0;p&&(u|=1),m&&(u|=2),d=l[u]}else d=c;if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var f=d.uuid,g=r.uuid,h=y[f];void 0===h&&(h={},y[f]=h);var _=h[g];void 0===_&&(_=d.clone(),h[g]=_),d=_}return d.visible=r.visible,d.wireframe=r.wireframe,d.side=null==r.shadowSide?S[r.side]:r.shadowSide,d.clipShadows=r.clipShadows,d.clippingPlanes=r.clippingPlanes,d.clipIntersection=r.clipIntersection,d.wireframeLinewidth=r.wireframeLinewidth,d.linewidth=r.linewidth,a&&d.isMeshDistanceMaterial&&(d.referencePosition.copy(i),d.nearDistance=n,d.farDistance=o),d}function s(t,a,n,c){if(!1!==t.visible){var p=t.layers.test(a.layers);if(p&&(t.isMesh||t.isLine||t.isPoints)&&t.castShadow&&(!t.frustumCulled||d.intersectsObject(t))){t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld);var m=r.update(t),u=t.material;if(Array.isArray(u))for(var g=m.groups,h=0,_=g.length;h<_;h++){var x=g[h],v=u[x.materialIndex];if(v&&v.visible){var y=o(t,v,c,f,n.near,n.far);e.renderBufferDirect(n,null,m,y,t,x)}}else if(u.visible){var y=o(t,u,c,f,n.near,n.far);e.renderBufferDirect(n,null,m,y,t,null)}}for(var E=t.children,S=0,M=E.length;S<void 0;S++)s(E[S],a,n,c)}}for(var d=new qe,l=new t,p=new c,m=new c(a,a),u=new n,f=new n,g=1,h=2,_=(g|h)+1,x=Array(_),v=Array(_),y={},S={0:1,1:0,2:2},M=[new n(1,0,0),new n(-1,0,0),new n(0,0,1),new n(0,0,-1),new n(0,1,0),new n(0,-1,0)],b=[new n(0,1,0),new n(0,1,0),new n(0,1,0),new n(0,1,0),new n(0,0,1),new n(0,0,-1)],T=[new E,new E,new E,new E,new E,new E],L=0;L!==_;++L){var w=0!=(L&g),A=0!=(L&h),R=new _r({depthPacking:3201,morphTargets:w,skinning:A});x[L]=R;var P=new xr({morphTargets:w,skinning:A});v[L]=P}var C=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,r,a){if(!1!==C.enabled&&(!1!==C.autoUpdate||!1!==C.needsUpdate)&&0!==t.length){var n=e.context,o=e.state;o.disable(n.BLEND),o.buffers.color.setClear(1,1,1,1),o.buffers.depth.setTest(!0),o.setScissorTest(!1);for(var c=0,g=t.length,h;void 0>c;c++){var _=t[c],x=_.shadow,v=_&&_.isPointLight;if(void 0===x){console.warn("THREE.WebGLShadowMap:",_,"has no shadow.");continue}var y=x.camera;if(p.copy(x.mapSize),p.min(m),v){var E=p.x,S=p.y;T[0].set(2*E,S,E,S),T[1].set(0,S,E,S),T[2].set(3*E,S,E,S),T[3].set(E,S,E,S),T[4].set(3*E,0,E,S),T[5].set(E,0,E,S),p.x*=4,p.y*=2}if(null===x.map){x.map=new hr(p.x,p.y,{minFilter:1003,magFilter:1003,format:1023}),x.map.texture.name=_.name+".shadowMap",y.updateProjectionMatrix()}x.isSpotLightShadow&&x.update(_);var L=x.map,w=x.matrix;f.setFromMatrixPosition(_.matrixWorld),y.position.copy(f),v?(h=6,w.makeTranslation(-f.x,-f.y,-f.z)):(h=1,u.setFromMatrixPosition(_.target.matrixWorld),y.lookAt(u),y.updateMatrixWorld(),w.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),w.multiply(y.projectionMatrix),w.multiply(y.matrixWorldInverse)),e.setRenderTarget(L),e.clear();for(var A=0;A<h;A++){if(v){u.copy(y.position),u.add(M[A]),y.up.copy(b[A]),y.lookAt(u),y.updateMatrixWorld();var R=T[A];o.viewport(R)}l.multiplyMatrices(y.projectionMatrix,y.matrixWorldInverse),d.setFromMatrix(l),s(r,a,y,v)}}C.needsUpdate=!1}}}function vr(e,t,r,a,i,n,o,s,d){Xe.call(this,e,t,r,a,i,n,o,s,d),this.needsUpdate=!0}function Er(t,r,a,i,o){function s(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),t=new Uint16Array([0,1,2,0,2,3]);u=r.createBuffer(),f=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,u),r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,f),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW),g=d(),h={position:r.getAttribLocation(g,"position"),uv:r.getAttribLocation(g,"uv")},_={uvOffset:r.getUniformLocation(g,"uvOffset"),uvScale:r.getUniformLocation(g,"uvScale"),rotation:r.getUniformLocation(g,"rotation"),center:r.getUniformLocation(g,"center"),scale:r.getUniformLocation(g,"scale"),color:r.getUniformLocation(g,"color"),map:r.getUniformLocation(g,"map"),opacity:r.getUniformLocation(g,"opacity"),modelViewMatrix:r.getUniformLocation(g,"modelViewMatrix"),projectionMatrix:r.getUniformLocation(g,"projectionMatrix"),fogType:r.getUniformLocation(g,"fogType"),fogDensity:r.getUniformLocation(g,"fogDensity"),fogNear:r.getUniformLocation(g,"fogNear"),fogFar:r.getUniformLocation(g,"fogFar"),fogColor:r.getUniformLocation(g,"fogColor"),fogDepth:r.getUniformLocation(g,"fogDepth"),alphaTest:r.getUniformLocation(g,"alphaTest")};var a=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");a.width=8,a.height=8;var i=a.getContext("2d");i.fillStyle="white",i.fillRect(0,0,8,8),x=new vr(a)}function d(){var e=r.createProgram(),t=r.createShader(r.VERTEX_SHADER),a=r.createShader(r.FRAGMENT_SHADER);return r.shaderSource(t,["precision "+o.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 center;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvUV = uvOffset + uv * uvScale;","\tvec2 alignedPosition = ( position - center ) * scale;","\tvec2 rotatedPosition;","\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","\tvec4 mvPosition;","\tmvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","\tmvPosition.xy += rotatedPosition;","\tgl_Position = projectionMatrix * mvPosition;","\tfogDepth = - mvPosition.z;","}"].join("\n")),r.shaderSource(a,["precision "+o.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvec4 texture = texture2D( map, vUV );","\tgl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","\tif ( gl_FragColor.a < alphaTest ) discard;","\tif ( fogType > 0 ) {","\t\tfloat fogFactor = 0.0;","\t\tif ( fogType == 1 ) {","\t\t\tfogFactor = smoothstep( fogNear, fogFar, fogDepth );","\t\t} else {","\t\t\tconst float LOG2 = 1.442695;","\t\t\tfogFactor = exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 );","\t\t\tfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","\t\t}","\t\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );","\t}","}"].join("\n")),r.compileShader(t),r.compileShader(a),r.attachShader(e,t),r.attachShader(e,a),r.linkProgram(e),e}function c(e,t){return e.renderOrder===t.renderOrder?e.z===t.z?t.id-e.id:t.z-e.z:e.renderOrder-t.renderOrder}var l=new n,p=new e,m=new n,u,f,g,h,_,x;this.render=function(e,n,o){if(0!==e.length){void 0===g&&s(),a.useProgram(g),a.initAttributes(),a.enableAttribute(h.position),a.enableAttribute(h.uv),a.disableUnusedAttributes(),a.disable(r.CULL_FACE),a.enable(r.BLEND),r.bindBuffer(r.ARRAY_BUFFER,u),r.vertexAttribPointer(h.position,2,r.FLOAT,!1,16,0),r.vertexAttribPointer(h.uv,2,r.FLOAT,!1,16,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,f),r.uniformMatrix4fv(_.projectionMatrix,!1,o.projectionMatrix.elements),a.activeTexture(r.TEXTURE0),r.uniform1i(_.map,0);var d=0,v=0,y=n.fog;y?(r.uniform3f(_.fogColor,y.color.r,y.color.g,y.color.b),y.isFog?(r.uniform1f(_.fogNear,y.near),r.uniform1f(_.fogFar,y.far),r.uniform1i(_.fogType,1),d=1,v=1):y.isFogExp2&&(r.uniform1f(_.fogDensity,y.density),r.uniform1i(_.fogType,2),d=2,v=2)):(r.uniform1i(_.fogType,0),d=0,v=0);for(var E=0,S=e.length,M;E<S;E++)M=e[E],M.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,M.matrixWorld),M.z=-M.modelViewMatrix.elements[14];e.sort(c);for(var b=[],T=[],E=0,S=e.length;E<S;E++){var M=e[E],L=M.material;if(!1!==L.visible){M.onBeforeRender(t,n,o,void 0,L,void 0),r.uniform1f(_.alphaTest,L.alphaTest),r.uniformMatrix4fv(_.modelViewMatrix,!1,M.modelViewMatrix.elements),M.matrixWorld.decompose(l,p,m),b[0]=m.x,b[1]=m.y,T[0]=M.center.x-.5,T[1]=M.center.y-.5;var w=0;n.fog&&L.fog&&(w=v),d!==w&&(r.uniform1i(_.fogType,w),d=w),null===L.map?(r.uniform2f(_.uvOffset,0,0),r.uniform2f(_.uvScale,1,1)):(r.uniform2f(_.uvOffset,L.map.offset.x,L.map.offset.y),r.uniform2f(_.uvScale,L.map.repeat.x,L.map.repeat.y)),r.uniform1f(_.opacity,L.opacity),r.uniform3f(_.color,L.color.r,L.color.g,L.color.b),r.uniform1f(_.rotation,L.rotation),r.uniform2fv(_.center,T),r.uniform2fv(_.scale,b),a.setBlending(L.blending,L.blendEquation,L.blendSrc,L.blendDst,L.blendEquationAlpha,L.blendSrcAlpha,L.blendDstAlpha,L.premultipliedAlpha),a.buffers.depth.setTest(L.depthTest),a.buffers.depth.setMask(L.depthWrite),a.buffers.color.setMask(L.colorWrite),i.setTexture2D(L.map||x,0),r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0),M.onAfterRender(t,n,o,void 0,L,void 0)}}a.enable(r.CULL_FACE),a.reset()}}}function Sr(e,t,r){function a(t,r,a){var n=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var s=0;s<a;s++)e.texImage2D(r+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,n);return o}function i(t){!0!==T[t]&&(e.enable(t),T[t]=!0)}function n(t){!1!==T[t]&&(e.disable(t),T[t]=!1)}function o(){if(null===L&&(L=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")||t.get("WEBGL_compressed_texture_astc")))for(var r=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),a=0;a<r.length;a++)L.push(r[a]);return L}function s(t){return w!==t&&(e.useProgram(t),w=t,!0)}function d(t,a,o,s,d,l,c,p){0===t?n(e.BLEND):i(e.BLEND),5===t?(d=d||a,l=l||o,c=c||s,(a!==R||d!==D)&&(e.blendEquationSeparate(r.convert(a),r.convert(d)),R=a,D=d),(o!==P||s!==C||l!==U||c!==N)&&(e.blendFuncSeparate(r.convert(o),r.convert(s),r.convert(l),r.convert(c)),P=o,C=s,U=l,N=c)):((t!==A||p!==I)&&(2===t?p?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE,e.ONE,e.ONE)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)):3===t?p?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)):4===t?p?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR)):p?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA))),R=null,P=null,C=null,D=null,U=null,N=null),A=t,I=p}function l(t){z!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),z=t)}function c(t){0===t?n(e.CULL_FACE):(i(e.CULL_FACE),t!==F&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))),F=t}function p(t){t!==B&&(H&&e.lineWidth(t),B=t)}function m(t,r,a){t?(i(e.POLYGON_OFFSET_FILL),(O!==r||G!==a)&&(e.polygonOffset(r,a),O=r,G=a)):n(e.POLYGON_OFFSET_FILL)}function u(t){void 0===t&&(t=e.TEXTURE0+V-1),X!==t&&(e.activeTexture(t),X=t)}function f(t,r){null===X&&u();var a=Y[X];void 0===a&&(a={type:void 0,texture:void 0},Y[X]=a),(a.type!==t||a.texture!==r)&&(e.bindTexture(t,r||Z[t]),a.type=t,a.texture=r)}function g(t){!1===q.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),q.copy(t))}function h(t){!1===j.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),j.copy(t))}var _=new function(){var t=!1,i=new E,r=null,n=new E(0,0,0,0);return{setMask:function(a){r===a||t||(e.colorMask(a,a,a,a),r=a)},setLocked:function(e){t=e},setClear:function(t,o,s,d,a){!0===a&&(t*=d,o*=d,s*=d),i.set(t,o,s,d),!1===n.equals(i)&&(e.clearColor(t,o,s,d),n.copy(i))},reset:function(){t=!1,r=null,n.set(-1,0,0,0)}}},x=new function(){var t=!1,r=null,a=null,o=null;return{setTest:function(t){t?i(e.DEPTH_TEST):n(e.DEPTH_TEST)},setMask:function(a){r===a||t||(e.depthMask(a),r=a)},setFunc:function(t){a!==t&&(t?0===t?e.depthFunc(e.NEVER):1===t?e.depthFunc(e.ALWAYS):2===t?e.depthFunc(e.LESS):3===t?e.depthFunc(e.LEQUAL):4===t?e.depthFunc(e.EQUAL):5===t?e.depthFunc(e.GEQUAL):6===t?e.depthFunc(e.GREATER):7===t?e.depthFunc(e.NOTEQUAL):e.depthFunc(e.LEQUAL):e.depthFunc(e.LEQUAL),a=t)},setLocked:function(e){t=e},setClear:function(t){o!==t&&(e.clearDepth(t),o=t)},reset:function(){t=!1,r=null,a=null,o=null}}},v=new function(){var t=!1,r=null,a=null,o=null,s=null,d=null,l=null,c=null,p=null;return{setTest:function(t){t?i(e.STENCIL_TEST):n(e.STENCIL_TEST)},setMask:function(a){r===a||t||(e.stencilMask(a),r=a)},setFunc:function(t,r,i){(a!==t||o!==r||s!==i)&&(e.stencilFunc(t,r,i),a=t,o=r,s=i)},setOp:function(t,r,a){(d!==t||l!==r||c!==a)&&(e.stencilOp(t,r,a),d=t,l=r,c=a)},setLocked:function(e){t=e},setClear:function(t){p!==t&&(e.clearStencil(t),p=t)},reset:function(){t=!1,r=null,a=null,o=null,s=null,d=null,l=null,c=null,p=null}}},y=e.getParameter(e.MAX_VERTEX_ATTRIBS),S=new Uint8Array(y),M=new Uint8Array(y),b=new Uint8Array(y),T={},L=null,w=null,A=null,R=null,P=null,C=null,D=null,U=null,N=null,I=!1,z=null,F=null,B=null,O=null,G=null,V=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),H=!1,k=0,W=e.getParameter(e.VERSION);-1===W.indexOf("WebGL")?-1!==W.indexOf("OpenGL ES")&&(k=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(W)[1]),H=2<=k):(k=parseFloat(/^WebGL\ ([0-9])/.exec(W)[1]),H=1<=k);var X=null,Y={},q=new E,j=new E,Z={};return Z[e.TEXTURE_2D]=a(e.TEXTURE_2D,e.TEXTURE_2D,1),Z[e.TEXTURE_CUBE_MAP]=a(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),_.setClear(0,0,0,1),x.setClear(1),v.setClear(0),i(e.DEPTH_TEST),x.setFunc(3),l(!1),c(1),i(e.CULL_FACE),i(e.BLEND),d(1),{buffers:{color:_,depth:x,stencil:v},initAttributes:function(){for(var e=0,t=S.length;e<t;e++)S[e]=0},enableAttribute:function(r){if(S[r]=1,0===M[r]&&(e.enableVertexAttribArray(r),M[r]=1),0!==b[r]){var a=t.get("ANGLE_instanced_arrays");a.vertexAttribDivisorANGLE(r,0),b[r]=0}},enableAttributeAndDivisor:function(r,a){if(S[r]=1,0===M[r]&&(e.enableVertexAttribArray(r),M[r]=1),b[r]!==a){var i=t.get("ANGLE_instanced_arrays");i.vertexAttribDivisorANGLE(r,a),b[r]=a}},disableUnusedAttributes:function(){for(var t=0,r=M.length;t!==r;++t)M[t]!==S[t]&&(e.disableVertexAttribArray(t),M[t]=0)},enable:i,disable:n,getCompressedTextureFormats:o,useProgram:s,setBlending:d,setMaterial:function(t,r){2===t.side?n(e.CULL_FACE):i(e.CULL_FACE);var a=1===t.side;r&&(a=!a),l(a),!0===t.transparent?d(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):d(0),x.setFunc(t.depthFunc),x.setTest(t.depthTest),x.setMask(t.depthWrite),_.setMask(t.colorWrite),m(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:l,setCullFace:c,setLineWidth:p,setPolygonOffset:m,setScissorTest:function(t){t?i(e.SCISSOR_TEST):n(e.SCISSOR_TEST)},activeTexture:u,bindTexture:f,compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:g,viewport:h,reset:function(){for(var t=0;t<M.length;t++)1===M[t]&&(e.disableVertexAttribArray(t),M[t]=0);T={},L=null,X=null,Y={},w=null,A=null,z=null,F=null,_.reset(),x.reset(),v.reset()}}}function Mr(e,t,r,a,n,o,s){function d(e,t){if(e.width>t||e.height>t){if("data"in e)return void console.warn("THREE.WebGLRenderer: image in DataTexture is too big ("+e.width+"x"+e.height+").");var r=t/kr(e.width,e.height),a=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");a.width=Hr(e.width*r),a.height=Hr(e.height*r);var i=a.getContext("2d");return i.drawImage(e,0,0,e.width,e.height,0,0,a.width,a.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+a.width+"x"+a.height,e),a}return e}function l(e){return Zr.isPowerOfTwo(e.width)&&Zr.isPowerOfTwo(e.height)}function c(e){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap){void 0===A&&(A=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),A.width=Zr.floorPowerOfTwo(e.width),A.height=Zr.floorPowerOfTwo(e.height);var t=A.getContext("2d");return t.drawImage(e,0,0,A.width,A.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+A.width+"x"+A.height,e),A}return e}function p(e){return e.wrapS!==1001||e.wrapT!==1001||e.minFilter!==1003&&e.minFilter!==1006}function m(e,t){return e.generateMipmaps&&t&&e.minFilter!==1003&&e.minFilter!==1006}function u(t,r,i,n){e.generateMipmap(t);var o=a.get(r);o.__maxMipLevel=Vr(kr(i,n))*Math.LOG2E}function i(t){return 1003===t||1004===t||1005===t?e.NEAREST:e.LINEAR}function f(e){var t=e.target;t.removeEventListener("dispose",f),h(t),t.isVideoTexture&&delete w[t.id],s.memory.textures--}function g(e){var t=e.target;t.removeEventListener("dispose",g),_(t),s.memory.textures--}function h(t){var r=a.get(t);if(t.image&&r.__image__webglTextureCube)e.deleteTexture(r.__image__webglTextureCube);else{if(r.__webglInit===void 0)return;e.deleteTexture(r.__webglTexture)}a.remove(t)}function _(t){var r=a.get(t),n=a.get(t.texture);if(t){if(void 0!==n.__webglTexture&&e.deleteTexture(n.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLRenderTargetCube)for(var o=0;6>o;o++)e.deleteFramebuffer(r.__webglFramebuffer[o]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[o]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer);a.remove(t.texture),a.remove(t)}}function x(t,i){var n=a.get(t);if(t.isVideoTexture&&T(t),0<t.version&&n.__version!==t.version){var o=t.image;if(void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",t);else if(!1===o.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",t);else return void y(n,t,i)}r.activeTexture(e.TEXTURE0+i),r.bindTexture(e.TEXTURE_2D,n.__webglTexture)}function v(r,s,d){var l;if(d?(e.texParameteri(r,e.TEXTURE_WRAP_S,o.convert(s.wrapS)),e.texParameteri(r,e.TEXTURE_WRAP_T,o.convert(s.wrapT)),e.texParameteri(r,e.TEXTURE_MAG_FILTER,o.convert(s.magFilter)),e.texParameteri(r,e.TEXTURE_MIN_FILTER,o.convert(s.minFilter))):(e.texParameteri(r,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(r,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),(1001!==s.wrapS||1001!==s.wrapT)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",s),e.texParameteri(r,e.TEXTURE_MAG_FILTER,i(s.magFilter)),e.texParameteri(r,e.TEXTURE_MIN_FILTER,i(s.minFilter)),1003!==s.minFilter&&1006!==s.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",s)),l=t.get("EXT_texture_filter_anisotropic"),l){if(1015===s.type&&null===t.get("OES_texture_float_linear"))return;if(1016===s.type&&null===t.get("OES_texture_half_float_linear"))return;(1<s.anisotropy||a.get(s).__currentAnisotropy)&&(e.texParameterf(r,l.TEXTURE_MAX_ANISOTROPY_EXT,Wr(s.anisotropy,n.getMaxAnisotropy())),a.get(s).__currentAnisotropy=s.anisotropy)}}function y(t,a,g){t.__webglInit===void 0&&(t.__webglInit=!0,a.addEventListener("dispose",f),t.__webglTexture=e.createTexture(),s.memory.textures++),r.activeTexture(e.TEXTURE0+g),r.bindTexture(e.TEXTURE_2D,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,a.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,a.unpackAlignment);var h=d(a.image,n.maxTextureSize);p(a)&&!1===l(h)&&(h=c(h));var _=l(h),x=o.convert(a.format),y=o.convert(a.type);v(e.TEXTURE_2D,a,_);var E=a.mipmaps,S;if(a.isDepthTexture){var M=e.DEPTH_COMPONENT;if(a.type===1015){if(!L)throw new Error("Float Depth Texture only supported in WebGL2.0");M=e.DEPTH_COMPONENT32F}else L&&(M=e.DEPTH_COMPONENT16);a.format===1026&&M===e.DEPTH_COMPONENT&&a.type!==1012&&a.type!==1014&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),a.type=1012,y=o.convert(a.type)),a.format===1027&&(M=e.DEPTH_STENCIL,a.type!==1020&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),a.type=1020,y=o.convert(a.type))),r.texImage2D(e.TEXTURE_2D,0,M,h.width,h.height,0,x,y,null)}else if(a.isDataTexture){if(0<E.length&&_){for(var b=0,T=E.length;b<T;b++)S=E[b],r.texImage2D(e.TEXTURE_2D,b,x,S.width,S.height,0,x,y,S.data);a.generateMipmaps=!1,t.__maxMipLevel=E.length-1}else r.texImage2D(e.TEXTURE_2D,0,x,h.width,h.height,0,x,y,h.data),t.__maxMipLevel=0;}else if(a.isCompressedTexture){for(var b=0,T=E.length;b<T;b++)S=E[b],1023!==a.format&&1022!==a.format?-1<r.getCompressedTextureFormats().indexOf(x)?r.compressedTexImage2D(e.TEXTURE_2D,b,x,S.width,S.height,0,S.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(e.TEXTURE_2D,b,x,S.width,S.height,0,x,y,S.data);t.__maxMipLevel=E.length-1}else if(0<E.length&&_){for(var b=0,T=E.length;b<T;b++)S=E[b],r.texImage2D(e.TEXTURE_2D,b,x,x,y,S);a.generateMipmaps=!1,t.__maxMipLevel=E.length-1}else r.texImage2D(e.TEXTURE_2D,0,x,x,y,h),t.__maxMipLevel=0;m(a,_)&&u(e.TEXTURE_2D,a,h.width,h.height),t.__version=a.version,a.onUpdate&&a.onUpdate(a)}function E(t,i,n,s){var d=o.convert(i.texture.format),l=o.convert(i.texture.type);r.texImage2D(s,0,d,i.width,i.height,0,d,l,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,n,s,a.get(i.texture).__webglTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}function S(t,r){e.bindRenderbuffer(e.RENDERBUFFER,t),r.depthBuffer&&!r.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)):r.depthBuffer&&r.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)):e.renderbufferStorage(e.RENDERBUFFER,e.RGBA4,r.width,r.height),e.bindRenderbuffer(e.RENDERBUFFER,null)}function M(t,r){var i=r&&r.isWebGLRenderTargetCube;if(i)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(e.FRAMEBUFFER,t),!(r.depthTexture&&r.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");a.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),x(r.depthTexture,0);var n=a.get(r.depthTexture).__webglTexture;if(1026===r.depthTexture.format)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,n,0);else if(1027===r.depthTexture.format)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,n,0);else throw new Error("Unknown depthTexture format")}function b(t){var r=a.get(t),n=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(n)throw new Error("target.depthTexture not supported in Cube render targets");M(r.__webglFramebuffer,t)}else if(n){r.__webglDepthbuffer=[];for(var o=0;6>o;o++)e.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[o]),r.__webglDepthbuffer[o]=e.createRenderbuffer(),S(r.__webglDepthbuffer[o],t)}else e.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),S(r.__webglDepthbuffer,t);e.bindFramebuffer(e.FRAMEBUFFER,null)}function T(e){var t=e.id,r=s.render.frame;w[t]!==r&&(w[t]=r,e.update())}var L="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,w={},A;this.setTexture2D=x,this.setTextureCube=function(t,c){var p=a.get(t);if(6===t.image.length)if(0<t.version&&p.__version!==t.version){p.__image__webglTextureCube||(t.addEventListener("dispose",f),p.__image__webglTextureCube=e.createTexture(),s.memory.textures++),r.activeTexture(e.TEXTURE0+c),r.bindTexture(e.TEXTURE_CUBE_MAP,p.__image__webglTextureCube),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var g=t&&t.isCompressedTexture,h=t.image[0]&&t.image[0].isDataTexture,_=[],x=0;6>x;x++)_[x]=g||h?h?t.image[x].image:t.image[x]:d(t.image[x],n.maxCubemapSize);var y=_[0],E=l(y),S=o.convert(t.format),M=o.convert(t.type);v(e.TEXTURE_CUBE_MAP,t,E);for(var x=0;6>x;x++)if(!g)h?r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+x,0,S,_[x].width,_[x].height,0,S,M,_[x].data):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+x,0,S,S,M,_[x]);else for(var b=_[x].mipmaps,T=0,L=b.length,w;T<L;T++)w=b[T],1023!==t.format&&1022!==t.format?-1<r.getCompressedTextureFormats().indexOf(S)?r.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+x,T,S,w.width,w.height,0,w.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+x,T,S,w.width,w.height,0,S,M,w.data);p.__maxMipLevel=g?b.length-1:0,m(t,E)&&u(e.TEXTURE_CUBE_MAP,t,y.width,y.height),p.__version=t.version,t.onUpdate&&t.onUpdate(t)}else r.activeTexture(e.TEXTURE0+c),r.bindTexture(e.TEXTURE_CUBE_MAP,p.__image__webglTextureCube)},this.setTextureCubeDynamic=function(t,i){r.activeTexture(e.TEXTURE0+i),r.bindTexture(e.TEXTURE_CUBE_MAP,a.get(t).__webglTexture)},this.setupRenderTarget=function(t){var n=a.get(t),o=a.get(t.texture);t.addEventListener("dispose",g),o.__webglTexture=e.createTexture(),s.memory.textures++;var d=!0===t.isWebGLRenderTargetCube,c=l(t);if(d){n.__webglFramebuffer=[];for(var p=0;6>p;p++)n.__webglFramebuffer[p]=e.createFramebuffer()}else n.__webglFramebuffer=e.createFramebuffer();if(d){r.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture),v(e.TEXTURE_CUBE_MAP,t.texture,c);for(var p=0;6>p;p++)E(n.__webglFramebuffer[p],t,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+p);m(t.texture,c)&&u(e.TEXTURE_CUBE_MAP,t.texture,t.width,t.height),r.bindTexture(e.TEXTURE_CUBE_MAP,null)}else r.bindTexture(e.TEXTURE_2D,o.__webglTexture),v(e.TEXTURE_2D,t.texture,c),E(n.__webglFramebuffer,t,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),m(t.texture,c)&&u(e.TEXTURE_2D,t.texture,t.width,t.height),r.bindTexture(e.TEXTURE_2D,null);t.depthBuffer&&b(t)},this.updateRenderTargetMipmap=function(t){var i=t.texture,n=l(t);if(m(i,n)){var o=t.isWebGLRenderTargetCube?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,s=a.get(i).__webglTexture;r.bindTexture(o,s),u(o,i,t.width,t.height),r.bindTexture(o,null)}}}function br(e,t){return{convert:function(r){var a;if(r===1000)return e.REPEAT;if(1001===r)return e.CLAMP_TO_EDGE;if(1002===r)return e.MIRRORED_REPEAT;if(1003===r)return e.NEAREST;if(1004===r)return e.NEAREST_MIPMAP_NEAREST;if(1005===r)return e.NEAREST_MIPMAP_LINEAR;if(1006===r)return e.LINEAR;if(1007===r)return e.LINEAR_MIPMAP_NEAREST;if(1008===r)return e.LINEAR_MIPMAP_LINEAR;if(1009===r)return e.UNSIGNED_BYTE;if(1017===r)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===r)return e.UNSIGNED_SHORT_5_5_5_1;if(1019===r)return e.UNSIGNED_SHORT_5_6_5;if(1010===r)return e.BYTE;if(1011===r)return e.SHORT;if(1012===r)return e.UNSIGNED_SHORT;if(1013===r)return e.INT;if(1014===r)return e.UNSIGNED_INT;if(1015===r)return e.FLOAT;if(1016===r&&(a=t.get("OES_texture_half_float"),null!==a))return a.HALF_FLOAT_OES;if(1021===r)return e.ALPHA;if(1022===r)return e.RGB;if(1023===r)return e.RGBA;if(1024===r)return e.LUMINANCE;if(1025===r)return e.LUMINANCE_ALPHA;if(1026===r)return e.DEPTH_COMPONENT;if(1027===r)return e.DEPTH_STENCIL;if(100===r)return e.FUNC_ADD;if(101===r)return e.FUNC_SUBTRACT;if(102===r)return e.FUNC_REVERSE_SUBTRACT;if(200===r)return e.ZERO;if(201===r)return e.ONE;if(202===r)return e.SRC_COLOR;if(203===r)return e.ONE_MINUS_SRC_COLOR;if(204===r)return e.SRC_ALPHA;if(205===r)return e.ONE_MINUS_SRC_ALPHA;if(206===r)return e.DST_ALPHA;if(207===r)return e.ONE_MINUS_DST_ALPHA;if(208===r)return e.DST_COLOR;if(209===r)return e.ONE_MINUS_DST_COLOR;if(210===r)return e.SRC_ALPHA_SATURATE;if((33776===r||33777===r||33778===r||33779===r)&&(a=t.get("WEBGL_compressed_texture_s3tc"),null!==a)){if(33776===r)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===r)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===r)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===r)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((35840===r||35841===r||35842===r||35843===r)&&(a=t.get("WEBGL_compressed_texture_pvrtc"),null!==a)){if(35840===r)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===r)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===r)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===r)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===r&&(a=t.get("WEBGL_compressed_texture_etc1"),null!==a))return a.COMPRESSED_RGB_ETC1_WEBGL;if((37808===r||37809===r||37810===r||37811===r||37812===r||37813===r||37814===r||37815===r||37816===r||37817===r||37818===r||37819===r||37820===r||37821===r)&&(a=t.get("WEBGL_compressed_texture_astc"),null!==a))return r;if((103===r||104===r)&&(a=t.get("EXT_blend_minmax"),null!==a)){if(103===r)return a.MIN_EXT;if(104===r)return a.MAX_EXT}return 1020===r&&(a=t.get("WEBGL_depth_texture"),null!==a)?a.UNSIGNED_INT_24_8_WEBGL:0}}}function Tr(e){l.call(this),this.cameras=e||[]}function Lr(r){function a(){return null!==s&&!0===s.isPresenting}function i(){if(a()){var e=s.getEyeParameters("left"),t=e.renderWidth,i=e.renderHeight;y=r.getPixelRatio(),v=r.getSize(),r.setDrawingBufferSize(2*t,i,1)}else o.enabled&&r.setDrawingBufferSize(v.width,v.height,y)}var o=this,s=null,d=null,c=null,p=new t,m=new t;"undefined"!=typeof window&&"VRFrameData"in window&&(d=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",i,!1));var u=new t,f=new e,g=new n,h=new l;h.bounds=new E(0,0,.5,1),h.layers.enable(1);var _=new l;_.bounds=new E(.5,0,.5,1),_.layers.enable(2);var x=new Tr([h,_]);x.layers.enable(1),x.layers.enable(2);var v,y;this.enabled=!1,this.userHeight=1.6,this.getDevice=function(){return s},this.setDevice=function(e){e!==void 0&&(s=e)},this.setPoseTarget=function(e){e!==void 0&&(c=e)},this.getCamera=function(e){if(null===s)return e;s.depthNear=e.near,s.depthFar=e.far,s.getFrameData(d);var t=s.stageParameters;t?p.fromArray(t.sittingToStandingTransform):p.makeTranslation(0,o.userHeight,0);var r=d.pose,a=null===c?e:c;if(a.matrix.copy(p),a.matrix.decompose(a.position,a.quaternion,a.scale),null!==r.orientation&&(f.fromArray(r.orientation),a.quaternion.multiply(f)),null!==r.position&&(f.setFromRotationMatrix(p),g.fromArray(r.position),g.applyQuaternion(f),a.position.add(g)),a.updateMatrixWorld(),!1===s.isPresenting)return e;h.near=e.near,_.near=e.near,h.far=e.far,_.far=e.far,x.matrixWorld.copy(e.matrixWorld),x.matrixWorldInverse.copy(e.matrixWorldInverse),h.matrixWorldInverse.fromArray(d.leftViewMatrix),_.matrixWorldInverse.fromArray(d.rightViewMatrix),m.getInverse(p),h.matrixWorldInverse.multiply(m),_.matrixWorldInverse.multiply(m);var i=a.parent;null!==i&&(u.getInverse(i.matrixWorld),h.matrixWorldInverse.multiply(u),_.matrixWorldInverse.multiply(u)),h.matrixWorld.getInverse(h.matrixWorldInverse),_.matrixWorld.getInverse(_.matrixWorldInverse),h.projectionMatrix.fromArray(d.leftProjectionMatrix),_.projectionMatrix.fromArray(d.rightProjectionMatrix),x.projectionMatrix.copy(h.projectionMatrix);var n=s.getLayers();if(n.length){var l=n[0];null!==l.leftBounds&&4===l.leftBounds.length&&h.bounds.fromArray(l.leftBounds),null!==l.rightBounds&&4===l.rightBounds.length&&_.bounds.fromArray(l.rightBounds)}return x},this.getStandingMatrix=function(){return p},this.submitFrame=function(){a()&&s.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",i)}}function wr(e){function r(){return null===Q?de:1}function a(){ye=new at(xe),ye.get("WEBGL_depth_texture"),ye.get("OES_texture_float"),ye.get("OES_texture_float_linear"),ye.get("OES_texture_half_float"),ye.get("OES_texture_half_float_linear"),ye.get("OES_standard_derivatives"),ye.get("OES_element_index_uint"),ye.get("ANGLE_instanced_arrays"),Fe=new br(xe,ye),Ee=new tt(xe,ye,e),Se=new Sr(xe,ye,Fe),Se.scissor(ae.copy(ce).multiplyScalar(de)),Se.viewport(re.copy(le).multiplyScalar(de)),Me=new ot(xe),be=new sr,Te=new Mr(xe,ye,Se,be,Ee,Fe,Me),Le=new je(xe),we=new it(xe,Le,Me),Ae=new lt(we,Me),Ue=new dt(xe),Re=new or(j,ye,Ee),Pe=new pr,Ce=new gr,De=new $e(j,Se,we,k),Ne=new et(xe,ye,Me),Ie=new nt(xe,ye,Me),ze=new Er(j,xe,Se,Te,Ee),Me.programs=Re.programs,j.context=xe,j.capabilities=Ee,j.extensions=ye,j.properties=be,j.renderLists=Pe,j.state=Se,j.info=Me}function i(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Z=!0}function o(){console.log("THREE.WebGLRenderer: Context Restored."),Z=!1,a()}function s(e){var t=e.target;t.removeEventListener("dispose",s),d(t)}function d(e){l(e),be.remove(e)}function l(e){var t=be.get(e).program;e.program=void 0,t!==void 0&&Re.releaseProgram(t)}function c(e,t,r){e.render(function(e){j.renderBufferImmediate(e,t,r)})}function p(e,t,r){if(r&&r.isInstancedBufferGeometry&&null===ye.get("ANGLE_instanced_arrays"))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");Se.initAttributes();var a=r.attributes,i=t.getAttributes(),n=e.defaultAttributeValues;for(var o in i){var s=i[o];if(0<=s){var d=a[o];if(d!==void 0){var l=d.normalized,c=d.itemSize,p=Le.get(d);if(p===void 0)continue;var m=p.buffer,u=p.type,f=p.bytesPerElement;if(d.isInterleavedBufferAttribute){var g=d.data,h=g.stride,_=d.offset;g&&g.isInstancedInterleavedBuffer?(Se.enableAttributeAndDivisor(s,g.meshPerAttribute),r.maxInstancedCount===void 0&&(r.maxInstancedCount=g.meshPerAttribute*g.count)):Se.enableAttribute(s),xe.bindBuffer(xe.ARRAY_BUFFER,m),xe.vertexAttribPointer(s,c,u,l,h*f,_*f)}else d.isInstancedBufferAttribute?(Se.enableAttributeAndDivisor(s,d.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=d.meshPerAttribute*d.count)):Se.enableAttribute(s),xe.bindBuffer(xe.ARRAY_BUFFER,m),xe.vertexAttribPointer(s,c,u,l,0,0)}else if(n!==void 0){var x=n[o];if(x!==void 0)switch(x.length){case 2:xe.vertexAttrib2fv(s,x);break;case 3:xe.vertexAttrib3fv(s,x);break;case 4:xe.vertexAttrib4fv(s,x);break;default:xe.vertexAttrib1fv(s,x);}}}}Se.disableUnusedAttributes()}function m(){Ge||(f(),Ge=!0)}function u(){Ge=!1}function f(){var e=Be.getDevice();e&&e.isPresenting?e.requestAnimationFrame(g):window.requestAnimationFrame(g)}function g(e){!1==Ge||(Ve(e),f())}function h(e,t,r){if(!1!==e.visible){var a=e.layers.test(t.layers);if(a)if(e.isLight)q.pushLight(e),e.castShadow&&q.pushShadow(e);else if(e.isSprite)(!e.frustumCulled||me.intersectsSprite(e))&&q.pushSprite(e);else if(e.isImmediateRenderObject)r&&_e.setFromMatrixPosition(e.matrixWorld).applyMatrix4(he),Y.push(e,null,e.material,_e.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||me.intersectsObject(e))){r&&_e.setFromMatrixPosition(e.matrixWorld).applyMatrix4(he);var n=Ae.update(e),o=e.material;if(Array.isArray(o))for(var s=n.groups,d=0,c=s.length;d<c;d++){var p=s[d],m=o[p.materialIndex];m&&m.visible&&Y.push(e,n,m,_e.z,p)}else o.visible&&Y.push(e,n,o,_e.z,null)}for(var u=e.children,d=0,c=u.length;d<c;d++)h(u[d],t,r)}}function _(e,t,r,a){for(var n=0,o=e.length;n<o;n++){var s=e[n],d=s.object,l=s.geometry,c=a===void 0?s.material:a,p=s.group;if(r.isArrayCamera){te=r;for(var m=r.cameras,u=0,f=m.length,g;u<f;u++)if(g=m[u],d.layers.test(g.layers)){var h=g.bounds,_=h.x*oe,x=h.y*se,y=h.z*oe,E=h.w*se;Se.viewport(re.set(_,x,y,E).multiplyScalar(de)),v(d,t,g,l,c,p)}}else te=null,v(d,t,r,l,c,p)}}function v(e,t,r,a,i,n){if(e.onBeforeRender(j,t,r,a,i,n),q=Ce.get(t,te||r),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var o=e.isMesh&&0>e.matrixWorld.determinant();Se.setMaterial(i,o);var s=y(r,t.fog,i,e);$="",c(e,s,i)}else j.renderBufferDirect(r,t.fog,a,i,e,n);e.onAfterRender(j,t,r,a,i,n),q=Ce.get(t,te||r)}function x(e,t,r){var a=be.get(e),n=q.state.lights,o=q.state.shadowsArray,d=Re.getParameters(e,n.state,o,t,ue.numPlanes,ue.numIntersection,r),c=Re.getProgramCode(e,d),p=a.program,m=!0;if(p===void 0)e.addEventListener("dispose",s);else if(p.code!==c)l(e);else if(a.lightsHash!==n.state.hash)be.update(e,"lightsHash",n.state.hash),m=!1;else{if(void 0!==d.shaderID)return;m=!1}if(m){if(d.shaderID){var u=Aa[d.shaderID];a.shader={name:e.type,uniforms:La.clone(u.uniforms),vertexShader:u.vertexShader,fragmentShader:u.fragmentShader}}else a.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(a.shader,j),p=Re.acquireProgram(e,a.shader,d,c),a.program=p,e.program=p}var f=p.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var g=0;g<j.maxMorphTargets;g++)0<=f["morphTarget"+g]&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(var g=0;g<j.maxMorphNormals;g++)0<=f["morphNormal"+g]&&e.numSupportedMorphNormals++}var h=a.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(a.numClippingPlanes=ue.numPlanes,a.numIntersection=ue.numIntersection,h.clippingPlanes=ue.uniform),a.fog=t,a.lightsHash=n.state.hash,e.lights&&(h.ambientLightColor.value=n.state.ambient,h.directionalLights.value=n.state.directional,h.spotLights.value=n.state.spot,h.rectAreaLights.value=n.state.rectArea,h.pointLights.value=n.state.point,h.hemisphereLights.value=n.state.hemi,h.directionalShadowMap.value=n.state.directionalShadowMap,h.directionalShadowMatrix.value=n.state.directionalShadowMatrix,h.spotShadowMap.value=n.state.spotShadowMap,h.spotShadowMatrix.value=n.state.spotShadowMatrix,h.pointShadowMap.value=n.state.pointShadowMap,h.pointShadowMatrix.value=n.state.pointShadowMatrix);var _=a.program.getUniforms(),x=Wt.seqWithValue(_.seq,h);a.uniformsList=x}function y(e,t,r,a){ne=0;var i=be.get(r),n=q.state.lights;if(fe&&(ge||e!==ee)){var o=e===ee&&r.id===K;ue.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,e,i,o)}!1===r.needsUpdate&&(void 0===i.program?r.needsUpdate=!0:r.fog&&i.fog!==t?r.needsUpdate=!0:r.lights&&i.lightsHash!==n.state.hash?r.needsUpdate=!0:void 0!==i.numClippingPlanes&&(i.numClippingPlanes!==ue.numPlanes||i.numIntersection!==ue.numIntersection)&&(r.needsUpdate=!0)),r.needsUpdate&&(x(r,t,a),r.needsUpdate=!1);var s=!1,d=!1,l=!1,c=i.program,p=c.getUniforms(),m=i.shader.uniforms;if(Se.useProgram(c.program)&&(s=!0,d=!0,l=!0),r.id!==K&&(K=r.id,d=!0),s||e!==ee){if(p.setValue(xe,"projectionMatrix",e.projectionMatrix),Ee.logarithmicDepthBuffer&&p.setValue(xe,"logDepthBufFC",2/(Vr(e.far+1)/Gr)),ee!==(te||e)&&(ee=te||e,d=!0,l=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.envMap){var u=p.map.cameraPosition;void 0!==u&&u.setValue(xe,_e.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&p.setValue(xe,"viewMatrix",e.matrixWorldInverse)}if(r.skinning){p.setOptional(xe,a,"bindMatrix"),p.setOptional(xe,a,"bindMatrixInverse");var f=a.skeleton;if(f){var g=f.bones;if(Ee.floatVertexTextures){if(void 0===f.boneTexture){var h=Fr(4*g.length);h=Zr.ceilPowerOfTwo(h),h=kr(h,4);var _=new Float32Array(4*(h*h));_.set(f.boneMatrices);var v=new Ye(_,h,h,1023,1015);v.needsUpdate=!0,f.boneMatrices=_,f.boneTexture=v,f.boneTextureSize=h}p.setValue(xe,"boneTexture",f.boneTexture),p.setValue(xe,"boneTextureSize",f.boneTextureSize)}else p.setOptional(xe,f,"boneMatrices")}}return d&&(p.setValue(xe,"toneMappingExposure",j.toneMappingExposure),p.setValue(xe,"toneMappingWhitePoint",j.toneMappingWhitePoint),r.lights&&I(m,l),t&&r.fog&&L(m,t),r.isMeshBasicMaterial?S(m,r):r.isMeshLambertMaterial?(S(m,r),w(m,r)):r.isMeshPhongMaterial?(S(m,r),r.isMeshToonMaterial?R(m,r):A(m,r)):r.isMeshStandardMaterial?(S(m,r),r.isMeshPhysicalMaterial?C(m,r):P(m,r)):r.isMeshDepthMaterial?(S(m,r),D(m,r)):r.isMeshDistanceMaterial?(S(m,r),U(m,r)):r.isMeshNormalMaterial?(S(m,r),N(m,r)):r.isLineBasicMaterial?(M(m,r),r.isLineDashedMaterial&&b(m,r)):r.isPointsMaterial?T(m,r):r.isShadowMaterial&&(m.color.value=r.color,m.opacity.value=r.opacity),void 0!==m.ltc_1&&(m.ltc_1.value=wa.LTC_1),void 0!==m.ltc_2&&(m.ltc_2.value=wa.LTC_2),Wt.upload(xe,i.uniformsList,m,j)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Wt.upload(xe,i.uniformsList,m,j),r.uniformsNeedUpdate=!1),p.setValue(xe,"modelViewMatrix",a.modelViewMatrix),p.setValue(xe,"normalMatrix",a.normalMatrix),p.setValue(xe,"modelMatrix",a.matrixWorld),c}function S(e,t){e.opacity.value=t.opacity,t.color&&(e.diffuse.value=t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap&&t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=be.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity);var r;t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap),r!==void 0&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}function M(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function b(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function T(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*de,e.scale.value=.5*se,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}function L(e,t){e.fogColor.value=t.color,t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}function w(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}function A(e,t){e.specular.value=t.specular,e.shininess.value=kr(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function R(e,t){A(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}function P(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}function C(e,t){e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness,P(e,t)}function D(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function U(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}function N(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function I(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLights.needsUpdate=t,e.pointLights.needsUpdate=t,e.spotLights.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}function z(){var e=ne;return e>=Ee.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+Ee.maxTextures),ne+=1,e}console.log("THREE.WebGLRenderer","92"),e=e||{};var F=e.canvas===void 0?document.createElementNS("http://www.w3.org/1999/xhtml","canvas"):e.canvas,B=e.context===void 0?null:e.context,O=e.alpha!==void 0&&e.alpha,G=!(e.depth!==void 0)||e.depth,V=!(e.stencil!==void 0)||e.stencil,H=e.antialias!==void 0&&e.antialias,k=!(e.premultipliedAlpha!==void 0)||e.premultipliedAlpha,W=e.preserveDrawingBuffer!==void 0&&e.preserveDrawingBuffer,X=e.powerPreference===void 0?"default":e.powerPreference,Y=null,q=null;this.domElement=F,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=1,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var j=this,Z=!1,Q=null,J=null,K=-1,$="",ee=null,te=null,re=new E,ae=new E,ie=null,ne=0,oe=F.width,se=F.height,de=1,le=new E(0,0,oe,se),ce=new E(0,0,oe,se),pe=!1,me=new qe,ue=new rt,fe=!1,ge=!1,he=new t,_e=new n,xe;try{var ve={alpha:O,depth:G,stencil:V,antialias:H,premultipliedAlpha:k,preserveDrawingBuffer:W,powerPreference:X};if(F.addEventListener("webglcontextlost",i,!1),F.addEventListener("webglcontextrestored",o,!1),xe=B||F.getContext("webgl",ve)||F.getContext("experimental-webgl",ve),null===xe)if(null!==F.getContext("webgl"))throw new Error("Error creating WebGL context with your selected attributes.");else throw new Error("Error creating WebGL context.");void 0===xe.getShaderPrecisionFormat&&(xe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){console.error("THREE.WebGLRenderer: "+e.message)}var ye,Ee,Se,Me,be,Te,Le,we,Ae,Re,Pe,Ce,De,Ue,Ne,Ie,ze,Fe;a();var Be=new Lr(j);this.vr=Be;var Oe=new yr(j,Ae,Ee.maxTextureSize);this.shadowMap=Oe,this.getContext=function(){return xe},this.getContextAttributes=function(){return xe.getContextAttributes()},this.forceContextLoss=function(){var e=ye.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=ye.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return de},this.setPixelRatio=function(e){void 0===e||(de=e,this.setSize(oe,se,!1))},this.getSize=function(){return{width:oe,height:se}},this.setSize=function(e,t,r){var a=Be.getDevice();return a&&a.isPresenting?void console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):void(oe=e,se=t,F.width=e*de,F.height=t*de,!1!==r&&(F.style.width=e+"px",F.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(){return{width:oe*de,height:se*de}},this.setDrawingBufferSize=function(e,t,r){oe=e,se=t,de=r,F.width=e*r,F.height=t*r,this.setViewport(0,0,e,t)},this.getCurrentViewport=function(){return re},this.setViewport=function(e,t,r,a){le.set(e,se-t-a,r,a),Se.viewport(re.copy(le).multiplyScalar(de))},this.setScissor=function(e,t,r,a){ce.set(e,se-t-a,r,a),Se.scissor(ae.copy(ce).multiplyScalar(de))},this.setScissorTest=function(e){Se.setScissorTest(pe=e)},this.getClearColor=function(){return De.getClearColor()},this.setClearColor=function(){De.setClearColor.apply(De,arguments)},this.getClearAlpha=function(){return De.getClearAlpha()},this.setClearAlpha=function(){De.setClearAlpha.apply(De,arguments)},this.clear=function(e,t,r){var a=0;(e===void 0||e)&&(a|=xe.COLOR_BUFFER_BIT),(t===void 0||t)&&(a|=xe.DEPTH_BUFFER_BIT),(r===void 0||r)&&(a|=xe.STENCIL_BUFFER_BIT),xe.clear(a)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(e,t,r,a){this.setRenderTarget(e),this.clear(t,r,a)},this.dispose=function(){F.removeEventListener("webglcontextlost",i,!1),F.removeEventListener("webglcontextrestored",o,!1),Pe.dispose(),Ce.dispose(),be.dispose(),Ae.dispose(),Be.dispose(),u()},this.renderBufferImmediate=function(e,t,r){Se.initAttributes();var a=be.get(e);e.hasPositions&&!a.position&&(a.position=xe.createBuffer()),e.hasNormals&&!a.normal&&(a.normal=xe.createBuffer()),e.hasUvs&&!a.uv&&(a.uv=xe.createBuffer()),e.hasColors&&!a.color&&(a.color=xe.createBuffer());var n=t.getAttributes();if(e.hasPositions&&(xe.bindBuffer(xe.ARRAY_BUFFER,a.position),xe.bufferData(xe.ARRAY_BUFFER,e.positionArray,xe.DYNAMIC_DRAW),Se.enableAttribute(n.position),xe.vertexAttribPointer(n.position,3,xe.FLOAT,!1,0,0)),e.hasNormals){if(xe.bindBuffer(xe.ARRAY_BUFFER,a.normal),!r.isMeshPhongMaterial&&!r.isMeshStandardMaterial&&!r.isMeshNormalMaterial&&!0===r.flatShading)for(var o=0,s=3*e.count;o<s;o+=9){var d=e.normalArray,l=(d[o+0]+d[o+3]+d[o+6])/3,c=(d[o+1]+d[o+4]+d[o+7])/3,p=(d[o+2]+d[o+5]+d[o+8])/3;d[o+0]=l,d[o+1]=c,d[o+2]=p,d[o+3]=l,d[o+4]=c,d[o+5]=p,d[o+6]=l,d[o+7]=c,d[o+8]=p}xe.bufferData(xe.ARRAY_BUFFER,e.normalArray,xe.DYNAMIC_DRAW),Se.enableAttribute(n.normal),xe.vertexAttribPointer(n.normal,3,xe.FLOAT,!1,0,0)}e.hasUvs&&r.map&&(xe.bindBuffer(xe.ARRAY_BUFFER,a.uv),xe.bufferData(xe.ARRAY_BUFFER,e.uvArray,xe.DYNAMIC_DRAW),Se.enableAttribute(n.uv),xe.vertexAttribPointer(n.uv,2,xe.FLOAT,!1,0,0)),e.hasColors&&0!==r.vertexColors&&(xe.bindBuffer(xe.ARRAY_BUFFER,a.color),xe.bufferData(xe.ARRAY_BUFFER,e.colorArray,xe.DYNAMIC_DRAW),Se.enableAttribute(n.color),xe.vertexAttribPointer(n.color,3,xe.FLOAT,!1,0,0)),Se.disableUnusedAttributes(),xe.drawArrays(xe.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,a,i,n,o){var s=n.isMesh&&0>n.matrixWorld.determinant();Se.setMaterial(i,s);var d=y(e,t,i,n),l=a.id+"_"+d.id+"_"+(!0===i.wireframe),c=!1;l!==$&&($=l,c=!0),n.morphTargetInfluences&&(Ue.update(n,a,i,d),c=!0);var m=a.index,u=a.attributes.position,f=1;!0===i.wireframe&&(m=we.getWireframeAttribute(a),f=2);var g=Ne,h;null!==m&&(h=Le.get(m),g=Ie,g.setIndex(h)),c&&(p(i,d,a),null!==m&&xe.bindBuffer(xe.ELEMENT_ARRAY_BUFFER,h.buffer));var _=1/0;null===m?u!==void 0&&(_=u.count):_=m.count;var x=a.drawRange.start*f,v=a.drawRange.count*f,E=null===o?0:o.start*f,S=null===o?1/0:o.count*f,M=kr(x,E),b=Wr(_,x+v,E+S)-1,T=kr(0,b-M+1);if(0!==T){if(n.isMesh){if(!0===i.wireframe)Se.setLineWidth(i.wireframeLinewidth*r()),g.setMode(xe.LINES);else switch(n.drawMode){case 0:g.setMode(xe.TRIANGLES);break;case 1:g.setMode(xe.TRIANGLE_STRIP);break;case 2:g.setMode(xe.TRIANGLE_FAN);}}else if(n.isLine){var L=i.linewidth;void 0===L&&(L=1),Se.setLineWidth(L*r()),n.isLineSegments?g.setMode(xe.LINES):n.isLineLoop?g.setMode(xe.LINE_LOOP):g.setMode(xe.LINE_STRIP)}else n.isPoints&&g.setMode(xe.POINTS);a&&a.isInstancedBufferGeometry?0<a.maxInstancedCount&&g.renderInstances(a,M,T):g.render(M,T)}},this.compile=function(e,t){q=Ce.get(e,t),q.init(),e.traverse(function(e){e.isLight&&(q.pushLight(e),e.castShadow&&q.pushShadow(e))}),q.setupLights(t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var r=0;r<t.material.length;r++)x(t.material[r],e.fog,t);else x(t.material,e.fog,t)})};var Ge=!1,Ve=null;this.animate=function(e){Ve=e,null===Ve?u():m()},this.render=function(e,t,r,a){if(!(t&&t.isCamera))return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!Z){$="",K=-1,ee=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),Be.enabled&&(t=Be.getCamera(t)),q=Ce.get(e,t),q.init(),e.onBeforeRender(j,e,t,r),he.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),me.setFromMatrix(he),ge=this.localClippingEnabled,fe=ue.init(this.clippingPlanes,ge,t),Y=Pe.get(e,t),Y.init(),h(e,t,j.sortObjects),!0===j.sortObjects&&Y.sort(),fe&&ue.beginShadows();var i=q.state.shadowsArray;Oe.render(i,e,t),q.setupLights(t),fe&&ue.endShadows(),this.info.autoReset&&this.info.reset(),void 0===r&&(r=null),this.setRenderTarget(r),De.render(Y,e,t,a);var n=Y.opaque,o=Y.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;n.length&&_(n,e,t,s),o.length&&_(o,e,t,s)}else n.length&&_(n,e,t),o.length&&_(o,e,t);var d=q.state.spritesArray;ze.render(d,e,t),r&&Te.updateRenderTargetMipmap(r),Se.buffers.depth.setTest(!0),Se.buffers.depth.setMask(!0),Se.buffers.color.setMask(!0),Se.setPolygonOffset(!1),e.onAfterRender(j,e,t),Be.enabled&&Be.submitFrame(),Y=null,q=null}},this.allocTextureUnit=z,this.setTexture2D=function(){var e=!1;return function(t,r){t&&t.isWebGLRenderTarget&&(!e&&(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),Te.setTexture2D(t,r)}}(),this.setTexture=function(){var e=!1;return function(t,r){e||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),Te.setTexture2D(t,r)}}(),this.setTextureCube=function(){var e=!1;return function(t,r){t&&t.isWebGLRenderTargetCube&&(!e&&(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?Te.setTextureCube(t,r):Te.setTextureCubeDynamic(t,r)}}(),this.getRenderTarget=function(){return Q},this.setRenderTarget=function(e){Q=e,e&&void 0===be.get(e).__webglFramebuffer&&Te.setupRenderTarget(e);var t=null,r=!1;if(e){var a=be.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(t=a[e.activeCubeFace],r=!0):t=a,re.copy(e.viewport),ae.copy(e.scissor),ie=e.scissorTest}else re.copy(le).multiplyScalar(de),ae.copy(ce).multiplyScalar(de),ie=pe;if(J!==t&&(xe.bindFramebuffer(xe.FRAMEBUFFER,t),J=t),Se.viewport(re),Se.scissor(ae),Se.setScissorTest(ie),r){var i=be.get(e.texture);xe.framebufferTexture2D(xe.FRAMEBUFFER,xe.COLOR_ATTACHMENT0,xe.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,i.__webglTexture,e.activeMipMapLevel)}},this.readRenderTargetPixels=function(e,t,r,a,i,n){if(!(e&&e.isWebGLRenderTarget))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");var o=be.get(e).__webglFramebuffer;if(o){var s=!1;o!==J&&(xe.bindFramebuffer(xe.FRAMEBUFFER,o),s=!0);try{var d=e.texture,l=d.format,c=d.type;if(1023!==l&&Fe.convert(l)!==xe.getParameter(xe.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(1009!==c&&Fe.convert(c)!==xe.getParameter(xe.IMPLEMENTATION_COLOR_READ_TYPE)&&!(1015===c&&(ye.get("OES_texture_float")||ye.get("WEBGL_color_buffer_float")))&&!(1016===c&&ye.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");xe.checkFramebufferStatus(xe.FRAMEBUFFER)===xe.FRAMEBUFFER_COMPLETE?0<=t&&t<=e.width-a&&0<=r&&r<=e.height-i&&xe.readPixels(t,r,a,i,Fe.convert(l),Fe.convert(c),n):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&xe.bindFramebuffer(xe.FRAMEBUFFER,J)}}},this.copyFramebufferToTexture=function(e,t,r){var a=t.image.width,i=t.image.height,n=Fe.convert(t.format);this.setTexture2D(t,0),xe.copyTexImage2D(xe.TEXTURE_2D,r||0,n,e.x,e.y,a,i,0)},this.copyTextureToTexture=function(e,t,r,a){var i=t.image.width,n=t.image.height,o=Fe.convert(r.format),s=Fe.convert(r.type),d=t.isDataTexture?t.image.data:t.image;this.setTexture2D(r,0),xe.texSubImage2D(xe.TEXTURE_2D,a||0,e.x,e.y,i,n,o,s,d)}}function Ar(e,t,r,a,i,n,o,s,d,l){if(l=void 0===l?1026:l,1026!==l&&1027!==l)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&1026===l&&(r=1012),void 0===r&&1027===l&&(r=1020),Xe.call(this,null,a,i,n,o,s,l,r,d),this.image={width:e,height:t},this.magFilter=void 0===o?1003:o,this.minFilter=void 0===s?1003:s,this.flipY=!1,this.generateMipmaps=!1}var Rr=Math.tan,Pr=Math.atan,Cr=Math.acos,Dr=Math.round,Ur=Math.abs,Nr=Math.cos,Ir=Math.sin,zr=Math.atan2,Fr=Math.sqrt,Br=Math.pow,Or=Math.ceil,Gr=Math.LN2,Vr=Math.log,Hr=Math.floor,kr=Math.max,Wr=Math.min,Xr=Math.PI;class Yr extends Set{constructor(){super(),this._onceCallbacksMap=new Map}add(e,{once:t=!1}={}){if(t){const t=()=>{e(...arguments),this.delete(e)};this._onceCallbacksMap.set(e,t),super.add(t)}else super.add(e)}delete(e){super.delete(this._onceCallbacksMap.get(e)||e),this._onceCallbacksMap.delete(e)}dispatch(e){for(let t of this)t(e)}}var qr=new class extends Yr{constructor(){super(),this._updateBinded=this._update.bind(this),this.time=.001*window.performance.now(),this._previousTime=this.time,this.deltaTime=0,this.timeScale=1,this._update()}_update(){requestAnimationFrame(this._updateBinded),this.time=.001*window.performance.now(),this.deltaTime=this.time-this._previousTime,this.timeScale=this.deltaTime/.0166666667,this._previousTime=this.time,this.dispatch()}};class jr extends HTMLElement{constructor({autoplay:e=!1,background:t=!1}={}){super(),this._autoplay=e||this.hasAttribute("autoplay"),this._background=t||this.hasAttribute("background"),this.paused=!0,this._pausedByBlur=!1,this._updateBinded=this.update.bind(this)}connectedCallback(){this._background||(window.top.addEventListener("blur",this._onBlur=()=>{this._pausedByBlur=!this.paused,this.pause()}),window.top.addEventListener("focus",this._onFocus=()=>{this._pausedByBlur&&this.play()})),(window.top.document.hasFocus()||this._background)&&this._autoplay?this.play():this._autoplay&&(this._pausedByBlur=!0,requestAnimationFrame(this._updateBinded))}disconnectedCallback(){this.pause(),window.top.removeEventListener("blur",this._onBlur),window.top.removeEventListener("focus",this._onFocus)}play(){this.paused=!1,this._pausedByBlur=!1,qr.add(this._updateBinded),this.dispatchEvent(new Event("playing"))}pause(){this.paused=!0,qr.delete(this._updateBinded),this.dispatchEvent(new Event("pause"))}update(){}}window.customElements.define("dlib-loop",jr);var Zr={DEG2RAD:Xr/180,RAD2DEG:180/Xr,generateUUID:function(){for(var e=[],t=0;256>t;t++)e[t]=(16>t?"0":"")+t.toString(16);return function(){var t=0|4294967295*Math.random(),r=0|4294967295*Math.random(),a=0|4294967295*Math.random(),i=0|4294967295*Math.random(),n=e[255&t]+e[255&t>>8]+e[255&t>>16]+e[255&t>>24]+"-"+e[255&r]+e[255&r>>8]+"-"+e[64|15&r>>16]+e[255&r>>24]+"-"+e[128|63&a]+e[255&a>>8]+"-"+e[255&a>>16]+e[255&a>>24]+e[255&i]+e[255&i>>8]+e[255&i>>16]+e[255&i>>24];return n.toUpperCase()}}(),clamp:function(e,t,r){return kr(t,Wr(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,a,i){return a+(e-t)*(i-a)/(r-t)},lerp:function(e,r,a){return(1-a)*e+a*r},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t),e*e*(3-2*e))},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t),e*e*e*(e*(6*e-15)+10))},randInt:function(e,t){return e+Hr(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Zr.DEG2RAD},radToDeg:function(e){return e*Zr.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Br(2,Or(Vr(e)/Gr))},floorPowerOfTwo:function(e){return Br(2,Hr(Vr(e)/Gr))}};Object.assign(e,{slerp:function(e,r,a,i){return a.copy(e).slerp(r,i)},slerpFlat:function(e,r,a,i,n,o,d){var l=a[i+0],c=a[i+1],p=a[i+2],m=a[i+3],u=n[o+0],g=n[o+1],h=n[o+2],_=n[o+3];if(m!==_||l!==u||c!==g||p!==h){var x=1-d,v=l*u+c*g+p*h+m*_,y=0<=v?1:-1,E=1-v*v;if(E>Number.EPSILON){var S=Fr(E),M=zr(S,v*y);x=Ir(x*M)/S,d=Ir(d*M)/S}var b=d*y;if(l=l*x+u*b,c=c*x+g*b,p=p*x+h*b,m=m*x+_*b,x==1-d){var T=1/Fr(l*l+c*c+p*p+m*m);l*=T,c*=T,p*=T,m*=T}}e[r]=l,e[r+1]=c,e[r+2]=p,e[r+3]=m}}),Object.defineProperties(e.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(e.prototype,{set:function(e,t,r,a){return this._x=e,this._y=t,this._z=r,this._w=a,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,a=e._y,i=e._z,n=e.order,o=Nr,s=Ir,d=o(r/2),l=o(a/2),c=o(i/2),p=s(r/2),m=s(a/2),u=s(i/2);return"XYZ"===n?(this._x=p*l*c+d*m*u,this._y=d*m*c-p*l*u,this._z=d*l*u+p*m*c,this._w=d*l*c-p*m*u):"YXZ"===n?(this._x=p*l*c+d*m*u,this._y=d*m*c-p*l*u,this._z=d*l*u-p*m*c,this._w=d*l*c+p*m*u):"ZXY"===n?(this._x=p*l*c-d*m*u,this._y=d*m*c+p*l*u,this._z=d*l*u+p*m*c,this._w=d*l*c-p*m*u):"ZYX"===n?(this._x=p*l*c-d*m*u,this._y=d*m*c+p*l*u,this._z=d*l*u-p*m*c,this._w=d*l*c+p*m*u):"YZX"===n?(this._x=p*l*c+d*m*u,this._y=d*m*c+p*l*u,this._z=d*l*u-p*m*c,this._w=d*l*c-p*m*u):"XZY"===n&&(this._x=p*l*c-d*m*u,this._y=d*m*c-p*l*u,this._z=d*l*u+p*m*c,this._w=d*l*c+p*m*u),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,a=Ir(r);return this._x=e.x*a,this._y=e.y*a,this._z=e.z*a,this._w=Nr(r),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t=e.elements,r=t[0],a=t[4],i=t[8],n=t[1],o=t[5],d=t[9],l=t[2],c=t[6],p=t[10],m=r+o+p,u;return 0<m?(u=.5/Fr(m+1),this._w=.25/u,this._x=(c-d)*u,this._y=(i-l)*u,this._z=(n-a)*u):r>o&&r>p?(u=2*Fr(1+r-o-p),this._w=(c-d)/u,this._x=.25*u,this._y=(a+n)/u,this._z=(i+l)/u):o>p?(u=2*Fr(1+o-r-p),this._w=(i-l)/u,this._x=(a+n)/u,this._y=.25*u,this._z=(d+c)/u):(u=2*Fr(1+p-r-o),this._w=(n-a)/u,this._x=(i+l)/u,this._y=(d+c)/u,this._z=.25*u),this.onChangeCallback(),this},setFromUnitVectors:function(){var e=new n,t;return function(r,a){return void 0===e&&(e=new n),t=r.dot(a)+1,t<1e-6?(t=0,Ur(r.x)>Ur(r.z)?e.set(-r.y,r.x,0):e.set(0,-r.z,r.y)):e.crossVectors(r,a),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize()}}(),inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Fr(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x*=e,this._y*=e,this._z*=e,this._w*=e),this.onChangeCallback(),this},multiply:function(e,t){return void 0===t?this.multiplyQuaternions(this,e):(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t))},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var r=e._x,a=e._y,i=e._z,n=e._w,o=t._x,s=t._y,d=t._z,l=t._w;return this._x=r*l+n*o+a*d-i*s,this._y=a*l+n*s+i*o-r*d,this._z=i*l+n*d+r*s-a*o,this._w=n*l-r*o-a*s-i*d,this.onChangeCallback(),this},slerp:function(e,r){if(0===r)return this;if(1===r)return this.copy(e);var t=this._x,a=this._y,i=this._z,n=this._w,o=n*e._w+t*e._x+a*e._y+i*e._z;if(0>o?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),1<=o)return this._w=n,this._x=t,this._y=a,this._z=i,this;var s=Fr(1-o*o);if(.001>Ur(s))return this._w=.5*(n+this._w),this._x=.5*(t+this._x),this._y=.5*(a+this._y),this._z=.5*(i+this._z),this;var d=zr(s,o),l=Ir((1-r)*d)/s,c=Ir(r*d)/s;return this._w=n*l+this._w*c,this._x=t*l+this._x*c,this._y=a*l+this._y*c,this._z=i*l+this._z*c,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(n.prototype,{isVector3:!0,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e);}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0===t?(this.x+=e.x,this.y+=e.y,this.z+=e.z,this):(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t))},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0===t?(this.x-=e.x,this.y-=e.y,this.z-=e.z,this):(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t))},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0===t?(this.x*=e.x,this.y*=e.y,this.z*=e.z,this):(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t))},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var t=new e;return function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(t.setFromEuler(e))}}(),applyAxisAngle:function(){var t=new e;return function(e,r){return this.applyQuaternion(t.setFromAxisAngle(e,r))}}(),applyMatrix3:function(t){var r=this.x,a=this.y,i=this.z,n=t.elements;return this.x=n[0]*r+n[3]*a+n[6]*i,this.y=n[1]*r+n[4]*a+n[7]*i,this.z=n[2]*r+n[5]*a+n[8]*i,this},applyMatrix4:function(t){var r=this.x,a=this.y,i=this.z,n=t.elements,e=1/(n[3]*r+n[7]*a+n[11]*i+n[15]);return this.x=(n[0]*r+n[4]*a+n[8]*i+n[12])*e,this.y=(n[1]*r+n[5]*a+n[9]*i+n[13])*e,this.z=(n[2]*r+n[6]*a+n[10]*i+n[14])*e,this},applyQuaternion:function(e){var t=this.x,r=this.y,a=this.z,i=e.x,n=e.y,o=e.z,s=e.w,d=s*t+n*a-o*r,l=s*r+o*t-i*a,c=s*a+i*r-n*t,p=-i*t-n*r-o*a;return this.x=d*s+p*-i+l*-o-c*-n,this.y=l*s+p*-n+c*-i-d*-o,this.z=c*s+p*-o+d*-n-l*-i,this},project:function(){var e=new t;return function(t){return e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyMatrix4(e)}}(),unproject:function(){var e=new t;return function(t){return e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyMatrix4(e)}}(),transformDirection:function(t){var r=this.x,a=this.y,i=this.z,n=t.elements;return this.x=n[0]*r+n[4]*a+n[8]*i,this.y=n[1]*r+n[5]*a+n[9]*i,this.z=n[2]*r+n[6]*a+n[10]*i,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Wr(this.x,e.x),this.y=Wr(this.y,e.y),this.z=Wr(this.z,e.z),this},max:function(e){return this.x=kr(this.x,e.x),this.y=kr(this.y,e.y),this.z=kr(this.z,e.z),this},clamp:function(e,t){return this.x=kr(e.x,Wr(t.x,this.x)),this.y=kr(e.y,Wr(t.y,this.y)),this.z=kr(e.z,Wr(t.z,this.z)),this},clampScalar:function(){var e=new n,t=new n;return function(r,a){return e.set(r,r,r),t.set(a,a,a),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(kr(e,Wr(t,r)))},floor:function(){return this.x=Hr(this.x),this.y=Hr(this.y),this.z=Hr(this.z),this},ceil:function(){return this.x=Or(this.x),this.y=Or(this.y),this.z=Or(this.z),this},round:function(){return this.x=Dr(this.x),this.y=Dr(this.y),this.z=Dr(this.z),this},roundToZero:function(){return this.x=0>this.x?Or(this.x):Hr(this.x),this.y=0>this.y?Or(this.y):Hr(this.y),this.z=0>this.z?Or(this.z):Hr(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Fr(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Ur(this.x)+Ur(this.y)+Ur(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function(e,t){return void 0===t?this.crossVectors(this,e):(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t))},crossVectors:function(e,t){var r=e.x,a=e.y,i=e.z,n=t.x,o=t.y,s=t.z;return this.x=a*s-i*o,this.y=i*n-r*s,this.z=r*o-a*n,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new n;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new n;return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Fr(this.lengthSq()*e.lengthSq());return Cr(Zr.clamp(t,-1,1))},distanceTo:function(e){return Fr(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,a=this.z-e.z;return t*t+r*r+a*a},manhattanDistanceTo:function(e){return Ur(this.x-e.x)+Ur(this.y-e.y)+Ur(this.z-e.z)},setFromSpherical:function(e){var t=Ir(e.phi)*e.radius;return this.x=t*Ir(e.theta),this.y=Nr(e.phi)*e.radius,this.z=t*Nr(e.theta),this},setFromCylindrical:function(e){return this.x=e.radius*Ir(e.theta),this.y=e.y,this.z=e.radius*Nr(e.theta),this},setFromMatrixPosition:function(t){var r=t.elements;return this.x=r[12],this.y=r[13],this.z=r[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),a=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=a,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(t.prototype,{isMatrix4:!0,set:function(e,t,r,a,i,n,o,s,d,l,c,p,m,u,f,g){var h=this.elements;return h[0]=e,h[4]=t,h[8]=r,h[12]=a,h[1]=i,h[5]=n,h[9]=o,h[13]=s,h[2]=d,h[6]=l,h[10]=c,h[14]=p,h[3]=m,h[7]=u,h[11]=f,h[15]=g,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return new t().fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(){var e=new n;return function(t){var r=this.elements,a=t.elements,i=1/e.setFromMatrixColumn(t,0).length(),n=1/e.setFromMatrixColumn(t,1).length(),o=1/e.setFromMatrixColumn(t,2).length();return r[0]=a[0]*i,r[1]=a[1]*i,r[2]=a[2]*i,r[4]=a[4]*n,r[5]=a[5]*n,r[6]=a[6]*n,r[8]=a[8]*o,r[9]=a[9]*o,r[10]=a[10]*o,this}}(),makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var r=this.elements,i=t.x,n=t.y,o=t.z,s=Nr(i),a=Ir(i),l=Nr(n),c=Ir(n),d=Nr(o),e=Ir(o);if("XYZ"===t.order){var p=s*d,m=s*e,u=a*d,f=a*e;r[0]=l*d,r[4]=-l*e,r[8]=c,r[1]=m+u*c,r[5]=p-f*c,r[9]=-a*l,r[2]=f-p*c,r[6]=u+m*c,r[10]=s*l}else if("YXZ"===t.order){var g=l*d,h=l*e,_=c*d,x=c*e;r[0]=g+x*a,r[4]=_*a-h,r[8]=s*c,r[1]=s*e,r[5]=s*d,r[9]=-a,r[2]=h*a-_,r[6]=x+g*a,r[10]=s*l}else if("ZXY"===t.order){var g=l*d,h=l*e,_=c*d,x=c*e;r[0]=g-x*a,r[4]=-s*e,r[8]=_+h*a,r[1]=h+_*a,r[5]=s*d,r[9]=x-g*a,r[2]=-s*c,r[6]=a,r[10]=s*l}else if("ZYX"===t.order){var p=s*d,m=s*e,u=a*d,f=a*e;r[0]=l*d,r[4]=u*c-m,r[8]=p*c+f,r[1]=l*e,r[5]=f*c+p,r[9]=m*c-u,r[2]=-c,r[6]=a*l,r[10]=s*l}else if("YZX"===t.order){var v=s*l,y=s*c,E=a*l,S=a*c;r[0]=l*d,r[4]=S-v*e,r[8]=E*e+y,r[1]=e,r[5]=s*d,r[9]=-a*d,r[2]=-c*d,r[6]=y*e+E,r[10]=v-S*e}else if("XZY"===t.order){var v=s*l,y=s*c,E=a*l,S=a*c;r[0]=l*d,r[4]=-e,r[8]=c*d,r[1]=v*e+S,r[5]=s*d,r[9]=y*e-E,r[2]=E*e-y,r[6]=a*d,r[10]=S*e+v}return r[3]=0,r[7]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,r=e._x,a=e._y,i=e._z,n=e._w,o=r+r,s=a+a,d=i+i,l=r*o,c=r*s,p=r*d,m=a*s,u=a*d,f=i*d,g=n*o,h=n*s,_=n*d;return t[0]=1-(m+f),t[4]=c-_,t[8]=p+h,t[1]=c+_,t[5]=1-(l+f),t[9]=u-g,t[2]=p-h,t[6]=u+g,t[10]=1-(l+m),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new n,t=new n,r=new n;return function(a,i,n){var o=this.elements;return r.subVectors(a,i),0===r.lengthSq()&&(r.z=1),r.normalize(),e.crossVectors(n,r),0===e.lengthSq()&&(1===Ur(n.z)?r.x+=1e-4:r.z+=1e-4,r.normalize(),e.crossVectors(n,r)),e.normalize(),t.crossVectors(r,e),o[0]=e.x,o[4]=t.x,o[8]=r.x,o[1]=e.y,o[5]=t.y,o[9]=r.y,o[2]=e.z,o[6]=t.z,o[10]=r.z,this}}(),multiply:function(e,t){return void 0===t?this.multiplyMatrices(this,e):(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t))},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,a=t.elements,i=this.elements,n=r[0],o=r[4],s=r[8],d=r[12],l=r[1],c=r[5],p=r[9],m=r[13],u=r[2],f=r[6],g=r[10],h=r[14],_=r[3],x=r[7],v=r[11],y=r[15],E=a[0],S=a[4],M=a[8],b=a[12],T=a[1],L=a[5],w=a[9],A=a[13],R=a[2],P=a[6],C=a[10],D=a[14],U=a[3],N=a[7],I=a[11],z=a[15];return i[0]=n*E+o*T+s*R+d*U,i[4]=n*S+o*L+s*P+d*N,i[8]=n*M+o*w+s*C+d*I,i[12]=n*b+o*A+s*D+d*z,i[1]=l*E+c*T+p*R+m*U,i[5]=l*S+c*L+p*P+m*N,i[9]=l*M+c*w+p*C+m*I,i[13]=l*b+c*A+p*D+m*z,i[2]=u*E+f*T+g*R+h*U,i[6]=u*S+f*L+g*P+h*N,i[10]=u*M+f*w+g*C+h*I,i[14]=u*b+f*A+g*D+h*z,i[3]=_*E+x*T+v*R+y*U,i[7]=_*S+x*L+v*P+y*N,i[11]=_*M+x*w+v*C+y*I,i[15]=_*b+x*A+v*D+y*z,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new n;return function(t){for(var r=0,a=t.count;r<a;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix4(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],r=e[4],a=e[8],i=e[12],n=e[1],o=e[5],s=e[9],d=e[13],l=e[2],c=e[6],p=e[10],m=e[14],u=e[3],f=e[7],g=e[11],h=e[15];return u*(+i*s*c-a*d*c-i*o*p+r*d*p+a*o*m-r*s*m)+f*(+t*s*m-t*d*p+i*n*p-a*n*m+a*d*l-i*s*l)+g*(+t*d*c-t*o*m-i*n*c+r*n*m+i*o*l-r*d*l)+h*(-a*o*l-t*s*c+t*o*p+a*n*c-r*n*p+r*s*l)},transpose:function(){var e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,a=e.elements,i=a[0],n=a[1],o=a[2],s=a[3],d=a[4],l=a[5],c=a[6],p=a[7],m=a[8],u=a[9],f=a[10],g=a[11],h=a[12],_=a[13],x=a[14],v=a[15],y=u*x*p-_*f*p+_*c*g-l*x*g-u*c*v+l*f*v,E=h*f*p-m*x*p-h*c*g+d*x*g+m*c*v-d*f*v,S=m*_*p-h*u*p+h*l*g-d*_*g-m*l*v+d*u*v,M=h*u*c-m*_*c-h*l*f+d*_*f+m*l*x-d*u*x,b=i*y+n*E+o*S+s*M;if(0===b){if(!0===t)throw new Error("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0");else console.warn("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0");return this.identity()}var T=1/b;return r[0]=y*T,r[1]=(_*f*s-u*x*s-_*o*g+n*x*g+u*o*v-n*f*v)*T,r[2]=(l*x*s-_*c*s+_*o*p-n*x*p-l*o*v+n*c*v)*T,r[3]=(u*c*s-l*f*s-u*o*p+n*f*p+l*o*g-n*c*g)*T,r[4]=E*T,r[5]=(m*x*s-h*f*s+h*o*g-i*x*g-m*o*v+i*f*v)*T,r[6]=(h*c*s-d*x*s-h*o*p+i*x*p+d*o*v-i*c*v)*T,r[7]=(d*f*s-m*c*s+m*o*p-i*f*p-d*o*g+i*c*g)*T,r[8]=S*T,r[9]=(h*u*s-m*_*s-h*n*g+i*_*g+m*n*v-i*u*v)*T,r[10]=(d*_*s-h*l*s+h*n*p-i*_*p-d*n*v+i*l*v)*T,r[11]=(m*l*s-d*u*s-m*n*p+i*u*p+d*n*g-i*l*g)*T,r[12]=M*T,r[13]=(m*_*o-h*u*o+h*n*f-i*_*f-m*n*x+i*u*x)*T,r[14]=(h*l*o-d*_*o-h*n*c+i*_*c+d*n*x-i*l*x)*T,r[15]=(d*u*o-m*l*o+m*n*c-i*u*c-d*n*f+i*l*f)*T,this},scale:function(e){var t=this.elements,r=e.x,a=e.y,i=e.z;return t[0]*=r,t[4]*=a,t[8]*=i,t[1]*=r,t[5]*=a,t[9]*=i,t[2]*=r,t[6]*=a,t[10]*=i,t[3]*=r,t[7]*=a,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],a=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Fr(kr(t,r,a))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Nr(e),r=Ir(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Nr(e),r=Ir(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Nr(e),r=Ir(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,r){var a=Nr(r),i=Ir(r),n=1-a,t=e.x,o=e.y,s=e.z,d=n*t,l=n*o;return this.set(d*t+a,d*o-i*s,d*s+i*o,0,d*o+i*s,l*o+a,l*s-i*t,0,d*s-i*o,l*s+i*t,n*s*s+a,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,r){return this.makeRotationFromQuaternion(t),this.scale(r),this.setPosition(e),this},decompose:function(){var e=new n,r=new t;return function(t,a,i){var n=this.elements,o=e.set(n[0],n[1],n[2]).length(),s=e.set(n[4],n[5],n[6]).length(),d=e.set(n[8],n[9],n[10]).length(),l=this.determinant();0>l&&(o=-o),t.x=n[12],t.y=n[13],t.z=n[14],r.copy(this);var c=1/o,p=1/s,m=1/d;return r.elements[0]*=c,r.elements[1]*=c,r.elements[2]*=c,r.elements[4]*=p,r.elements[5]*=p,r.elements[6]*=p,r.elements[8]*=m,r.elements[9]*=m,r.elements[10]*=m,a.setFromRotationMatrix(r),i.x=o,i.y=s,i.z=d,this}}(),makePerspective:function(e,t,r,a,i,n){void 0===n&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements;return o[0]=2*i/(t-e),o[4]=0,o[8]=(t+e)/(t-e),o[12]=0,o[1]=0,o[5]=2*i/(r-a),o[9]=(r+a)/(r-a),o[13]=0,o[2]=0,o[6]=0,o[10]=-(n+i)/(n-i),o[14]=-2*n*i/(n-i),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(e,t,r,a,i,n){var o=this.elements,s=1/(t-e),d=1/(r-a),l=1/(n-i);return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-((t+e)*s),o[1]=0,o[5]=2*d,o[9]=0,o[13]=-((r+a)*d),o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-((n+i)*l),o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,a=0;16>a;a++)if(t[a]!==r[a])return!1;return!0},fromArray:function(e,t){t===void 0&&(t=0);for(var r=0;16>r;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}),Object.assign(r.prototype,{addEventListener:function(e,t){this._listeners===void 0&&(this._listeners={});var r=this._listeners;r[e]===void 0&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(this._listeners===void 0)return!1;var r=this._listeners;return r[e]!==void 0&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners,a=r[e];if(void 0!==a){var i=a.indexOf(t);-1!==i&&a.splice(i,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners,r=t[e.type];if(void 0!==r){e.target=this;for(var a=r.slice(0),n=0,o=a.length;n<o;n++)a[n].call(this,e)}}}}),a.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],a.DefaultOrder="XYZ",Object.defineProperties(a.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(a.prototype,{isEuler:!0,set:function(e,t,r,a){return this._x=e,this._y=t,this._z=r,this._order=a||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var a=Math.asin,i=Zr.clamp,n=e.elements,o=n[0],s=n[4],d=n[8],l=n[1],c=n[5],p=n[9],m=n[2],u=n[6],f=n[10];return t=t||this._order,"XYZ"===t?(this._y=a(i(d,-1,1)),.99999>Ur(d)?(this._x=zr(-p,f),this._z=zr(-s,o)):(this._x=zr(u,c),this._z=0)):"YXZ"===t?(this._x=a(-i(p,-1,1)),.99999>Ur(p)?(this._y=zr(d,f),this._z=zr(l,c)):(this._y=zr(-m,o),this._z=0)):"ZXY"===t?(this._x=a(i(u,-1,1)),.99999>Ur(u)?(this._y=zr(-m,f),this._z=zr(-s,c)):(this._y=0,this._z=zr(l,o))):"ZYX"===t?(this._y=a(-i(m,-1,1)),.99999>Ur(m)?(this._x=zr(u,f),this._z=zr(l,o)):(this._x=0,this._z=zr(-s,c))):"YZX"===t?(this._z=a(i(l,-1,1)),.99999>Ur(l)?(this._x=zr(-p,c),this._y=zr(-m,o)):(this._x=0,this._y=zr(d,f))):"XZY"===t?(this._z=a(-i(s,-1,1)),.99999>Ur(s)?(this._x=zr(u,c),this._y=zr(d,o)):(this._x=zr(-p,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==r&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new t;return function(t,r,a){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,r,a)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var t=new e;return function(e){return t.setFromEuler(this),this.setFromQuaternion(t,e)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new n(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(i.prototype,{set:function(e){this.mask=0|1<<e},enable:function(e){this.mask|=0|1<<e},toggle:function(e){this.mask^=0|1<<e},disable:function(e){this.mask&=~(0|1<<e)},test:function(e){return 0!=(this.mask&e.mask)}}),Object.assign(o.prototype,{isMatrix3:!0,set:function(e,t,r,a,i,n,o,s,d){var l=this.elements;return l[0]=e,l[1]=a,l[2]=o,l[3]=t,l[4]=i,l[5]=s,l[6]=r,l[7]=n,l[8]=d,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return new this.constructor().fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var e=new n;return function(t){for(var r=0,a=t.count;r<a;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix3(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,a=t.elements,i=this.elements,n=r[0],o=r[3],s=r[6],d=r[1],l=r[4],c=r[7],p=r[2],m=r[5],u=r[8],f=a[0],g=a[3],h=a[6],_=a[1],x=a[4],v=a[7],y=a[2],E=a[5],S=a[8];return i[0]=n*f+o*_+s*y,i[3]=n*g+o*x+s*E,i[6]=n*h+o*v+s*S,i[1]=d*f+l*_+c*y,i[4]=d*g+l*x+c*E,i[7]=d*h+l*v+c*S,i[2]=p*f+m*_+u*y,i[5]=p*g+m*x+u*E,i[8]=p*h+m*v+u*S,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var t=this.elements,r=t[0],a=t[1],n=t[2],o=t[3],s=t[4],e=t[5],d=t[6],l=t[7],c=t[8];return r*s*c-r*e*l-a*o*c+a*e*d+n*o*l-n*s*d},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=e.elements,a=this.elements,i=r[0],n=r[1],o=r[2],s=r[3],d=r[4],l=r[5],c=r[6],p=r[7],m=r[8],u=m*d-l*p,f=l*c-m*s,g=p*s-d*c,h=i*u+n*f+o*g;if(0==h){if(!0===t)throw new Error("THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0");else console.warn("THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0");return this.identity()}var _=1/h;return a[0]=u*_,a[1]=(o*p-m*n)*_,a[2]=(l*n-o*d)*_,a[3]=f*_,a[4]=(m*i-o*c)*_,a[5]=(o*s-l*i)*_,a[6]=g*_,a[7]=(n*c-p*i)*_,a[8]=(d*i-n*s)*_,this},transpose:function(){var e=this.elements,t;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,r,a,i,n,o){var d=Nr(i),l=Ir(i);this.set(r*d,r*l,-r*(d*n+l*o)+n+e,-a*l,a*d,-a*(-l*n+d*o)+o+t,0,0,1)},scale:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this},rotate:function(e){var t=Nr(e),r=Ir(e),a=this.elements,i=a[0],n=a[3],o=a[6],s=a[1],d=a[4],l=a[7];return a[0]=t*i+r*s,a[3]=t*n+r*d,a[6]=t*o+r*l,a[1]=-r*i+t*s,a[4]=-r*n+t*d,a[7]=-r*o+t*l,this},translate:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this},equals:function(e){for(var t=this.elements,r=e.elements,a=0;9>a;a++)if(t[a]!==r[a])return!1;return!0},fromArray:function(e,t){t===void 0&&(t=0);for(var r=0;9>r;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}});var Qr=0;s.DefaultUp=new n(0,1,0),s.DefaultMatrixAutoUpdate=!0,s.prototype=Object.assign(Object.create(r.prototype),{constructor:s,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var t=new e;return function(e,r){return t.setFromAxisAngle(e,r),this.quaternion.multiply(t),this}}(),rotateOnWorldAxis:function(){var t=new e;return function(e,r){return t.setFromAxisAngle(e,r),this.quaternion.premultiply(t),this}}(),rotateX:function(){var e=new n(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new n(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new n(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new n;return function(t,r){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translateX:function(){var e=new n(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new n(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new n(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new t;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new t,r=new n;return function(t,a,i){t.isVector3?r.copy(t):r.set(t,a,i),this.isCamera?e.lookAt(this.position,r,this.up):e.lookAt(r,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var r=this.children.indexOf(e);return-1!==r&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(r,1)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,a=this.children.length;r<a;r++){var n=this.children[r],o=n.getObjectByProperty(e,t);if(o!==void 0)return o}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new n),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var t=new n,r=new n;return function(a){return void 0===a&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),a=new e),this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,a,r),a}}(),getWorldScale:function(){var t=new n,r=new e;return function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new n),this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,r,e),e}}(),getWorldDirection:function(){var t=new e;return function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new n),this.getWorldQuaternion(t),e.set(0,0,1).applyQuaternion(t)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,a=t.length;r<a;r++)t[r].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,r=0,a=t.length;r<void 0;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,r=0,a=t.length;r<a;r++)t[r].updateMatrixWorld(e)},toJSON:function(e){function t(t,r){return void 0===t[r.uuid]&&(t[r.uuid]=r.toJSON(e)),r.uuid}function r(e){var t=[];for(var r in e){var a=e[r];delete a.metadata,t.push(a)}return t}var a=void 0===e||"string"==typeof e,n={};a&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var o={};if(o.uuid=this.uuid,o.type=this.type,""!==this.name&&(o.name=this.name),!0===this.castShadow&&(o.castShadow=!0),!0===this.receiveShadow&&(o.receiveShadow=!0),!1===this.visible&&(o.visible=!1),!1===this.frustumCulled&&(o.frustumCulled=!1),0!==this.renderOrder&&(o.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(o.userData=this.userData),o.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(o.matrixAutoUpdate=!1),void 0!==this.geometry){o.geometry=t(e.geometries,this.geometry);var s=this.geometry.parameters;if(void 0!==s&&void 0!==s.shapes){var d=s.shapes;if(Array.isArray(d))for(var c=0,p=d.length,m;c<p;c++)m=d[c],t(e.shapes,m);else t(e.shapes,d)}}if(void 0!==this.material)if(Array.isArray(this.material)){for(var u=[],c=0,p=this.material.length;c<p;c++)u.push(t(e.materials,this.material[c]));o.material=u}else o.material=t(e.materials,this.material);if(0<this.children.length){o.children=[];for(var c=0;c<this.children.length;c++)o.children.push(this.children[c].toJSON(e).object)}if(a){var f=r(e.geometries),g=r(e.materials),h=r(e.textures),_=r(e.images),d=r(e.shapes);0<f.length&&(n.geometries=f),0<g.length&&(n.materials=g),0<h.length&&(n.textures=h),0<_.length&&(n.images=_),0<d.length&&(n.shapes=d)}return n.object=o,n},clone:function(e){return new this.constructor().copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var r=0,a;r<e.children.length;r++)a=e.children[r],this.add(a.clone());return this}}),d.prototype=Object.assign(Object.create(s.prototype),{constructor:d,isCamera:!0,copy:function(e,t){return s.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},getWorldDirection:function(){var t=new e;return function(e){return void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new n),this.getWorldQuaternion(t),e.set(0,0,-1).applyQuaternion(t)}}(),updateMatrixWorld:function(e){s.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return new this.constructor().copy(this)}}),l.prototype=Object.assign(Object.create(d.prototype),{constructor:l,isPerspectiveCamera:!0,copy:function(e,t){return d.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Zr.RAD2DEG*Pr(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Rr(.5*Zr.DEG2RAD*this.fov);return .5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Zr.RAD2DEG*Pr(Rr(.5*Zr.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Wr(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/kr(this.aspect,1)},setViewOffset:function(e,t,r,a,i,n){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=a,this.view.width=i,this.view.height=n,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Rr(.5*Zr.DEG2RAD*this.fov)/this.zoom,r=2*t,a=this.aspect*r,i=-.5*a,n=this.view;if(null!==this.view&&this.view.enabled){var o=n.fullWidth,s=n.fullHeight;i+=n.offsetX*a/o,t-=n.offsetY*r/s,a*=n.width/o,r*=n.height/s}var d=this.filmOffset;0!==d&&(i+=e*d/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+a,t,t-r,e,this.far)},toJSON:function(e){var t=s.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),Object.defineProperties(c.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(c.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e);}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0===t?(this.x+=e.x,this.y+=e.y,this):(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t))},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0===t?(this.x-=e.x,this.y-=e.y,this):(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t))},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(t){var r=this.x,a=this.y,i=t.elements;return this.x=i[0]*r+i[3]*a+i[6],this.y=i[1]*r+i[4]*a+i[7],this},min:function(e){return this.x=Wr(this.x,e.x),this.y=Wr(this.y,e.y),this},max:function(e){return this.x=kr(this.x,e.x),this.y=kr(this.y,e.y),this},clamp:function(e,t){return this.x=kr(e.x,Wr(t.x,this.x)),this.y=kr(e.y,Wr(t.y,this.y)),this},clampScalar:function(){var e=new c,t=new c;return function(r,a){return e.set(r,r),t.set(a,a),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(kr(e,Wr(t,r)))},floor:function(){return this.x=Hr(this.x),this.y=Hr(this.y),this},ceil:function(){return this.x=Or(this.x),this.y=Or(this.y),this},round:function(){return this.x=Dr(this.x),this.y=Dr(this.y),this},roundToZero:function(){return this.x=0>this.x?Or(this.x):Hr(this.x),this.y=0>this.y?Or(this.y):Hr(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Fr(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Ur(this.x)+Ur(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=zr(this.y,this.x);return 0>e&&(e+=2*Xr),e},distanceTo:function(e){return Fr(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},manhattanDistanceTo:function(e){return Ur(this.x-e.x)+Ur(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var r=Nr(t),a=Ir(t),i=this.x-e.x,n=this.y-e.y;return this.x=i*r-n*a+e.x,this.y=i*a+n*r+e.y,this}}),Object.assign(p.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=+Infinity,r=+Infinity,a=+Infinity,n=-Infinity,o=-Infinity,s=-Infinity,d=0,c=e.length;d<c;d+=3){var l=e[d],p=e[d+1],m=e[d+2];l<t&&(t=l),p<r&&(r=p),m<a&&(a=m),l>n&&(n=l),p>o&&(o=p),m>s&&(s=m)}return this.min.set(t,r,a),this.max.set(n,o,s),this},setFromBufferAttribute:function(e){for(var t=+Infinity,r=+Infinity,a=+Infinity,n=-Infinity,o=-Infinity,s=-Infinity,d=0,c=e.count;d<c;d++){var l=e.getX(d),p=e.getY(d),m=e.getZ(d);l<t&&(t=l),p<r&&(r=p),m<a&&(a=m),l>n&&(n=l),p>o&&(o=p),m>s&&(s=m)}return this.min.set(t,r,a),this.max.set(n,o,s),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new n;return function(t,r){var a=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(a),this.max.copy(t).add(a),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=+Infinity,this.max.x=this.max.y=this.max.z=-Infinity,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new n),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new n),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){function e(e){var i=e.geometry;if(i!==void 0)if(i.isGeometry){var n=i.vertices;for(a=0,o=n.length;a<o;a++)t.copy(n[a]),t.applyMatrix4(e.matrixWorld),r.expandByPoint(t)}else if(i.isBufferGeometry){var s=i.attributes.position;if(void 0!==s)for(a=0,o=s.count;a<o;a++)t.fromBufferAttribute(s,a).applyMatrix4(e.matrixWorld),r.expandByPoint(t)}}var t=new n,r,a,o;return function(t){return r=this,t.updateMatrixWorld(!0),t.traverse(e),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new n),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(){var e=new n;return function(t){return this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(e){var t,r;return 0<e.normal.x?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=e.constant&&r>=e.constant},intersectsTriangle:function(){function e(e){var n,s;for(n=0,s=e.length-3;n<=s;n+=3){d.fromArray(e,n);var l=c.x*Ur(d.x)+c.y*Ur(d.y)+c.z*Ur(d.z),r=t.dot(d),p=a.dot(d),m=o.dot(d);if(kr(-kr(r,p,m),Wr(r,p,m))>l)return!1}return!0}var t=new n,a=new n,o=new n,r=new n,i=new n,s=new n,d=new n,l=new n,c=new n,p=new n;return function(n){if(this.isEmpty())return!1;this.getCenter(l),c.subVectors(this.max,l),t.subVectors(n.a,l),a.subVectors(n.b,l),o.subVectors(n.c,l),r.subVectors(a,t),i.subVectors(o,a),s.subVectors(t,o);var d=[0,-r.z,r.y,0,-i.z,i.y,0,-s.z,s.y,r.z,0,-r.x,i.z,0,-i.x,s.z,0,-s.x,-r.y,r.x,0,-i.y,i.x,0,-s.y,s.x,0];return!!e(d)&&(d=[1,0,0,0,1,0,0,0,1],!!e(d))&&(p.crossVectors(r,i),d=[p.x,p.y,p.z],e(d))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new n),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new n;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),getBoundingSphere:function(){var e=new n;return function(t){return void 0===t&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),t=new m),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new n,new n,new n,new n,new n,new n,new n,new n];return function(t){return this.isEmpty()?this:(e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(e),this)}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(m.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new p;return function(t,r){var a=this.center;void 0===r?e.setFromPoints(t).getCenter(a):a.copy(r);for(var n=0,o=0,s=t.length;o<s;o++)n=kr(n,a.distanceToSquared(t[o]));return this.radius=Fr(n),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Ur(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new n),t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new p),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius*=e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(u.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new n),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new n;return function(r){return this.origin.copy(this.at(r,e)),this}}(),closestPointToPoint:function(e,t){t===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new n),t.subVectors(e,this.origin);var r=t.dot(this.direction);return 0>r?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Fr(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new n;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return 0>r?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new n,t=new n,r=new n;return function(a,i,n,o){e.copy(a).add(i).multiplyScalar(.5),t.copy(i).sub(a).normalize(),r.copy(this.origin).sub(e);var s=.5*a.distanceTo(i),d=-this.direction.dot(t),l=r.dot(this.direction),p=-r.dot(t),m=r.lengthSq(),c=Ur(1-d*d),u,f,g,h;if(!(0<c))f=0<d?-s:s,u=kr(0,-(d*f+l)),g=-u*u+f*(f+2*p)+m;else if(u=d*p-l,f=d*l-p,h=s*c,!(0<=u))f<=-h?(u=kr(0,-(-d*s+l)),f=0<u?-s:Wr(kr(-s,-p),s),g=-u*u+f*(f+2*p)+m):f<=h?(u=0,f=Wr(kr(-s,-p),s),g=f*(f+2*p)+m):(u=kr(0,-(d*s+l)),f=0<u?s:Wr(kr(-s,-p),s),g=-u*u+f*(f+2*p)+m);else if(!(f>=-h))f=-s,u=kr(0,-(d*f+l)),g=-u*u+f*(f+2*p)+m;else if(f<=h){var _=1/c;u*=_,f*=_,g=u*(u+d*f+2*l)+f*(d*u+f+2*p)+m}else f=s,u=kr(0,-(d*f+l)),g=-u*u+f*(f+2*p)+m;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),o&&o.copy(t).multiplyScalar(f).add(e),g}}(),intersectSphere:function(){var e=new n;return function(t,r){e.subVectors(t.center,this.origin);var a=e.dot(this.direction),i=e.dot(e)-a*a,n=t.radius*t.radius;if(i>n)return null;var o=Fr(n-i),s=a-o,d=a+o;return 0>s&&0>d?null:0>s?this.at(d,r):this.at(s,r)}}(),intersectsSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},distanceToPlane:function(e){var r=e.normal.dot(this.direction);if(0===r)return 0===e.distanceToPoint(this.origin)?0:null;var a=-(this.origin.dot(e.normal)+e.constant)/r;return 0<=a?a:null},intersectPlane:function(e,r){var a=this.distanceToPlane(e);return null===a?null:this.at(a,r)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;var r=e.normal.dot(this.direction);return!!(0>r*t)},intersectBox:function(e,t){var r=1/this.direction.x,a=1/this.direction.y,i=1/this.direction.z,n=this.origin,o,s,d,l,c,p;return(0<=r?(o=(e.min.x-n.x)*r,s=(e.max.x-n.x)*r):(o=(e.max.x-n.x)*r,s=(e.min.x-n.x)*r),0<=a?(d=(e.min.y-n.y)*a,l=(e.max.y-n.y)*a):(d=(e.max.y-n.y)*a,l=(e.min.y-n.y)*a),o>l||d>s)?null:((d>o||o!=o)&&(o=d),(l<s||s!=s)&&(s=l),0<=i?(c=(e.min.z-n.z)*i,p=(e.max.z-n.z)*i):(c=(e.max.z-n.z)*i,p=(e.min.z-n.z)*i),o>p||c>s)?null:((c>o||o!=o)&&(o=c),(p<s||s!=s)&&(s=p),0>s?null:this.at(0<=o?o:s,t))},intersectsBox:function(){var e=new n;return function(t){return null!==this.intersectBox(t,e)}}(),intersectTriangle:function(){var e=new n,t=new n,r=new n,i=new n;return function(n,a,o,s,d){t.subVectors(a,n),r.subVectors(o,n),i.crossVectors(t,r);var l=this.direction.dot(i),c;if(0<l){if(s)return null;c=1}else if(0>l)c=-1,l=-l;else return null;e.subVectors(this.origin,n);var p=c*this.direction.dot(r.crossVectors(e,r));if(0>p)return null;var m=c*this.direction.dot(t.cross(e));if(0>m)return null;if(p+m>l)return null;var u=-c*e.dot(i);return 0>u?null:this.at(u/l,d)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(f.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new n),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new n),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new n),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new n,r=new n;return function(a,i){e.subVectors(a,this.start),r.subVectors(this.end,this.start);var n=r.dot(r),o=r.dot(e),s=o/n;return i&&(s=Zr.clamp(s,0,1)),s}}(),closestPointToPoint:function(e,r,a){var i=this.closestPointToPointParameter(e,r);return void 0===a&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),a=new n),this.delta(a).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),Object.assign(g.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,a){return this.normal.set(e,t,r),this.constant=a,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new n,t=new n;return function(r,a,i){var n=e.subVectors(i,a).cross(t.subVectors(r,a)).normalize();return this.setFromNormalAndCoplanarPoint(n,r),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new n),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new n;return function(r,a){a===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),a=new n);var i=r.delta(e),o=this.normal.dot(i);if(0===o)return 0===this.distanceToPoint(r.start)?a.copy(r.start):void 0;var s=-(r.start.dot(this.normal)+this.constant)/o;return 0>s||1<s?void 0:a.copy(i).multiplyScalar(s).add(r.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return 0>t&&0<r||0>r&&0<t},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new n),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new n,t=new o;return function(r,a){var i=a||t.getNormalMatrix(r),n=this.coplanarPoint(e).applyMatrix4(r),o=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(o),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(h,{getNormal:function(){var e=new n;return function(t,r,a,i){i===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new n),i.subVectors(a,r),e.subVectors(t,r),i.cross(e);var o=i.lengthSq();return 0<o?i.multiplyScalar(1/Fr(o)):i.set(0,0,0)}}(),getBarycoord:function(){var e=new n,t=new n,r=new n;return function(i,o,a,s,d){e.subVectors(s,o),t.subVectors(a,o),r.subVectors(i,o);var l=e.dot(e),c=e.dot(t),p=e.dot(r),m=t.dot(t),f=t.dot(r),g=l*m-c*c;if(void 0===d&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),d=new n),0===g)return d.set(-2,-1,-1);var h=1/g,_=(m*p-c*f)*h,u=(l*f-c*p)*h;return d.set(1-_-u,u,_)}}(),containsPoint:function(){var e=new n;return function(t,r,a,i){return h.getBarycoord(t,r,a,i,e),0<=e.x&&0<=e.y&&1>=e.x+e.y}}()}),Object.assign(h.prototype,{set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,a){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[a]),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new n,t=new n;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new n),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return h.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new n),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return h.getBarycoord(e,this.a,this.b,this.c,t)},containsPoint:function(e){return h.containsPoint(e,this.a,this.b,this.c)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(){var e=new g,t=[new f,new f,new f],r=new n,a=new n;return function(o,s){void 0===s&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),s=new n);var d=1/0;if(e.setFromCoplanarPoints(this.a,this.b,this.c),e.projectPoint(o,r),!0===this.containsPoint(r))s.copy(r);else{t[0].set(this.a,this.b),t[1].set(this.b,this.c),t[2].set(this.c,this.a);for(var l=0;l<t.length;l++){t[l].closestPointToPoint(r,!0,a);var c=r.distanceToSquared(a);c<d&&(d=c,s.copy(a))}}return s}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var Jr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Object.assign(_.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Hr(e),this.r=(255&e>>16)/255,this.g=(255&e>>8)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(){function e(e,r,a){return 0>a&&(a+=1),1<a&&(a-=1),a<1/6?e+6*(r-e)*a:a<1/2?r:a<2/3?e+6*(r-e)*(2/3-a):e}return function(t,r,a){if(t=Zr.euclideanModulo(t,1),r=Zr.clamp(r,0,1),a=Zr.clamp(a,0,1),0===r)this.r=this.g=this.b=a;else{var i=.5>=a?a*(1+r):a+r-a*r,n=2*a-i;this.r=e(n,i,t+1/3),this.g=e(n,i,t),this.b=e(n,i,t-1/3)}return this}}(),setStyle:function(e){function t(t){void 0===t||1>parseFloat(t)&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var a=r[1],i=r[2],n;switch(a){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Wr(255,parseInt(n[1],10))/255,this.g=Wr(255,parseInt(n[2],10))/255,this.b=Wr(255,parseInt(n[3],10))/255,t(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Wr(100,parseInt(n[1],10))/100,this.g=Wr(100,parseInt(n[2],10))/100,this.b=Wr(100,parseInt(n[3],10))/100,t(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i)){var o=parseFloat(n[1])/360,d=parseInt(n[2],10)/100,s=parseInt(n[3],10)/100;return t(n[5]),this.setHSL(o,d,s)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(e)){var l=r[1],c=l.length;if(3===c)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}if(e&&0<e.length){var l=Jr[e];void 0===l?console.warn("THREE.Color: Unknown color "+e):this.setHex(l)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Br(e.r,t),this.g=Br(e.g,t),this.b=Br(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var r=0<t?1/t:1;return this.r=Br(e.r,r),this.g=Br(e.g,r),this.b=Br(e.b,r),this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;return this.r=e*e,this.g=t*t,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Fr(this.r),this.g=Fr(this.g),this.b=Fr(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t=this.r,r=this.g,a=this.b,i=kr(t,r,a),n=Wr(t,r,a),o=(n+i)/2,s,d;if(n===i)s=0,d=0;else{var l=i-n;d=.5>=o?l/(i+n):l/(2-i-n),i===t?s=(r-a)/l+(r<a?6:0):i===r?s=(a-t)/l+2:i===a?s=(t-r)/l+4:void 0,s/=6}return e.h=s,e.s=d,e.l=o,e},getStyle:function(){return"rgb("+(0|255*this.r)+","+(0|255*this.g)+","+(0|255*this.b)+")"},offsetHSL:function(){var e={};return function(t,r,a){return this.getHSL(e),e.h+=t,e.s+=r,e.l+=a,this.setHSL(e.h,e.s,e.l),this}}(),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=kr(0,this.r-e.r),this.g=kr(0,this.g-e.g),this.b=kr(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),Object.assign(x.prototype,{clone:function(){return new this.constructor().copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var Kr=300,$r=1e3,ea=1001,ta=1002,ra=1006,aa=1012,ia=0;v.prototype=Object.assign(Object.create(r.prototype),{constructor:v,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0===r){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"==t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=r===1;continue}var a=this[t];if(void 0===a){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}a&&a.isColor?a.set(r):a&&a.isVector3&&r&&r.isVector3?a.copy(r):"overdraw"==t?this[t]=+r:this[t]=r}},toJSON:function(e){function t(e){var t=[];for(var r in e){var a=e[r];delete a.metadata,t.push(a)}return t}var r=void 0===e||"string"==typeof e;r&&(e={textures:{},images:{}});var a={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};if(a.uuid=this.uuid,a.type=this.type,""!==this.name&&(a.name=this.name),this.color&&this.color.isColor&&(a.color=this.color.getHex()),void 0!==this.roughness&&(a.roughness=this.roughness),void 0!==this.metalness&&(a.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(a.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(a.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(a.specular=this.specular.getHex()),void 0!==this.shininess&&(a.shininess=this.shininess),void 0!==this.clearCoat&&(a.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(a.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(a.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(a.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(a.lightMap=this.lightMap.toJSON(e).uuid),this.bumpMap&&this.bumpMap.isTexture&&(a.bumpMap=this.bumpMap.toJSON(e).uuid,a.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(a.normalMap=this.normalMap.toJSON(e).uuid,a.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(a.displacementMap=this.displacementMap.toJSON(e).uuid,a.displacementScale=this.displacementScale,a.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(a.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(a.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(a.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(a.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(a.envMap=this.envMap.toJSON(e).uuid,a.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(a.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(a.size=this.size),void 0!==this.sizeAttenuation&&(a.sizeAttenuation=this.sizeAttenuation),this.blending!==1&&(a.blending=this.blending),!0===this.flatShading&&(a.flatShading=this.flatShading),this.side!==0&&(a.side=this.side),this.vertexColors!==0&&(a.vertexColors=this.vertexColors),1>this.opacity&&(a.opacity=this.opacity),!0===this.transparent&&(a.transparent=this.transparent),a.depthFunc=this.depthFunc,a.depthTest=this.depthTest,a.depthWrite=this.depthWrite,0!==this.rotation&&(a.rotation=this.rotation),1!==this.linewidth&&(a.linewidth=this.linewidth),void 0!==this.dashSize&&(a.dashSize=this.dashSize),void 0!==this.gapSize&&(a.gapSize=this.gapSize),void 0!==this.scale&&(a.scale=this.scale),!0===this.dithering&&(a.dithering=!0),0<this.alphaTest&&(a.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(a.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(a.wireframe=this.wireframe),1<this.wireframeLinewidth&&(a.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(a.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(a.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(a.morphTargets=!0),!0===this.skinning&&(a.skinning=!0),!1===this.visible&&(a.visible=!1),"{}"!==JSON.stringify(this.userData)&&(a.userData=this.userData),r){var i=t(e.textures),n=t(e.images);0<i.length&&(a.textures=i),0<n.length&&(a.images=n)}return a},clone:function(){return new this.constructor().copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.overdraw=e.overdraw,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,r=null;if(null!==t){var a=t.length;r=Array(a);for(var n=0;n!==a;++n)r[n]=t[n].clone()}return this.clippingPlanes=r,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),y.prototype=Object.create(v.prototype),y.prototype.constructor=y,y.prototype.isMeshBasicMaterial=!0,y.prototype.copy=function(e){return v.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Object.assign(E.prototype,{isVector4:!0,set:function(e,t,r,a){return this.x=e,this.y=t,this.z=r,this.w=a,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e);}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0===e.w?1:e.w,this},add:function(e,t){return void 0===t?(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this):(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t))},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0===t?(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this):(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t))},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(t){var r=this.x,a=this.y,i=this.z,n=this.w,o=t.elements;return this.x=o[0]*r+o[4]*a+o[8]*i+o[12]*n,this.y=o[1]*r+o[5]*a+o[9]*i+o[13]*n,this.z=o[2]*r+o[6]*a+o[10]*i+o[14]*n,this.w=o[3]*r+o[7]*a+o[11]*i+o[15]*n,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Cr(e.w);var t=Fr(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t=.01,r=.1,a=e.elements,i=a[0],n=a[4],o=a[8],d=a[1],l=a[5],c=a[9],p=a[2],m=a[6],u=a[10],f,g,h,_;if(Ur(n-d)<t&&Ur(o-p)<t&&Ur(c-m)<t){if(Ur(n+d)<r&&Ur(o+p)<r&&Ur(c+m)<r&&Ur(i+l+u-3)<r)return this.set(1,0,0,0),this;f=Xr;var v=(i+1)/2,E=(l+1)/2,S=(u+1)/2,M=(n+d)/4,b=(o+p)/4,T=(c+m)/4;return v>E&&v>S?v<t?(g=0,h=.707106781,_=.707106781):(g=Fr(v),h=M/g,_=b/g):E>S?E<t?(g=.707106781,h=0,_=.707106781):(h=Fr(E),g=M/h,_=T/h):S<t?(g=.707106781,h=.707106781,_=0):(_=Fr(S),g=b/_,h=T/_),this.set(g,h,_,f),this}var L=Fr((m-c)*(m-c)+(o-p)*(o-p)+(d-n)*(d-n));return .001>Ur(L)&&(L=1),this.x=(m-c)/L,this.y=(o-p)/L,this.z=(d-n)/L,this.w=Cr((i+l+u-1)/2),this},min:function(e){return this.x=Wr(this.x,e.x),this.y=Wr(this.y,e.y),this.z=Wr(this.z,e.z),this.w=Wr(this.w,e.w),this},max:function(e){return this.x=kr(this.x,e.x),this.y=kr(this.y,e.y),this.z=kr(this.z,e.z),this.w=kr(this.w,e.w),this},clamp:function(e,t){return this.x=kr(e.x,Wr(t.x,this.x)),this.y=kr(e.y,Wr(t.y,this.y)),this.z=kr(e.z,Wr(t.z,this.z)),this.w=kr(e.w,Wr(t.w,this.w)),this},clampScalar:function(){var e,t;return function(r,a){return null==e&&(e=new E,t=new E),e.set(r,r,r,r),t.set(a,a,a,a),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(kr(e,Wr(t,r)))},floor:function(){return this.x=Hr(this.x),this.y=Hr(this.y),this.z=Hr(this.z),this.w=Hr(this.w),this},ceil:function(){return this.x=Or(this.x),this.y=Or(this.y),this.z=Or(this.z),this.w=Or(this.w),this},round:function(){return this.x=Dr(this.x),this.y=Dr(this.y),this.z=Dr(this.z),this.w=Dr(this.w),this},roundToZero:function(){return this.x=0>this.x?Or(this.x):Hr(this.x),this.y=0>this.y?Or(this.y):Hr(this.y),this.z=0>this.z?Or(this.z):Hr(this.z),this.w=0>this.w?Or(this.w):Hr(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Fr(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Ur(this.x)+Ur(this.y)+Ur(this.z)+Ur(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Object.defineProperty(S.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(S.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0===e?0:e.length/this.itemSize,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var a=0,n=this.itemSize;a<n;a++)this.array[e+a]=t.array[r+a];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,a=0,n=e.length,o;a<n;a++)o=e[a],void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",a),o=new _),t[r++]=o.r,t[r++]=o.g,t[r++]=o.b;return this},copyVector2sArray:function(e){for(var t=this.array,r=0,a=0,n=e.length,o;a<n;a++)o=e[a],void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",a),o=new c),t[r++]=o.x,t[r++]=o.y;return this},copyVector3sArray:function(e){for(var t=this.array,r=0,a=0,o=e.length,s;a<o;a++)s=e[a],void 0===s&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",a),s=new n),t[r++]=s.x,t[r++]=s.y,t[r++]=s.z;return this},copyVector4sArray:function(e){for(var t=this.array,r=0,a=0,n=e.length,o;a<n;a++)o=e[a],void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",a),o=new E),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z,t[r++]=o.w;return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,a){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=a,this},setXYZW:function(e,t,r,a,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=a,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),M.prototype=Object.create(S.prototype),M.prototype.constructor=M,b.prototype=Object.create(S.prototype),b.prototype.constructor=b,T.prototype=Object.create(S.prototype),T.prototype.constructor=T,L.prototype=Object.create(S.prototype),L.prototype.constructor=L,w.prototype=Object.create(S.prototype),w.prototype.constructor=w,A.prototype=Object.create(S.prototype),A.prototype.constructor=A,R.prototype=Object.create(S.prototype),R.prototype.constructor=R,P.prototype=Object.create(S.prototype),P.prototype.constructor=P,C.prototype=Object.create(S.prototype),C.prototype.constructor=C,Object.assign(D.prototype,{computeGroups:function(e){for(var t=[],r=void 0,a=e.faces,n=0,o,s;n<a.length;n++)s=a[n],s.materialIndex!==r&&(r=s.materialIndex,void 0!==o&&(o.count=3*n-o.start,t.push(o)),o={start:3*n,materialIndex:r});o!==void 0&&(o.count=3*n-o.start,t.push(o)),this.groups=t},fromGeometry:function(e){var t=e.faces,r=e.vertices,a=e.faceVertexUvs,n=a[0]&&0<a[0].length,o=a[1]&&0<a[1].length,s=e.morphTargets,d=s.length,l;if(0<d){l=[];for(var p=0;p<d;p++)l[p]=[];this.morphTargets.position=l}var m=e.morphNormals,u=m.length,f;if(0<u){f=[];for(var p=0;p<u;p++)f[p]=[];this.morphTargets.normal=f}for(var g=e.skinIndices,h=e.skinWeights,_=g.length===r.length,x=h.length===r.length,p=0,v;p<t.length;p++){v=t[p],this.vertices.push(r[v.a],r[v.b],r[v.c]);var y=v.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var E=v.normal;this.normals.push(E,E,E)}var S=v.vertexColors;if(3===S.length)this.colors.push(S[0],S[1],S[2]);else{var M=v.color;this.colors.push(M,M,M)}if(!0===n){var b=a[0][p];void 0===b?(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",p),this.uvs.push(new c,new c,new c)):this.uvs.push(b[0],b[1],b[2])}if(!0===o){var b=a[1][p];void 0===b?(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",p),this.uvs2.push(new c,new c,new c)):this.uvs2.push(b[0],b[1],b[2])}for(var T=0,L;T<d;T++)L=s[T].vertices,l[T].push(L[v.a],L[v.b],L[v.c]);for(var T=0,w;T<u;T++)w=m[T].vertexNormals[p],f[T].push(w.a,w.b,w.c);_&&this.skinIndices.push(g[v.a],g[v.b],g[v.c]),x&&this.skinWeights.push(h[v.a],h[v.b],h[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});var na=1;N.prototype=Object.assign(Object.create(r.prototype),{constructor:N,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){this.index=Array.isArray(e)?new(65535<U(e)?R:w)(e,1):e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(t)):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(e,new S(arguments[1],arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:r===void 0?0:r})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var r=this.attributes.normal;if(void 0!==r){var a=new o().getNormalMatrix(e);a.applyToBufferAttribute(r),r.needsUpdate=!0}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new t;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new t;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new t;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new t;return function(t,r,a){return e.makeTranslation(t,r,a),this.applyMatrix(e),this}}(),scale:function(){var e=new t;return function(t,r,a){return e.makeScale(t,r,a),this.applyMatrix(e),this}}(),lookAt:function(){var e=new s;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){var e=new n;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var r=new P(3*t.vertices.length,3),a=new P(3*t.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(t.vertices)),this.addAttribute("color",a.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var i=new P(t.lineDistances.length,1);this.addAttribute("lineDistance",i.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],r=0,a=e.length,n;r<a;r++)n=e[r],t.push(n.x,n.y,n.z||0);return this.addAttribute("position",new P(t,3)),this},updateFromObject:function(e){var t=e.geometry;if(e.isMesh){var r=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(r=void 0,t.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(t);r.verticesNeedUpdate=t.verticesNeedUpdate,r.normalsNeedUpdate=t.normalsNeedUpdate,r.colorsNeedUpdate=t.colorsNeedUpdate,r.uvsNeedUpdate=t.uvsNeedUpdate,r.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=r}var a;return!0===t.verticesNeedUpdate&&(a=this.attributes.position,void 0!==a&&(a.copyVector3sArray(t.vertices),a.needsUpdate=!0),t.verticesNeedUpdate=!1),!0===t.normalsNeedUpdate&&(a=this.attributes.normal,void 0!==a&&(a.copyVector3sArray(t.normals),a.needsUpdate=!0),t.normalsNeedUpdate=!1),!0===t.colorsNeedUpdate&&(a=this.attributes.color,void 0!==a&&(a.copyColorsArray(t.colors),a.needsUpdate=!0),t.colorsNeedUpdate=!1),t.uvsNeedUpdate&&(a=this.attributes.uv,void 0!==a&&(a.copyVector2sArray(t.uvs),a.needsUpdate=!0),t.uvsNeedUpdate=!1),t.lineDistancesNeedUpdate&&(a=this.attributes.lineDistance,void 0!==a&&(a.copyArray(t.lineDistances),a.needsUpdate=!0),t.lineDistancesNeedUpdate=!1),t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=new D().fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new S(t,3).copyVector3sArray(e.vertices)),0<e.normals.length){var r=new Float32Array(3*e.normals.length);this.addAttribute("normal",new S(r,3).copyVector3sArray(e.normals))}if(0<e.colors.length){var a=new Float32Array(3*e.colors.length);this.addAttribute("color",new S(a,3).copyColorsArray(e.colors))}if(0<e.uvs.length){var n=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new S(n,2).copyVector2sArray(e.uvs))}if(0<e.uvs2.length){var o=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new S(o,2).copyVector2sArray(e.uvs2))}for(var s in this.groups=e.groups,e.morphTargets){for(var d=[],c=e.morphTargets[s],p=0,m=c.length;p<m;p++){var l=c[p],u=new P(3*l.length,3);d.push(u.copyVector3sArray(l))}this.morphAttributes[s]=d}if(0<e.skinIndices.length){var f=new P(4*e.skinIndices.length,4);this.addAttribute("skinIndex",f.copyVector4sArray(e.skinIndices))}if(0<e.skinWeights.length){var g=new P(4*e.skinWeights.length,4);this.addAttribute("skinWeight",g.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new p);var e=this.attributes.position;e===void 0?this.boundingBox.makeEmpty():this.boundingBox.setFromBufferAttribute(e),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error("THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.",this)},computeBoundingSphere:function(){var e=new p,t=new n;return function(){null===this.boundingSphere&&(this.boundingSphere=new m);var r=this.attributes.position;if(r){var a=this.boundingSphere.center;e.setFromBufferAttribute(r),e.getCenter(a);for(var n=0,o=0,s=r.count;o<s;o++)t.x=r.getX(o),t.y=r.getY(o),t.z=r.getZ(o),n=kr(n,a.distanceToSquared(t));this.boundingSphere.radius=Fr(n),isNaN(this.boundingSphere.radius)&&console.error("THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.",this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes,r=this.groups;if(t.position){var a=t.position.array;if(t.normal===void 0)this.addAttribute("normal",new S(new Float32Array(a.length),3));else for(var o=t.normal.array,s=0,d=o.length;s<d;s++)o[s]=0;var l=t.normal.array,c=new n,p=new n,m=new n,u=new n,f=new n,g,h,_;if(e){var x=e.array;0===r.length&&this.addGroup(0,x.length);for(var v=0,y=r.length;v<y;++v)for(var E=r[v],M=E.start,b=E.count,s=M,d=M+b;s<d;s+=3)g=3*x[s+0],h=3*x[s+1],_=3*x[s+2],c.fromArray(a,g),p.fromArray(a,h),m.fromArray(a,_),u.subVectors(m,p),f.subVectors(c,p),u.cross(f),l[g]+=u.x,l[g+1]+=u.y,l[g+2]+=u.z,l[h]+=u.x,l[h+1]+=u.y,l[h+2]+=u.z,l[_]+=u.x,l[_+1]+=u.y,l[_+2]+=u.z}else for(var s=0,d=a.length;s<d;s+=9)c.fromArray(a,s),p.fromArray(a,s+3),m.fromArray(a,s+6),u.subVectors(m,p),f.subVectors(c,p),u.cross(f),l[s]=u.x,l[s+1]=u.y,l[s+2]=u.z,l[s+3]=u.x,l[s+4]=u.y,l[s+5]=u.z,l[s+6]=u.x,l[s+7]=u.y,l[s+8]=u.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(!(e&&e.isBufferGeometry))return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var a in r)if(e.attributes[a]!==void 0)for(var n=r[a],o=n.array,s=e.attributes[a],d=s.array,l=s.itemSize,c=0,p=l*t;c<d.length;c++,p++)o[p]=d[c];return this},normalizeNormals:function(){var e=new n;return function(){for(var t=this.attributes.normal,r=0,a=t.count;r<a;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.normalize(),t.setXYZ(r,e.x,e.y,e.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new N,t=this.index.array,r=this.attributes;for(var a in r){for(var n=r[a],o=n.array,s=n.itemSize,d=new o.constructor(t.length*s),c=0,p=0,m=0,u=t.length;m<u;m++){c=t[m]*s;for(var f=0;f<s;f++)d[p++]=o[c++]}e.addAttribute(a,new S(d,s))}for(var g=this.groups,m=0,u=g.length,h;m<u;m++)h=g[m],e.addGroup(h.start,h.count,h.materialIndex);return e},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};var a=this.index;if(null!==a){var i=Array.prototype.slice.call(a.array);e.data.index={type:a.array.constructor.name,array:i}}var n=this.attributes;for(var r in n){var o=n[r],i=Array.prototype.slice.call(o.array);e.data.attributes[r]={itemSize:o.itemSize,type:o.array.constructor.name,array:i,normalized:o.normalized}}var s=this.groups;0<s.length&&(e.data.groups=JSON.parse(JSON.stringify(s)));var d=this.boundingSphere;return null!==d&&(e.data.boundingSphere={center:d.center.toArray(),radius:d.radius}),e},clone:function(){return new N().copy(this)},copy:function(e){var t,r,a;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone());var o=e.attributes;for(t in o){var s=o[t];this.addAttribute(t,s.clone())}var d=e.morphAttributes;for(t in d){var c=[],p=d[t];for(r=0,a=p.length;r<a;r++)c.push(p[r].clone());this.morphAttributes[t]=c}var m=e.groups;for(r=0,a=m.length;r<a;r++){var u=m[r];this.addGroup(u.start,u.count,u.materialIndex)}var f=e.boundingBox;null!==f&&(this.boundingBox=f.clone());var g=e.boundingSphere;return null!==g&&(this.boundingSphere=g.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),I.prototype=Object.assign(Object.create(s.prototype),{constructor:I,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return s.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e=this.geometry,t,r,a;if(e.isBufferGeometry){var i=e.morphAttributes,n=Object.keys(i);if(0<n.length){var o=i[n[0]];if(o!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},(t=0,r=o.length);t<r;t++)a=o[t].name||t+"",this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=t}}else{var s=e.morphTargets;if(s!==void 0&&0<s.length)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},(t=0,r=s.length);t<r;t++)a=s[t].name||t+"",this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=t}},raycast:function(){function e(e,t,r,a,i,n,o){return h.getBarycoord(e,t,r,a,S),i.multiplyScalar(S.x),n.multiplyScalar(S.y),o.multiplyScalar(S.z),i.add(n).add(o),i.clone()}function r(e,t,r,a,i,n,o,s){var d;if(d=t.side===1?a.intersectTriangle(o,n,i,!0,s):a.intersectTriangle(i,n,o,t.side!==2,s),null===d)return null;b.copy(s),b.applyMatrix4(e.matrixWorld);var l=r.ray.origin.distanceTo(b);return l<r.near||l>r.far?null:{distance:l,point:b.clone(),object:e}}function o(t,n,o,s,d,p,a,m){i.fromBufferAttribute(s,p),l.fromBufferAttribute(s,a),f.fromBufferAttribute(s,m);var c=r(t,t.material,n,o,i,l,f,M);if(c){d&&(v.fromBufferAttribute(d,p),y.fromBufferAttribute(d,a),E.fromBufferAttribute(d,m),c.uv=e(M,i,l,f,v,y,E));var u=new x(p,a,m);h.getNormal(i,l,f,u.normal),c.face=u,c.faceIndex=p}return c}var s=new t,d=new u,p=new m,i=new n,l=new n,f=new n,a=new n,g=new n,_=new n,v=new c,y=new c,E=new c,S=new n,M=new n,b=new n;return function(n,m){var u=this.geometry,h=this.material,x=this.matrixWorld;if(void 0!==h&&(null===u.boundingSphere&&u.computeBoundingSphere(),p.copy(u.boundingSphere),p.applyMatrix4(x),!1!==n.ray.intersectsSphere(p))&&(s.getInverse(x),d.copy(n.ray).applyMatrix4(s),null===u.boundingBox||!1!==d.intersectsBox(u.boundingBox))){var S;if(u.isBufferGeometry){var T=u.index,L=u.attributes.position,w=u.attributes.uv,A,R,P,C,D;if(null!==T)for(C=0,D=T.count;C<D;C+=3)A=T.getX(C),R=T.getX(C+1),P=T.getX(C+2),S=o(this,n,d,L,w,A,R,P),S&&(S.faceIndex=Hr(C/3),m.push(S));else if(void 0!==L)for(C=0,D=L.count;C<D;C+=3)A=C,R=C+1,P=C+2,S=o(this,n,d,L,w,A,R,P),S&&m.push(S)}else if(u.isGeometry){var U=Array.isArray(h),N=u.vertices,I=u.faces,z=u.faceVertexUvs[0],F,B,O,G;0<z.length&&(G=z);for(var V=0,H=I.length;V<H;V++){var k=I[V],W=U?h[k.materialIndex]:h;if(void 0!==W){if(F=N[k.a],B=N[k.b],O=N[k.c],!0===W.morphTargets){var X=u.morphTargets,Y=this.morphTargetInfluences;i.set(0,0,0),l.set(0,0,0),f.set(0,0,0);for(var q=0,j=X.length,Z;q<j;q++)if(Z=Y[q],0!==Z){var Q=X[q].vertices;i.addScaledVector(a.subVectors(Q[k.a],F),Z),l.addScaledVector(g.subVectors(Q[k.b],B),Z),f.addScaledVector(_.subVectors(Q[k.c],O),Z)}i.add(F),l.add(B),f.add(O),F=i,B=l,O=f}if(S=r(this,W,n,d,F,B,O,M),S){if(G&&G[V]){var J=G[V];v.copy(J[0]),y.copy(J[1]),E.copy(J[2]),S.uv=e(M,F,B,O,v,y,E)}S.face=k,S.faceIndex=V,m.push(S)}}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var oa=0;z.prototype=Object.assign(Object.create(r.prototype),{constructor:z,isGeometry:!0,applyMatrix:function(e){for(var t=new o().getNormalMatrix(e),r=0,a=this.vertices.length,n;r<a;r++)n=this.vertices[r],n.applyMatrix4(e);for(var r=0,a=this.faces.length,s;r<a;r++){s=this.faces[r],s.normal.applyMatrix3(t).normalize();for(var d=0,l=s.vertexNormals.length;d<l;d++)s.vertexNormals[d].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e=new t;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new t;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new t;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new t;return function(t,r,a){return e.makeTranslation(t,r,a),this.applyMatrix(e),this}}(),scale:function(){var e=new t;return function(t,r,a){return e.makeScale(t,r,a),this.applyMatrix(e),this}}(),lookAt:function(){var e=new s;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){function t(e,t,a,i){var n=void 0===d?[]:[u[e].clone(),u[t].clone(),u[a].clone()],o=void 0===l?[]:[r.colors[e].clone(),r.colors[t].clone(),r.colors[a].clone()],s=new x(e,t,a,n,o,i);r.faces.push(s),void 0!==p&&r.faceVertexUvs[0].push([f[e].clone(),f[t].clone(),f[a].clone()]),void 0!==m&&r.faceVertexUvs[1].push([g[e].clone(),g[t].clone(),g[a].clone()])}var r=this,a=null===e.index?void 0:e.index.array,o=e.attributes,s=o.position.array,d=void 0===o.normal?void 0:o.normal.array,l=void 0===o.color?void 0:o.color.array,p=void 0===o.uv?void 0:o.uv.array,m=void 0===o.uv2?void 0:o.uv2.array;void 0!==m&&(this.faceVertexUvs[1]=[]);for(var u=[],f=[],g=[],h=0,v=0;h<s.length;h+=3,v+=2)r.vertices.push(new n(s[h],s[h+1],s[h+2])),void 0!==d&&u.push(new n(d[h],d[h+1],d[h+2])),void 0!==l&&r.colors.push(new _(l[h],l[h+1],l[h+2])),void 0!==p&&f.push(new c(p[v],p[v+1])),void 0!==m&&g.push(new c(m[v],m[v+1]));var y=e.groups;if(0<y.length)for(var h=0;h<y.length;h++)for(var E=y[h],S=E.start,M=E.count,v=S;v<S+M;v+=3)void 0===a?t(v,v+1,v+2,E.materialIndex):t(a[v],a[v+1],a[v+2],E.materialIndex);else if(void 0!==a)for(var h=0;h<a.length;h+=3)t(a[h],a[h+1],a[h+2]);else for(var h=0;h<s.length/3;h+=3)t(h,h+1,h+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){var e=new n;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,r=this.boundingSphere.radius,a=0===r?1:1/r,i=new t;return i.set(a,0,0,-a*e.x,0,a,0,-a*e.y,0,0,a,-a*e.z,0,0,0,1),this.applyMatrix(i),this},computeFaceNormals:function(){for(var e=new n,t=new n,r=0,a=this.faces.length;r<a;r++){var i=this.faces[r],o=this.vertices[i.a],s=this.vertices[i.b],d=this.vertices[i.c];e.subVectors(d,s),t.subVectors(o,s),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){e===void 0&&(e=!0);var t,r,a,i,o,s;for(s=Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)s[t]=new n;if(e){var d=new n,l=new n,c,p,m;for(a=0,i=this.faces.length;a<i;a++)o=this.faces[a],c=this.vertices[o.a],p=this.vertices[o.b],m=this.vertices[o.c],d.subVectors(m,p),l.subVectors(c,p),d.cross(l),s[o.a].add(d),s[o.b].add(d),s[o.c].add(d)}else for(this.computeFaceNormals(),a=0,i=this.faces.length;a<i;a++)o=this.faces[a],s[o.a].add(o.normal),s[o.b].add(o.normal),s[o.c].add(o.normal);for(t=0,r=this.vertices.length;t<r;t++)s[t].normalize();for(a=0,i=this.faces.length;a<i;a++){o=this.faces[a];var u=o.vertexNormals;3===u.length?(u[0].copy(s[o.a]),u[1].copy(s[o.b]),u[2].copy(s[o.c])):(u[0]=s[o.a].clone(),u[1]=s[o.b].clone(),u[2]=s[o.c].clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,r;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){r=this.faces[e];var a=r.vertexNormals;3===a.length?(a[0].copy(r.normal),a[1].copy(r.normal),a[2].copy(r.normal)):(a[0]=r.normal.clone(),a[1]=r.normal.clone(),a[2]=r.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,r,a,o;for(r=0,a=this.faces.length;r<a;r++)for(o=this.faces[r],o.__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]),(e=0,t=o.vertexNormals.length);e<t;e++)o.__originalVertexNormals[e]?o.__originalVertexNormals[e].copy(o.vertexNormals[e]):o.__originalVertexNormals[e]=o.vertexNormals[e].clone();var s=new z;for(s.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var d=this.morphNormals[e].faceNormals,l=this.morphNormals[e].vertexNormals,c,p;for(r=0,a=this.faces.length;r<a;r++)c=new n,p={a:new n,b:new n,c:new n},d.push(c),l.push(p)}var m=this.morphNormals[e];s.vertices=this.morphTargets[e].vertices,s.computeFaceNormals(),s.computeVertexNormals();var c,p;for(r=0,a=this.faces.length;r<a;r++)o=this.faces[r],c=m.faceNormals[r],p=m.vertexNormals[r],c.copy(o.normal),p.a.copy(o.vertexNormals[0]),p.b.copy(o.vertexNormals[1]),p.c.copy(o.vertexNormals[2])}for(r=0,a=this.faces.length;r<a;r++)o=this.faces[r],o.normal=o.__originalFaceNormal,o.vertexNormals=o.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new p),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new m),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(!(e&&e.isGeometry))return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);var a=this.vertices.length,n=this.vertices,s=e.vertices,d=this.faces,l=e.faces,c=this.faceVertexUvs[0],p=e.faceVertexUvs[0],m=this.colors,u=e.colors,f;r===void 0&&(r=0),t!==void 0&&(f=new o().getNormalMatrix(t));for(var g=0,h=s.length;g<h;g++){var _=s[g],v=_.clone();t!==void 0&&v.applyMatrix4(t),n.push(v)}for(var g=0,h=u.length;g<h;g++)m.push(u[g].clone());for(g=0,h=l.length;g<h;g++){var y=l[g],E=y.vertexNormals,S=y.vertexColors,M,b,T;M=new x(y.a+a,y.b+a,y.c+a),M.normal.copy(y.normal),f!==void 0&&M.normal.applyMatrix3(f).normalize();for(var L=0,w=E.length;L<w;L++)b=E[L].clone(),void 0!==f&&b.applyMatrix3(f).normalize(),M.vertexNormals.push(b);M.color.copy(y.color);for(var L=0,w=S.length;L<w;L++)T=S[L],M.vertexColors.push(T.clone());M.materialIndex=y.materialIndex+r,d.push(M)}for(g=0,h=p.length;g<h;g++){var A=p[g],R=[];if(void 0!==A){for(var L=0,w=A.length;L<w;L++)R.push(A[L].clone());c.push(R)}}},mergeMesh:function(e){return e&&e.isMesh?void(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):void console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e={},t=[],r=[],a=10000,o,s,d,l,c,p,m,u;for(d=0,l=this.vertices.length;d<l;d++)o=this.vertices[d],s=Dr(o.x*a)+"_"+Dr(o.y*a)+"_"+Dr(o.z*a),void 0===e[s]?(e[s]=d,t.push(this.vertices[d]),r[d]=t.length-1):r[d]=r[e[s]];var f=[];for(d=0,l=this.faces.length;d<l;d++){c=this.faces[d],c.a=r[c.a],c.b=r[c.b],c.c=r[c.c],p=[c.a,c.b,c.c];for(var g=0;3>g;g++)if(p[g]===p[(g+1)%3]){f.push(d);break}}for(d=f.length-1;0<=d;d--){var h=f[d];for(this.faces.splice(h,1),m=0,u=this.faceVertexUvs.length;m<u;m++)this.faceVertexUvs[m].splice(h,1)}var _=this.vertices.length-t.length;return this.vertices=t,_},setFromPoints:function(e){this.vertices=[];for(var t=0,r=e.length,a;t<r;t++)a=e[t],this.vertices.push(new n(a.x,a.y,a.z||0));return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var a=this.faceVertexUvs[0],n=this.faceVertexUvs[1],o,s;a&&a.length===t&&(o=[]),n&&n.length===t&&(s=[]);for(var r=0,d;r<t;r++)d=e[r]._id,o&&o.push(a[d]),s&&s.push(n[d]);o&&(this.faceVertexUvs[0]=o),s&&(this.faceVertexUvs[1]=s)},toJSON:function(){function e(e,t,r){return r?e|1<<t:e&~(1<<t)}function t(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0===u[t]?(u[t]=m.length/3,m.push(e.x,e.y,e.z),u[t]):u[t]}function r(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0===g[t]?(g[t]=f.length,f.push(e.getHex()),g[t]):g[t]}function a(e){var t=e.x.toString()+e.y.toString();return void 0===_[t]?(_[t]=h.length/2,h.push(e.x,e.y),_[t]):_[t]}var n={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),void 0!==this.parameters){var o=this.parameters;for(var s in o)void 0!==o[s]&&(n[s]=o[s]);return n}for(var d=[],l=0,c;l<this.vertices.length;l++)c=this.vertices[l],d.push(c.x,c.y,c.z);for(var p=[],m=[],u={},f=[],g={},h=[],_={},l=0;l<this.faces.length;l++){var x=this.faces[l],v=void 0!==this.faceVertexUvs[0][l],y=0<x.normal.length(),E=0<x.vertexNormals.length,S=1!==x.color.r||1!==x.color.g||1!==x.color.b,M=0<x.vertexColors.length,b=0;if(b=e(b,0,0),b=e(b,1,!0),b=e(b,2,!1),b=e(b,3,v),b=e(b,4,y),b=e(b,5,E),b=e(b,6,S),b=e(b,7,M),p.push(b),p.push(x.a,x.b,x.c),p.push(x.materialIndex),v){var T=this.faceVertexUvs[0][l];p.push(a(T[0]),a(T[1]),a(T[2]))}if(y&&p.push(t(x.normal)),E){var L=x.vertexNormals;p.push(t(L[0]),t(L[1]),t(L[2]))}if(S&&p.push(r(x.color)),M){var w=x.vertexColors;p.push(r(w[0]),r(w[1]),r(w[2]))}}return n.data={},n.data.vertices=d,n.data.normals=m,0<f.length&&(n.data.colors=f),0<h.length&&(n.data.uvs=[h]),n.data.faces=p,n},clone:function(){return new z().copy(this)},copy:function(e){var t,r,a,n,o,s;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var d=e.vertices;for(t=0,r=d.length;t<r;t++)this.vertices.push(d[t].clone());var l=e.colors;for(t=0,r=l.length;t<r;t++)this.colors.push(l[t].clone());var c=e.faces;for(t=0,r=c.length;t<r;t++)this.faces.push(c[t].clone());for(t=0,r=e.faceVertexUvs.length;t<r;t++){var p=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),a=0,n=p.length;a<n;a++){var m=p[a],u=[];for(o=0,s=m.length;o<s;o++){var f=m[o];u.push(f.clone())}this.faceVertexUvs[t].push(u)}}var g=e.morphTargets;for(t=0,r=g.length;t<r;t++){var h={name:g[t].name};if(void 0!==g[t].vertices)for(h.vertices=[],a=0,n=g[t].vertices.length;a<n;a++)h.vertices.push(g[t].vertices[a].clone());if(void 0!==g[t].normals)for(h.normals=[],a=0,n=g[t].normals.length;a<n;a++)h.normals.push(g[t].normals[a].clone());this.morphTargets.push(h)}var _=e.morphNormals;for(t=0,r=_.length;t<r;t++){var x={};if(void 0!==_[t].vertexNormals)for(x.vertexNormals=[],a=0,n=_[t].vertexNormals.length;a<n;a++){var v=_[t].vertexNormals[a],y={};y.a=v.a.clone(),y.b=v.b.clone(),y.c=v.c.clone(),x.vertexNormals.push(y)}if(void 0!==_[t].faceNormals)for(x.faceNormals=[],a=0,n=_[t].faceNormals.length;a<n;a++)x.faceNormals.push(_[t].faceNormals[a].clone());this.morphNormals.push(x)}var E=e.skinWeights;for(t=0,r=E.length;t<r;t++)this.skinWeights.push(E[t].clone());var S=e.skinIndices;for(t=0,r=S.length;t<r;t++)this.skinIndices.push(S[t].clone());var M=e.lineDistances;for(t=0,r=M.length;t<r;t++)this.lineDistances.push(M[t]);var b=e.boundingBox;null!==b&&(this.boundingBox=b.clone());var T=e.boundingSphere;return null!==T&&(this.boundingSphere=T.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),F.prototype=Object.create(z.prototype),F.prototype.constructor=F,B.prototype=Object.create(N.prototype),B.prototype.constructor=B,O.prototype=Object.create(v.prototype),O.prototype.constructor=O,O.prototype.isMeshNormalMaterial=!0,O.prototype.copy=function(e){return v.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},G.prototype=Object.assign(Object.create(s.prototype),{constructor:G,copy:function(e,t){return s.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=s.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}});let sa="undefined"==typeof Float32Array?Array:Float32Array;(function(){let e=V();return function(t,r,a,n,o,s){let d,c;for(r||(r=2),a||(a=0),c=n?Wr(n*r+a,t.length):t.length,d=a;d<c;d+=r)e[0]=t[d],e[1]=t[d+1],o(e,e,s),t[d]=e[0],t[d+1]=e[1];return t}})();class da extends Float32Array{static distance(e,t){return q(e,t)}constructor(e=[0,0]){return super(e),this}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}set(e,t){return k(this,e,t),this}copy(e){return H(this,e),this}add(e){return W(this,this,e),this}get size(){return j(this)}get squaredSize(){return Z(this)}subtract(e){return X(this,this,e),this}negate(e=this){return Q(this,e),this}cross(e,t){return $(this,e,t),this}scale(e){return Y(this,this,e),this}normalize(){J(this,this)}dot(e){return K(this,e)}distance(e){return da.distance(this,e)}equals(e){return ae(this,e)}applyMatrix3(e){return te(this,this,e),this}applyMatrix4(e){return re(this,this,e),this}lerp(e,t){ee(this,this,e,t)}clone(){return new da(this)}}let la=new Map;class ca extends da{static get TOUCH_TYPE(){return"touchtype"}static get MOUSE_TYPE(){return"mousetype"}static get(e=document.body){let t=la.get(e);return t||(t=new ca(e)),t}get downed(){return this._downed}constructor(e=document.body){super(),this.domElement=e,this.type=ca.TOUCH_TYPE,this.velocity=new da,this.dragOffset=new da,this.centered=new da,this.centeredFlippedY=new da,this.normalized=new da,this.normalizedFlippedY=new da,this.normalizedCentered=new da,this.normalizedCenteredFlippedY=new da,this._downed=!1,la.set(this.domElement,this),this.onDown=new Yr,this.onMove=new Yr,this.onUp=new Yr,this.onClick=new Yr,this.onTypeChange=new Yr,this._preventMouseTypeChange=!1,this._onPointerMoveBinded=this._onPointerMove.bind(this),this._onPointerDownBinded=this._onPointerDown.bind(this),this._onPointerUpBinded=this._onPointerUp.bind(this),this._updateBinded=this._update.bind(this),this._resizeBinded=this.resize.bind(this),this.resize(),this._position=new da,this.enable()}resize(){this._domElementBoundingRect=this.domElement.getBoundingClientRect()}_onPointerDown(t){"touchstart"===t.type&&(this._preventMouseTypeChange=!0,this._changeType(ca.TOUCH_TYPE)),this._downed=!0,this.dragOffset.set(0,0),this.copy(this._position),this._onPointerEvent(t),this._updatePositions(),this.onDown.dispatch(t)}_onPointerMove(t){if("mousemove"===t.type){if(this._preventMouseTypeChange)return;this._changeType(ca.MOUSE_TYPE)}this._onPointerEvent(t),this.onMove.dispatch(t)}_onPointerUp(t){this._downed&&(this._downed=!1,this._onPointerEvent(t),this._updatePositions(),this.onUp.dispatch(t),4>this.dragOffset.length&&this.onClick.dispatch(t),clearTimeout(this._timeout),this._timeout=setTimeout(()=>{this._preventMouseTypeChange=!1},2e3))}_onPointerEvent(t){!!window.TouchEvent&&t instanceof window.TouchEvent&&("touchend"===t.type?t=t.changedTouches[0]:t=t.touches[0]),this._position.x=t.clientX-this._domElementBoundingRect.left,this._position.y=t.clientY-this._domElementBoundingRect.top}_changeType(e){this.type===e||(this.type=e,this.disable(),this.enable(),this.onTypeChange.dispatch(this.type))}_update(){(this.x||this.y)&&(this.velocity.x=this._position.x-this.x,this.velocity.y=this._position.y-this.y,this.downed&&this.dragOffset.add(this.velocity)),this._updatePositions()}_updatePositions(){this.x=this._position.x,this.y=this._position.y;(this.x||this.y)&&(this.centered.x=this.centeredFlippedY.x=this.x-.5*this._domElementBoundingRect.width,this.centered.y=this.centeredFlippedY.y=this.y-.5*this._domElementBoundingRect.height,this.centeredFlippedY.y*=-1,this.normalized.x=this.normalizedFlippedY.x=this.x/this._domElementBoundingRect.width,this.normalized.y=this.normalizedFlippedY.y=this.y/this._domElementBoundingRect.height,this.normalizedFlippedY.y=1-this.normalizedFlippedY.y,this.normalizedCentered.x=this.normalizedCenteredFlippedY.x=2*this.normalized.x-1,this.normalizedCentered.y=this.normalizedCenteredFlippedY.y=2*this.normalized.y-1,this.normalizedCenteredFlippedY.y*=-1)}enable(){this.disable(),this.resize(),this.type===ca.TOUCH_TYPE?(this.domElement.addEventListener("touchmove",this._onPointerMoveBinded),window.addEventListener("touchend",this._onPointerUpBinded)):(this.domElement.addEventListener("mousedown",this._onPointerDownBinded),window.addEventListener("mouseup",this._onPointerUpBinded)),this.domElement.addEventListener("touchstart",this._onPointerDownBinded),this.domElement.addEventListener("mousemove",this._onPointerMoveBinded),window.addEventListener("resize",this._resizeBinded),qr.add(this._updateBinded=this._updateBinded||this._update.bind(this))}disable(){qr.delete(this._updateBinded),this.domElement.removeEventListener("touchstart",this._onPointerDownBinded),this.domElement.removeEventListener("mousedown",this._onPointerDownBinded),this.domElement.removeEventListener("touchmove",this._onPointerMoveBinded),this.domElement.removeEventListener("mousemove",this._onPointerMoveBinded),window.removeEventListener("touchend",this._onPointerUpBinded),window.removeEventListener("mouseup",this._onPointerUpBinded),window.removeEventListener("resize",this._resizeBinded)}}class pa extends Float32Array{constructor(e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return super(e),this}set x(e){this[12]=e}get x(){return this[12]}set y(e){this[13]=e}get y(){return this[13]}set z(e){this[14]=e}get z(){return this[14]}set w(e){this[15]=e}get w(){return this[15]}set(e,t,r,a,i,n,o,s,d,l,c,p,m,u,f,g){return e.length?this.copy(e):(ne(this,e,t,r,a,i,n,o,s,d,l,c,p,m,u,f,g),this)}translate(e,t=this){return le(this,t,e),this}rotateX(e,t=this){return pe(this,t,e),this}rotateY(e,t=this){return me(this,t,e),this}rotateZ(e,t=this){return ue(this,t,e),this}scale(e,t=this){return ce(this,t,"number"==typeof e?[e,e,e]:e),this}multiply(e,t){return t?de(this,e,t):de(this,this,e),this}identity(){return oe(this),this}copy(e){return ie(this,e),this}fromPerspective({fov:e,aspectRatio:t,near:r,far:a}={}){return ge(this,e,t,r,a),this}fromQuaternion(e){return fe(this,e),this}setPosition(e){return this.x=e[0],this.y=e[1],this.z=e[2],this}invert(e=this){return se(this,e),this}}(function(){let e=he();return function(t,r,a,n,o,s){let d,c;for(r||(r=3),a||(a=0),c=n?Wr(n*r+a,t.length):t.length,d=a;d<c;d+=r)e[0]=t[d],e[1]=t[d+1],e[2]=t[d+2],o(e,e,s),t[d]=e[0],t[d+1]=e[1],t[d+2]=e[2];return t}})();class ma extends Float32Array{constructor(e=[0,0,0]){return super(e),this}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}get z(){return this[2]}set z(e){this[2]=e}set(e,t,r){return ye(this,e,t,r),this}copy(e){return ve(this,e),this}add(e){return Ee(this,this,e),this}get size(){return _e(this)}get squaredSize(){return Te(this)}distance(e){return be(this,e)}subtract(e){return Se(this,this,e),this}negate(e=this){return Le(this,e),this}cross(e,t){return Re(this,e,t),this}scale(e){return Me(this,this,e),this}normalize(){return we(this,this),this}dot(e){return Ae(this,e)}equals(e){return De(this,e)}applyMatrix4(e){return Pe(this,this,e),this}angle(e){return Ce(this,e)}clone(){return new ma(this)}}const ua=function(){let e=Ne();return function(t,r,a,n,o,s){let d,c;for(r||(r=4),a||(a=0),c=n?Wr(n*r+a,t.length):t.length,d=a;d<c;d+=r)e[0]=t[d],e[1]=t[d+1],e[2]=t[d+2],e[3]=t[d+3],o(e,e,s),t[d]=e[0],t[d+1]=e[1],t[d+2]=e[2],t[d+3]=e[3];return t}}(),fa=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},ga=function(e,t,r,a,i){return e[0]=t,e[1]=r,e[2]=a,e[3]=i,e},ha=function(e,t){let r=t[0],a=t[1],i=t[2],n=t[3],o=r*r+a*a+i*i+n*n;return 0<o&&(o=1/Fr(o),e[0]=r*o,e[1]=a*o,e[2]=i*o,e[3]=n*o),e},_a=function(){let e=he(),t=xe(1,0,0),r=xe(0,1,0);return function(i,n,a){let o=Ae(n,a);return-.999999>o?(Re(e,t,n),1e-6>_e(e)&&Re(e,r,n),we(e,e),Fe(i,e,Math.PI),i):.999999<o?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Re(e,n,a),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+o,ha(i,i))}}(),xa=function(){let e=Ie(),r=Ie();return function(i,n,a,o,s,d){return He(e,n,s,d),He(r,a,o,d),He(i,e,r,2*d*(1-d)),i}}(),va=function(){let e=Ue();return function(t,r,a,i){return e[0]=a[0],e[3]=a[1],e[6]=a[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],ha(t,We(t,e))}}();class ya extends Float32Array{constructor(e=0,t=0,r=0,a=1){return super(4),this.set(e,t,r,a),this}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}get z(){return this[2]}set z(e){this[2]=e}get w(){return this[3]}set w(e){this[3]=e}identity(){return ze(this),this}set(e,t,r,a){return ga(this,e,t,r,a),this}rotateX(e){return Oe(this,this,e),this}rotateY(e){return Ge(this,this,e),this}rotateZ(e){return Ve(this,this,e),this}invert(e=this){return ke(this,e),this}copy(e){return fa(this,e),this}normalize(e=this){return ha(this,this),this}multiply(e,t){return t?Be(this,e,t):Be(this,this,e),this}fromMatrix3(e){return We(this,e),this}}class Ea{constructor({matrix:e=new pa,domElement:t=document.body,distance:r=0,invertRotation:a=!0,rotationEaseRatio:i=.04,zoomSpeed:n=.1,zoomEaseRatio:o=.1,minDistance:s=0,maxDistance:d=1/0,enabled:l=!0}={}){this.matrix=e,this._distance=r,this.invertRotation=a,this.rotationEaseRatio=i,this.maxDistance=d,this.minDistance=s,this.zoomSpeed=n,this.zoomEaseRatio=o,this._pointer=ca.get(t),this._nextDistance=this._distance,this._cachedQuaternion=new ya,this._cachedMatrix=new pa,this._cachedVector3=new ma,this._velocity=new da,this._velocityOrigin=new da,this._position=new ma([this.matrix.x,this.matrix.y,this.matrix.z]),this._positionPrevious=this._position.clone(),this._positionOffset=new ma,t.addEventListener("wheel",this.onWheel.bind(this)),this.enabled=!0,this.update(),this.enabled=l}set distance(e){this._distance=this._nextDistance=e}get distance(){return this._distance}onWheel(t){if(this.enabled){const e=1+Ur(.01*(t.deltaY*this.zoomSpeed));this._nextDistance=this._nextDistance||1,this._nextDistance=0<t.deltaY?this._nextDistance*e:this._nextDistance/e,this._nextDistance=kr(Wr(this._nextDistance,this.maxDistance),this.minDistance)}}update(){this.enabled&&(this._cachedMatrix.identity(),this._cachedQuaternion.identity(),this._distance+=(this._nextDistance-this._distance)*this.zoomEaseRatio,this._position.set(this.matrix.x,this.matrix.y,this.matrix.z).subtract(this._positionOffset),this.matrix.x=0,this.matrix.y=0,this.matrix.z=0,this._pointer.downed&&this._velocity.copy(this._pointer.velocity).scale(.003),this._velocity.lerp(this._velocityOrigin,this.rotationEaseRatio),this._cachedQuaternion.rotateY(this.invertRotation?-this._velocity.x:this._velocity.x),this._cachedQuaternion.rotateX(this.invertRotation?-this._velocity.y:this._velocity.y),this._cachedMatrix.fromQuaternion(this._cachedQuaternion),this.matrix.multiply(this._cachedMatrix),this._positionOffset.set(0,0,1),this._positionOffset.applyMatrix4(this.matrix),this._positionOffset.scale(this._distance),this._cachedVector3.copy(this._position).add(this._positionOffset),this.matrix.x=this._cachedVector3.x,this.matrix.y=this._cachedVector3.y,this.matrix.z=this._cachedVector3.z)}}class Sa extends Ea{constructor(e=new s,r){e.updateMatrix(),super(Object.assign({matrix:new pa(e.matrix.elements)},r)),this._matrix4=new t,this.object3D=e,this.update()}update(){this.object3D&&(this.matrix.x=this.object3D.position.x,this.matrix.y=this.object3D.position.y,this.matrix.z=this.object3D.position.z,super.update(),this._matrix4.fromArray(this.matrix),this.object3D.matrix.identity(),this.object3D.applyMatrix(this._matrix4))}}class Ma extends G{constructor({canvas:e}={}){super(),this.camera=new l(65,window.innerWidth/window.innerHeight,.1,1e4),this.controls=new Sa(this.camera,{distance:5,domElement:e});let t=new I(new F(1,1,1),new O());this.add(t)}resize(e,t){this.camera.aspect=e/t,this.camera.updateProjectionMatrix()}update(){this.controls.update()}}var ba=0;Xe.DEFAULT_IMAGE=void 0,Xe.DEFAULT_MAPPING=Kr,Xe.prototype=Object.assign(Object.create(r.prototype),{constructor:Xe,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){function t(e){var t;if(e instanceof HTMLCanvasElement)t=e;else{t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),t.width=e.width,t.height=e.height;var r=t.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height)}return 2048<t.width||2048<t.height?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}var r=void 0===e||"string"==typeof e;if(!r&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var a={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var i=this.image;void 0===i.uuid&&(i.uuid=Zr.generateUUID()),r||void 0!==e.images[i.uuid]||(e.images[i.uuid]={uuid:i.uuid,url:t(i)}),a.image=i.uuid}return r||(e.textures[this.uuid]=a),a},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping===Kr){if(e.applyMatrix3(this.matrix),0>e.x||1<e.x)switch(this.wrapS){case $r:e.x-=Hr(e.x);break;case ea:e.x=0>e.x?0:1;break;case ta:1===Ur(Hr(e.x)%2)?e.x=Or(e.x)-e.x:e.x-=Hr(e.x);}if(0>e.y||1<e.y)switch(this.wrapT){case $r:e.y-=Hr(e.y);break;case ea:e.y=0>e.y?0:1;break;case ta:1===Ur(Hr(e.y)%2)?e.y=Or(e.y)-e.y:e.y-=Hr(e.y);}this.flipY&&(e.y=1-e.y)}}}),Object.defineProperty(Xe.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Ye.prototype=Object.create(Xe.prototype),Ye.prototype.constructor=Ye,Ye.prototype.isDataTexture=!0,Object.assign(qe.prototype,{set:function(e,t,r,a,i,n){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(a),o[4].copy(i),o[5].copy(n),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){for(var t=this.planes,r=0;6>r;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,a=r[0],i=r[1],n=r[2],o=r[3],s=r[4],d=r[5],l=r[6],c=r[7],p=r[8],m=r[9],u=r[10],f=r[11],g=r[12],h=r[13],_=r[14],x=r[15];return t[0].setComponents(o-a,c-s,f-p,x-g).normalize(),t[1].setComponents(o+a,c+s,f+p,x+g).normalize(),t[2].setComponents(o+i,c+d,f+m,x+h).normalize(),t[3].setComponents(o-i,c-d,f-m,x-h).normalize(),t[4].setComponents(o-n,c-l,f-u,x-_).normalize(),t[5].setComponents(o+n,c+l,f+u,x+_).normalize(),this},intersectsObject:function(){var e=new m;return function(t){var r=t.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),e.copy(r.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new m;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,r=e.center,a=-e.radius,n=0,o;6>n;n++)if(o=t[n].distanceToPoint(r),o<a)return!1;return!0},intersectsBox:function(){var e=new n,t=new n;return function(r){for(var a=this.planes,n=0,o;6>n;n++){o=a[n],e.x=0<o.normal.x?r.min.x:r.max.x,t.x=0<o.normal.x?r.max.x:r.min.x,e.y=0<o.normal.y?r.min.y:r.max.y,t.y=0<o.normal.y?r.max.y:r.min.y,e.z=0<o.normal.z?r.min.z:r.max.z,t.z=0<o.normal.z?r.max.z:r.min.z;var s=o.distanceToPoint(e),d=o.distanceToPoint(t);if(0>s&&0>d)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,r=0;6>r;r++)if(0>t[r].distanceToPoint(e))return!1;return!0}});var Ta={alphamap_fragment:"#ifdef USE_ALPHAMAP\ndiffuseColor.a*=texture2D(alphaMap,vUv).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\nuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\nif(diffuseColor.a<ALPHATEST)discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\nfloat ambientOcclusion=(texture2D(aoMap,vUv2).r-1.0)*aoMapIntensity+1.0;reflectedLight.indirectDiffuse*=ambientOcclusion;\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\nfloat dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.specularRoughness);\n#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\nuniform sampler2D aoMap;uniform float aoMapIntensity;\n#endif\n",begin_vertex:"vec3 transformed=vec3(position);",beginnormal_vertex:"vec3 objectNormal=vec3(normal);",bsdfs:"float punctualLightIntensityToIrradianceFactor(const in float lightDistance,const in float cutoffDistance,const in float decayExponent){if(decayExponent>0.0){\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\nfloat distanceFalloff=1.0/max(pow(lightDistance,decayExponent),0.01);float maxDistanceCutoffFactor=pow2(saturate(1.0-pow4(lightDistance/cutoffDistance)));return distanceFalloff*maxDistanceCutoffFactor;\n#else\nreturn pow(saturate(-lightDistance/cutoffDistance+1.0),decayExponent);\n#endif\n}return 1.0;}vec3 BRDF_Diffuse_Lambert(const in vec3 diffuseColor){return RECIPROCAL_PI*diffuseColor;}vec3 F_Schlick(const in vec3 specularColor,const in float dotLH){float fresnel=exp2((-5.55473*dotLH-6.98316)*dotLH);return(1.0-specularColor)*fresnel+specularColor;}float G_GGX_Smith(const in float alpha,const in float dotNL,const in float dotNV){float a2=pow2(alpha);float gl=dotNL+sqrt(a2+(1.0-a2)*pow2(dotNL));float gv=dotNV+sqrt(a2+(1.0-a2)*pow2(dotNV));return 1.0/(gl*gv);}float G_GGX_SmithCorrelated(const in float alpha,const in float dotNL,const in float dotNV){float a2=pow2(alpha);float gv=dotNL*sqrt(a2+(1.0-a2)*pow2(dotNV));float gl=dotNV*sqrt(a2+(1.0-a2)*pow2(dotNL));return 0.5/max(gv+gl,EPSILON);}float D_GGX(const in float alpha,const in float dotNH){float a2=pow2(alpha);float denom=pow2(dotNH)*(a2-1.0)+1.0;return RECIPROCAL_PI*a2/pow2(denom);}vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight,const in GeometricContext geometry,const in vec3 specularColor,const in float roughness){float alpha=pow2(roughness);vec3 halfDir=normalize(incidentLight.direction+geometry.viewDir);float dotNL=saturate(dot(geometry.normal,incidentLight.direction));float dotNV=saturate(dot(geometry.normal,geometry.viewDir));float dotNH=saturate(dot(geometry.normal,halfDir));float dotLH=saturate(dot(incidentLight.direction,halfDir));vec3 F=F_Schlick(specularColor,dotLH);float G=G_GGX_SmithCorrelated(alpha,dotNL,dotNV);float D=D_GGX(alpha,dotNH);return F*(G*D);}vec2 LTC_Uv(const in vec3 N,const in vec3 V,const in float roughness){const float LUT_SIZE=64.0;const float LUT_SCALE=(LUT_SIZE-1.0)/LUT_SIZE;const float LUT_BIAS=0.5/LUT_SIZE;float dotNV=saturate(dot(N,V));vec2 uv=vec2(roughness,sqrt(1.0-dotNV));uv=uv*LUT_SCALE+LUT_BIAS;return uv;}float LTC_ClippedSphereFormFactor(const in vec3 f){float l=length(f);return max((l*l+f.z)/(l+1.0),0.0);}vec3 LTC_EdgeVectorFormFactor(const in vec3 v1,const in vec3 v2){float x=dot(v1,v2);float y=abs(x);float a=0.8543985+(0.4965155+0.0145206*y)*y;float b=3.4175940+(4.1616724+y)*y;float v=a/b;float theta_sintheta=(x>0.0)? v : 0.5*inversesqrt(max(1.0-x*x,1e-7))-v;return cross(v1,v2)*theta_sintheta;}vec3 LTC_Evaluate(const in vec3 N,const in vec3 V,const in vec3 P,const in mat3 mInv,const in vec3 rectCoords[4]){vec3 v1=rectCoords[1]-rectCoords[0];vec3 v2=rectCoords[3]-rectCoords[0];vec3 lightNormal=cross(v1,v2);if(dot(lightNormal,P-rectCoords[0])<0.0)return vec3(0.0);vec3 T1,T2;T1=normalize(V-N*dot(V,N));T2=-cross(N,T1);mat3 mat=mInv*transposeMat3(mat3(T1,T2,N));vec3 coords[4];coords[0]=mat*(rectCoords[0]-P);coords[1]=mat*(rectCoords[1]-P);coords[2]=mat*(rectCoords[2]-P);coords[3]=mat*(rectCoords[3]-P);coords[0]=normalize(coords[0]);coords[1]=normalize(coords[1]);coords[2]=normalize(coords[2]);coords[3]=normalize(coords[3]);vec3 vectorFormFactor=vec3(0.0);vectorFormFactor+=LTC_EdgeVectorFormFactor(coords[0],coords[1]);vectorFormFactor+=LTC_EdgeVectorFormFactor(coords[1],coords[2]);vectorFormFactor+=LTC_EdgeVectorFormFactor(coords[2],coords[3]);vectorFormFactor+=LTC_EdgeVectorFormFactor(coords[3],coords[0]);float result=LTC_ClippedSphereFormFactor(vectorFormFactor);/*float len=length(vectorFormFactor);float z=vectorFormFactor.z/len;const float LUT_SIZE=64.0;const float LUT_SCALE=(LUT_SIZE-1.0)/LUT_SIZE;const float LUT_BIAS=0.5/LUT_SIZE;vec2 uv=vec2(z*0.5+0.5,len);uv=uv*LUT_SCALE+LUT_BIAS;float scale=texture2D(ltc_2,uv).w;float result=len*scale;*/return vec3(result);}vec3 BRDF_Specular_GGX_Environment(const in GeometricContext geometry,const in vec3 specularColor,const in float roughness){float dotNV=saturate(dot(geometry.normal,geometry.viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}float G_BlinnPhong_Implicit(){return 0.25;}float D_BlinnPhong(const in float shininess,const in float dotNH){return RECIPROCAL_PI*(shininess*0.5+1.0)*pow(dotNH,shininess);}vec3 BRDF_Specular_BlinnPhong(const in IncidentLight incidentLight,const in GeometricContext geometry,const in vec3 specularColor,const in float shininess){vec3 halfDir=normalize(incidentLight.direction+geometry.viewDir);float dotNH=saturate(dot(geometry.normal,halfDir));float dotLH=saturate(dot(incidentLight.direction,halfDir));vec3 F=F_Schlick(specularColor,dotLH);float G=G_BlinnPhong_Implicit();float D=D_BlinnPhong(shininess,dotNH);return F*(G*D);}float GGXRoughnessToBlinnExponent(const in float ggxRoughness){return(2.0/pow2(ggxRoughness+0.0001)-2.0);}float BlinnExponentToGGXRoughness(const in float blinnExponent){return sqrt(2.0/(blinnExponent+2.0));}",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;uniform float bumpScale;vec2 dHdxy_fwd(){vec2 dSTdx=dFdx(vUv);vec2 dSTdy=dFdy(vUv);float Hll=bumpScale*texture2D(bumpMap,vUv).x;float dBx=bumpScale*texture2D(bumpMap,vUv+dSTdx).x-Hll;float dBy=bumpScale*texture2D(bumpMap,vUv+dSTdy).x-Hll;return vec2(dBx,dBy);}vec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy){vec3 vSigmaX=vec3(dFdx(surf_pos.x),dFdx(surf_pos.y),dFdx(surf_pos.z));vec3 vSigmaY=vec3(dFdy(surf_pos.x),dFdy(surf_pos.y),dFdy(surf_pos.z));vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1);vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\nvec4 plane;\n#pragma unroll_loop\nfor(int i=0;i<UNION_CLIPPING_PLANES;i++){plane=clippingPlanes[i];if(dot(vViewPosition,plane.xyz)>plane.w)discard;}\n#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\nbool clipped=true;\n#pragma unroll_loop\nfor(int i=UNION_CLIPPING_PLANES;i<NUM_CLIPPING_PLANES;i++){plane=clippingPlanes[i];clipped=(dot(vViewPosition,plane.xyz)>plane.w)&&clipped;}if(clipped)discard;\n#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n#if ! defined( PHYSICAL ) && ! defined( PHONG )\nvarying vec3 vViewPosition;\n#endif\nuniform vec4 clippingPlanes[NUM_CLIPPING_PLANES];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\nvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\nvViewPosition=-mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\ndiffuseColor.rgb*=vColor;\n#endif\n",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n",color_vertex:"#ifdef USE_COLOR\nvColor.xyz=color.xyz;\n#endif\n",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2(const in float x){return x*x;}float pow3(const in float x){return x*x*x;}float pow4(const in float x){float x2=x*x;return x2*x2;}float average(const in vec3 color){return dot(color,vec3(0.3333));}highp float rand(const in vec2 uv){const highp float a=12.9898,b=78.233,c=43758.5453;highp float dt=dot(uv.xy,vec2(a,b)),sn=mod(dt,PI);return fract(sin(sn)*c);}struct IncidentLight{vec3 color;vec3 direction;bool visible;};struct ReflectedLight{vec3 directDiffuse;vec3 directSpecular;vec3 indirectDiffuse;vec3 indirectSpecular;};struct GeometricContext{vec3 position;vec3 normal;vec3 viewDir;};vec3 transformDirection(in vec3 dir,in mat4 matrix){return normalize((matrix*vec4(dir,0.0)).xyz);}vec3 inverseTransformDirection(in vec3 dir,in mat4 matrix){return normalize((vec4(dir,0.0)*matrix).xyz);}vec3 projectOnPlane(in vec3 point,in vec3 pointOnPlane,in vec3 planeNormal){float distance=dot(planeNormal,point-pointOnPlane);return-distance*planeNormal+point;}float sideOfPlane(in vec3 point,in vec3 pointOnPlane,in vec3 planeNormal){return sign(dot(point-pointOnPlane,planeNormal));}vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/dot(planeNormal,lineDirection))+pointOnLine;}mat3 transposeMat3(const in mat3 m){mat3 tmp;tmp[0]=vec3(m[0].x,m[1].x,m[2].x);tmp[1]=vec3(m[0].y,m[1].y,m[2].y);tmp[2]=vec3(m[0].z,m[1].z,m[2].z);return tmp;}float linearToRelativeLuminance(const in vec3 color){vec3 weights=vec3(0.2126,0.7152,0.0722);return dot(weights,color.rgb);}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction){vec3 absDirection=abs(direction);int face=-1;if(absDirection.x>absDirection.z){if(absDirection.x>absDirection.y)face=direction.x>0.0 ? 0 : 3;elseface=direction.y>0.0 ? 1 : 4;}else{if(absDirection.z>absDirection.y)face=direction.z>0.0 ? 2 : 5;elseface=direction.y>0.0 ? 1 : 4;}return face;}\n#define cubeUV_maxLods1 (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo(vec3 vec,float roughnessLevel,float roughness){float scale=exp2(cubeUV_maxLods1-roughnessLevel);float dxRoughness=dFdx(roughness);float dyRoughness=dFdy(roughness);vec3 dx=dFdx(vec*scale*dxRoughness);vec3 dy=dFdy(vec*scale*dyRoughness);float d=max(dot(dx,dx),dot(dy,dy));d=clamp(d,1.0,cubeUV_rangeClamp);float mipLevel=0.5*log2(d);return vec2(floor(mipLevel),fract(mipLevel));}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction,float roughnessLevel,float mipLevel){mipLevel=roughnessLevel>cubeUV_maxLods2-3.0 ? 0.0 : mipLevel;float a=16.0*cubeUV_rcpTextureSize;vec2 exp2_packed=exp2(vec2(roughnessLevel,mipLevel));vec2 rcp_exp2_packed=vec2(1.0)/exp2_packed;float powScale=exp2_packed.x*exp2_packed.y;float scale=rcp_exp2_packed.x*rcp_exp2_packed.y*0.25;float mipOffset=0.75*(1.0-rcp_exp2_packed.y)*rcp_exp2_packed.x;bool bRes=mipLevel==0.0;scale=bRes&&(scale<a)? a : scale;vec3 r;vec2 offset;int face=getFaceFromDirection(direction);float rcpPowScale=1.0/powScale;if(face==0){r=vec3(direction.x,-direction.z,direction.y);offset=vec2(0.0+mipOffset,0.75*rcpPowScale);offset.y=bRes&&(offset.y<2.0*a)? a : offset.y;}else if(face==1){r=vec3(direction.y,direction.x,direction.z);offset=vec2(scale+mipOffset,0.75*rcpPowScale);offset.y=bRes&&(offset.y<2.0*a)? a : offset.y;}else if(face==2){r=vec3(direction.z,direction.x,direction.y);offset=vec2(2.0*scale+mipOffset,0.75*rcpPowScale);offset.y=bRes&&(offset.y<2.0*a)? a : offset.y;}else if(face==3){r=vec3(direction.x,direction.z,direction.y);offset=vec2(0.0+mipOffset,0.5*rcpPowScale);offset.y=bRes&&(offset.y<2.0*a)? 0.0 : offset.y;}else if(face==4){r=vec3(direction.y,direction.x,-direction.z);offset=vec2(scale+mipOffset,0.5*rcpPowScale);offset.y=bRes&&(offset.y<2.0*a)? 0.0 : offset.y;}else{r=vec3(direction.z,-direction.x,direction.y);offset=vec2(2.0*scale+mipOffset,0.5*rcpPowScale);offset.y=bRes&&(offset.y<2.0*a)? 0.0 : offset.y;}r=normalize(r);float texelOffset=0.5*cubeUV_rcpTextureSize;vec2 s=(r.yz/abs(r.x)+vec2(1.0))*0.5;vec2 base=offset+vec2(texelOffset);return base+s*(scale-2.0*texelOffset);}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection,float roughness){float roughnessVal=roughness*cubeUV_maxLods3;float r1=floor(roughnessVal);float r2=r1+1.0;float t=fract(roughnessVal);vec2 mipInfo=MipLevelInfo(reflectedDirection,r1,roughness);float s=mipInfo.y;float level0=mipInfo.x;float level1=level0+1.0;level1=level1>5.0 ? 5.0 : level1;level0+=min(floor(s+0.5),5.0);vec2 uv_10=getCubeUV(reflectedDirection,r1,level0);vec4 color10=envMapTexelToLinear(texture2D(envMap,uv_10));vec2 uv_20=getCubeUV(reflectedDirection,r2,level0);vec4 color20=envMapTexelToLinear(texture2D(envMap,uv_20));vec4 result=mix(color10,color20,t);return vec4(result.rgb,1.0);}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal=normalMatrix*objectNormal;\n#ifdef FLIP_SIDED\ntransformedNormal=-transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\nuniform sampler2D displacementMap;uniform float displacementScale;uniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\ntransformed+=normalize(objectNormal)*(texture2D(displacementMap,uv).x*displacementScale+displacementBias);\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\nvec4 emissiveColor=texture2D(emissiveMap,vUv);emissiveColor.rgb=emissiveMapTexelToLinear(emissiveColor).rgb;totalEmissiveRadiance*=emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\nuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"gl_FragColor=linearToOutputTexel(gl_FragColor);",encodings_pars_fragment:"vec4 LinearToLinear(in vec4 value){return value;}vec4 GammaToLinear(in vec4 value,in float gammaFactor){return vec4(pow(value.xyz,vec3(gammaFactor)),value.w);}vec4 LinearToGamma(in vec4 value,in float gammaFactor){return vec4(pow(value.xyz,vec3(1.0/gammaFactor)),value.w);}vec4 sRGBToLinear(in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.w);}vec4 LinearTosRGB(in vec4 value){return vec4(mix(pow(value.rgb,vec3(0.41666))*1.055-vec3(0.055),value.rgb*12.92,vec3(lessThanEqual(value.rgb,vec3(0.0031308)))),value.w);}vec4 RGBEToLinear(in vec4 value){return vec4(value.rgb*exp2(value.a*255.0-128.0),1.0);}vec4 LinearToRGBE(in vec4 value){float maxComponent=max(max(value.r,value.g),value.b);float fExp=clamp(ceil(log2(maxComponent)),-128.0,127.0);return vec4(value.rgb/exp2(fExp),(fExp+128.0)/255.0);}vec4 RGBMToLinear(in vec4 value,in float maxRange){return vec4(value.xyz*value.w*maxRange,1.0);}vec4 LinearToRGBM(in vec4 value,in float maxRange){float maxRGB=max(value.x,max(value.g,value.b));float M=clamp(maxRGB/maxRange,0.0,1.0);M=ceil(M*255.0)/255.0;return vec4(value.rgb/(M*maxRange),M);}vec4 RGBDToLinear(in vec4 value,in float maxRange){return vec4(value.rgb*((maxRange/255.0)/value.a),1.0);}vec4 LinearToRGBD(in vec4 value,in float maxRange){float maxRGB=max(value.x,max(value.g,value.b));float D=max(maxRange/maxRGB,1.0);D=min(floor(D)/255.0,1.0);return vec4(value.rgb*(D*(255.0/maxRange)),D);}const mat3 cLogLuvM=mat3(0.2209,0.3390,0.4184,0.1138,0.6780,0.7319,0.0102,0.1130,0.2969);vec4 LinearToLogLuv(in vec4 value){vec3 Xp_Y_XYZp=value.rgb*cLogLuvM;Xp_Y_XYZp=max(Xp_Y_XYZp,vec3(1e-6,1e-6,1e-6));vec4 vResult;vResult.xy=Xp_Y_XYZp.xy/Xp_Y_XYZp.z;float Le=2.0*log2(Xp_Y_XYZp.y)+127.0;vResult.w=fract(Le);vResult.z=(Le-(floor(vResult.w*255.0))/255.0)/255.0;return vResult;}const mat3 cLogLuvInverseM=mat3(6.0014,-2.7008,-1.7996,-1.3320,3.1029,-5.7721,0.3008,-1.0882,5.6268);vec4 LogLuvToLinear(in vec4 value){float Le=value.z*255.0+value.w;vec3 Xp_Y_XYZp;Xp_Y_XYZp.y=exp2((Le-127.0)/2.0);Xp_Y_XYZp.z=Xp_Y_XYZp.y/value.y;Xp_Y_XYZp.x=value.x*Xp_Y_XYZp.z;vec3 vRGB=Xp_Y_XYZp.rgb*cLogLuvInverseM;return vec4(max(vRGB,0.0),1.0);}",envmap_fragment:"#ifdef USE_ENVMAP\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\nvec3 cameraToVertex=normalize(vWorldPosition-cameraPosition);vec3 worldNormal=inverseTransformDirection(normal,viewMatrix);\n#ifdef ENVMAP_MODE_REFLECTION\nvec3 reflectVec=reflect(cameraToVertex,worldNormal);\n#else\nvec3 reflectVec=refract(cameraToVertex,worldNormal,refractionRatio);\n#endif\n#else\nvec3 reflectVec=vReflect;\n#endif\n#ifdef ENVMAP_TYPE_CUBE\nvec4 envColor=textureCube(envMap,vec3(flipEnvMap*reflectVec.x,reflectVec.yz));\n#elif defined( ENVMAP_TYPE_EQUIREC )\nvec2 sampleUV;reflectVec=normalize(reflectVec);sampleUV.y=asin(clamp(reflectVec.y,-1.0,1.0))*RECIPROCAL_PI+0.5;sampleUV.x=atan(reflectVec.z,reflectVec.x)*RECIPROCAL_PI2+0.5;vec4 envColor=texture2D(envMap,sampleUV);\n#elif defined( ENVMAP_TYPE_SPHERE )\nreflectVec=normalize(reflectVec);vec3 reflectView=normalize((viewMatrix*vec4(reflectVec,0.0)).xyz+vec3(0.0,0.0,1.0));vec4 envColor=texture2D(envMap,reflectView.xy*0.5+0.5);\n#else\nvec4 envColor=vec4(0.0);\n#endif\nenvColor=envMapTexelToLinear(envColor);\n#ifdef ENVMAP_BLENDING_MULTIPLY\noutgoingLight=mix(outgoingLight,outgoingLight*envColor.xyz,specularStrength*reflectivity);\n#elif defined( ENVMAP_BLENDING_MIX )\noutgoingLight=mix(outgoingLight,envColor.xyz,specularStrength*reflectivity);\n#elif defined( ENVMAP_BLENDING_ADD )\noutgoingLight+=envColor.xyz*specularStrength*reflectivity;\n#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\nuniform float reflectivity;uniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\nvarying vec3 vWorldPosition;\n#endif\n#ifdef ENVMAP_TYPE_CUBE\nuniform samplerCube envMap;\n#else\nuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;uniform int maxMipLevel;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\nuniform float refractionRatio;\n#else\nvarying vec3 vReflect;\n#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\nvarying vec3 vWorldPosition;\n#else\nvarying vec3 vReflect;uniform float refractionRatio;\n#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\nvWorldPosition=worldPosition.xyz;\n#else\nvec3 cameraToVertex=normalize(worldPosition.xyz-cameraPosition);vec3 worldNormal=inverseTransformDirection(transformedNormal,viewMatrix);\n#ifdef ENVMAP_MODE_REFLECTION\nvReflect=reflect(cameraToVertex,worldNormal);\n#else\nvReflect=refract(cameraToVertex,worldNormal,refractionRatio);\n#endif\n#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth=-mvPosition.z;\n#endif\n",fog_pars_vertex:"#ifdef USE_FOG\nvarying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n#ifdef FOG_EXP2\nfloat fogFactor=whiteCompliment(exp2(-fogDensity*fogDensity*fogDepth*fogDepth*LOG2));\n#else\nfloat fogFactor=smoothstep(fogNear,fogFar,fogDepth);\n#endif\ngl_FragColor.rgb=mix(gl_FragColor.rgb,fogColor,fogFactor);\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;varying float fogDepth;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;uniform float fogFar;\n#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\nuniform sampler2D gradientMap;vec3 getGradientIrradiance(vec3 normal,vec3 lightDirection){float dotNL=dot(normal,lightDirection);vec2 coord=vec2(dotNL*0.5+0.5,0.0);\n#ifdef USE_GRADIENTMAP\nreturn texture2D(gradientMap,coord).rgb;\n#else\nreturn(coord.x<0.7)? vec3(0.7): vec3(1.0);\n#endif\n}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\nreflectedLight.indirectDiffuse+=PI*texture2D(lightMap,vUv2).xyz*lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nuniform sampler2D lightMap;uniform float lightMapIntensity;\n#endif\n",lights_lambert_vertex:"vec3 diffuse=vec3(1.0);GeometricContext geometry;geometry.position=mvPosition.xyz;geometry.normal=normalize(transformedNormal);geometry.viewDir=normalize(-mvPosition.xyz);GeometricContext backGeometry;backGeometry.position=geometry.position;backGeometry.normal=-geometry.normal;backGeometry.viewDir=geometry.viewDir;vLightFront=vec3(0.0);\n#ifdef DOUBLE_SIDED\nvLightBack=vec3(0.0);\n#endif\nIncidentLight directLight;float dotNL;vec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n#pragma unroll_loop\nfor(int i=0;i<NUM_POINT_LIGHTS;i++){getPointDirectLightIrradiance(pointLights[i],geometry,directLight);dotNL=dot(geometry.normal,directLight.direction);directLightColor_Diffuse=PI*directLight.color;vLightFront+=saturate(dotNL)*directLightColor_Diffuse;\n#ifdef DOUBLE_SIDED\nvLightBack+=saturate(-dotNL)*directLightColor_Diffuse;\n#endif\n}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n#pragma unroll_loop\nfor(int i=0;i<NUM_SPOT_LIGHTS;i++){getSpotDirectLightIrradiance(spotLights[i],geometry,directLight);dotNL=dot(geometry.normal,directLight.direction);directLightColor_Diffuse=PI*directLight.color;vLightFront+=saturate(dotNL)*directLightColor_Diffuse;\n#ifdef DOUBLE_SIDED\nvLightBack+=saturate(-dotNL)*directLightColor_Diffuse;\n#endif\n}\n#endif\n/*\n#if NUM_RECT_AREA_LIGHTS > 0\nfor(int i=0;i<NUM_RECT_AREA_LIGHTS;i++){}\n#endif\n*/\n#if NUM_DIR_LIGHTS > 0\n#pragma unroll_loop\nfor(int i=0;i<NUM_DIR_LIGHTS;i++){getDirectionalDirectLightIrradiance(directionalLights[i],geometry,directLight);dotNL=dot(geometry.normal,directLight.direction);directLightColor_Diffuse=PI*directLight.color;vLightFront+=saturate(dotNL)*directLightColor_Diffuse;\n#ifdef DOUBLE_SIDED\nvLightBack+=saturate(-dotNL)*directLightColor_Diffuse;\n#endif\n}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n#pragma unroll_loop\nfor(int i=0;i<NUM_HEMI_LIGHTS;i++){vLightFront+=getHemisphereLightIrradiance(hemisphereLights[i],geometry);\n#ifdef DOUBLE_SIDED\nvLightBack+=getHemisphereLightIrradiance(hemisphereLights[i],backGeometry);\n#endif\n}\n#endif\n",lights_pars_begin:"uniform vec3 ambientLightColor;vec3 getAmbientLightIrradiance(const in vec3 ambientLightColor){vec3 irradiance=ambientLightColor;\n#ifndef PHYSICALLY_CORRECT_LIGHTS\nirradiance*=PI;\n#endif\nreturn irradiance;}\n#if NUM_DIR_LIGHTS > 0\nstruct DirectionalLight{vec3 direction;vec3 color;int shadow;float shadowBias;float shadowRadius;vec2 shadowMapSize;};uniform DirectionalLight directionalLights[NUM_DIR_LIGHTS];void getDirectionalDirectLightIrradiance(const in DirectionalLight directionalLight,const in GeometricContext geometry,out IncidentLight directLight){directLight.color=directionalLight.color;directLight.direction=directionalLight.direction;directLight.visible=true;}\n#endif\n#if NUM_POINT_LIGHTS > 0\nstruct PointLight{vec3 position;vec3 color;float distance;float decay;int shadow;float shadowBias;float shadowRadius;vec2 shadowMapSize;float shadowCameraNear;float shadowCameraFar;};uniform PointLight pointLights[NUM_POINT_LIGHTS];void getPointDirectLightIrradiance(const in PointLight pointLight,const in GeometricContext geometry,out IncidentLight directLight){vec3 lVector=pointLight.position-geometry.position;directLight.direction=normalize(lVector);float lightDistance=length(lVector);directLight.color=pointLight.color;directLight.color*=punctualLightIntensityToIrradianceFactor(lightDistance,pointLight.distance,pointLight.decay);directLight.visible=(directLight.color!=vec3(0.0));}\n#endif\n#if NUM_SPOT_LIGHTS > 0\nstruct SpotLight{vec3 position;vec3 direction;vec3 color;float distance;float decay;float coneCos;float penumbraCos;int shadow;float shadowBias;float shadowRadius;vec2 shadowMapSize;};uniform SpotLight spotLights[NUM_SPOT_LIGHTS];void getSpotDirectLightIrradiance(const in SpotLight spotLight,const in GeometricContext geometry,out IncidentLight directLight){vec3 lVector=spotLight.position-geometry.position;directLight.direction=normalize(lVector);float lightDistance=length(lVector);float angleCos=dot(directLight.direction,spotLight.direction);if(angleCos>spotLight.coneCos){float spotEffect=smoothstep(spotLight.coneCos,spotLight.penumbraCos,angleCos);directLight.color=spotLight.color;directLight.color*=spotEffect*punctualLightIntensityToIrradianceFactor(lightDistance,spotLight.distance,spotLight.decay);directLight.visible=true;}else{directLight.color=vec3(0.0);directLight.visible=false;}}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\nstruct RectAreaLight{vec3 color;vec3 position;vec3 halfWidth;vec3 halfHeight;};uniform sampler2D ltc_1;uniform sampler2D ltc_2;uniform RectAreaLight rectAreaLights[NUM_RECT_AREA_LIGHTS];\n#endif\n#if NUM_HEMI_LIGHTS > 0\nstruct HemisphereLight{vec3 direction;vec3 skyColor;vec3 groundColor;};uniform HemisphereLight hemisphereLights[NUM_HEMI_LIGHTS];vec3 getHemisphereLightIrradiance(const in HemisphereLight hemiLight,const in GeometricContext geometry){float dotNL=dot(geometry.normal,hemiLight.direction);float hemiDiffuseWeight=0.5*dotNL+0.5;vec3 irradiance=mix(hemiLight.groundColor,hemiLight.skyColor,hemiDiffuseWeight);\n#ifndef PHYSICALLY_CORRECT_LIGHTS\nirradiance*=PI;\n#endif\nreturn irradiance;}\n#endif\n",lights_pars_maps:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\nvec3 getLightProbeIndirectIrradiance(const in GeometricContext geometry,const in int maxMIPLevel){vec3 worldNormal=inverseTransformDirection(geometry.normal,viewMatrix);\n#ifdef ENVMAP_TYPE_CUBE\nvec3 queryVec=vec3(flipEnvMap*worldNormal.x,worldNormal.yz);\n#ifdef TEXTURE_LOD_EXT\nvec4 envMapColor=textureCubeLodEXT(envMap,queryVec,float(maxMIPLevel));\n#else\nvec4 envMapColor=textureCube(envMap,queryVec,float(maxMIPLevel));\n#endif\nenvMapColor.rgb=envMapTexelToLinear(envMapColor).rgb;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\nvec3 queryVec=vec3(flipEnvMap*worldNormal.x,worldNormal.yz);vec4 envMapColor=textureCubeUV(queryVec,1.0);\n#else\nvec4 envMapColor=vec4(0.0);\n#endif\nreturn PI*envMapColor.rgb*envMapIntensity;}float getSpecularMIPLevel(const in float blinnShininessExponent,const in int maxMIPLevel){float maxMIPLevelScalar=float(maxMIPLevel);float desiredMIPLevel=maxMIPLevelScalar+0.79248-0.5*log2(pow2(blinnShininessExponent)+1.0);return clamp(desiredMIPLevel,0.0,maxMIPLevelScalar);}vec3 getLightProbeIndirectRadiance(const in GeometricContext geometry,const in float blinnShininessExponent,const in int maxMIPLevel){\n#ifdef ENVMAP_MODE_REFLECTION\nvec3 reflectVec=reflect(-geometry.viewDir,geometry.normal);\n#else\nvec3 reflectVec=refract(-geometry.viewDir,geometry.normal,refractionRatio);\n#endif\nreflectVec=inverseTransformDirection(reflectVec,viewMatrix);float specularMIPLevel=getSpecularMIPLevel(blinnShininessExponent,maxMIPLevel);\n#ifdef ENVMAP_TYPE_CUBE\nvec3 queryReflectVec=vec3(flipEnvMap*reflectVec.x,reflectVec.yz);\n#ifdef TEXTURE_LOD_EXT\nvec4 envMapColor=textureCubeLodEXT(envMap,queryReflectVec,specularMIPLevel);\n#else\nvec4 envMapColor=textureCube(envMap,queryReflectVec,specularMIPLevel);\n#endif\nenvMapColor.rgb=envMapTexelToLinear(envMapColor).rgb;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\nvec3 queryReflectVec=vec3(flipEnvMap*reflectVec.x,reflectVec.yz);vec4 envMapColor=textureCubeUV(queryReflectVec,BlinnExponentToGGXRoughness(blinnShininessExponent));\n#elif defined( ENVMAP_TYPE_EQUIREC )\nvec2 sampleUV;sampleUV.y=asin(clamp(reflectVec.y,-1.0,1.0))*RECIPROCAL_PI+0.5;sampleUV.x=atan(reflectVec.z,reflectVec.x)*RECIPROCAL_PI2+0.5;\n#ifdef TEXTURE_LOD_EXT\nvec4 envMapColor=texture2DLodEXT(envMap,sampleUV,specularMIPLevel);\n#else\nvec4 envMapColor=texture2D(envMap,sampleUV,specularMIPLevel);\n#endif\nenvMapColor.rgb=envMapTexelToLinear(envMapColor).rgb;\n#elif defined( ENVMAP_TYPE_SPHERE )\nvec3 reflectView=normalize((viewMatrix*vec4(reflectVec,0.0)).xyz+vec3(0.0,0.0,1.0));\n#ifdef TEXTURE_LOD_EXT\nvec4 envMapColor=texture2DLodEXT(envMap,reflectView.xy*0.5+0.5,specularMIPLevel);\n#else\nvec4 envMapColor=texture2D(envMap,reflectView.xy*0.5+0.5,specularMIPLevel);\n#endif\nenvMapColor.rgb=envMapTexelToLinear(envMapColor).rgb;\n#endif\nreturn envMapColor.rgb*envMapIntensity;}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;material.diffuseColor=diffuseColor.rgb;material.specularColor=specular;material.specularShininess=shininess;material.specularStrength=specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial{vec3 diffuseColor;vec3 specularColor;float specularShininess;float specularStrength;};void RE_Direct_BlinnPhong(const in IncidentLight directLight,const in GeometricContext geometry,const in BlinnPhongMaterial material,inout ReflectedLight reflectedLight){\n#ifdef TOON\nvec3 irradiance=getGradientIrradiance(geometry.normal,directLight.direction)*directLight.color;\n#else\nfloat dotNL=saturate(dot(geometry.normal,directLight.direction));vec3 irradiance=dotNL*directLight.color;\n#endif\n#ifndef PHYSICALLY_CORRECT_LIGHTS\nirradiance*=PI;\n#endif\nreflectedLight.directDiffuse+=irradiance*BRDF_Diffuse_Lambert(material.diffuseColor);reflectedLight.directSpecular+=irradiance*BRDF_Specular_BlinnPhong(directLight,geometry,material.specularColor,material.specularShininess)*material.specularStrength;}void RE_IndirectDiffuse_BlinnPhong(const in vec3 irradiance,const in GeometricContext geometry,const in BlinnPhongMaterial material,inout ReflectedLight reflectedLight){reflectedLight.indirectDiffuse+=irradiance*BRDF_Diffuse_Lambert(material.diffuseColor);}\n#define RE_Direct RE_Direct_BlinnPhong\n#define RE_IndirectDiffuse RE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material ) (0)\n",lights_physical_fragment:"PhysicalMaterial material;material.diffuseColor=diffuseColor.rgb*(1.0-metalnessFactor);material.specularRoughness=clamp(roughnessFactor,0.04,1.0);\n#ifdef STANDARD\nmaterial.specularColor=mix(vec3(DEFAULT_SPECULAR_COEFFICIENT),diffuseColor.rgb,metalnessFactor);\n#else\nmaterial.specularColor=mix(vec3(MAXIMUM_SPECULAR_COEFFICIENT*pow2(reflectivity)),diffuseColor.rgb,metalnessFactor);material.clearCoat=saturate(clearCoat);material.clearCoatRoughness=clamp(clearCoatRoughness,0.04,1.0);\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial{vec3 diffuseColor;float specularRoughness;vec3 specularColor;\n#ifndef STANDARD\nfloat clearCoat;float clearCoatRoughness;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox(const in float roughness,const in float dotNL){return DEFAULT_SPECULAR_COEFFICIENT+(1.0-DEFAULT_SPECULAR_COEFFICIENT)*(pow(1.0-dotNL,5.0)*pow(1.0-roughness,2.0));}\n#if NUM_RECT_AREA_LIGHTS > 0\nvoid RE_Direct_RectArea_Physical(const in RectAreaLight rectAreaLight,const in GeometricContext geometry,const in PhysicalMaterial material,inout ReflectedLight reflectedLight){vec3 normal=geometry.normal;vec3 viewDir=geometry.viewDir;vec3 position=geometry.position;vec3 lightPos=rectAreaLight.position;vec3 halfWidth=rectAreaLight.halfWidth;vec3 halfHeight=rectAreaLight.halfHeight;vec3 lightColor=rectAreaLight.color;float roughness=material.specularRoughness;vec3 rectCoords[4];rectCoords[0]=lightPos-halfWidth-halfHeight;rectCoords[1]=lightPos+halfWidth-halfHeight;rectCoords[2]=lightPos+halfWidth+halfHeight;rectCoords[3]=lightPos-halfWidth+halfHeight;vec2 uv=LTC_Uv(normal,viewDir,roughness);vec4 t1=texture2D(ltc_1,uv);vec4 t2=texture2D(ltc_2,uv);mat3 mInv=mat3(vec3(t1.x,0,t1.y),vec3(0,1,0),vec3(t1.z,0,t1.w));vec3 fresnel=(material.specularColor*t2.x+(vec3(1.0)-material.specularColor)*t2.y);reflectedLight.directSpecular+=lightColor*fresnel*LTC_Evaluate(normal,viewDir,position,mInv,rectCoords);reflectedLight.directDiffuse+=lightColor*material.diffuseColor*LTC_Evaluate(normal,viewDir,position,mat3(1.0),rectCoords);}\n#endif\nvoid RE_Direct_Physical(const in IncidentLight directLight,const in GeometricContext geometry,const in PhysicalMaterial material,inout ReflectedLight reflectedLight){float dotNL=saturate(dot(geometry.normal,directLight.direction));vec3 irradiance=dotNL*directLight.color;\n#ifndef PHYSICALLY_CORRECT_LIGHTS\nirradiance*=PI;\n#endif\n#ifndef STANDARD\nfloat clearCoatDHR=material.clearCoat*clearCoatDHRApprox(material.clearCoatRoughness,dotNL);\n#else\nfloat clearCoatDHR=0.0;\n#endif\nreflectedLight.directSpecular+=(1.0-clearCoatDHR)*irradiance*BRDF_Specular_GGX(directLight,geometry,material.specularColor,material.specularRoughness);reflectedLight.directDiffuse+=(1.0-clearCoatDHR)*irradiance*BRDF_Diffuse_Lambert(material.diffuseColor);\n#ifndef STANDARD\nreflectedLight.directSpecular+=irradiance*material.clearCoat*BRDF_Specular_GGX(directLight,geometry,vec3(DEFAULT_SPECULAR_COEFFICIENT),material.clearCoatRoughness);\n#endif\n}void RE_IndirectDiffuse_Physical(const in vec3 irradiance,const in GeometricContext geometry,const in PhysicalMaterial material,inout ReflectedLight reflectedLight){reflectedLight.indirectDiffuse+=irradiance*BRDF_Diffuse_Lambert(material.diffuseColor);}void RE_IndirectSpecular_Physical(const in vec3 radiance,const in vec3 clearCoatRadiance,const in GeometricContext geometry,const in PhysicalMaterial material,inout ReflectedLight reflectedLight){\n#ifndef STANDARD\nfloat dotNV=saturate(dot(geometry.normal,geometry.viewDir));float dotNL=dotNV;float clearCoatDHR=material.clearCoat*clearCoatDHRApprox(material.clearCoatRoughness,dotNL);\n#else\nfloat clearCoatDHR=0.0;\n#endif\nreflectedLight.indirectSpecular+=(1.0-clearCoatDHR)*radiance*BRDF_Specular_GGX_Environment(geometry,material.specularColor,material.specularRoughness);\n#ifndef STANDARD\nreflectedLight.indirectSpecular+=clearCoatRadiance*material.clearCoat*BRDF_Specular_GGX_Environment(geometry,vec3(DEFAULT_SPECULAR_COEFFICIENT),material.clearCoatRoughness);\n#endif\n}\n#define RE_Direct RE_Direct_Physical\n#define RE_Direct_RectArea RE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse RE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular RE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material ) GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material ) GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion(const in float dotNV,const in float ambientOcclusion,const in float roughness){return saturate(pow(dotNV+ambientOcclusion,exp2(-16.0*roughness-1.0))-1.0+ambientOcclusion);}",lights_fragment_begin:"/***This is a template that can be used to light a material,it uses pluggable*RenderEquations(RE)for specific lighting scenarios.**Instructions for use:*-Ensure that both RE_Direct,RE_IndirectDiffuse and RE_IndirectSpecular are defined*-If you have defined an RE_IndirectSpecular,you need to also provide a Material_LightProbeLOD.<----???*-Create a material parameter that is to be passed as the third parameter to your lighting functions.**TODO:*-Add area light support.*-Add sphere light support.*-Add diffuse light probe(irradiance cubemap)support.*/GeometricContext geometry;geometry.position=-vViewPosition;geometry.normal=normal;geometry.viewDir=normalize(vViewPosition);IncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\nPointLight pointLight;\n#pragma unroll_loop\nfor(int i=0;i<NUM_POINT_LIGHTS;i++){pointLight=pointLights[i];getPointDirectLightIrradiance(pointLight,geometry,directLight);\n#ifdef USE_SHADOWMAP\ndirectLight.color*=all(bvec2(pointLight.shadow,directLight.visible))? getPointShadow(pointShadowMap[i],pointLight.shadowMapSize,pointLight.shadowBias,pointLight.shadowRadius,vPointShadowCoord[i],pointLight.shadowCameraNear,pointLight.shadowCameraFar): 1.0;\n#endif\nRE_Direct(directLight,geometry,material,reflectedLight);}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\nSpotLight spotLight;\n#pragma unroll_loop\nfor(int i=0;i<NUM_SPOT_LIGHTS;i++){spotLight=spotLights[i];getSpotDirectLightIrradiance(spotLight,geometry,directLight);\n#ifdef USE_SHADOWMAP\ndirectLight.color*=all(bvec2(spotLight.shadow,directLight.visible))? getShadow(spotShadowMap[i],spotLight.shadowMapSize,spotLight.shadowBias,spotLight.shadowRadius,vSpotShadowCoord[i]): 1.0;\n#endif\nRE_Direct(directLight,geometry,material,reflectedLight);}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\nDirectionalLight directionalLight;\n#pragma unroll_loop\nfor(int i=0;i<NUM_DIR_LIGHTS;i++){directionalLight=directionalLights[i];getDirectionalDirectLightIrradiance(directionalLight,geometry,directLight);\n#ifdef USE_SHADOWMAP\ndirectLight.color*=all(bvec2(directionalLight.shadow,directLight.visible))? getShadow(directionalShadowMap[i],directionalLight.shadowMapSize,directionalLight.shadowBias,directionalLight.shadowRadius,vDirectionalShadowCoord[i]): 1.0;\n#endif\nRE_Direct(directLight,geometry,material,reflectedLight);}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\nRectAreaLight rectAreaLight;\n#pragma unroll_loop\nfor(int i=0;i<NUM_RECT_AREA_LIGHTS;i++){rectAreaLight=rectAreaLights[i];RE_Direct_RectArea(rectAreaLight,geometry,material,reflectedLight);}\n#endif\n#if defined( RE_IndirectDiffuse )\nvec3 irradiance=getAmbientLightIrradiance(ambientLightColor);\n#if ( NUM_HEMI_LIGHTS > 0 )\n#pragma unroll_loop\nfor(int i=0;i<NUM_HEMI_LIGHTS;i++){irradiance+=getHemisphereLightIrradiance(hemisphereLights[i],geometry);}\n#endif\n#endif\n#if defined( RE_IndirectSpecular )\nvec3 radiance=vec3(0.0);vec3 clearCoatRadiance=vec3(0.0);\n#endif\n",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n#ifdef USE_LIGHTMAP\nvec3 lightMapIrradiance=texture2D(lightMap,vUv2).xyz*lightMapIntensity;\n#ifndef PHYSICALLY_CORRECT_LIGHTS\nlightMapIrradiance*=PI;\n#endif\nirradiance+=lightMapIrradiance;\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\nirradiance+=getLightProbeIndirectIrradiance(geometry,maxMipLevel);\n#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\nradiance+=getLightProbeIndirectRadiance(geometry,Material_BlinnShininessExponent(material),maxMipLevel);\n#ifndef STANDARD\nclearCoatRadiance+=getLightProbeIndirectRadiance(geometry,Material_ClearCoat_BlinnShininessExponent(material),maxMipLevel);\n#endif\n#endif\n",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\nRE_IndirectDiffuse(irradiance,geometry,material,reflectedLight);\n#endif\n#if defined( RE_IndirectSpecular )\nRE_IndirectSpecular(radiance,clearCoatRadiance,geometry,material,reflectedLight);\n#endif\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\ngl_FragDepthEXT=log2(vFragDepth)*logDepthBufFC*0.5;\n#endif\n",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\nuniform float logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\nvarying float vFragDepth;\n#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n#ifdef USE_LOGDEPTHBUF_EXT\nvarying float vFragDepth;\n#endif\nuniform float logDepthBufFC;\n#endif\n",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n#ifdef USE_LOGDEPTHBUF_EXT\nvFragDepth=1.0+gl_Position.w;\n#else\ngl_Position.z=log2(max(EPSILON,gl_Position.w+1.0))*logDepthBufFC-1.0;gl_Position.z*=gl_Position.w;\n#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\nvec4 texelColor=texture2D(map,vUv);texelColor=mapTexelToLinear(texelColor);diffuseColor*=texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\nvec2 uv=(uvTransform*vec3(gl_PointCoord.x,1.0-gl_PointCoord.y,1)).xy;vec4 mapTexel=texture2D(map,uv);diffuseColor*=mapTexelToLinear(mapTexel);\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform mat3 uvTransform;uniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor=metalness;\n#ifdef USE_METALNESSMAP\nvec4 texelMetalness=texture2D(metalnessMap,vUv);metalnessFactor*=texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\nuniform sampler2D metalnessMap;\n#endif\n",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\nobjectNormal+=(morphNormal0-normal)*morphTargetInfluences[0];objectNormal+=(morphNormal1-normal)*morphTargetInfluences[1];objectNormal+=(morphNormal2-normal)*morphTargetInfluences[2];objectNormal+=(morphNormal3-normal)*morphTargetInfluences[3];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[8];\n#else\nuniform float morphTargetInfluences[4];\n#endif\n#endif\n",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\ntransformed+=(morphTarget0-position)*morphTargetInfluences[0];transformed+=(morphTarget1-position)*morphTargetInfluences[1];transformed+=(morphTarget2-position)*morphTargetInfluences[2];transformed+=(morphTarget3-position)*morphTargetInfluences[3];\n#ifndef USE_MORPHNORMALS\ntransformed+=(morphTarget4-position)*morphTargetInfluences[4];transformed+=(morphTarget5-position)*morphTargetInfluences[5];transformed+=(morphTarget6-position)*morphTargetInfluences[6];transformed+=(morphTarget7-position)*morphTargetInfluences[7];\n#endif\n#endif\n",normal_fragment_begin:"#ifdef FLAT_SHADED\nvec3 fdx=vec3(dFdx(vViewPosition.x),dFdx(vViewPosition.y),dFdx(vViewPosition.z));vec3 fdy=vec3(dFdy(vViewPosition.x),dFdy(vViewPosition.y),dFdy(vViewPosition.z));vec3 normal=normalize(cross(fdx,fdy));\n#else\nvec3 normal=normalize(vNormal);\n#ifdef DOUBLE_SIDED\nnormal=normal*(float(gl_FrontFacing)*2.0-1.0);\n#endif\n#endif\n",normal_fragment_maps:"#ifdef USE_NORMALMAP\nnormal=perturbNormal2Arb(-vViewPosition,normal);\n#elif defined( USE_BUMPMAP )\nnormal=perturbNormalArb(-vViewPosition,normal,dHdxy_fwd());\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\nuniform sampler2D normalMap;uniform vec2 normalScale;vec3 perturbNormal2Arb(vec3 eye_pos,vec3 surf_norm){vec3 q0=vec3(dFdx(eye_pos.x),dFdx(eye_pos.y),dFdx(eye_pos.z));vec3 q1=vec3(dFdy(eye_pos.x),dFdy(eye_pos.y),dFdy(eye_pos.z));vec2 st0=dFdx(vUv.st);vec2 st1=dFdy(vUv.st);float scale=sign(st1.t*st0.s-st0.t*st1.s);scale*=float(gl_FrontFacing)*2.0-1.0;vec3 S=normalize((q0*st1.t-q1*st0.t)*scale);vec3 T=normalize((-q0*st1.s+q1*st0.s)*scale);vec3 N=normalize(surf_norm);vec3 mapN=texture2D(normalMap,vUv).xyz*2.0-1.0;mapN.xy=normalScale*mapN.xy;mat3 tsn=mat3(S,T,N);return normalize(tsn*mapN);}\n#endif\n",packing:"vec3 packNormalToRGB(const in vec3 normal){return normalize(normal)*0.5+0.5;}vec3 unpackRGBToNormal(const in vec3 rgb){return 2.0*rgb.xyz-1.0;}const float PackUpscale=256./255.;const float UnpackDownscale=255./256.;const vec3 PackFactors=vec3(256.*256.*256.,256.*256.,256.);const vec4 UnpackFactors=UnpackDownscale/vec4(PackFactors,1.);const float ShiftRight8=1./256.;vec4 packDepthToRGBA(const in float v){vec4 r=vec4(fract(v*PackFactors),v);r.yzw-=r.xyz*ShiftRight8;return r*PackUpscale;}float unpackRGBAToDepth(const in vec4 v){return dot(v,UnpackFactors);}float viewZToOrthographicDepth(const in float viewZ,const in float near,const in float far){return(viewZ+near)/(near-far);}float orthographicDepthToViewZ(const in float linearClipZ,const in float near,const in float far){return linearClipZ*(near-far)-near;}float viewZToPerspectiveDepth(const in float viewZ,const in float near,const in float far){return((near+viewZ)*far)/((far-near)*viewZ);}float perspectiveDepthToViewZ(const in float invClipZ,const in float near,const in float far){return(near*far)/((far-near)*invClipZ-far);}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\ngl_FragColor.rgb*=gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition=modelViewMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*mvPosition;",dithering_fragment:"#if defined( DITHERING )\ngl_FragColor.rgb=dithering(gl_FragColor.rgb);\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\nvec3 dithering(vec3 color){float grid_position=rand(gl_FragCoord.xy);vec3 dither_shift_RGB=vec3(0.25/255.0,-0.25/255.0,0.25/255.0);dither_shift_RGB=mix(2.0*dither_shift_RGB,-2.0*dither_shift_RGB,grid_position);return color+dither_shift_RGB;}\n#endif\n",roughnessmap_fragment:"float roughnessFactor=roughness;\n#ifdef USE_ROUGHNESSMAP\nvec4 texelRoughness=texture2D(roughnessMap,vUv);roughnessFactor*=texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\nuniform sampler2D roughnessMap;\n#endif\n",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n#if NUM_DIR_LIGHTS > 0\nuniform sampler2D directionalShadowMap[NUM_DIR_LIGHTS];varying vec4 vDirectionalShadowCoord[NUM_DIR_LIGHTS];\n#endif\n#if NUM_SPOT_LIGHTS > 0\nuniform sampler2D spotShadowMap[NUM_SPOT_LIGHTS];varying vec4 vSpotShadowCoord[NUM_SPOT_LIGHTS];\n#endif\n#if NUM_POINT_LIGHTS > 0\nuniform sampler2D pointShadowMap[NUM_POINT_LIGHTS];varying vec4 vPointShadowCoord[NUM_POINT_LIGHTS];\n#endif\n/*\n#if NUM_RECT_AREA_LIGHTS > 0\n#endif\n*/float texture2DCompare(sampler2D depths,vec2 uv,float compare){return step(compare,unpackRGBAToDepth(texture2D(depths,uv)));}float texture2DShadowLerp(sampler2D depths,vec2 size,vec2 uv,float compare){const vec2 offset=vec2(0.0,1.0);vec2 texelSize=vec2(1.0)/size;vec2 centroidUV=floor(uv*size+0.5)/size;float lb=texture2DCompare(depths,centroidUV+texelSize*offset.xx,compare);float lt=texture2DCompare(depths,centroidUV+texelSize*offset.xy,compare);float rb=texture2DCompare(depths,centroidUV+texelSize*offset.yx,compare);float rt=texture2DCompare(depths,centroidUV+texelSize*offset.yy,compare);vec2 f=fract(uv*size+0.5);float a=mix(lb,lt,f.y);float b=mix(rb,rt,f.y);float c=mix(a,b,f.x);return c;}float getShadow(sampler2D shadowMap,vec2 shadowMapSize,float shadowBias,float shadowRadius,vec4 shadowCoord){float shadow=1.0;shadowCoord.xyz/=shadowCoord.w;shadowCoord.z+=shadowBias;bvec4 inFrustumVec=bvec4(shadowCoord.x>=0.0,shadowCoord.x<=1.0,shadowCoord.y>=0.0,shadowCoord.y<=1.0);bool inFrustum=all(inFrustumVec);bvec2 frustumTestVec=bvec2(inFrustum,shadowCoord.z<=1.0);bool frustumTest=all(frustumTestVec);if(frustumTest){\n#if defined( SHADOWMAP_TYPE_PCF )\nvec2 texelSize=vec2(1.0)/shadowMapSize;float dx0=-texelSize.x*shadowRadius;float dy0=-texelSize.y*shadowRadius;float dx1=+texelSize.x*shadowRadius;float dy1=+texelSize.y*shadowRadius;shadow=(texture2DCompare(shadowMap,shadowCoord.xy+vec2(dx0,dy0),shadowCoord.z)+texture2DCompare(shadowMap,shadowCoord.xy+vec2(0.0,dy0),shadowCoord.z)+texture2DCompare(shadowMap,shadowCoord.xy+vec2(dx1,dy0),shadowCoord.z)+texture2DCompare(shadowMap,shadowCoord.xy+vec2(dx0,0.0),shadowCoord.z)+texture2DCompare(shadowMap,shadowCoord.xy,shadowCoord.z)+texture2DCompare(shadowMap,shadowCoord.xy+vec2(dx1,0.0),shadowCoord.z)+texture2DCompare(shadowMap,shadowCoord.xy+vec2(dx0,dy1),shadowCoord.z)+texture2DCompare(shadowMap,shadowCoord.xy+vec2(0.0,dy1),shadowCoord.z)+texture2DCompare(shadowMap,shadowCoord.xy+vec2(dx1,dy1),shadowCoord.z))*(1.0/9.0);\n#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\nvec2 texelSize=vec2(1.0)/shadowMapSize;float dx0=-texelSize.x*shadowRadius;float dy0=-texelSize.y*shadowRadius;float dx1=+texelSize.x*shadowRadius;float dy1=+texelSize.y*shadowRadius;shadow=(texture2DShadowLerp(shadowMap,shadowMapSize,shadowCoord.xy+vec2(dx0,dy0),shadowCoord.z)+texture2DShadowLerp(shadowMap,shadowMapSize,shadowCoord.xy+vec2(0.0,dy0),shadowCoord.z)+texture2DShadowLerp(shadowMap,shadowMapSize,shadowCoord.xy+vec2(dx1,dy0),shadowCoord.z)+texture2DShadowLerp(shadowMap,shadowMapSize,shadowCoord.xy+vec2(dx0,0.0),shadowCoord.z)+texture2DShadowLerp(shadowMap,shadowMapSize,shadowCoord.xy,shadowCoord.z)+texture2DShadowLerp(shadowMap,shadowMapSize,shadowCoord.xy+vec2(dx1,0.0),shadowCoord.z)+texture2DShadowLerp(shadowMap,shadowMapSize,shadowCoord.xy+vec2(dx0,dy1),shadowCoord.z)+texture2DShadowLerp(shadowMap,shadowMapSize,shadowCoord.xy+vec2(0.0,dy1),shadowCoord.z)+texture2DShadowLerp(shadowMap,shadowMapSize,shadowCoord.xy+vec2(dx1,dy1),shadowCoord.z))*(1.0/9.0);\n#else\nshadow=texture2DCompare(shadowMap,shadowCoord.xy,shadowCoord.z);\n#endif\n}return shadow;}vec2 cubeToUV(vec3 v,float texelSizeY){vec3 absV=abs(v);float scaleToCube=1.0/max(absV.x,max(absV.y,absV.z));absV*=scaleToCube;v*=scaleToCube*(1.0-2.0*texelSizeY);vec2 planar=v.xy;float almostATexel=1.5*texelSizeY;float almostOne=1.0-almostATexel;if(absV.z>=almostOne){if(v.z>0.0)planar.x=4.0-v.x;}else if(absV.x>=almostOne){float signX=sign(v.x);planar.x=v.z*signX+2.0*signX;}else if(absV.y>=almostOne){float signY=sign(v.y);planar.x=v.x+2.0*signY+2.0;planar.y=v.z*signY-2.0;}return vec2(0.125,0.25)*planar+vec2(0.375,0.75);}float getPointShadow(sampler2D shadowMap,vec2 shadowMapSize,float shadowBias,float shadowRadius,vec4 shadowCoord,float shadowCameraNear,float shadowCameraFar){vec2 texelSize=vec2(1.0)/(shadowMapSize*vec2(4.0,2.0));vec3 lightToPosition=shadowCoord.xyz;float dp=(length(lightToPosition)-shadowCameraNear)/(shadowCameraFar-shadowCameraNear);dp+=shadowBias;vec3 bd3D=normalize(lightToPosition);\n#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\nvec2 offset=vec2(-1,1)*shadowRadius*texelSize.y;return(texture2DCompare(shadowMap,cubeToUV(bd3D+offset.xyy,texelSize.y),dp)+texture2DCompare(shadowMap,cubeToUV(bd3D+offset.yyy,texelSize.y),dp)+texture2DCompare(shadowMap,cubeToUV(bd3D+offset.xyx,texelSize.y),dp)+texture2DCompare(shadowMap,cubeToUV(bd3D+offset.yyx,texelSize.y),dp)+texture2DCompare(shadowMap,cubeToUV(bd3D,texelSize.y),dp)+texture2DCompare(shadowMap,cubeToUV(bd3D+offset.xxy,texelSize.y),dp)+texture2DCompare(shadowMap,cubeToUV(bd3D+offset.yxy,texelSize.y),dp)+texture2DCompare(shadowMap,cubeToUV(bd3D+offset.xxx,texelSize.y),dp)+texture2DCompare(shadowMap,cubeToUV(bd3D+offset.yxx,texelSize.y),dp))*(1.0/9.0);\n#else\nreturn texture2DCompare(shadowMap,cubeToUV(bd3D,texelSize.y),dp);\n#endif\n}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n#if NUM_DIR_LIGHTS > 0\nuniform mat4 directionalShadowMatrix[NUM_DIR_LIGHTS];varying vec4 vDirectionalShadowCoord[NUM_DIR_LIGHTS];\n#endif\n#if NUM_SPOT_LIGHTS > 0\nuniform mat4 spotShadowMatrix[NUM_SPOT_LIGHTS];varying vec4 vSpotShadowCoord[NUM_SPOT_LIGHTS];\n#endif\n#if NUM_POINT_LIGHTS > 0\nuniform mat4 pointShadowMatrix[NUM_POINT_LIGHTS];varying vec4 vPointShadowCoord[NUM_POINT_LIGHTS];\n#endif\n/*\n#if NUM_RECT_AREA_LIGHTS > 0\n#endif\n*/\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n#if NUM_DIR_LIGHTS > 0\n#pragma unroll_loop\nfor(int i=0;i<NUM_DIR_LIGHTS;i++){vDirectionalShadowCoord[i]=directionalShadowMatrix[i]*worldPosition;}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n#pragma unroll_loop\nfor(int i=0;i<NUM_SPOT_LIGHTS;i++){vSpotShadowCoord[i]=spotShadowMatrix[i]*worldPosition;}\n#endif\n#if NUM_POINT_LIGHTS > 0\n#pragma unroll_loop\nfor(int i=0;i<NUM_POINT_LIGHTS;i++){vPointShadowCoord[i]=pointShadowMatrix[i]*worldPosition;}\n#endif\n/*\n#if NUM_RECT_AREA_LIGHTS > 0\n#endif\n*/\n#endif\n",shadowmask_pars_fragment:"float getShadowMask(){float shadow=1.0;\n#ifdef USE_SHADOWMAP\n#if NUM_DIR_LIGHTS > 0\nDirectionalLight directionalLight;\n#pragma unroll_loop\nfor(int i=0;i<NUM_DIR_LIGHTS;i++){directionalLight=directionalLights[i];shadow*=bool(directionalLight.shadow)? getShadow(directionalShadowMap[i],directionalLight.shadowMapSize,directionalLight.shadowBias,directionalLight.shadowRadius,vDirectionalShadowCoord[i]): 1.0;}\n#endif\n#if NUM_SPOT_LIGHTS > 0\nSpotLight spotLight;\n#pragma unroll_loop\nfor(int i=0;i<NUM_SPOT_LIGHTS;i++){spotLight=spotLights[i];shadow*=bool(spotLight.shadow)? getShadow(spotShadowMap[i],spotLight.shadowMapSize,spotLight.shadowBias,spotLight.shadowRadius,vSpotShadowCoord[i]): 1.0;}\n#endif\n#if NUM_POINT_LIGHTS > 0\nPointLight pointLight;\n#pragma unroll_loop\nfor(int i=0;i<NUM_POINT_LIGHTS;i++){pointLight=pointLights[i];shadow*=bool(pointLight.shadow)? getPointShadow(pointShadowMap[i],pointLight.shadowMapSize,pointLight.shadowBias,pointLight.shadowRadius,vPointShadowCoord[i],pointLight.shadowCameraNear,pointLight.shadowCameraFar): 1.0;}\n#endif\n/*\n#if NUM_RECT_AREA_LIGHTS > 0\n#endif\n*/\n#endif\nreturn shadow;}",skinbase_vertex:"#ifdef USE_SKINNING\nmat4 boneMatX=getBoneMatrix(skinIndex.x);mat4 boneMatY=getBoneMatrix(skinIndex.y);mat4 boneMatZ=getBoneMatrix(skinIndex.z);mat4 boneMatW=getBoneMatrix(skinIndex.w);\n#endif\n",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 bindMatrix;uniform mat4 bindMatrixInverse;\n#ifdef BONE_TEXTURE\nuniform sampler2D boneTexture;uniform int boneTextureSize;mat4 getBoneMatrix(const in float i){float j=i*4.0;float x=mod(j,float(boneTextureSize));float y=floor(j/float(boneTextureSize));float dx=1.0/float(boneTextureSize);float dy=1.0/float(boneTextureSize);y=dy*(y+0.5);vec4 v1=texture2D(boneTexture,vec2(dx*(x+0.5),y));vec4 v2=texture2D(boneTexture,vec2(dx*(x+1.5),y));vec4 v3=texture2D(boneTexture,vec2(dx*(x+2.5),y));vec4 v4=texture2D(boneTexture,vec2(dx*(x+3.5),y));mat4 bone=mat4(v1,v2,v3,v4);return bone;}\n#else\nuniform mat4 boneMatrices[MAX_BONES];mat4 getBoneMatrix(const in float i){mat4 bone=boneMatrices[int(i)];return bone;}\n#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\nvec4 skinVertex=bindMatrix*vec4(transformed,1.0);vec4 skinned=vec4(0.0);skinned+=boneMatX*skinVertex*skinWeight.x;skinned+=boneMatY*skinVertex*skinWeight.y;skinned+=boneMatZ*skinVertex*skinWeight.z;skinned+=boneMatW*skinVertex*skinWeight.w;transformed=(bindMatrixInverse*skinned).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\nmat4 skinMatrix=mat4(0.0);skinMatrix+=skinWeight.x*boneMatX;skinMatrix+=skinWeight.y*boneMatY;skinMatrix+=skinWeight.z*boneMatZ;skinMatrix+=skinWeight.w*boneMatW;skinMatrix=bindMatrixInverse*skinMatrix*bindMatrix;objectNormal=vec4(skinMatrix*vec4(objectNormal,0.0)).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\nvec4 texelSpecular=texture2D(specularMap,vUv);specularStrength=texelSpecular.r;\n#else\nspecularStrength=1.0;\n#endif\n",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\nuniform sampler2D specularMap;\n#endif\n",tonemapping_fragment:"#if defined( TONE_MAPPING )\ngl_FragColor.rgb=toneMapping(gl_FragColor.rgb);\n#endif\n",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;uniform float toneMappingWhitePoint;vec3 LinearToneMapping(vec3 color){return toneMappingExposure*color;}vec3 ReinhardToneMapping(vec3 color){color*=toneMappingExposure;return saturate(color/(vec3(1.0)+color));}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping(vec3 color){color*=toneMappingExposure;return saturate(Uncharted2Helper(color)/Uncharted2Helper(vec3(toneMappingWhitePoint)));}vec3 OptimizedCineonToneMapping(vec3 color){color*=toneMappingExposure;color=max(vec3(0.0),color-0.004);return pow((color*(6.2*color+0.5))/(color*(6.2*color+1.7)+0.06),vec3(2.2));}",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\nvarying vec2 vUv;\n#endif\n",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\nvarying vec2 vUv;uniform mat3 uvTransform;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\nvUv=(uvTransform*vec3(uv,1)).xy;\n#endif\n",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\nvarying vec2 vUv2;\n#endif\n",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\nattribute vec2 uv2;varying vec2 vUv2;\n#endif\n",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\nvUv2=uv2;\n#endif\n",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\nvec4 worldPosition=modelMatrix*vec4(transformed,1.0);\n#endif\n",cube_frag:"uniform samplerCube tCube;uniform float tFlip;uniform float opacity;varying vec3 vWorldPosition;void main(){gl_FragColor=textureCube(tCube,vec3(tFlip*vWorldPosition.x,vWorldPosition.yz));gl_FragColor.a*=opacity;}",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main(){vWorldPosition=transformDirection(position,modelMatrix);\n#include <begin_vertex>\n#include <project_vertex>\ngl_Position.z=gl_Position.w;}",depth_frag:"#if DEPTH_PACKING == 3200\nuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main(){\n#include <clipping_planes_fragment>\nvec4 diffuseColor=vec4(1.0);\n#if DEPTH_PACKING == 3200\ndiffuseColor.a=opacity;\n#endif\n#include <map_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\n#include <logdepthbuf_fragment>\n#if DEPTH_PACKING == 3200\ngl_FragColor=vec4(vec3(1.0-gl_FragCoord.z),opacity);\n#elif DEPTH_PACKING == 3201\ngl_FragColor=packDepthToRGBA(gl_FragCoord.z);\n#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main(){\n#include <uv_vertex>\n#include <skinbase_vertex>\n#ifdef USE_DISPLACEMENTMAP\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinnormal_vertex>\n#endif\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;uniform float nearDistance;uniform float farDistance;varying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main(){\n#include <clipping_planes_fragment>\nvec4 diffuseColor=vec4(1.0);\n#include <map_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\nfloat dist=length(vWorldPosition-referencePosition);dist=(dist-nearDistance)/(farDistance-nearDistance);dist=saturate(dist);gl_FragColor=packDepthToRGBA(dist);}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main(){\n#include <uv_vertex>\n#include <skinbase_vertex>\n#ifdef USE_DISPLACEMENTMAP\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinnormal_vertex>\n#endif\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <worldpos_vertex>\n#include <clipping_planes_vertex>\nvWorldPosition=worldPosition.xyz;}",equirect_frag:"uniform sampler2D tEquirect;varying vec3 vWorldPosition;\n#include <common>\nvoid main(){vec3 direction=normalize(vWorldPosition);vec2 sampleUV;sampleUV.y=asin(clamp(direction.y,-1.0,1.0))*RECIPROCAL_PI+0.5;sampleUV.x=atan(direction.z,direction.x)*RECIPROCAL_PI2+0.5;gl_FragColor=texture2D(tEquirect,sampleUV);}",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main(){vWorldPosition=transformDirection(position,modelMatrix);\n#include <begin_vertex>\n#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;uniform float opacity;uniform float dashSize;uniform float totalSize;varying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main(){\n#include <clipping_planes_fragment>\nif(mod(vLineDistance,totalSize)>dashSize){discard;}vec3 outgoingLight=vec3(0.0);vec4 diffuseColor=vec4(diffuse,opacity);\n#include <logdepthbuf_fragment>\n#include <color_fragment>\noutgoingLight=diffuseColor.rgb;gl_FragColor=vec4(outgoingLight,diffuseColor.a);\n#include <premultiplied_alpha_fragment>\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;attribute float lineDistance;varying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main(){\n#include <color_vertex>\nvLineDistance=scale*lineDistance;vec4 mvPosition=modelViewMatrix*vec4(position,1.0);gl_Position=projectionMatrix*mvPosition;\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;uniform float opacity;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main(){\n#include <clipping_planes_fragment>\nvec4 diffuseColor=vec4(diffuse,opacity);\n#include <logdepthbuf_fragment>\n#include <map_fragment>\n#include <color_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\n#include <specularmap_fragment>\nReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));\n#ifdef USE_LIGHTMAP\nreflectedLight.indirectDiffuse+=texture2D(lightMap,vUv2).xyz*lightMapIntensity;\n#else\nreflectedLight.indirectDiffuse+=vec3(1.0);\n#endif\n#include <aomap_fragment>\nreflectedLight.indirectDiffuse*=diffuseColor.rgb;vec3 outgoingLight=reflectedLight.indirectDiffuse;\n#include <envmap_fragment>\ngl_FragColor=vec4(outgoingLight,diffuseColor.a);\n#include <premultiplied_alpha_fragment>\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main(){\n#include <uv_vertex>\n#include <uv2_vertex>\n#include <color_vertex>\n#include <skinbase_vertex>\n#ifdef USE_ENVMAP\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#endif\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <worldpos_vertex>\n#include <clipping_planes_vertex>\n#include <envmap_vertex>\n#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;uniform vec3 emissive;uniform float opacity;varying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main(){\n#include <clipping_planes_fragment>\nvec4 diffuseColor=vec4(diffuse,opacity);ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));vec3 totalEmissiveRadiance=emissive;\n#include <logdepthbuf_fragment>\n#include <map_fragment>\n#include <color_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\n#include <specularmap_fragment>\n#include <emissivemap_fragment>\nreflectedLight.indirectDiffuse=getAmbientLightIrradiance(ambientLightColor);\n#include <lightmap_fragment>\nreflectedLight.indirectDiffuse*=BRDF_Diffuse_Lambert(diffuseColor.rgb);\n#ifdef DOUBLE_SIDED\nreflectedLight.directDiffuse=(gl_FrontFacing)? vLightFront : vLightBack;\n#else\nreflectedLight.directDiffuse=vLightFront;\n#endif\nreflectedLight.directDiffuse*=BRDF_Diffuse_Lambert(diffuseColor.rgb)*getShadowMask();\n#include <aomap_fragment>\nvec3 outgoingLight=reflectedLight.directDiffuse+reflectedLight.indirectDiffuse+totalEmissiveRadiance;\n#include <envmap_fragment>\ngl_FragColor=vec4(outgoingLight,diffuseColor.a);\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n#include <premultiplied_alpha_fragment>\n#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main(){\n#include <uv_vertex>\n#include <uv2_vertex>\n#include <color_vertex>\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n#include <worldpos_vertex>\n#include <envmap_vertex>\n#include <lights_lambert_vertex>\n#include <shadowmap_vertex>\n#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;uniform vec3 emissive;uniform vec3 specular;uniform float shininess;uniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main(){\n#include <clipping_planes_fragment>\nvec4 diffuseColor=vec4(diffuse,opacity);ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));vec3 totalEmissiveRadiance=emissive;\n#include <logdepthbuf_fragment>\n#include <map_fragment>\n#include <color_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\n#include <specularmap_fragment>\n#include <normal_fragment_begin>\n#include <normal_fragment_maps>\n#include <emissivemap_fragment>\n#include <lights_phong_fragment>\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n#include <aomap_fragment>\nvec3 outgoingLight=reflectedLight.directDiffuse+reflectedLight.indirectDiffuse+reflectedLight.directSpecular+reflectedLight.indirectSpecular+totalEmissiveRadiance;\n#include <envmap_fragment>\ngl_FragColor=vec4(outgoingLight,diffuseColor.a);\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n#include <premultiplied_alpha_fragment>\n#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main(){\n#include <uv_vertex>\n#include <uv2_vertex>\n#include <color_vertex>\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\nvNormal=normalize(transformedNormal);\n#endif\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\nvViewPosition=-mvPosition.xyz;\n#include <worldpos_vertex>\n#include <envmap_vertex>\n#include <shadowmap_vertex>\n#include <fog_vertex>\n}",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;uniform vec3 emissive;uniform float roughness;uniform float metalness;uniform float opacity;\n#ifndef STANDARD\nuniform float clearCoat;uniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main(){\n#include <clipping_planes_fragment>\nvec4 diffuseColor=vec4(diffuse,opacity);ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));vec3 totalEmissiveRadiance=emissive;\n#include <logdepthbuf_fragment>\n#include <map_fragment>\n#include <color_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\n#include <roughnessmap_fragment>\n#include <metalnessmap_fragment>\n#include <normal_fragment_begin>\n#include <normal_fragment_maps>\n#include <emissivemap_fragment>\n#include <lights_physical_fragment>\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n#include <aomap_fragment>\nvec3 outgoingLight=reflectedLight.directDiffuse+reflectedLight.indirectDiffuse+reflectedLight.directSpecular+reflectedLight.indirectSpecular+totalEmissiveRadiance;gl_FragColor=vec4(outgoingLight,diffuseColor.a);\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n#include <premultiplied_alpha_fragment>\n#include <dithering_fragment>\n}",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main(){\n#include <uv_vertex>\n#include <uv2_vertex>\n#include <color_vertex>\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\nvNormal=normalize(transformedNormal);\n#endif\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\nvViewPosition=-mvPosition.xyz;\n#include <worldpos_vertex>\n#include <shadowmap_vertex>\n#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main(){\n#include <logdepthbuf_fragment>\n#include <normal_fragment_begin>\n#include <normal_fragment_maps>\ngl_FragColor=vec4(packNormalToRGB(normal),opacity);}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main(){\n#include <uv_vertex>\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\nvNormal=normalize(transformedNormal);\n#endif\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvViewPosition=-mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;uniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main(){\n#include <clipping_planes_fragment>\nvec3 outgoingLight=vec3(0.0);vec4 diffuseColor=vec4(diffuse,opacity);\n#include <logdepthbuf_fragment>\n#include <map_particle_fragment>\n#include <color_fragment>\n#include <alphatest_fragment>\noutgoingLight=diffuseColor.rgb;gl_FragColor=vec4(outgoingLight,diffuseColor.a);\n#include <premultiplied_alpha_fragment>\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n}",points_vert:"uniform float size;uniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main(){\n#include <color_vertex>\n#include <begin_vertex>\n#include <project_vertex>\n#ifdef USE_SIZEATTENUATION\ngl_PointSize=size*(scale/-mvPosition.z);\n#else\ngl_PointSize=size;\n#endif\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n#include <worldpos_vertex>\n#include <shadowmap_vertex>\n#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;uniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main(){gl_FragColor=vec4(color,opacity*(1.0-getShadowMask()));\n#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main(){\n#include <begin_vertex>\n#include <project_vertex>\n#include <worldpos_vertex>\n#include <shadowmap_vertex>\n#include <fog_vertex>\n}"},La={merge:function(e){for(var t={},r=0,a;r<e.length;r++)for(var i in a=this.clone(e[r]),a)t[i]=a[i];return t},clone:function(e){var t={};for(var r in e)for(var a in t[r]={},e[r]){var i=e[r][a];t[r][a]=i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?i.clone():Array.isArray(i)?i.slice():i}return t}},wa={common:{diffuse:{value:new _(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new o},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new c(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new _(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new _(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new o}}},Aa={basic:{uniforms:La.merge([wa.common,wa.specularmap,wa.envmap,wa.aomap,wa.lightmap,wa.fog]),vertexShader:Ta.meshbasic_vert,fragmentShader:Ta.meshbasic_frag},lambert:{uniforms:La.merge([wa.common,wa.specularmap,wa.envmap,wa.aomap,wa.lightmap,wa.emissivemap,wa.fog,wa.lights,{emissive:{value:new _(0)}}]),vertexShader:Ta.meshlambert_vert,fragmentShader:Ta.meshlambert_frag},phong:{uniforms:La.merge([wa.common,wa.specularmap,wa.envmap,wa.aomap,wa.lightmap,wa.emissivemap,wa.bumpmap,wa.normalmap,wa.displacementmap,wa.gradientmap,wa.fog,wa.lights,{emissive:{value:new _(0)},specular:{value:new _(1118481)},shininess:{value:30}}]),vertexShader:Ta.meshphong_vert,fragmentShader:Ta.meshphong_frag},standard:{uniforms:La.merge([wa.common,wa.envmap,wa.aomap,wa.lightmap,wa.emissivemap,wa.bumpmap,wa.normalmap,wa.displacementmap,wa.roughnessmap,wa.metalnessmap,wa.fog,wa.lights,{emissive:{value:new _(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Ta.meshphysical_vert,fragmentShader:Ta.meshphysical_frag},points:{uniforms:La.merge([wa.points,wa.fog]),vertexShader:Ta.points_vert,fragmentShader:Ta.points_frag},dashed:{uniforms:La.merge([wa.common,wa.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ta.linedashed_vert,fragmentShader:Ta.linedashed_frag},depth:{uniforms:La.merge([wa.common,wa.displacementmap]),vertexShader:Ta.depth_vert,fragmentShader:Ta.depth_frag},normal:{uniforms:La.merge([wa.common,wa.bumpmap,wa.normalmap,wa.displacementmap,{opacity:{value:1}}]),vertexShader:Ta.normal_vert,fragmentShader:Ta.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ta.cube_vert,fragmentShader:Ta.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ta.equirect_vert,fragmentShader:Ta.equirect_frag},distanceRGBA:{uniforms:La.merge([wa.common,wa.displacementmap,{referencePosition:{value:new n},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ta.distanceRGBA_vert,fragmentShader:Ta.distanceRGBA_frag},shadow:{uniforms:La.merge([wa.lights,wa.fog,{color:{value:new _(0)},opacity:{value:1}}]),vertexShader:Ta.shadow_vert,fragmentShader:Ta.shadow_frag}};Aa.physical={uniforms:La.merge([Aa.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Ta.meshphysical_vert,fragmentShader:Ta.meshphysical_frag},Ze.prototype=Object.assign(Object.create(d.prototype),{constructor:Ze,isOrthographicCamera:!0,copy:function(e,t){return d.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,r,a,i,n){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=a,this.view.width=i,this.view.height=n,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,a=(this.top+this.bottom)/2,i=r-e,n=r+e,o=a+t,s=a-t;if(null!==this.view&&this.view.enabled){var d=this.zoom/(this.view.width/this.view.fullWidth),l=this.zoom/(this.view.height/this.view.fullHeight),c=(this.right-this.left)/this.view.width,p=(this.top-this.bottom)/this.view.height;i+=c*(this.view.offsetX/d),n=i+c*(this.view.width/d),o-=p*(this.view.offsetY/l),s=o-p*(this.view.height/l)}this.projectionMatrix.makeOrthographic(i,n,o,s,this.near,this.far)},toJSON:function(e){var t=s.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),Qe.prototype=Object.create(z.prototype),Qe.prototype.constructor=Qe,Je.prototype=Object.create(N.prototype),Je.prototype.constructor=Je,Ke.prototype=Object.create(v.prototype),Ke.prototype.constructor=Ke,Ke.prototype.isShaderMaterial=!0,Ke.prototype.copy=function(e){return v.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=La.clone(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},Ke.prototype.toJSON=function(e){var t=v.prototype.toJSON.call(this,e);return t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},ct.prototype=Object.create(Xe.prototype),ct.prototype.constructor=ct,ct.prototype.isCubeTexture=!0,Object.defineProperty(ct.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});var Ra=new Xe,Pa=new ct,Ca=[],Da=[],Ua=new Float32Array(16),Na=new Float32Array(9);Vt.prototype.setValue=function(e,t){for(var r=this.seq,a=0,o=r.length,n;a!==o;++a)n=r[a],n.setValue(e,t[n.id])};var Ia=/([\w\d_]+)(\])?(\[|\.)?/g;Wt.prototype.setValue=function(e,t,r){var a=this.map[t];a!==void 0&&a.setValue(e,r,this.renderer)},Wt.prototype.setOptional=function(e,t,r){var a=t[r];a!==void 0&&this.setValue(e,r,a)},Wt.upload=function(e,t,r,a){for(var o=0,s=t.length;o!==s;++o){var n=t[o],d=r[n.id];!1!==d.needsUpdate&&n.setValue(e,d.value,a)}},Wt.seqWithValue=function(e,t){for(var a=[],r=0,o=e.length,n;r!==o;++r)n=e[r],n.id in t&&a.push(n);return a};var za=0,Fa=0;hr.prototype=Object.assign(Object.create(r.prototype),{constructor:hr,isWebGLRenderTarget:!0,setSize:function(e,t){(this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),_r.prototype=Object.create(v.prototype),_r.prototype.constructor=_r,_r.prototype.isMeshDepthMaterial=!0,_r.prototype.copy=function(e){return v.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},xr.prototype=Object.create(v.prototype),xr.prototype.constructor=xr,xr.prototype.isMeshDistanceMaterial=!0,xr.prototype.copy=function(e){return v.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},vr.prototype=Object.create(Xe.prototype),vr.prototype.constructor=vr,Tr.prototype=Object.assign(Object.create(l.prototype),{constructor:Tr,isArrayCamera:!0}),Ar.prototype=Object.create(Xe.prototype),Ar.prototype.constructor=Ar,Ar.prototype.isDepthTexture=!0;class Ba extends wr{constructor(e){super(Object.assign({antialias:!0},e)),this.filters=[],this._renderTargets=new Map;let t=new hr(this.domElement.width,this.domElement.height,{format:1023,minFilter:ra,magFilter:ra,stencilBuffer:!1});t.texture.generateMipmaps=!1;let r=t.clone();r.texture.generateMipmaps=!1,this.context.getExtension("WEBGL_depth_texture")&&(t.depthTexture=new Ar,t.depthTexture.type=aa,r.depthTexture=new Ar,r.depthTexture.type=aa),this._renderTargets.set(this,{in:t,out:r}),this.scene=new G,this.scene.camera=new Ze(-1,1,1,-1,0,1),this._quad=new I(new Je(2,2)),this._quad.frustumCulled=!1,this.scene.add(this._quad),this._render=this.render,delete this.render}applyFilter(e,t,r){this._quad.material=e,e.renderTargetTexture&&(e.renderTargetTexture=t.texture),e.renderTargetDepthTexture&&t.depthTexture&&(e.renderTargetDepthTexture=t.depthTexture),this._render(this.scene,this.scene.camera,r)}resize(e,t){this.setSize(e,t,!1);let r=this._renderTargets.get(this);r.in.setSize(e,t),r.out.setSize(e,t)}render({scene:e,camera:t,filters:n=this.filters,renderTarget:r,viewport:a,scissor:i=a}={}){if(1<arguments.length)return void this._render(...arguments);let o=this._renderTargets.get(r||this);o||(o={in:r.clone(),out:r.clone()},o.in.texture.generateMipmaps=!1,o.out.texture.generateMipmaps=!1,this._renderTargets.set(r,o)),a||i?(a&&(r?r.viewport.set(a[0],a[1],a[2],a[3]):this.setViewport(a[0],a[1],a[2],a[3])),r?(r.scissor.set(i[0],i[1],i[2],i[3]),r.scissorTest=!0):(this.setScissor(i[0],i[1],i[2],i[3]),this.setScissorTest(!0))):r?(r.viewport.set(0,0,r.width,r.height),r.scissor.set(0,0,r.width,r.height),r.scissorTest=!1):(this.setViewport(0,0,this.domElement.width,this.domElement.height),this.setScissor(0,0,this.domElement.width,this.domElement.height),this.setScissorTest(!1)),e&&(t=t||e.camera,this._render(e,t,n.length?o.in:r));for(let[s,d]of n.entries())this.applyFilter(d,o.in,s<n.length-1?o.out:r),[o.in,o.out]=[o.out,o.in]}}class Oa{static add(e="void main() {}",t){for(let[r,a]of t)e="start"===r?e.replace(/^(#version .*?\n(\s*precision highp float;\s)?)?([\s\S]*)/,`$1\n${a}\n$3`):"end"===r?e.replace(/(}\s*$)/,`\n${a}\n$1`):"main"===r?e.replace(/(\bvoid\b +\bmain\b[\s\S]*?{\s*)/,`$1\n${a}\n`):e.replace(r,a);return e}constructor({vertexShader:e=`#version 300 es
      void main() {
        gl_Position = vec4(0., 0., 0., 1.);
      }
    `,fragmentShader:t=`#version 300 es
      precision highp float;

      out vec4 fragColor;

      void main() {
        fragColor = vec4(1.);
      }
    `,dataTypeConctructors:r={Vector2:class extends Float32Array{constructor(){super(2)}},Vector3:class extends Float32Array{constructor(){super(3)}},Vector4:class extends Float32Array{constructor(){super(4)}},Matrix3:class extends Float32Array{constructor(){super([1,0,0,0,1,0,0,0,1])}},Matrix4:class extends Float32Array{constructor(){super([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},Texture:class{},TextureCube:class{}},uniforms:a=[],vertexShaderChunks:i=[],fragmentShaderChunks:n=[],shaders:o=[]}={}){this.uniforms=new Map,this.uniformTypes=new Map,this._dataTypeConctructors=r,this.vertexShader=e,this.fragmentShader=t,this._vertexShaderChunks=[],this._fragmentShaderChunks=[],this.add({vertexShaderChunks:i,fragmentShaderChunks:n,uniforms:a});for(let s of o)this.add(s)}add({vertexShaderChunks:e=[],fragmentShaderChunks:t=[],uniforms:r=[]}={}){this.vertexShader=Oa.add(this.vertexShader,e),this._vertexShaderChunks.push(...e),this.fragmentShader=Oa.add(this.fragmentShader,t),this._fragmentShaderChunks.push(...t);for(let[a,i]of r)this.uniforms.set(a,i)}set vertexShader(e){this._vertexShader=e,this._parseUniforms(this._vertexShader)}get vertexShader(){return this._vertexShader}set fragmentShader(e){this._fragmentShader=e,this._parseUniforms(this._fragmentShader)}get fragmentShader(){return this._fragmentShader}get vertexShaderChunks(){return this._vertexShaderChunks}get fragmentShaderChunks(){return this._fragmentShaderChunks}_addUniform(e,t,r){if(this.uniforms.has(e))return;let a,i;if(this.uniformTypes.set(e,t),/float|double/.test(t))a=isNaN(r)?0:Array(r).fill(0);else if(/int|uint/.test(t))a=isNaN(r)?0:Array(r).fill(0);else if(/sampler2D/.test(t))a=isNaN(r)?new this._dataTypeConctructors.Texture:Array(r).fill().map(()=>new this._dataTypeConctructors.Texture);else if(/samplerCube/.test(t))a=isNaN(r)?new this._dataTypeConctructors.TextureCube:Array(r).fill().map(()=>new this._dataTypeConctructors.TextureCube);else if(i=/(.?)vec(\d)/.exec(t)){let e=i[2];a=isNaN(r)?new this._dataTypeConctructors[`Vector${e}`]:Array(r).fill().map(()=>new this._dataTypeConctructors[`Vector${e}`])}else if(i=/mat(\d)/.exec(t)){let e=i[1];a=isNaN(r)?new this._dataTypeConctructors[`Matrix${e}`]:Array(r).fill().map(()=>new this._dataTypeConctructors[`Matrix${e}`])}else a=void 0;this.uniforms.set(e,a)}_parseUniforms(e){const t=new Map,r=/struct\s*(.*)\s*{\s*([\s\S]*?)}/g,a=/^\s*(.[^ ]+) (.[^ ;\[\]]+)\[? *(\d+)? *\]?/gm;for(let i;i=r.exec(e);){const e=i[1],r=i[2],n={};for(let e;e=a.exec(r);){const[,t,r,a]=e,i=parseInt(a);n[r]={type:t,arrayLength:i}}t.set(e,n)}const i=/^\s*uniform (.[^ ]+) (.[^ ;\[\]]+)\[? *(\d+)? *\]?/gm;for(let r;r=i.exec(e);){const[,e,a,i]=r,n=parseInt(i),o=t.get(e);if(o)for(const e in o)this._addUniform(`${a}.${e}`,o[e].type,o[e].arrayLength);else this._addUniform(a,e,n)}}}class Ga extends Oa{constructor({vertexShader:r=`
    void main() {
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.);
    }
  `,fragmentShader:a=`
    void main() {
      gl_FragColor = vec4(1.);
    }
  `,uniforms:e,shaders:t}={}){super({vertexShader:r,fragmentShader:a,uniforms:e,shaders:t,dataTypeConctructors:{Vector2:THREE.Vector2,Vector3:THREE.Vector3,Vector4:THREE.Vector4,Matrix3:THREE.Matrix3,Matrix4:THREE.Matrix4,Texture:THREE.Texture,TextureCube:THREE.CubeTexture}})}add({vertexShaderChunks:e=[],fragmentShaderChunks:t=[],uniforms:r=[]}={}){if(!(r instanceof Array||r instanceof Map)){const e=r;for(let t in r=new Map,e)r.set(t,void 0===e[t].value?e[t]:e[t].value)}if(!(this.uniforms instanceof Array||this.uniforms instanceof Map)){const e=this.uniforms;for(let t in this.uniforms=new Map,e)this.uniforms.set(t,void 0===e[t].value?e[t]:e[t].value)}super.add({vertexShaderChunks:e,fragmentShaderChunks:t,uniforms:r});const a={};for(let[i,n]of this.uniforms)a[i]={value:n};this.uniforms=a}}class Va extends Ke{constructor(e={}){let t=e.type||"",r=e.vertexShaderChunks,a=e.fragmentShaderChunks,i=e.uniforms,n=e.shaders||[];e=Object.assign({},e),delete e.type,delete e.vertexShaderChunks,delete e._vertexShaderChunks,delete e._vertexShader,delete e.fragmentShaderChunks,delete e._fragmentShaderChunks,delete e._fragmentShader,delete e.uniforms,delete e.attributes,delete e.shaders;let o=new Ga({vertexShader:e.vertexShader||(t?THREE.ShaderLib[t].vertexShader:void 0),fragmentShader:e.fragmentShader||(t?THREE.ShaderLib[t].fragmentShader:void 0),uniforms:t?THREE.UniformsUtils.clone(THREE.ShaderLib[t].uniforms):void 0});super(Object.assign({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:o.uniforms},e)),this.defines={[t.toUpperCase()]:""},this._shader=o,this.add({vertexShaderChunks:r,fragmentShaderChunks:a,uniforms:i});for(let t of n)this.add(t);this.lights=/lambert|phong|standard/.test(t),this.envMap&&(this.envMap=this.envMap)}add({vertexShaderChunks:e,fragmentShaderChunks:t,uniforms:r}){for(let a in this._shader.add({vertexShaderChunks:e,fragmentShaderChunks:t,uniforms:r}),this.fragmentShader=this._shader.fragmentShader,this.vertexShader=this._shader.vertexShader,this._shader.uniforms){let e=a;this.uniforms[e]=this._shader.uniforms[e];let t;t="envMap"==e?function(t){t&&t.generateMipmaps&&t.image&&(this.maxMipLevel=Math.log2(kr(t.image.width,t.image.height))),this.uniforms[e].value=t}:function(t){this.uniforms[e].value=t},Object.defineProperty(this,e,{configurable:!0,get:function(){return this.uniforms[e].value},set:t})}this.needsUpdate=!0}}class Ha{static vertex(){return`
      varying vec2 v_rgbNW;
      varying vec2 v_rgbNE;
      varying vec2 v_rgbSW;
      varying vec2 v_rgbSE;
      varying vec2 v_rgbM;

      void computeFXAATextureCoordinates(vec2 uv, vec2 resolution) {
        vec2 inverseVP = 1.0 / resolution.xy;
        vec2 fragCoord = uv * resolution;
        v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
        v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
        v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
        v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
        v_rgbM = vec2(fragCoord * inverseVP);
      }
    `}static fragment(){return`
      varying vec2 v_rgbNW;
      varying vec2 v_rgbNE;
      varying vec2 v_rgbSW;
      varying vec2 v_rgbSE;
      varying vec2 v_rgbM;

      #ifndef FXAA_REDUCE_MIN
      #define FXAA_REDUCE_MIN   (1.0/ 128.0)
      #endif
      #ifndef FXAA_REDUCE_MUL
      #define FXAA_REDUCE_MUL   (1.0 / 8.0)
      #endif
      #ifndef FXAA_SPAN_MAX
      #define FXAA_SPAN_MAX     8.0
      #endif

      vec4 fxaa(sampler2D tex, vec2 uv, vec2 resolution) {
        vec4 color;
        vec2 fragCoord = uv * resolution;
        mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);
        vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
        vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
        vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
        vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
        vec4 texColor = texture2D(tex, v_rgbM);
        vec3 rgbM  = texColor.xyz;
        vec3 luma = vec3(0.299, 0.587, 0.114);
        float lumaNW = dot(rgbNW, luma);
        float lumaNE = dot(rgbNE, luma);
        float lumaSW = dot(rgbSW, luma);
        float lumaSE = dot(rgbSE, luma);
        float lumaM  = dot(rgbM,  luma);
        float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
        float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

        mediump vec2 dir;
        dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
        dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

        float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
        (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

        float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
        dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
        max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
        dir * rcpDirMin)) * inverseVP;

        vec3 rgbA = 0.5 * (
        texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
        texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
        vec3 rgbB = rgbA * 0.5 + 0.25 * (
          texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
          texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

        float lumaB = dot(rgbB, luma);
        if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
        else
        color = vec4(rgbB, texColor.a);
        return color;
      }
    `}}class ka extends Ba{constructor(e){super(e),!1===e.antialias||this.context.getContextAttributes().antialias||this.filters.push(this.fxaaFilter=new Va({vertexShader:`
          uniform vec2 resolution;
          varying vec2 vUv;
          ${Ha.vertex()}
          void main() {
            computeFXAATextureCoordinates(uv, resolution);
            vUv = uv;
            gl_Position = vec4(position, 1.);
          }
        `,fragmentShader:`
          uniform vec2 resolution;
          uniform sampler2D renderTargetTexture;
          varying vec2 vUv;
          ${Ha.fragment()}
          void main() {
            gl_FragColor = fxaa(renderTargetTexture, vUv, resolution);
          }
        `}))}resize(e,t){e*=window.devicePixelRatio,t*=window.devicePixelRatio,super.resize(e,t),this.fxaaFilter&&this.fxaaFilter.resolution.set(e,t)}}window.customElements.define("dnit-main",class extends jr{connectedCallback(){super.connectedCallback(),this.innerHTML=`
      <style>
        @import "src/main/index.css";
      </style>
      <canvas></canvas>
    `,this.canvas=this.querySelector("canvas"),this.renderer=new ka({canvas:this.canvas}),this.scene=new Ma({canvas:this.canvas}),this.querySelector("style").addEventListener("load",()=>{this.dispatchEvent(new Event("load")),this.resize(),this.play()}),window.addEventListener("resize",this._resizeBinded=this.resize.bind(this))}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("resize",this._resizeBinded)}resize(){let e=this.canvas.offsetWidth,t=this.canvas.offsetHeight;this.scene.resize(e,t),this.renderer.resize(e,t),this.renderer.render({scene:this.scene})}update(){this.scene.update(),this.renderer.render({scene:this.scene})}})})();